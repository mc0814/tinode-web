{"version":3,"file":"index.prod.js","mappings":"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","sources":["webpack://im/webpack/runtime/create fake namespace object","webpack://im/webpack/runtime/load script","webpack://im/./src/config.js","webpack://im/./src/lib/blob-helpers.js","webpack://im/./src/lib/local-storage.js","webpack://im/./src/lib/navigation.js","webpack://im/./src/lib/strformat.js","webpack://im/./src/lib/utils.js","webpack://im/./src/version.js","webpack://im/./src/widgets/audio-player.jsx","webpack://im/./src/widgets/cropper.jsx","webpack://im/./src/widgets/avatar-crop.jsx","webpack://im/./src/widgets/avatar-upload.jsx","webpack://im/./src/widgets/badge-list.jsx","webpack://im/./src/widgets/checkbox.jsx","webpack://im/./src/widgets/letter-tile.jsx","webpack://im/./src/widgets/load-spinner.jsx","webpack://im/./src/widgets/visible-password.jsx","webpack://im/./node_modules/react-dom/client.js","webpack://im/external var \"React\"","webpack://im/external var \"ReactDOM\"","webpack://im/external var \"ReactIntl\"","webpack://im/external var \"tinode\"","webpack://im/webpack/bootstrap","webpack://im/webpack/runtime/compat get default export","webpack://im/webpack/runtime/define property getters","webpack://im/webpack/runtime/ensure chunk","webpack://im/webpack/runtime/get javascript chunk filename","webpack://im/webpack/runtime/global","webpack://im/webpack/runtime/hasOwnProperty shorthand","webpack://im/webpack/runtime/make namespace object","webpack://im/webpack/runtime/publicPath","webpack://im/webpack/runtime/jsonp chunk loading","webpack://im/./node_modules/@firebase/util/dist/postinstall.mjs","webpack://im/./node_modules/@firebase/util/dist/index.esm2017.js","webpack://im/./node_modules/@firebase/component/dist/esm/index.esm2017.js","webpack://im/./node_modules/@firebase/logger/dist/esm/index.esm2017.js","webpack://im/./node_modules/idb/build/wrap-idb-value.js","webpack://im/./node_modules/idb/build/index.js","webpack://im/./node_modules/@firebase/app/dist/esm/index.esm2017.js","webpack://im/./node_modules/firebase/app/dist/esm/index.esm.js","webpack://im/./node_modules/@firebase/installations/dist/esm/index.esm2017.js","webpack://im/./node_modules/@firebase/messaging/dist/esm/index.esm2017.js","webpack://im/./src/widgets/alert.jsx","webpack://im/./src/widgets/context-menu.jsx","webpack://im/./src/widgets/contact-badges.jsx","webpack://im/./src/widgets/unread-badge.jsx","webpack://im/./src/widgets/call-message.jsx","webpack://im/./src/widgets/call-status.jsx","webpack://im/./src/widgets/inline-video.jsx","webpack://im/./src/widgets/lazy-image.jsx","webpack://im/./src/widgets/file-progress.jsx","webpack://im/./src/widgets/uploading-image.jsx","webpack://im/./src/lib/formatters.js","webpack://im/./src/widgets/contact.jsx","webpack://im/./src/widgets/contact-action.jsx","webpack://im/./src/widgets/contact-list.jsx","webpack://im/./src/widgets/search-contacts.jsx","webpack://im/./src/widgets/forward-dialog.jsx","webpack://im/./src/constants.js","webpack://im/./src/widgets/call-incoming.jsx","webpack://im/./src/widgets/menu-cancel.jsx","webpack://im/./src/widgets/error-panel.jsx","webpack://im/./src/widgets/chip.jsx","webpack://im/./src/widgets/chip-input.jsx","webpack://im/./src/widgets/group-manager.jsx","webpack://im/./src/widgets/permissions-editor.jsx","webpack://im/external var \"QRCode\"","webpack://im/./src/widgets/show-qrcode.jsx","webpack://im/./src/widgets/in-place-edit.jsx","webpack://im/./src/widgets/tag-manager.jsx","webpack://im/./src/widgets/topic-desc-edit.jsx","webpack://im/./src/views/topic-common-view.jsx","webpack://im/./src/widgets/topic-security.jsx","webpack://im/./src/views/info-view.jsx","webpack://im/./src/widgets/call-panel.jsx","webpack://im/./src/widgets/attachment.jsx","webpack://im/./src/widgets/received-marker.jsx","webpack://im/./src/widgets/chat-message.jsx","webpack://im/./src/widgets/send-message.jsx","webpack://im/./src/widgets/doc-preview.jsx","webpack://im/./src/widgets/group-subs.jsx","webpack://im/./src/widgets/image-preview.jsx","webpack://im/./src/widgets/invitation.jsx","webpack://im/./src/views/logo-view.jsx","webpack://im/./src/widgets/meta-message.jsx","webpack://im/./src/widgets/pinned-messages.jsx","webpack://im/./src/widgets/video-preview.jsx","webpack://im/./src/views/messages-view.jsx","webpack://im/./src/widgets/button-back.jsx","webpack://im/./src/widgets/menu-contacts.jsx","webpack://im/./src/widgets/menu-start.jsx","webpack://im/./src/widgets/side-navbar.jsx","webpack://im/./src/views/contacts-view.jsx","webpack://im/./src/views/acc-notifications-view.jsx","webpack://im/./src/views/acc-security-view.jsx","webpack://im/./src/views/acc-support-view.jsx","webpack://im/./src/views/login-view.jsx","webpack://im/./src/widgets/new-topic-by-id.jsx","webpack://im/./src/widgets/new-topic-group.jsx","webpack://im/./src/views/new-topic-view.jsx","webpack://im/./src/widgets/host-selector.jsx","webpack://im/./src/views/settings-view.jsx","webpack://im/./src/views/validation-view.jsx","webpack://im/./src/views/sidepanel-view.jsx","webpack://im/./src/lib/host-name.js","webpack://im/./src/views/tinode-web.jsx","webpack://im/./src/index.js"],"sourcesContent":["var getProto = Object.getPrototypeOf ? function(obj) { return Object.getPrototypeOf(obj); } : function(obj) { return obj.__proto__; };\nvar leafPrototypes;\n// create a fake namespace object\n// mode & 1: value is a module id, require it\n// mode & 2: merge all properties of value into the ns\n// mode & 4: return value when already ns object\n// mode & 16: return value when it's Promise-like\n// mode & 8|1: behave like require\n__webpack_require__.t = function(value, mode) {\n\tif(mode & 1) value = this(value);\n\tif(mode & 8) return value;\n\tif(typeof value === 'object' && value) {\n\t\tif((mode & 4) && value.__esModule) return value;\n\t\tif((mode & 16) && typeof value.then === 'function') return value;\n\t}\n\tvar ns = Object.create(null);\n\t__webpack_require__.r(ns);\n\tvar def = {};\n\tleafPrototypes = leafPrototypes || [null, getProto({}), getProto([]), getProto(getProto)];\n\tfor(var current = mode & 2 && value; typeof current == 'object' && !~leafPrototypes.indexOf(current); current = getProto(current)) {\n\t\tObject.getOwnPropertyNames(current).forEach(function(key) { def[key] = function() { return value[key]; }; });\n\t}\n\tdef['default'] = function() { return value; };\n\t__webpack_require__.d(ns, def);\n\treturn ns;\n};","var inProgress = {};\nvar dataWebpackPrefix = \"im:\";\n// loadScript function to load a script via script tag\n__webpack_require__.l = function(url, done, key, chunkId) {\n\tif(inProgress[url]) { inProgress[url].push(done); return; }\n\tvar script, needAttach;\n\tif(key !== undefined) {\n\t\tvar scripts = document.getElementsByTagName(\"script\");\n\t\tfor(var i = 0; i < scripts.length; i++) {\n\t\t\tvar s = scripts[i];\n\t\t\tif(s.getAttribute(\"src\") == url || s.getAttribute(\"data-webpack\") == dataWebpackPrefix + key) { script = s; break; }\n\t\t}\n\t}\n\tif(!script) {\n\t\tneedAttach = true;\n\t\tscript = document.createElement('script');\n\n\t\tscript.charset = 'utf-8';\n\t\tscript.timeout = 120;\n\t\tif (__webpack_require__.nc) {\n\t\t\tscript.setAttribute(\"nonce\", __webpack_require__.nc);\n\t\t}\n\t\tscript.setAttribute(\"data-webpack\", dataWebpackPrefix + key);\n\n\t\tscript.src = url;\n\t}\n\tinProgress[url] = [done];\n\tvar onScriptComplete = function(prev, event) {\n\t\t// avoid mem leaks in IE.\n\t\tscript.onerror = script.onload = null;\n\t\tclearTimeout(timeout);\n\t\tvar doneFns = inProgress[url];\n\t\tdelete inProgress[url];\n\t\tscript.parentNode && script.parentNode.removeChild(script);\n\t\tdoneFns && doneFns.forEach(function(fn) { return fn(event); });\n\t\tif(prev) return prev(event);\n\t}\n\tvar timeout = setTimeout(onScriptComplete.bind(null, undefined, { type: 'timeout', target: script }), 120000);\n\tscript.onerror = onScriptComplete.bind(null, script.onerror);\n\tscript.onload = onScriptComplete.bind(null, script.onload);\n\tneedAttach && document.head.appendChild(script);\n};","import { PACKAGE_VERSION } from './version.js';\r\n\r\n// Name of this application, used in the User-Agent.\r\nexport const APP_NAME = 'TinodeWeb/' + (PACKAGE_VERSION || '0.24');\r\n\r\n// API key. Use https://github.com/tinode/chat/tree/master/keygen to generate your own\r\nexport const API_KEY = 'AQEAAAABAAD_rAp4DJh05a1HAwFT3A6K';\r\n\r\n// The array of possible hosts to connect to.\r\nexport const KNOWN_HOSTS = {hosted: 'web.tinode.co', local: 'localhost:6060'};\r\n\r\n// Default host name and port to connect to.\r\nexport const DEFAULT_HOST = KNOWN_HOSTS.hosted;\r\n\r\n// Enable console logging.\r\nexport const LOGGING_ENABLED = true;\r\n\r\n// Minimum time between two keypress notifications, milliseconds.\r\nexport const KEYPRESS_DELAY = 3_000;\r\n// Delay before sending a read notification, milliseconds.\r\nexport const READ_DELAY = 1_500;\r\n\r\n// The default shortest allowed tag length. Matches the value on the server.\r\nexport const MIN_TAG_LENGTH = 2;\r\n// The default greatest allowed tag length. Matches the value on the server.\r\nexport const MAX_TAG_LENGTH = 96;\r\n// The default maximum number of tags allowed. Matches the value on the server.\r\nexport const MAX_TAG_COUNT = 16;\r\n\r\n// Access mode for P2P subscriptions initiated by the current user.\r\nexport const DEFAULT_P2P_ACCESS_MODE = 'JRWPS';\r\n// Access mode for new group topics created by the current user.\r\nexport const NEW_GRP_ACCESS_MODE = 'JRWPSAO';\r\n// Access mode for a channel.\r\nexport const CHANNEL_ACCESS_MODE = 'JR';\r\n\r\n// Access mode for no access.\r\nexport const NO_ACCESS_MODE = 'N';\r\n\r\n// Mediaquery breakpoint between desktop and mobile, in px. Should match the value\r\n// in @media (max-size: 640px) in base.css\r\nexport const MEDIA_BREAKPOINT = 640;\r\n// Size of css 'rem' unit in pixels. Default 1rem = 10pt = 13px.\r\nexport const REM_SIZE = 13;\r\n\r\n// Size of the avatar image: when image dimensions are greater or the image is not square, it's resized to\r\n// a square of this size or less.\r\nexport const AVATAR_SIZE = 384;\r\n\r\n// Maximum size of an avatar in bytes for sending in-band. Bigger avatars will be sent out of band (as uploads).\r\nexport const MAX_AVATAR_BYTES = 4096;\r\n\r\n// Size of the broken_image shown in MessagesView\r\nexport const BROKEN_IMAGE_SIZE = 32;\r\n\r\n// Size of video preview when dimensions are missing.\r\nexport const NO_DIMENSIONS_VIDEO = 128;\r\n\r\n// Number of chat messages to fetch in one call.\r\nexport const MESSAGES_PAGE = 24;\r\n\r\n// Default maximum in-band (included directly into the message) attachment size which fits into\r\n// a message of 256K in size. Used when the server-provided value is unavailable. The actual\r\n// binary size of the attachment should be smaller due to base64 encoding expansion and some overhead,\r\n// for instance 1024 bytes.\r\n// Increase this limit to a greater value in production, if desired. Also increase\r\n// max_message_size in the server config.\r\nexport const MAX_INBAND_ATTACHMENT_SIZE = 262_144;\r\n\r\n// Default absolute maximum attachment size to be used with the server = 8MB.\r\n// Used when the server-provided value is unavailable. Increase to something like 100MB in production.\r\nexport const MAX_EXTERN_ATTACHMENT_SIZE = 1 << 23;\r\n\r\n// Maximum allowed linear dimension (pixels) of an image sent inline. Larger images will be shrunk\r\n// to make the larger dimension fit under this size. You may want to adjust it to 1600 or\r\n// 2400 for production.\r\nexport const MAX_IMAGE_DIM = 1024;\r\n\r\n// Linear dimensions of image preview: shrink image under this size for previews.\r\nexport const IMAGE_PREVIEW_DIM = 64;\r\n\r\n// Linear dimensions of video screencapture: shrink image under this size for previews.\r\nexport const VIDEO_PREVIEW_DIM = 96;\r\n\r\n// Linear dimensions of image thumbnail: shrink image under this size for thumbnails in reply quote previews.\r\nexport const IMAGE_THUMBNAIL_DIM = 36;\r\n// Width of video thumbnail: allow it to be wider, but not taller. Use IMAGE_THUMBNAIL_DIM for height.\r\nexport const VIDEO_THUMBNAIL_WIDTH = 48;\r\n\r\n// Maximum number of online users to be shown in a topic title bar. Others will be\r\n// hidden under \"+X more\"\r\nexport const MAX_ONLINE_IN_TOPIC = 4;\r\n\r\n// Maximum length of user name, topic title, and private comment.\r\nexport const MAX_TITLE_LENGTH = 60;\r\n// Maximum length of topic description.\r\nexport const MAX_TOPIC_DESCRIPTION_LENGTH = 360;\r\n// Maximum length of user name when displaying a video call.\r\nexport const MAX_PEER_TITLE_LENGTH = 24;\r\n\r\n// Length of message previews in chat list, in characters.\r\nexport const MESSAGE_PREVIEW_LENGTH = 80;\r\n\r\n// Length of a quote in quoted reply (for outgoing messages).\r\nexport const QUOTED_REPLY_LENGTH = 30;\r\n// Length of a preview of a forwarded message.\r\nexport const FORWARDED_PREVIEW_LENGTH = 84;\r\n// Length of preview for a message being edited.\r\nexport const EDIT_PREVIEW_LENGTH = 48;\r\n\r\n// Minimum duration of an audio recording in milliseconds (2 sec).\r\nexport const MIN_DURATION = 2_000;\r\n// Maximum duration of an audio recording in milliseconds (10 min).\r\nexport const MAX_DURATION = 600_000;\r\n\r\n// Link for \"Contact Us\".\r\nexport const LINK_CONTACT_US = 'mailto:support@tinode.co';\r\n\r\n// Link to Privacy Policy.\r\nexport const LINK_PRIVACY_POLICY = 'https://tinode.co/privacy.html';\r\n\r\n// Link to Terms of Service.\r\nexport const LINK_TERMS_OF_SERVICE = 'https://tinode.co/terms.html';\r\n\r\n// When user starts a P2P topic, automatic subscription does not\r\n// happen until the first message. Setting this option to true enables\r\n// immediate subscription.\r\nexport const IMMEDIATE_P2P_SUBSCRIPTION = false;\r\n\r\n// URL schemes permitted to appear in links (i.e. no javascript: scheme).\r\nexport const CLICKABLE_URL_SCHEMES = ['http', 'https', 'ftp', 'ftps'];\r\n\r\n// Size of the QR code in the app.\r\nexport const QRCODE_SIZE = 128;\r\n\r\n// How much time has to pass to consider computer awoken from sleep (80 sec).\r\n// Chrome throttles ticker events in inactive tabs to once per minute. This\r\n// value ensures that these once-a-minute events do not trigger a reconnect.\r\nexport const WAKE_UP_TIMEOUT = 80000;\r\n// Timer interval between checks if computer woke up from sleep (1 sec).\r\nexport const WAKE_UP_TICK = 1000;\r\n\r\n// Swipe distance to register as a gesture, in pixels.\r\nexport const MIN_SWIPE_DISTANCE = REM_SIZE * 3;\r\n\r\n// Self-topic avatar as an SVG icon encoded as data URI\r\nexport const SELF_AVATAR_URI = 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz48c3ZnIHZpZXdCb3g9IjAgMCAxNyAxNyIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCBkPSJNMy41NjIgMXYxNS40NTlsNC42ODYtMy4yNyA0Ljc1MiAzLjI2di0xNS40NDloLTkuNDM4ek0xMiAxNC41NTFsLTMuNzU2LTIuNTc4LTMuNjgxIDIuNTY4di0xMi41NDFoNy40Mzd2MTIuNTUxeiIgZmlsbD0iIzU1NTU1NSIgLz48L3N2Zz4=' // eslint-disable-line max-len\r\n\r\n// Toast display duration, milliseconds.\r\nexport const TOAST_DURATION = 3_000;\r\n\r\n// MIME type for the legacy Drafty form-response data.\r\nexport const DRAFTY_FR_MIME_TYPE_LEGACY = 'application/json'; // Remove in 2026.\r\n","// File and image helper functions.\r\n\r\n// Supported image MIME types and corresponding file extensions.\r\nexport const SUPPORTED_IMAGE_FORMATS = ['image/jpeg', 'image/gif', 'image/png', 'image/svg', 'image/svg+xml'];\r\nexport const MIME_EXTENSIONS         = ['jpg',        'gif',       'png',       'svg',       'svg'];\r\n\r\n// Get an URL from a theCard photo: either create a data: URL or return reference URL.\r\nexport function makeImageUrl(photo) {\r\n  if (photo && typeof photo == 'object') {\r\n    if (photo.ref) {\r\n      return photo.ref\r\n    }\r\n    if (photo.data && photo.type) {\r\n      const mime = photo.type.startsWith('image/') ? photo.type : ('image/' + photo.type);\r\n      return 'data:' + mime + ';base64,' + photo.data;\r\n    }\r\n  }\r\n  return null;\r\n}\r\n\r\n// Calculate linear dimensions for scaling image down to fit under a certain size.\r\n// Returns an object which contains destination sizes, source sizes, and offsets\r\n// into source (when making square images).\r\nexport function fitImageSize(width, height, maxWidth, maxHeight, forceSquare) {\r\n  // Sanitize input\r\n  width = width | 0;\r\n  height = height | 0;\r\n  maxWidth = maxWidth | 0;\r\n  maxHeight = maxHeight | 0;\r\n\r\n  if (width <= 0 || height <= 0 || maxWidth <= 0 || maxHeight <= 0) {\r\n    return null;\r\n  }\r\n\r\n  if (forceSquare) {\r\n    maxWidth = maxHeight = Math.min(maxWidth, maxHeight);\r\n  }\r\n\r\n  const scale = Math.min(\r\n    Math.min(width, maxWidth) / width,\r\n    Math.min(height, maxHeight) / height\r\n  );\r\n\r\n  const size = {\r\n    dstWidth: (width * scale) | 0,\r\n    dstHeight: (height * scale) | 0,\r\n  };\r\n\r\n  if (forceSquare) {\r\n    // Also calculate parameters for making the image square.\r\n    size.dstWidth = size.dstHeight = Math.min(size.dstWidth, size.dstHeight);\r\n    size.srcWidth = size.srcHeight = Math.min(width, height);\r\n    size.xoffset = ((width - size.srcWidth) / 2) | 0;\r\n    size.yoffset = ((height - size.srcWidth) / 2) | 0;\r\n  } else {\r\n    size.xoffset = size.yoffset = 0;\r\n    size.srcWidth = width;\r\n    size.srcHeight = height;\r\n  }\r\n  return size;\r\n}\r\n\r\n// Ensure file's extension matches mime content type\r\nexport function fileNameForMime(fname, mime) {\r\n  const idx = SUPPORTED_IMAGE_FORMATS.indexOf(mime);\r\n  if (idx < 0 || !fname) {\r\n    // Unknown mime or empty name.\r\n    return fname;\r\n  }\r\n  const ext = MIME_EXTENSIONS[idx];\r\n\r\n  const at = fname.lastIndexOf('.');\r\n  if (at >= 0) {\r\n    fname = fname.substring(0, at);\r\n  }\r\n  return fname + '.' + ext;\r\n}\r\n\r\n// Scale uploaded image to fit under certain dimensions and byte size, optionally constraining to a square.\r\n// Returns a promise which is resolven on success or rejected on failure.\r\nexport function imageScaled(fileOrBlob, maxWidth, maxHeight, maxSize, forceSquare) {\r\n  return new Promise((resolve, reject) => {\r\n    const img = new Image();\r\n    img.crossOrigin = 'Anonymous';\r\n    img.onerror = function(err) {\r\n      reject(new Error(\"Image format unrecognized\"));\r\n    }\r\n    img.onload = async function() {\r\n      // Once the image is loaded, the URL is no longer needed.\r\n      URL.revokeObjectURL(img.src);\r\n\r\n      // Calculate the desired image dimensions.\r\n      const dim = fitImageSize(img.width, img.height, maxWidth, maxHeight, forceSquare);\r\n      if (!dim) {\r\n        reject(new Error(\"Invalid image\"));\r\n        return;\r\n      }\r\n      let canvas = document.createElement('canvas');\r\n      canvas.width = dim.dstWidth;\r\n      canvas.height = dim.dstHeight;\r\n      let ctx = canvas.getContext('2d');\r\n      ctx.imageSmoothingEnabled = true;\r\n      ctx.drawImage(img, dim.xoffset, dim.yoffset, dim.srcWidth, dim.srcHeight,\r\n        0, 0, dim.dstWidth, dim.dstHeight);\r\n\r\n      const mime = SUPPORTED_IMAGE_FORMATS.includes(fileOrBlob.type) ? fileOrBlob.type : 'image/jpeg';\r\n      // Generate blob to check size of the image.\r\n      let blob = await new Promise(resolve => canvas.toBlob(resolve, mime));\r\n      if (!blob) {\r\n        reject(new Error(\"Unsupported image format\"));\r\n        return;\r\n      }\r\n      // Ensure the image is not too large. Shrink the image keeping the aspect ratio.\r\n      // Do nothing if maxsize is <= 0.\r\n      while (maxSize > 0 && blob.length > maxSize) {\r\n        dim.dstWidth = (dim.dstWidth * 0.70710678118) | 0;\r\n        dim.dstHeight = (dim.dstHeight * 0.70710678118) | 0;\r\n        canvas.width = dim.dstWidth;\r\n        canvas.height = dim.dstHeight;\r\n        ctx = canvas.getContext('2d');\r\n        ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n        ctx.drawImage(img, dim.xoffset, dim.yoffset, dim.srcWidth, dim.srcHeight,\r\n          0, 0, dim.dstWidth, dim.dstHeight);\r\n        blob = await new Promise(resolve => canvas.toBlob(resolve, mime));\r\n      }\r\n\r\n      canvas = null;\r\n      resolve({mime: mime, blob: blob, width: dim.dstWidth, height: dim.dstHeight, name: fileNameForMime(fileOrBlob.name, mime)});\r\n    };\r\n    img.src = URL.createObjectURL(fileOrBlob);\r\n  });\r\n}\r\n\r\n// Scale and crop image according to specified dimensions.\r\n// The coordinates are in unscaled image pixels, i.e. cut the rectangle first then scale it.\r\n// returns a promise.\r\nexport function imageCrop(mime, objURL, left, top, width, height, scale) {\r\n  return new Promise((resolve, reject) => {\r\n    const img = new Image();\r\n    img.crossOrigin = 'Anonymous';\r\n    img.onerror = _ => {\r\n      reject(new Error(\"Image format unrecognized\"));\r\n    };\r\n    img.onload = _ => {\r\n      // Once the image is loaded, the URL is no longer needed.\r\n      URL.revokeObjectURL(img.src);\r\n\r\n      let canvas = document.createElement('canvas');\r\n      canvas.width = width * scale;\r\n      canvas.height = height * scale;\r\n      let ctx = canvas.getContext('2d');\r\n      ctx.imageSmoothingEnabled = true;\r\n      ctx.drawImage(img, left, top, width, height, 0, 0, canvas.width, canvas.height);\r\n\r\n      mime = SUPPORTED_IMAGE_FORMATS.includes(mime) ? mime : 'image/jpeg';\r\n      // Generate blob to check size of the image.\r\n      canvas.toBlob((blob) => {\r\n        // Allow GC.\r\n        canvas = null;\r\n        if (blob) {\r\n          resolve({mime: mime, blob: blob, width: width, height: height});\r\n        } else {\r\n          reject(new Error(\"Unsupported image format\"));\r\n        }\r\n      }, mime);\r\n    };\r\n    img.src = objURL;\r\n  });\r\n}\r\n\r\n// Convert file to base64 string.\r\nexport function fileToBase64(file) {\r\n  return new Promise((resolve, reject) => {\r\n    const reader = new FileReader();\r\n    reader.onerror = _ => {\r\n      reject(reader.error);\r\n    };\r\n    reader.onload = _ => {\r\n      resolve({mime: file.type, bits: reader.result.split(',')[1], name: file.name});\r\n    };\r\n    reader.readAsDataURL(file);\r\n  });\r\n}\r\n\r\n// Convert Blob to base64 string. Returns a promise resolved with the base64 string and mime.\r\nexport function blobToBase64(blob) {\r\n  return new Promise((resolve, reject) => {\r\n    const reader = new FileReader();\r\n    reader.onerror = _ => {\r\n      reject(reader.error);\r\n    };\r\n    reader.onload = _ => {\r\n      resolve({mime: blob.type, bits: reader.result.split(',')[1]});\r\n    };\r\n    reader.readAsDataURL(blob);\r\n  });\r\n}\r\n\r\n// File pasted from the clipboard. It's either an inline image or a file attachment.\r\nexport function filePasted(event, onImageSuccess, onAttachmentSuccess, onError) {\r\n  const items = (event.clipboardData || event.originalEvent.clipboardData || {}).items;\r\n  console.log('paste', items);\r\n  if (!items || !items.length) {\r\n    return false;\r\n  }\r\n\r\n  for (let i in items) {\r\n    const item = items[i];\r\n    if (item.kind === 'file') {\r\n      const file = item.getAsFile();\r\n      if (!file) {\r\n        console.error(\"Failed to get file object from pasted file item\", item.kind, item.type);\r\n        onError(\"Failed to get file object from pasted file item\");\r\n        continue;\r\n      }\r\n      if (file.type && file.type.split('/')[0] == 'image') {\r\n        console.log('paste', 'image', file);\r\n        onImageSuccess(file);\r\n      } else {\r\n        console.log('paste', 'file', file);\r\n        onAttachmentSuccess(file);\r\n      }\r\n      // Indicate that the pasted data contains a file.\r\n      return true;\r\n    }\r\n  }\r\n  console.log('paste', 'no file');\r\n  // No file found.\r\n  return false;\r\n}\r\n\r\n// Get mime type from data URL header.\r\nexport function getMimeType(header) {\r\n  const mime = /^data:(image\\/[-+a-z0-9.]+);base64/.exec(header);\r\n  return (mime && mime.length > 1) ? mime[1] : null;\r\n}\r\n\r\n// Given length of a binary object in bytes, calculate the length after\r\n// base64 encoding.\r\nexport function base64EncodedLen(n) {\r\n  return Math.floor((n + 2) / 3) * 4;\r\n}\r\n\r\n// Given length of a base64-encoded object, calculate decoded size of the\r\n// pbject in bytes.\r\nexport function base64DecodedLen(n) {\r\n  return Math.floor(n / 4) * 3;\r\n}\r\n\r\n// Re-encode string to standard base64 encoding with padding.\r\n// The string may be base64-URL encoded without the padding.\r\nexport function base64ReEncode(str) {\r\n  if (str) {\r\n    str = str.replace(/-/g, '+').replace(/_/g, '/');\r\n    try {\r\n      str = btoa(atob(str));\r\n    } catch(err) {\r\n      console.error(\"Failed to base64 re-encode string.\", err);\r\n      str = null;\r\n    }\r\n  }\r\n  return str;\r\n}\r\n\r\n// Convert a base64 encoded string with the provided mime type into a Blob.\r\nexport function base64ToBlob(str, mime) {\r\n  if (!str) {\r\n    return null;\r\n  }\r\n\r\n  try {\r\n    // Make blob.\r\n    const bin = atob(str);\r\n    const length = bin.length;\r\n    const buf = new ArrayBuffer(length);\r\n    const arr = new Uint8Array(buf);\r\n    for (let i = 0; i < length; i++) {\r\n      arr[i] = bin.charCodeAt(i);\r\n    }\r\n\r\n    return new Blob([buf], { type: mime });\r\n  } catch(err) {\r\n    console.error(\"Failed to convert base64 to blob: \", err);\r\n  }\r\n\r\n  return null;\r\n}\r\n\r\nexport function intArrayToBase64(arr) {\r\n  if (!Array.isArray(arr)) {\r\n    return null;\r\n  }\r\n  try {\r\n    let bin = '';\r\n    new Uint8Array(arr).forEach(b => bin += String.fromCharCode(b));\r\n    return window.btoa(bin);\r\n  } catch (err) {}\r\n  return null;\r\n}\r\n\r\nexport function base64ToIntArray(b64) {\r\n  const arr = [];\r\n  try {\r\n    const bin =  window.atob(b64);\r\n    [...bin].forEach(c => {\r\n      arr.push(c.charCodeAt(0));\r\n    });\r\n    return arr;\r\n  } catch (err) {}\r\n  return null;\r\n}\r\n","// Helper functions for storing values in localStorage.\r\n// By default localStorage can store only strings, not objects or other types.\r\n\r\nexport default class LocalStorageUtil {\r\n  // Replace old object with the new one.\r\n  static setObject(key, value) {\r\n    localStorage.setItem(key, JSON.stringify(value));\r\n  }\r\n\r\n  // Get stored object.\r\n  static getObject(key) {\r\n    const value = localStorage.getItem(key);\r\n    return value && JSON.parse(value);\r\n  }\r\n\r\n  // Partially or wholly update stored object.\r\n  static updateObject(key, value) {\r\n    const oldVal = this.getObject(key);\r\n    this.setObject(key, Object.assign(oldVal || {}, value));\r\n  }\r\n\r\n  // Just a wrapper.\r\n  static removeItem(key) {\r\n    localStorage.removeItem(key);\r\n  }\r\n}\r\n","// Utility class for hash navigation.\r\n\r\nexport default class HashNavigation {\r\n  // Parse hash as in http://www.example.com/path#hash as if it were\r\n  // path and arguments.\r\n  static parseUrlHash(hash) {\r\n    // Split 'path/?args' into 'path/' and 'args', path -> parts[0], args->path[1].\r\n    const parts = hash.split('?', 2);\r\n    const params = {};\r\n    let path = [];\r\n    if (parts[0]) {\r\n      path = parts[0].replace('#', '').split('/');\r\n    }\r\n    if (parts[1]) {\r\n      parts[1].split('&').forEach((arg) => {\r\n        // Can't use split() because the value may contain '='.\r\n        const eq = arg.indexOf('=');\r\n        if (eq > 0) {\r\n          params[arg.slice(0, eq)] = decodeURIComponent(arg.slice(eq + 1));\r\n        }\r\n      });\r\n    }\r\n    return {path: path, params: params};\r\n  }\r\n\r\n  static navigateTo(url) {\r\n    window.location.hash = url;\r\n  }\r\n\r\n  static composeUrlHash(path, params) {\r\n    let url = path.join('/');\r\n    const args = [];\r\n    for (const key in params) {\r\n      if (params.hasOwnProperty(key)) {\r\n        if (params[key] !== undefined) {\r\n          args.push(key + '=' + encodeURIComponent(params[key]));\r\n        }\r\n      }\r\n    }\r\n    if (args.length > 0) {\r\n      url += '?' + args.join('&');\r\n    }\r\n    return url;\r\n  }\r\n\r\n  static addUrlParam(hash, key, value) {\r\n    const parsed = HashNavigation.parseUrlHash(hash);\r\n    parsed.params[key] = value;\r\n    return HashNavigation.composeUrlHash(parsed.path, parsed.params);\r\n  }\r\n\r\n  static removeUrlParam(hash, key) {\r\n    const parsed = HashNavigation.parseUrlHash(hash);\r\n    delete parsed.params[key];\r\n    return HashNavigation.composeUrlHash(parsed.path, parsed.params);\r\n  }\r\n\r\n  static setUrlSidePanel(hash, sidepanel) {\r\n    const parsed = HashNavigation.parseUrlHash(hash);\r\n    parsed.path[0] = sidepanel;\r\n    return HashNavigation.composeUrlHash(parsed.path, parsed.params);\r\n  }\r\n\r\n  static setUrlInfoPanel(hash, infopanel) {\r\n    const parsed = HashNavigation.parseUrlHash(hash);\r\n    if (infopanel) {\r\n      parsed.params.info = infopanel;\r\n    } else {\r\n      delete parsed.params.info;\r\n    }\r\n    return HashNavigation.composeUrlHash(parsed.path, parsed.params);\r\n  }\r\n\r\n  static setUrlTopic(hash, topic) {\r\n    const parsed = HashNavigation.parseUrlHash(hash);\r\n    parsed.path[1] = topic;\r\n    // Close InfoView on topic change.\r\n    delete parsed.params.info;\r\n    return HashNavigation.composeUrlHash(parsed.path, parsed.params);\r\n  }\r\n}\r\n","// Short representation of time in the past.\r\nexport function shortDateFormat(then, locale) {\r\n  locale = locale || window.navigator.userLanguage || window.navigator.language;\r\n  const now = new Date();\r\n  if (then.getFullYear() == now.getFullYear()) {\r\n    // Same year.\r\n    if (then.getMonth() == now.getMonth() && then.getDate() == now.getDate()) {\r\n      // Same month and day, show time only.\r\n      return then.toLocaleTimeString(locale, {hour12: false, hour: '2-digit', minute: '2-digit'});\r\n    }\r\n    // Different month and/or day, show month day, time.\r\n    return then.toLocaleDateString(locale,\r\n      {hour12: false, month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit'});\r\n  }\r\n  // Different year: just show the date.\r\n  return then.toLocaleDateString(locale, {year: 'numeric', month: 'short', day: 'numeric'});\r\n}\r\n\r\n// Representation a date relative to now.\r\nexport function relativeDateFormat(then, locale) {\r\n  locale = locale || window.navigator.userLanguage || window.navigator.language;\r\n  const now = new Date();\r\n  const thenDays = Math.floor((then.getTime() - then.getTimezoneOffset() * 60_000) / 86_400_000);\r\n  const nowDays = Math.floor((now.getTime() - now.getTimezoneOffset() * 60_000) / 86_400_000);\r\n  const diff = thenDays - nowDays;\r\n  if (Math.abs(diff) < 2) {\r\n    // Today or yesterday.\r\n    return new Intl.RelativeTimeFormat(locale, { numeric: 'auto' }).format(diff, 'day')\r\n  }\r\n  // More than two days: just show the date.\r\n  return new Intl.DateTimeFormat(locale).format(then);\r\n}\r\n\r\n// Convert seconds to [hours:]minutes:seconds, i.e. 156 sec -> 2:36, 3756 sec -> 1:02:36.\r\n// If <code>fixedMins</code> is true, then minutes are represented by at least two digits.\r\nexport function secondsToTime(seconds, fixedMin) {\r\n  if (typeof seconds != 'number') {\r\n    return '';\r\n  }\r\n\r\n  let min = (Math.floor(seconds / 60) | 0) % 60;\r\n  let hours = Math.floor(seconds / 3600) | 0;\r\n\r\n  if (fixedMin || hours > 0) {\r\n    min = min < 10 ? `0${min}` : min;\r\n  }\r\n  let sec = (seconds | 0) % 60;\r\n  sec = sec < 10 ? `0${sec}` : sec;\r\n  if (hours == 0) {\r\n    return `${min}:${sec}`;\r\n  }\r\n  return `${hours}:${min}:${sec}`;\r\n}\r\n\r\n// Convert a number of bytes to human-readable format.\r\nexport function bytesToHumanSize(bytes) {\r\n  if (!bytes || bytes == 0) {\r\n    return '0 Bytes';\r\n  }\r\n\r\n  const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB', 'PB'];\r\n  const bucket = Math.min(Math.floor(Math.log2(bytes) / 10) | 0, sizes.length-1);\r\n  const count = bytes / Math.pow(1024, bucket);\r\n  const round = bucket > 0 ? (count < 3 ? 2 : (count < 30 ? 1 : 0)) : 0;\r\n  return count.toFixed(round) + ' ' + sizes[bucket];\r\n}\r\n\r\n// Shorten a file name to be under maxLength by clipping out the middle.\r\nexport function shortenFileName(filename, maxLength) {\r\n  if (typeof filename != 'string') {\r\n    return filename;\r\n  }\r\n  return filename.length > maxLength ?\r\n    filename.slice(0, maxLength/2 - 1) + '…' + filename.slice(1 - maxLength/2) : filename;\r\n}\r\n\r\n// Get 32 bit integer hash value for a string. Ideally it should produce the same value\r\n// as Java's String#hash().\r\nfunction stringToColorHash(value) {\r\n  let hash = 0;\r\n  value = '' + value;\r\n  for (let i = 0; i < value.length; i++) {\r\n    hash = ((hash << 5) - hash) + value.charCodeAt(i);\r\n    hash = hash & hash; // Convert to 32bit integer\r\n  }\r\n  return hash;\r\n}\r\n\r\n// User avatar letter color id.\r\nexport function letterTileColorId(userId) {\r\n  return Math.abs(stringToColorHash(userId)) % 16;\r\n}\r\n\r\n// Converts user or topic ID to a CSS color class. Ideally it should produce the same color value as Java version.\r\n// params:\r\n// - {string} id: user or topic ID\r\n// - {boolean} light: light or dark version of the color.\r\n// - {boolean} fg: foreground (text) or background color.\r\nexport function idToColorClass(id, light, fg) {\r\n  return (light ? 'lt-' : 'dk-') + (fg ? 'fg-' : 'bg-') + letterTileColorId(id);\r\n}\r\n\r\n// Takes ISO Alpha-2 country code, like 'US' and converts it to a flag emoji.\r\nexport function flagEmoji(countryCode) {\r\n  const codePoints = countryCode\r\n    .toUpperCase()\r\n    .split('')\r\n    .map(char => 0x1F1A5 + char.charCodeAt());\r\n  return String.fromCodePoint(...codePoints);\r\n}\r\n","// Odds and ends\r\n\r\nimport { Tinode } from 'tinode-sdk';\r\n\r\n// Make shortcut icon appear with a green dot + show unread count in title.\r\nexport function updateFavicon(count) {\r\n  const oldIcon = document.getElementById('shortcut-icon');\r\n  const head = document.head || document.getElementsByTagName('head')[0];\r\n  const newIcon = document.createElement('link');\r\n  newIcon.type = 'image/png';\r\n  newIcon.id = 'shortcut-icon';\r\n  newIcon.rel = 'shortcut icon';\r\n  newIcon.href = 'img/logo32x32' + (count > 0 ? 'a' : '') + '.png';\r\n  if (oldIcon) {\r\n    head.removeChild(oldIcon);\r\n  }\r\n  head.appendChild(newIcon);\r\n\r\n  document.title = (count > 0 ? '('+count+') ' : '') + 'Tinode';\r\n}\r\n\r\n// Create theCard which represents user's or topic's \"public\" info.\r\nexport function theCard(fn, imageUrl, imageMimeType, note) {\r\n  let card = null;\r\n  fn = fn && fn.trim();\r\n  note = note && note.trim();\r\n\r\n  if (fn) {\r\n    card = {\r\n      fn: fn\r\n    };\r\n  }\r\n\r\n  if (typeof note == 'string') {\r\n    card = card || {};\r\n    card.note = note ? note : Tinode.DEL_CHAR;\r\n  }\r\n\r\n  if (imageUrl) {\r\n    card = card || {};\r\n    let mimeType = imageMimeType;\r\n    // Is this a data URL \"data:[<mediatype>][;base64],<data>\"?\r\n    const matches = /^data:(image\\/[-a-z0-9+.]+)?(;base64)?,/i.exec(imageUrl);\r\n    if (matches) {\r\n      mimeType = matches[1];\r\n      card.photo = {\r\n        data: imageUrl.substring(imageUrl.indexOf(',') + 1),\r\n        ref: Tinode.DEL_CHAR\r\n      };\r\n    } else {\r\n      card.photo = {\r\n        data: Tinode.DEL_CHAR,\r\n        ref: imageUrl\r\n      };\r\n    }\r\n    card.photo.type = (mimeType || 'image/jpeg').substring('image/'.length);\r\n  }\r\n\r\n  return card;\r\n}\r\n\r\n// Deep-shallow compare two arrays: shallow compare each element.\r\nexport function arrayEqual(a, b) {\r\n  if (a === b) {\r\n    return true;\r\n  }\r\n\r\n  if (!Array.isArray(a) || !Array.isArray(b)) {\r\n    return false;\r\n  }\r\n\r\n  // Compare lengths first.\r\n  if (a.length != b.length) {\r\n    return false;\r\n  }\r\n  // Order of elements is ignored.\r\n  a.sort();\r\n  b.sort();\r\n  for (let i = 0, l = a.length; i < l; i++) {\r\n    if (a[i] !== b[i]) {\r\n      return false;\r\n    }\r\n  }\r\n  return true;\r\n}\r\n\r\n// Checks (loosely) if the given string is a phone. If so, returns the phone number in a format\r\n// as close to E.164 as possible.\r\nexport function asPhone(val) {\r\n  val = val.trim();\r\n  if (/^(?:\\+?(\\d{1,3}))?[- (.]*(\\d{3})[- ).]*(\\d{3})[- .]*(\\d{2})[- .]*(\\d{2})?$/.test(val)) {\r\n    return val.replaceAll(/[- ().]*/g, '');\r\n  }\r\n  return null;\r\n}\r\n\r\n// Checks (loosely) if the given string is an email. If so returns the email.\r\nexport function asEmail(val) {\r\n  val = val.trim();\r\n  if (/^[a-z0-9_.+-]+@[a-z0-9-]+(\\.[a-z0-9-]+)+$/i.test(val)) {\r\n    return val;\r\n  }\r\n  return null;\r\n}\r\n\r\n// Checks if URL is a relative url, i.e. has no 'scheme://', including the case of missing scheme '//'.\r\n// The scheme is expected to be RFC-compliant, e.g. [a-z][a-z0-9+.-]*\r\n// example.html - ok\r\n// https:example.com - not ok.\r\n// http:/example.com - not ok.\r\n// //example.com or \\\\example.com - not ok.\r\n// ' ↲ https://example.com' - not ok. (↲ means carriage return)\r\nexport function isUrlRelative(url) {\r\n  // Replacing backslashes with forward slashes to mimic JS URL parser then testing for\r\n  // 'scheme:' and '//' with optional space at the start.\r\n  return url && !/^\\s*([a-z][a-z0-9+.-]*:|\\/\\/)/im.test(url.replace(/\\\\/g, '/'));\r\n}\r\n\r\n// Ensure URL does not present an XSS risk. Optional allowedSchemes may contain an array of\r\n// strings with permitted URL schemes, such as ['ftp', 'ftps']; otherwise accept http and https only.\r\nexport function sanitizeUrl(url, allowedSchemes) {\r\n  if (typeof url != 'string') {\r\n    return url;\r\n  }\r\n\r\n  // Strip control characters and whitespace. They are not valid URL characters anyway.\r\n  url = url.replace(/[^\\x21-\\x7E]/gmi, '').trim();\r\n\r\n  // Replace backslashes with forward slashes. They will be replaced in the URL parser anyway.\r\n  url = url.replace(/\\\\/g, '/');\r\n\r\n  // Relative URLs are safe.\r\n  // Relative URL does not start with ':', abcd123: or '//'.\r\n  if (!/^([a-z][a-z0-9+.-]*:|\\/\\/)/i.test(url)) {\r\n    return url;\r\n  }\r\n\r\n  // Blob URLs are safe.\r\n  if (/^blob:http/.test(url)) {\r\n    return url;\r\n  }\r\n\r\n  // Absolute URL. Accept only safe schemes, or no scheme.\r\n  const schemes = Array.isArray(allowedSchemes) ? allowedSchemes.join('|') : 'http|https';\r\n  const re = new RegExp('^((' + schemes + '):|//)', 'i');\r\n  if (!re.test(url)) {\r\n    return null;\r\n  }\r\n\r\n  return url;\r\n}\r\n\r\n// Ensure URL is suitable as a source like <img src=\"url\"> field: the URL must be a relative URL or\r\n// have http:, https:, blob: or data: scheme.\r\n// In case of data: scheme, the URL must must be of the right MIME type such as 'data:{mimeMajor}/XXXX;base64,'.\r\nexport function sanitizeUrlForMime(url, mimeMajor) {\r\n  if (!url) {\r\n    return null;\r\n  }\r\n\r\n  const sanitizedUrl = sanitizeUrl(url);\r\n  if (sanitizedUrl) {\r\n    return sanitizedUrl;\r\n  }\r\n\r\n  // Is this a data: URL of the appropriate mime type?\r\n  const re = new RegExp(`data:${mimeMajor}\\/[-+.a-z0-9]+;base64,`, 'i');\r\n  if (re.test(url.trim())) {\r\n    return url;\r\n  }\r\n\r\n  return null;\r\n}\r\n\r\n// Append query parameter 'asatt=1' to the URL.\r\n// It will cause Tinode server to add 'Content-Disposition: attachment' header when serving it.\r\n// The URL is a string. The URL here is always absolute.\r\nexport function urlAsAttachment(url) {\r\n  // TODO: check if URL is local or remote, i.e. compare to window.location.origin.\r\n  /*\r\n  if (typeof window.location == 'object') {\r\n    if (!url.startsWith(window.location.origin)) {\r\n      return url;\r\n    }\r\n  }\r\n  */\r\n  // Check if the URL is a data or blob. Do not alter such URLs.\r\n  if (url.startsWith('data:') || url.startsWith('blob:')) {\r\n    return url;\r\n  }\r\n\r\n  // Split URL into host+path, query, fragment.\r\n  let query = '', fragment = '';\r\n  const idxF = url.indexOf('#');\r\n  if (idxF > 0) {\r\n    fragment = url.substring(idxF+1);\r\n    url = url.substring(0, idxF);\r\n  }\r\n  const idxQ = url.indexOf('?');\r\n  if (idxQ > 0) {\r\n    query = url.substring(idxQ+1);\r\n    url = url.substring(0, idxQ);\r\n  }\r\n  // Add parameter and reassemble.\r\n  const params = new URLSearchParams(query);\r\n  params.append('asatt', '1');\r\n  return `${url}?${params.toString()}` + (fragment ? `#${fragment}` : '');\r\n}\r\n\r\n// Given message's received status, return name and color of a delivery indicator icon.\r\nexport function deliveryMarker(received) {\r\n  switch (received) {\r\n    case Tinode.MESSAGE_STATUS_SENDING:\r\n      return { name: 'access_time' }; // watch face\r\n    case Tinode.MESSAGE_STATUS_FAILED:\r\n    case Tinode.MESSAGE_STATUS_FATAL:\r\n      return { name: 'warning', color: 'danger-color' }; // yellow icon /!\\\r\n    case Tinode.MESSAGE_STATUS_SENT:\r\n      return { name: 'done' }; // checkmark\r\n    case Tinode.MESSAGE_STATUS_RECEIVED:\r\n      return { name: 'done_all' }; // double checkmark\r\n    case Tinode.MESSAGE_STATUS_READ:\r\n      return { name: 'done_all', color: 'blue' }; // blue double checkmark\r\n  }\r\n  return null;\r\n}\r\n\r\n// Wraps a promise to make it cancelable.\r\n// The parameter can be either a promise or an error. If it's an error, the wrapped promise is\r\n// created in a rejected state.\r\nexport function cancelablePromise(promise) {\r\n  let hasCanceled = false;\r\n\r\n  const wrappedPromise = promise instanceof Error ?\r\n    Promise.reject(promise) :\r\n    new Promise((resolve, reject) => {\r\n      promise.then(\r\n        result => hasCanceled ? reject({isCanceled: true}) : resolve(result),\r\n        error => hasCanceled ? reject({isCanceled: true}) : reject(error)\r\n      );\r\n    });\r\n\r\n  return {\r\n    promise: wrappedPromise,\r\n    cancel() {\r\n      hasCanceled = true;\r\n    },\r\n  };\r\n};\r\n\r\n// Clips string to the specified length.\r\nexport function clipStr(str, length) {\r\n  return str && str.substring(0, length);\r\n}\r\n","// This is a generated file. Don't edit.\n\nexport const PACKAGE_VERSION = \"0.24.3\";\n","// Audio recorder widget.\r\n\r\nimport React from 'react';\r\nimport { defineMessages, injectIntl } from 'react-intl';\r\n\r\nimport { secondsToTime } from '../lib/strformat';\r\nimport { base64ToIntArray } from '../lib/blob-helpers';\r\n\r\n// Make canvas bigger than the element size to reduce blurring.\r\nconst CANVAS_UPSCALING = 2.0;\r\n// Thickness of a visualization bar.\r\nconst LINE_WIDTH = 3 * CANVAS_UPSCALING;\r\n// Spacing between two visualization bars.\r\nconst SPACING = 2 * CANVAS_UPSCALING;\r\n// Color of histogram bars.\r\nconst BAR_COLOR = '#888A';\r\nconst BAR_COLOR_DARK = '#666C';\r\nconst THUMB_COLOR = '#444E';\r\n// Minimum number of amplitude bars to draw.\r\nconst MIN_PREVIEW_LENGTH = 16;\r\n\r\nconst messages = defineMessages({\r\n  icon_title_play: {\r\n    id: 'icon_title_play',\r\n    defaultMessage: 'Play recording',\r\n    description: 'Icon tool tip for starting audio playback'\r\n  }\r\n});\r\n\r\nclass AudioPlayer extends React.PureComponent {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    let preview = base64ToIntArray(this.props.preview);\r\n    if (!Array.isArray(preview) || preview.length < MIN_PREVIEW_LENGTH) {\r\n      preview = null;\r\n    }\r\n\r\n    this.state = {\r\n      canPlay: false,\r\n      playing: false,\r\n      currentTime: '0:00',\r\n      duration: this.props.duration > 0 ? secondsToTime(this.props.duration / 1000) : '-:--',\r\n      longMin: this.props.duration >= 600000,\r\n      preview: preview\r\n    };\r\n\r\n    this.initAudio = this.initAudio.bind(this);\r\n    this.initCanvas = this.initCanvas.bind(this);\r\n    this.resampleBars = this.resampleBars.bind(this);\r\n    this.visualize = this.visualize.bind(this);\r\n\r\n    this.handlePlay = this.handlePlay.bind(this);\r\n    this.handleSeek = this.handleSeek.bind(this);\r\n    this.handleError = this.handleError.bind(this);\r\n    this.getBlob = this.getBlob.bind(this);\r\n\r\n    this.audioPlayer = null;\r\n\r\n    this.viewBuffer = [];\r\n    this.canvasRef = React.createRef();\r\n  }\r\n\r\n  componentDidMount() {\r\n    if (this.props.src) {\r\n      this.initAudio();\r\n    }\r\n\r\n    this.initCanvas();\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    if (this.audioPlayer) {\r\n      this.audioPlayer.onloadedmetadata = null;\r\n      this.audioPlayer.ontimeupdate = null;\r\n      this.audioPlayer.onended = null;\r\n      this.audioPlayer.pause();\r\n      this.audioPlayer = null;\r\n    }\r\n  }\r\n\r\n  componentDidUpdate(prevProps) {\r\n    if (this.props.src != prevProps.src) {\r\n      this.initAudio();\r\n    }\r\n\r\n    if (this.props.preview != prevProps.preview) {\r\n      let preview = base64ToIntArray(this.props.preview);\r\n      if (!Array.isArray(preview) || preview.length < MIN_PREVIEW_LENGTH) {\r\n        preview = null;\r\n      }\r\n      this.setState({preview: preview}, this.initCanvas);\r\n    }\r\n  }\r\n\r\n  async initAudio() {\r\n    // when do not support webm, trans to mp3\r\n    try {\r\n      let src = this.props.src;\r\n      if (!MediaRecorder.isTypeSupported(\"audio/webm\") && this.props.src.startsWith(\"blob:\")) {\r\n        console.log(\"not support webm\", src);\r\n        const blob = await this.getBlob(src);\r\n        src = URL.createObjectURL(blob);\r\n        console.log(\"mp3 src: \", src);\r\n      }\r\n      console.log(\"src:\", src);\r\n      this.audioPlayer = new Audio(src);\r\n      this.audioPlayer.load();\r\n      this.audioPlayer.onloadedmetadata = _ => this.setState({canPlay: true});\r\n      this.audioPlayer.ontimeupdate = _ => this.setState({\r\n        currentTime: secondsToTime(this.audioPlayer.currentTime, this.state.longMin)\r\n      });\r\n      this.audioPlayer.onended = _ => {\r\n        this.audioPlayer.currentTime = 0;\r\n        this.setState({playing: false, currentTime: secondsToTime(0, this.state.longMin)})\r\n      }\r\n    } catch (e) {\r\n      console.log(\"init audio fail\", e);\r\n    }\r\n  }\r\n\r\n  initCanvas() {\r\n    // Force canvas aspect ratio to match one of the element + upscale canvas to reduce blurring.\r\n    this.canvasRef.current.width = this.canvasRef.current.offsetWidth * CANVAS_UPSCALING;\r\n    this.canvasRef.current.height = this.canvasRef.current.offsetHeight * CANVAS_UPSCALING;\r\n\r\n    this.canvasContext = this.canvasRef.current.getContext('2d');\r\n    this.canvasContext.lineCap = 'round';\r\n\r\n    this.viewBuffer = this.resampleBars(this.state.preview);\r\n    this.visualize();\r\n  }\r\n\r\n  // Draw amplitude of sound.\r\n  visualize() {\r\n    if (!this.canvasRef.current) {\r\n      return;\r\n    }\r\n\r\n    const width = this.effectiveWidth;\r\n    const height = this.canvasRef.current.height;\r\n\r\n    this.canvasContext.lineWidth = LINE_WIDTH;\r\n\r\n    const drawFrame = _ => {\r\n      if (!this.canvasRef.current || !this.audioPlayer) {\r\n        // The component is unmounted.\r\n        return;\r\n      }\r\n\r\n      this.canvasContext.clearRect(0, 0, this.canvasRef.current.width, height);\r\n\r\n      if (this.viewBuffer) {\r\n        if (this.state.playing) {\r\n          window.requestAnimationFrame(drawFrame);\r\n        }\r\n\r\n        // Current playback position.\r\n        const thumbAt = this.props.duration ?\r\n          Math.max(0, Math.min(this.audioPlayer.currentTime * 1000 / this.props.duration, 1)) * (width - LINE_WIDTH * 2) : -1;\r\n\r\n        // Draw amplitude bars.\r\n        this.canvasContext.beginPath();\r\n        this.canvasContext.strokeStyle = BAR_COLOR_DARK;\r\n        for (let i = 0; i < this.viewBuffer.length; i++) {\r\n          let x = 1 + i * (LINE_WIDTH + SPACING) + LINE_WIDTH * 0.5;\r\n          let y = Math.max(this.viewBuffer[i] * height * 0.9, 1);\r\n\r\n          const color = x < thumbAt ? BAR_COLOR_DARK : BAR_COLOR;\r\n          if (this.canvasContext.strokeStyle != color) {\r\n            this.canvasContext.stroke();\r\n            this.canvasContext.beginPath();\r\n            this.canvasContext.strokeStyle = color;\r\n          }\r\n\r\n          this.canvasContext.moveTo(x, (height - y) * 0.5);\r\n          this.canvasContext.lineTo(x, (height + y) * 0.5);\r\n        }\r\n        // Actually draw the bars on canvas.\r\n        this.canvasContext.stroke();\r\n\r\n        // Draw thumb.\r\n        if (this.props.duration) {\r\n          this.canvasContext.beginPath();\r\n          this.canvasContext.arc(thumbAt + LINE_WIDTH * 2, height * 0.5, LINE_WIDTH * 2, 0, 2 * Math.PI);\r\n          this.canvasContext.fillStyle = THUMB_COLOR;\r\n          this.canvasContext.fill();\r\n        }\r\n      }\r\n    }\r\n\r\n    drawFrame();\r\n  }\r\n\r\n  // Quick and dirty downsampling of the original preview bars into a smaller (or equal) number of bars we can display here.\r\n  resampleBars(original) {\r\n    const dstCount = ((this.canvasRef.current.width - SPACING) / (LINE_WIDTH + SPACING)) | 0;\r\n    // Remove extra padding on the right due to fractional bar which is not drawn.\r\n    this.effectiveWidth = dstCount * (LINE_WIDTH + SPACING) + SPACING;\r\n\r\n    if (!Array.isArray(original) || original.length == 0) {\r\n      return Array.apply(null, Array(dstCount)).map(_ => 0.01);\r\n    }\r\n\r\n    const factor = original.length / dstCount;\r\n    let amps = [];\r\n    let maxAmp = -1;\r\n    for (let i=0; i<dstCount; i++) {\r\n      let lo = (i * factor) | 0; // low bound;\r\n      let hi = ((i + 1) * factor) | 0; // high bound;\r\n      if (hi == lo) {\r\n        amps[i] = original[lo];\r\n      } else {\r\n        let amp = 0.0;\r\n        for (let j=lo; j<hi; j++) {\r\n          amp += original[j]\r\n        }\r\n        amps[i] = Math.max(0, amp / (hi - lo));\r\n      }\r\n      maxAmp = Math.max(amps[i], maxAmp);\r\n    }\r\n\r\n    if (maxAmp > 0) {\r\n      return amps.map(a => a / maxAmp);\r\n    }\r\n    return Array.apply(null, Array(dstCount)).map(_ => 0.01);\r\n  }\r\n\r\n  handlePlay(e) {\r\n    e.preventDefault();\r\n    if (!this.state.canPlay) {\r\n      return;\r\n    }\r\n\r\n    if (this.state.playing) {\r\n      this.audioPlayer.pause();\r\n      this.setState({playing: false});\r\n    } else if (this.audioPlayer.readyState >= 2) {\r\n      this.audioPlayer.play();\r\n      this.setState({playing: true}, this.visualize);\r\n    }\r\n  }\r\n\r\n  handleError(err) {\r\n    console.error(err);\r\n  }\r\n\r\n  handleSeek(e) {\r\n    e.preventDefault();\r\n    if (e.target && this.props.duration) {\r\n      const rect = e.target.getBoundingClientRect();\r\n      const offset = (e.clientX - rect.left) / this.effectiveWidth * CANVAS_UPSCALING;\r\n      this.audioPlayer.currentTime = this.props.duration * offset / 1000;\r\n      this.setState({currentTime: secondsToTime(this.audioPlayer.currentTime, this.state.longMin)});\r\n      if (!this.state.playing) {\r\n        this.visualize();\r\n      }\r\n    }\r\n  }\r\n\r\n  getBlob(url) {\r\n    return new Promise((resolve, reject) => {\r\n      const xhr = new XMLHttpRequest();\r\n      xhr.responseType = 'blob';\r\n      xhr.overrideMimeType('audio/mp4');\r\n\r\n      xhr.onload = (event) => {\r\n        var blob = xhr.response;\r\n        resolve(blob);\r\n      };\r\n      xhr.onerror = (event) => {\r\n        reject(event);\r\n      };\r\n\r\n      xhr.open('GET', url);\r\n      xhr.send();\r\n    });\r\n  }\r\n\r\n  render() {\r\n    const playClass = 'material-icons' +\r\n      (this.props.short ? '' : ' large') +\r\n      (this.state.canPlay ? '' : ' disabled');\r\n    const play = (<a href=\"#\" onClick={this.handlePlay} title={this.props.intl.formatMessage(messages.icon_title_play)}>\r\n        <i className={playClass}>{this.state.playing ? 'pause_circle' :\r\n          (this.state.canPlay ? 'play_circle' : 'not_interested')}</i>\r\n      </a>);\r\n    return (<div className=\"audio-player\">{this.props.short ?\r\n      <>\r\n        <canvas className=\"playback\" ref={this.canvasRef} onClick={this.handleSeek} />\r\n        {play}\r\n      </>\r\n    :\r\n      <>\r\n        {play}\r\n        <div>\r\n          <canvas className=\"playback\" ref={this.canvasRef} onClick={this.handleSeek} />\r\n          <div className=\"timer\">{this.state.currentTime}/{this.state.duration}</div>\r\n        </div>\r\n      </>\r\n    }\r\n    </div>);\r\n  }\r\n}\r\n\r\nexport default injectIntl(AudioPlayer);\r\n","// Image zoom and crop widget.\r\n\r\nimport React from 'react';\r\n\r\nconst DEFAULT_MAX_ZOOM = 2.5;\r\n\r\nexport default class Cropper extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      // Coordinates of the top left corner of the image in container coordinates.\r\n      panX: 0,\r\n      panY: 0,\r\n      // Origin of the zoom in image coordinates.\r\n      originX: 0,\r\n      originY: 0,\r\n      // Zoom scale.\r\n      zoom: 1,\r\n      // Zoom min and max.\r\n      minZoom: 0,\r\n      maxZoom: DEFAULT_MAX_ZOOM,\r\n    };\r\n\r\n    // References to DOM elements for hooking up events and getting screen dimensions.\r\n    // The transparent element which captures mouse moves (moves with the image).\r\n    this.overlay = React.createRef();\r\n    // The image cutout window or view port (static).\r\n    this.cutout = React.createRef();\r\n    // Scaled and translated image preview.\r\n    this.preview = React.createRef();\r\n    // The main container (static).\r\n    this.boundingBox = React.createRef();\r\n\r\n    // The original image width and height before any scaling.\r\n    this.imageWidth = 0;\r\n    this.imageHeight = 0;\r\n\r\n    // Mouse position when dragging.\r\n    this.mouseX = 0\r\n    this.mouseY = 0;\r\n    // Length of the previous mouse move when dragging.\r\n    this.prevDistance = 0;\r\n\r\n    // Bounding rectangles of static elements.\r\n    this.cutoutRect = {};\r\n    this.bBoxRect = {};\r\n    // Center of the bounding box.\r\n    this.originX = 0;\r\n    this.originY = 0;\r\n\r\n    this.initScaling = this.initScaling.bind(this);\r\n    this.onZoom = this.onZoom.bind(this);\r\n    this.handleZoom = this.handleZoom.bind(this);\r\n    this.mouseDown = this.mouseDown.bind(this);\r\n    this.mouseUp = this.mouseUp.bind(this);\r\n    this.mouseMove = this.mouseMove.bind(this);\r\n    this.mouseTouch = this.mouseTouch.bind(this);\r\n    this.positionAll = this.positionAll.bind(this);\r\n    this.translate = this.translate.bind(this);\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.overlay.current.addEventListener('mousedown', this.mouseDown, { passive: true });\r\n    this.overlay.current.addEventListener('touchstart', this.mouseDown, { passive: true });\r\n\r\n    // The rectangle position is in viewport coordinates.\r\n    this.bBoxRect = this.boundingBox.current.getBoundingClientRect();\r\n    // Center of the bounding box in container coordinates.\r\n    this.originX = this.bBoxRect.width / 2;\r\n    this.originY = this.bBoxRect.height / 2;\r\n\r\n    // The rectangle position is in viewport coordinates.\r\n    this.cutoutRect = this.cutout.current.getBoundingClientRect();\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    if (this.overlay.current) {\r\n      this.overlay.current.removeEventListener('mousedown', this.mouseDown);\r\n      this.overlay.current.removeEventListener('touchstart', this.mouseDown);\r\n    }\r\n  }\r\n\r\n  // Position all elements.\r\n  positionAll(panX, panY, zoom) {\r\n    // Zoom origin in image preview coordinates.\r\n    this.setState({\r\n      panX: panX,\r\n      panY: panY,\r\n      zoom: zoom,\r\n      originX: this.originX - panX,\r\n      originY: this.originY - panY,\r\n    });\r\n\r\n    // Pass cut out coordinates to caller.\r\n    const left = (this.originX - panX) * zoom - this.originX;\r\n    const top = (this.originY - panY) * zoom - this.originY;\r\n    this.props.onChange(\r\n      (left + this.cutoutRect.left - this.bBoxRect.left) / zoom,\r\n      (top + this.cutoutRect.top - this.bBoxRect.top) / zoom,\r\n      this.cutoutRect.width / zoom,\r\n      this.cutoutRect.height / zoom,\r\n      zoom);\r\n  }\r\n\r\n  // Check if new location is within the limits.\r\n  static checkBound(currPan, img, cutout, delta) {\r\n    let nextDiff = Math.min(0, cutout[0] - img[0] - delta, img[1] - cutout[1] + delta);\r\n    if (nextDiff == 0) {\r\n      // Cutout is completely within the image.\r\n      currPan += delta;\r\n    } else if (Math.min(0, cutout[0] - img[0], img[1] - cutout[1]) < nextDiff) {\r\n      // Cutout is outside of the range but closer to the bound.\r\n      currPan += delta;\r\n    }\r\n    return currPan;\r\n  }\r\n\r\n  initScaling() {\r\n    // Initialize components.\r\n    const imgRect = this.preview.current.getBoundingClientRect();\r\n\r\n    this.imageWidth = imgRect.width;\r\n    this.imageHeight = imgRect.height;\r\n\r\n    // Set zoom slider's min and max values. Make sure the scaled image cannot be smaller than the cutout.\r\n    const minZoom = Math.max(this.cutoutRect.width / imgRect.width, this.cutoutRect.height / imgRect.height);\r\n    this.setState({\r\n      minZoom: minZoom,\r\n      maxZoom: Math.max(DEFAULT_MAX_ZOOM, minZoom + 1)\r\n    });\r\n\r\n    // Initial zoom level fills the bounding box at the smallest image dimension and overflows the largest, i.e. \"fill\" not \"fit\".\r\n    const zoom = Math.max(this.bBoxRect.width / imgRect.width, this.bBoxRect.height / imgRect.height);\r\n    // Converting from viewport coordinates to container, then panning.\r\n    const panX = this.cutoutRect.left - this.bBoxRect.left -\r\n      (imgRect.width - this.cutoutRect.width) / 2;\r\n    const panY = this.cutoutRect.top - this.bBoxRect.top -\r\n      (imgRect.height - this.cutoutRect.height) / 2;\r\n\r\n    this.positionAll(panX, panY, zoom);\r\n  }\r\n\r\n  onZoom(e) {\r\n    this.handleZoom(e.target.value);\r\n  }\r\n\r\n  handleZoom(zoom) {\r\n    let panX = this.state.panX;\r\n    let panY = this.state.panY;\r\n\r\n    // Ensure that the image at the new zoom is not outside of the cutout boundaries.\r\n    // Calculate image coordinates at the new zoom.\r\n    const imgLeft = this.originX - (this.originX - panX) * zoom;\r\n    const imgRight = imgLeft + this.imageWidth * zoom;\r\n    // Cutout in the same coordinates as the image.\r\n    const coLeft = this.cutoutRect.left - this.bBoxRect.left;\r\n    const coRight = coLeft + this.cutoutRect.width;\r\n    if (coLeft < imgLeft) {\r\n      panX -= imgLeft - coLeft;\r\n    } else if (coRight > imgRight) {\r\n      panX += coRight - imgRight;\r\n    }\r\n    const imgTop = this.originY - (this.originY - panY) * zoom;\r\n    const imgBottom = imgTop + this.imageHeight * zoom;\r\n    const coTop = this.cutoutRect.top - this.bBoxRect.top;\r\n    const coBottom = coTop + this.cutoutRect.height;\r\n    if (coTop < imgTop) {\r\n      panY -= imgTop - coTop;\r\n    } else if (coBottom > imgBottom) {\r\n      panY += coBottom - imgBottom;\r\n    }\r\n\r\n    this.positionAll(panX, panY, zoom);\r\n  }\r\n\r\n  mouseDown(e) {\r\n    if (e.touches) {\r\n      this.mouseX = e.touches[0].pageX;\r\n      this.mouseY = e.touches[0].pageY;\r\n    } else {\r\n      this.mouseX = e.pageX;\r\n      this.mouseY = e.pageY;\r\n    }\r\n\r\n    window.addEventListener('mousemove', this.mouseMove, { passive: false });\r\n    window.addEventListener('touchmove', this.mouseTouch, { passive: false });\r\n    window.addEventListener('mouseup', this.mouseUp, { passive: true });\r\n    window.addEventListener('touchend', this.mouseUp, { passive: true });\r\n    // Disable text selection in the entire document.\r\n    document.body.style['userSelect'] = 'none';\r\n  }\r\n\r\n  // Perform image panning.\r\n  translate(pageX, pageY) {\r\n    const dX = pageX - this.mouseX;\r\n    const dY = pageY - this.mouseY;\r\n\r\n    this.mouseX = pageX;\r\n    this.mouseY = pageY;\r\n\r\n    // Make sure the image is within the cutout window.\r\n    const imgRect = this.preview.current.getBoundingClientRect();\r\n\r\n    // Check if the new position is within the boundaries, and if not if it's closer to them.\r\n    let panX = Cropper.checkBound(this.state.panX, [imgRect.left, imgRect.right],\r\n      [this.cutoutRect.left, this.cutoutRect.right], dX);\r\n    let panY = Cropper.checkBound(this.state.panY, [imgRect.top, imgRect.bottom],\r\n      [this.cutoutRect.top, this.cutoutRect.bottom], dY);\r\n\r\n    this.positionAll(panX, panY, this.state.zoom);\r\n  }\r\n\r\n  // Image panning.\r\n  mouseMove(e) {\r\n    e.preventDefault();\r\n    this.translate(e.pageX, e.pageY);\r\n  }\r\n\r\n  mouseTouch(e) {\r\n    e.preventDefault();\r\n\r\n    if (e.touches.length == 1) {\r\n      this.translate(e.touches[0].pageX, e.touches[0].pageY);\r\n      return;\r\n    }\r\n\r\n    // Image zooming by pinching.\r\n    const [touch0, touch1] = e.touches;\r\n    const distance = Math.sqrt((touch0.pageX - touch1.pageX) * (touch0.pageX - touch1.pageX) +\r\n      (touch0.pageY - touch1.pageY) * (touch0.pageY - touch1.pageY));\r\n\r\n    if (!this.prevDistance) {\r\n        this.prevDistance = distance / this.state.zoom;\r\n    }\r\n\r\n    let scale = (distance / this.prevDistance);\r\n    this.handleZoom(Math.max(this.minZoom, Math.min(this.maxZoom, scale)));\r\n  }\r\n\r\n  mouseUp(e) {\r\n    window.removeEventListener('mousemove', this.mouseMove);\r\n    window.removeEventListener('touchmove', this.mouseTouch);\r\n    window.removeEventListener('mouseup', this.mouseUp);\r\n    window.removeEventListener('touchend', this.mouseUp);\r\n    // Re-enable text selection.\r\n    document.body.style['userSelect'] = '';\r\n\r\n    this.positionAll(this.state.panX, this.state.panY, this.state.zoom);\r\n  }\r\n\r\n  render() {\r\n    // transform3d: position and scale.\r\n    const t3d = `translate3d(${this.state.panX}px, ${this.state.panY}px, 0) scale(${this.state.zoom})`;\r\n    // transformOrigin: zoom origin.\r\n    const orig = `${this.state.originX}px ${this.state.originY}px`;\r\n\r\n    // Overlay position and size are exactly equal to the position and size of the transformed image\r\n    // except it uses different coordinates.\r\n    const overlay = {\r\n      top: `${this.originY - this.state.originY * this.state.zoom}px`,\r\n      left: `${this.originX - this.state.originX * this.state.zoom}px`,\r\n      width: `${this.imageWidth * this.state.zoom}px`,\r\n      height: `${this.imageHeight * this.state.zoom}px`\r\n    };\r\n    return (\r\n      <div className=\"cropper\">\r\n        <div className=\"bounding-box\" ref={this.boundingBox}>\r\n          <img src={this.props.source} className=\"preview\" alt=\"\"\r\n            style={{transform: t3d, transformOrigin: orig}} ref={this.preview} onLoad={this.initScaling} />\r\n          <div className=\"cutout circle\" ref={this.cutout} />\r\n          <div className=\"overlay\" style={overlay} ref={this.overlay} />\r\n        </div>\r\n        <div className=\"zoom-wrapper\">\r\n          <input type=\"range\" className=\"zoomer\"\r\n            step=\"0.001\" min={this.state.minZoom} max={this.state.maxZoom} value={this.state.zoom} onChange={this.onZoom} />\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","// Edit account parameters.\r\nimport React from 'react';\r\nimport { FormattedMessage } from 'react-intl';\r\n\r\nimport Cropper from './cropper.jsx';\r\nimport { imageCrop } from '../lib/blob-helpers.js';\r\n\r\nexport default class AvatarCrop extends React.PureComponent {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      top: 0,\r\n      left: 0,\r\n      width: 0,\r\n      height: 0,\r\n      scale: 1\r\n    };\r\n\r\n    this.handleSubmit = this.handleSubmit.bind(this);\r\n    this.handleChange = this.handleChange.bind(this);\r\n  }\r\n\r\n  // Cut out in image coordinates and desired scale factor.\r\n  handleChange(left, top, width, height, scale) {\r\n    this.setState({\r\n      left: left,\r\n      top: top,\r\n      width: width,\r\n      height: height,\r\n      scale: scale\r\n    });\r\n  }\r\n\r\n  handleSubmit() {\r\n    imageCrop(this.props.mime, this.props.avatar,\r\n      this.state.left, this.state.top, this.state.width, this.state.height,\r\n      this.state.scale)\r\n      .then(img => {\r\n        this.props.onSubmit(img.mime, img.blob, img.width, img.height);\r\n      })\r\n      .catch(err => {\r\n        this.props.onError(err);\r\n      });\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div className=\"panel-form\">\r\n        <div className=\"panel-form-row\">\r\n          <Cropper\r\n            source={this.props.avatar}\r\n            onChange={this.handleChange} />\r\n        </div>\r\n        <div className=\"dialog-buttons\">\r\n          {this.props.onCancel ?\r\n            <button className=\"secondary\" onClick={this.props.onCancel}>\r\n              <FormattedMessage id=\"button_cancel\" defaultMessage=\"Cancel\" description=\"Button [Cancel]\" />\r\n            </button>\r\n            : null}\r\n          <button className=\"primary\" onClick={this.handleSubmit}>\r\n            <FormattedMessage id=\"button_ok\" defaultMessage=\"OK\" description=\"Button [OK]\" />\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n};\r\n","import React from 'react';\r\n\r\nimport LetterTile from './letter-tile.jsx';\r\nimport LoadSpinner from './load-spinner.jsx';\r\n\r\nimport { sanitizeUrlForMime } from '../lib/utils.js';\r\n\r\nimport { AVATAR_SIZE } from '../config.js';\r\n\r\nexport default class AvatarUpload extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      source: props.avatar\r\n    };\r\n\r\n    this.handleFileReceived = this.handleFileReceived.bind(this);\r\n  }\r\n\r\n  componentDidUpdate(prevProps) {\r\n    if (this.props.avatar != prevProps.avatar) {\r\n      this.setState({source: this.props.avatar});\r\n    }\r\n  }\r\n\r\n  handleFileReceived(e) {\r\n    const image = e.target.files[0];\r\n    this.props.onImageUpdated(image.type, URL.createObjectURL(image), image.name);\r\n    // Clear the value so the same file can be uploaded again.\r\n    e.target.value = '';\r\n  }\r\n\r\n  render() {\r\n    // Randomize id value in case more than one AvatarUpload is shown\r\n    // at the same time.\r\n    const randId = 'file-input-avatar-' + ('' + Math.random()).substring(0, 4);\r\n    const className = 'avatar-upload' + (this.props.readOnly ? ' read-only' : '');\r\n    return (\r\n      <div className={className}>\r\n        {this.props.readOnly || !this.state.source ?\r\n          null :\r\n          <a href=\"#\" className=\"clear-avatar\" onClick={(e) => {e.preventDefault(); this.props.onImageUpdated();}}>\r\n            <i className=\"material-icons\">clear</i>\r\n          </a>}\r\n        {this.state.source ?\r\n          <img src={this.props.tinode.authorizeURL(sanitizeUrlForMime(this.state.source, 'image'))} className=\"preview\" /> :\r\n          this.props.readOnly && this.props.uid ?\r\n            <div className=\"avatar-box\">\r\n              <LetterTile\r\n                tinode={this.props.tinode}\r\n                avatar={true}\r\n                topic={this.props.uid}\r\n                title={this.props.title} />\r\n            </div>\r\n            :\r\n            <div className=\"blank\">{AVATAR_SIZE}&times;{AVATAR_SIZE}</div>}\r\n        {this.props.readOnly ? null :\r\n          <input type=\"file\" id={randId} className=\"inputfile hidden\"\r\n            accept=\"image/*\" onChange={this.handleFileReceived} />}\r\n        {this.props.readOnly ? null :\r\n        <label htmlFor={randId} className=\"round\">\r\n          <i className=\"material-icons\">file_upload</i>\r\n        </label>}\r\n        <LoadSpinner show={this.props.uploading} large={true} clear={true} centered={true} />\r\n      </div>\r\n    );\r\n  }\r\n};\r\n","import React from 'react';\r\nimport { defineMessages, injectIntl } from 'react-intl';\r\n\r\nconst icon_mapping = {'staff': 'verified_user'};\r\n\r\nconst messages = defineMessages({\r\n  badge_verified: {\r\n    id: 'badge_verified',\r\n    defaultMessage: 'Verified/official',\r\n    description: 'Explanation of a verified account or topic badge'\r\n  },\r\n  badge_staff: {\r\n    id: 'badge_staff',\r\n    defaultMessage: 'Staff-managed',\r\n    description: 'Explanation of a staff-managed account or topic badge'\r\n  },\r\n  badge_danger: {\r\n    id: 'badge_danger',\r\n    defaultMessage: 'Untrustworthy',\r\n    description: 'Suspicious or untrustworthy account or topic badge'\r\n  },\r\n});\r\n\r\n\r\n/* Trusted badges with labels: verified, staff, danger */\r\nclass BadgeList extends React.PureComponent {\r\n  render() {\r\n    const {formatMessage} = this.props.intl;\r\n    let badges = null;\r\n    if (this.props.trustedBadges && this.props.trustedBadges.length > 0) {\r\n      badges = [];\r\n      this.props.trustedBadges.forEach(b => {\r\n        const comment = this.props.short ? null : formatMessage(messages['badge_' + b]);\r\n        const style = 'material-icons ' + b + '-color';\r\n        badges.push(<div className=\"trusted-badge\" key={b}><i className={style}>{icon_mapping[b] || b}</i> {comment}</div>);\r\n      });\r\n      return <>{badges}</>;\r\n    }\r\n    return null;\r\n  }\r\n};\r\n\r\nexport default injectIntl(BadgeList);\r\n","import React from 'react';\r\n\r\n/* CheckBox: styled three-state checkbox, either clickable or static */\r\nexport default class CheckBox extends React.PureComponent {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.handleChange = this.handleChange.bind(this);\r\n  }\r\n\r\n  handleChange() {\r\n    this.props.onChange(this.props.name, !this.props.checked);\r\n  }\r\n\r\n  render() {\r\n    let classList = ['material-icons'];\r\n    let iconName;\r\n    if (Array.isArray(this.props.className)) {\r\n      classList.push(...this.props.className);\r\n    } else if (this.props.className) {\r\n      classList.push(this.props.className);\r\n    }\r\n    if (this.props.onChange) {\r\n      if (this.props.checked) {\r\n        classList.push('blue', 'clickable');\r\n        iconName = 'check_box';\r\n      } else if (this.props.checked === false) {\r\n        classList.push('blue', 'clickable');\r\n        iconName = 'check_box_outline_blank';\r\n      } else {\r\n        classList.push('lt-blue');\r\n        iconName = 'indeterminate_check_box';\r\n      }\r\n    } else {\r\n        if (this.props.checked) {\r\n          iconName = 'check_box';\r\n        } else {\r\n          iconName = 'check_box_outline_blank';\r\n        }\r\n    }\r\n    let attrs = {\r\n      className: classList.join(' '),\r\n      id: this.props.id,\r\n    };\r\n    if (this.props.onChange) {\r\n      attrs.onClick = this.handleChange;\r\n    }\r\n    return React.createElement('i', attrs, iconName);\r\n  }\r\n}\r\n","import React from 'react';\r\n\r\nimport { Tinode } from 'tinode-sdk';\r\n\r\nimport { idToColorClass } from '../lib/strformat.js';\r\nimport { sanitizeUrlForMime } from '../lib/utils.js';\r\n\r\nimport { SELF_AVATAR_URI } from '../config.js';\r\n\r\nexport default class LetterTile extends React.PureComponent {\r\n  render() {\r\n    let avatar;\r\n    if (this.props.avatar === true) {\r\n      if (Tinode.isSelfTopicName(this.props.topic)) {\r\n        avatar = <img className=\"avatar self\" alt=\"avatar\" src={SELF_AVATAR_URI} />\r\n      } else {\r\n        const isGroup = Tinode.isGroupTopicName(this.props.topic);\r\n        const iconColor = idToColorClass(this.props.topic, isGroup);\r\n\r\n        if (this.props.topic && this.props.title && this.props.title.trim()) {\r\n          const letter = this.props.title.trim().charAt(0);\r\n          const className = 'lettertile ' + iconColor + (this.props.deleted ? ' disabled' : '');\r\n          avatar = (<div className={className}><div>{letter}</div></div>)\r\n        } else {\r\n          const className = 'material-icons ' + iconColor + (this.props.deleted ? ' disabled' : '');\r\n          avatar = isGroup ? <i className={className}>group</i> : <i className={className}>person</i>;\r\n        }\r\n      }\r\n    } else if (this.props.avatar) {\r\n      const url = this.props.tinode.authorizeURL(sanitizeUrlForMime(this.props.avatar, 'image'));\r\n      // If avatar image is invalid, show a placeholder.\r\n      const className = 'avatar' + (this.props.deleted ? ' deleted' : '');\r\n      avatar = <img className={className} alt=\"avatar\" src={url}\r\n        onError={e=>{e.target.onerror = null; e.target.src=\"../img/broken_image.png\"}} />;\r\n    } else {\r\n      avatar = null;\r\n    }\r\n    return avatar;\r\n  }\r\n}\r\n","import React from 'react';\r\n\r\nexport default class LoadSpinner extends React.PureComponent {\r\n  render() {\r\n    const className = 'load-spinner-box' + (this.props.large ? ' large' : '')\r\n      + (this.props.clear ? ' clear' : '') + (this.props.centered ? ' centered' : '');\r\n    return (this.props.show ?\r\n      <div className={className}><div className=\"loader-spinner\"></div></div> : null);\r\n  }\r\n}\r\n","// Password with a visiblity toggle.\r\nimport React from 'react';\r\n\r\nexport default class VisiblePassword extends React.PureComponent {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.inputRef = React.createRef();\r\n\r\n    this.state = {\r\n      value: this.props.value || '',\r\n      visible: false\r\n    };\r\n\r\n    this.handleVisibility = this.handleVisibility.bind(this);\r\n    this.handeTextChange = this.handeTextChange.bind(this);\r\n    this.handleKeyDown = this.handleKeyDown.bind(this);\r\n    this.handleEditingFinished = this.handleEditingFinished.bind(this);\r\n  }\r\n\r\n  componentDidMount() {\r\n    if (this.props.autoFocus) {\r\n      this.inputRef.current.focus();\r\n    }\r\n  }\r\n\r\n  handeTextChange(e) {\r\n    this.setState({value: e.target.value});\r\n    if (this.props.onChange) {\r\n      this.props.onChange(e);\r\n    }\r\n  }\r\n\r\n  handleVisibility(e) {\r\n    e.preventDefault();\r\n    this.setState({visible: !this.state.visible});\r\n  }\r\n\r\n  handleKeyDown(e) {\r\n    if (e.keyCode == 27) {\r\n      // Escape pressed\r\n      this.setState({value: this.props.value || '', visible: false});\r\n      if (this.props.onFinished) {\r\n        this.props.onFinished();\r\n      }\r\n    } else if (e.keyCode == 13) {\r\n      // Enter pressed\r\n      this.handleEditingFinished();\r\n    }\r\n  }\r\n\r\n  handleEditingFinished(e) {\r\n    if (e) {\r\n      let currentTarget = e.currentTarget;\r\n      setTimeout(_ => {\r\n        if (!currentTarget.contains(document.activeElement)) {\r\n          if (this.props.onFinished) {\r\n            this.props.onFinished(this.state.value);\r\n          }\r\n        }\r\n      }, 0);\r\n    } else if (this.props.onFinished) {\r\n      this.props.onFinished(this.state.value.trim());\r\n    }\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div tabIndex=\"-1\" className=\"group-focus\" onBlur={this.handleEditingFinished}>\r\n        <input className=\"with-icon-right\"\r\n          type={this.state.visible ? 'text' : 'password'}\r\n          value={this.state.value}\r\n          placeholder={this.props.placeholder}\r\n          maxLength={32}\r\n          required={this.props.required ? 'required' : ''}\r\n          autoFocus={this.props.autoFocus ? 'autoFocus' : ''}\r\n          autoComplete={this.props.autoComplete}\r\n          onChange={this.handeTextChange}\r\n          onKeyDown={this.handleKeyDown}\r\n          ref={this.inputRef} />\r\n        <span onClick={this.handleVisibility}>\r\n          <i className=\"material-icons clickable light-gray\">\r\n            {this.state.visible ? 'visibility' : 'visibility_off'}\r\n          </i>\r\n        </span>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","'use strict';\n\nvar m = require('react-dom');\nif (process.env.NODE_ENV === 'production') {\n  exports.createRoot = m.createRoot;\n  exports.hydrateRoot = m.hydrateRoot;\n} else {\n  var i = m.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;\n  exports.createRoot = function(c, o) {\n    i.usingClientEntryPoint = true;\n    try {\n      return m.createRoot(c, o);\n    } finally {\n      i.usingClientEntryPoint = false;\n    }\n  };\n  exports.hydrateRoot = function(c, h, o) {\n    i.usingClientEntryPoint = true;\n    try {\n      return m.hydrateRoot(c, h, o);\n    } finally {\n      i.usingClientEntryPoint = false;\n    }\n  };\n}\n","module.exports = React;","module.exports = ReactDOM;","module.exports = ReactIntl;","module.exports = tinode;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = function(module) {\n\tvar getter = module && module.__esModule ?\n\t\tfunction() { return module['default']; } :\n\t\tfunction() { return module; };\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = function(exports, definition) {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.f = {};\n// This file contains only the entry chunk.\n// The chunk loading function for additional chunks\n__webpack_require__.e = function(chunkId) {\n\treturn Promise.all(Object.keys(__webpack_require__.f).reduce(function(promises, key) {\n\t\t__webpack_require__.f[key](chunkId, promises);\n\t\treturn promises;\n\t}, []));\n};","// This function allow to reference async chunks\n__webpack_require__.u = function(chunkId) {\n\t// return url for filenames based on template\n\treturn \"\" + chunkId + \".prod.js\";\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }","// define __esModule on exports\n__webpack_require__.r = function(exports) {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","__webpack_require__.p = \"/umd/\";","// no baseURI\n\n// object to store loaded and loading chunks\n// undefined = chunk not loaded, null = chunk preloaded/prefetched\n// [resolve, reject, Promise] = chunk loading, 0 = chunk loaded\nvar installedChunks = {\n\t656: 0\n};\n\n__webpack_require__.f.j = function(chunkId, promises) {\n\t\t// JSONP chunk loading for javascript\n\t\tvar installedChunkData = __webpack_require__.o(installedChunks, chunkId) ? installedChunks[chunkId] : undefined;\n\t\tif(installedChunkData !== 0) { // 0 means \"already installed\".\n\n\t\t\t// a Promise means \"currently loading\".\n\t\t\tif(installedChunkData) {\n\t\t\t\tpromises.push(installedChunkData[2]);\n\t\t\t} else {\n\t\t\t\tif(true) { // all chunks have JS\n\t\t\t\t\t// setup Promise in chunk cache\n\t\t\t\t\tvar promise = new Promise(function(resolve, reject) { installedChunkData = installedChunks[chunkId] = [resolve, reject]; });\n\t\t\t\t\tpromises.push(installedChunkData[2] = promise);\n\n\t\t\t\t\t// start chunk loading\n\t\t\t\t\tvar url = __webpack_require__.p + __webpack_require__.u(chunkId);\n\t\t\t\t\t// create error before stack unwound to get useful stacktrace later\n\t\t\t\t\tvar error = new Error();\n\t\t\t\t\tvar loadingEnded = function(event) {\n\t\t\t\t\t\tif(__webpack_require__.o(installedChunks, chunkId)) {\n\t\t\t\t\t\t\tinstalledChunkData = installedChunks[chunkId];\n\t\t\t\t\t\t\tif(installedChunkData !== 0) installedChunks[chunkId] = undefined;\n\t\t\t\t\t\t\tif(installedChunkData) {\n\t\t\t\t\t\t\t\tvar errorType = event && (event.type === 'load' ? 'missing' : event.type);\n\t\t\t\t\t\t\t\tvar realSrc = event && event.target && event.target.src;\n\t\t\t\t\t\t\t\terror.message = 'Loading chunk ' + chunkId + ' failed.\\n(' + errorType + ': ' + realSrc + ')';\n\t\t\t\t\t\t\t\terror.name = 'ChunkLoadError';\n\t\t\t\t\t\t\t\terror.type = errorType;\n\t\t\t\t\t\t\t\terror.request = realSrc;\n\t\t\t\t\t\t\t\tinstalledChunkData[1](error);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t\t__webpack_require__.l(url, loadingEnded, \"chunk-\" + chunkId, chunkId);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n};\n\n// no prefetching\n\n// no preloaded\n\n// no HMR\n\n// no HMR manifest\n\n// no on chunks loaded\n\n// install a JSONP callback for chunk loading\nvar webpackJsonpCallback = function(parentChunkLoadingFunction, data) {\n\tvar chunkIds = data[0];\n\tvar moreModules = data[1];\n\tvar runtime = data[2];\n\t// add \"moreModules\" to the modules object,\n\t// then flag all \"chunkIds\" as loaded and fire callback\n\tvar moduleId, chunkId, i = 0;\n\tif(chunkIds.some(function(id) { return installedChunks[id] !== 0; })) {\n\t\tfor(moduleId in moreModules) {\n\t\t\tif(__webpack_require__.o(moreModules, moduleId)) {\n\t\t\t\t__webpack_require__.m[moduleId] = moreModules[moduleId];\n\t\t\t}\n\t\t}\n\t\tif(runtime) var result = runtime(__webpack_require__);\n\t}\n\tif(parentChunkLoadingFunction) parentChunkLoadingFunction(data);\n\tfor(;i < chunkIds.length; i++) {\n\t\tchunkId = chunkIds[i];\n\t\tif(__webpack_require__.o(installedChunks, chunkId) && installedChunks[chunkId]) {\n\t\t\tinstalledChunks[chunkId][0]();\n\t\t}\n\t\tinstalledChunks[chunkId] = 0;\n\t}\n\n}\n\nvar chunkLoadingGlobal = self[\"webpackChunkim\"] = self[\"webpackChunkim\"] || [];\nchunkLoadingGlobal.forEach(webpackJsonpCallback.bind(null, 0));\nchunkLoadingGlobal.push = webpackJsonpCallback.bind(null, chunkLoadingGlobal.push.bind(chunkLoadingGlobal));","const getDefaultsFromPostinstall = () => (undefined);\nexport { getDefaultsFromPostinstall };","import { getDefaultsFromPostinstall } from './postinstall.mjs';\n\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/**\n * @fileoverview Firebase constants.  Some of these (@defines) can be overridden at compile-time.\n */\nconst CONSTANTS = {\n    /**\n     * @define {boolean} Whether this is the client Node.js SDK.\n     */\n    NODE_CLIENT: false,\n    /**\n     * @define {boolean} Whether this is the Admin Node.js SDK.\n     */\n    NODE_ADMIN: false,\n    /**\n     * Firebase SDK Version\n     */\n    SDK_VERSION: '${JSCORE_VERSION}'\n};\n\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/**\n * Throws an error if the provided assertion is falsy\n */\nconst assert = function (assertion, message) {\n    if (!assertion) {\n        throw assertionError(message);\n    }\n};\n/**\n * Returns an Error object suitable for throwing.\n */\nconst assertionError = function (message) {\n    return new Error('Firebase Database (' +\n        CONSTANTS.SDK_VERSION +\n        ') INTERNAL ASSERT FAILED: ' +\n        message);\n};\n\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nconst stringToByteArray$1 = function (str) {\n    // TODO(user): Use native implementations if/when available\n    const out = [];\n    let p = 0;\n    for (let i = 0; i < str.length; i++) {\n        let c = str.charCodeAt(i);\n        if (c < 128) {\n            out[p++] = c;\n        }\n        else if (c < 2048) {\n            out[p++] = (c >> 6) | 192;\n            out[p++] = (c & 63) | 128;\n        }\n        else if ((c & 0xfc00) === 0xd800 &&\n            i + 1 < str.length &&\n            (str.charCodeAt(i + 1) & 0xfc00) === 0xdc00) {\n            // Surrogate Pair\n            c = 0x10000 + ((c & 0x03ff) << 10) + (str.charCodeAt(++i) & 0x03ff);\n            out[p++] = (c >> 18) | 240;\n            out[p++] = ((c >> 12) & 63) | 128;\n            out[p++] = ((c >> 6) & 63) | 128;\n            out[p++] = (c & 63) | 128;\n        }\n        else {\n            out[p++] = (c >> 12) | 224;\n            out[p++] = ((c >> 6) & 63) | 128;\n            out[p++] = (c & 63) | 128;\n        }\n    }\n    return out;\n};\n/**\n * Turns an array of numbers into the string given by the concatenation of the\n * characters to which the numbers correspond.\n * @param bytes Array of numbers representing characters.\n * @return Stringification of the array.\n */\nconst byteArrayToString = function (bytes) {\n    // TODO(user): Use native implementations if/when available\n    const out = [];\n    let pos = 0, c = 0;\n    while (pos < bytes.length) {\n        const c1 = bytes[pos++];\n        if (c1 < 128) {\n            out[c++] = String.fromCharCode(c1);\n        }\n        else if (c1 > 191 && c1 < 224) {\n            const c2 = bytes[pos++];\n            out[c++] = String.fromCharCode(((c1 & 31) << 6) | (c2 & 63));\n        }\n        else if (c1 > 239 && c1 < 365) {\n            // Surrogate Pair\n            const c2 = bytes[pos++];\n            const c3 = bytes[pos++];\n            const c4 = bytes[pos++];\n            const u = (((c1 & 7) << 18) | ((c2 & 63) << 12) | ((c3 & 63) << 6) | (c4 & 63)) -\n                0x10000;\n            out[c++] = String.fromCharCode(0xd800 + (u >> 10));\n            out[c++] = String.fromCharCode(0xdc00 + (u & 1023));\n        }\n        else {\n            const c2 = bytes[pos++];\n            const c3 = bytes[pos++];\n            out[c++] = String.fromCharCode(((c1 & 15) << 12) | ((c2 & 63) << 6) | (c3 & 63));\n        }\n    }\n    return out.join('');\n};\n// We define it as an object literal instead of a class because a class compiled down to es5 can't\n// be treeshaked. https://github.com/rollup/rollup/issues/1691\n// Static lookup maps, lazily populated by init_()\n// TODO(dlarocque): Define this as a class, since we no longer target ES5.\nconst base64 = {\n    /**\n     * Maps bytes to characters.\n     */\n    byteToCharMap_: null,\n    /**\n     * Maps characters to bytes.\n     */\n    charToByteMap_: null,\n    /**\n     * Maps bytes to websafe characters.\n     * @private\n     */\n    byteToCharMapWebSafe_: null,\n    /**\n     * Maps websafe characters to bytes.\n     * @private\n     */\n    charToByteMapWebSafe_: null,\n    /**\n     * Our default alphabet, shared between\n     * ENCODED_VALS and ENCODED_VALS_WEBSAFE\n     */\n    ENCODED_VALS_BASE: 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' + 'abcdefghijklmnopqrstuvwxyz' + '0123456789',\n    /**\n     * Our default alphabet. Value 64 (=) is special; it means \"nothing.\"\n     */\n    get ENCODED_VALS() {\n        return this.ENCODED_VALS_BASE + '+/=';\n    },\n    /**\n     * Our websafe alphabet.\n     */\n    get ENCODED_VALS_WEBSAFE() {\n        return this.ENCODED_VALS_BASE + '-_.';\n    },\n    /**\n     * Whether this browser supports the atob and btoa functions. This extension\n     * started at Mozilla but is now implemented by many browsers. We use the\n     * ASSUME_* variables to avoid pulling in the full useragent detection library\n     * but still allowing the standard per-browser compilations.\n     *\n     */\n    HAS_NATIVE_SUPPORT: typeof atob === 'function',\n    /**\n     * Base64-encode an array of bytes.\n     *\n     * @param input An array of bytes (numbers with\n     *     value in [0, 255]) to encode.\n     * @param webSafe Boolean indicating we should use the\n     *     alternative alphabet.\n     * @return The base64 encoded string.\n     */\n    encodeByteArray(input, webSafe) {\n        if (!Array.isArray(input)) {\n            throw Error('encodeByteArray takes an array as a parameter');\n        }\n        this.init_();\n        const byteToCharMap = webSafe\n            ? this.byteToCharMapWebSafe_\n            : this.byteToCharMap_;\n        const output = [];\n        for (let i = 0; i < input.length; i += 3) {\n            const byte1 = input[i];\n            const haveByte2 = i + 1 < input.length;\n            const byte2 = haveByte2 ? input[i + 1] : 0;\n            const haveByte3 = i + 2 < input.length;\n            const byte3 = haveByte3 ? input[i + 2] : 0;\n            const outByte1 = byte1 >> 2;\n            const outByte2 = ((byte1 & 0x03) << 4) | (byte2 >> 4);\n            let outByte3 = ((byte2 & 0x0f) << 2) | (byte3 >> 6);\n            let outByte4 = byte3 & 0x3f;\n            if (!haveByte3) {\n                outByte4 = 64;\n                if (!haveByte2) {\n                    outByte3 = 64;\n                }\n            }\n            output.push(byteToCharMap[outByte1], byteToCharMap[outByte2], byteToCharMap[outByte3], byteToCharMap[outByte4]);\n        }\n        return output.join('');\n    },\n    /**\n     * Base64-encode a string.\n     *\n     * @param input A string to encode.\n     * @param webSafe If true, we should use the\n     *     alternative alphabet.\n     * @return The base64 encoded string.\n     */\n    encodeString(input, webSafe) {\n        // Shortcut for Mozilla browsers that implement\n        // a native base64 encoder in the form of \"btoa/atob\"\n        if (this.HAS_NATIVE_SUPPORT && !webSafe) {\n            return btoa(input);\n        }\n        return this.encodeByteArray(stringToByteArray$1(input), webSafe);\n    },\n    /**\n     * Base64-decode a string.\n     *\n     * @param input to decode.\n     * @param webSafe True if we should use the\n     *     alternative alphabet.\n     * @return string representing the decoded value.\n     */\n    decodeString(input, webSafe) {\n        // Shortcut for Mozilla browsers that implement\n        // a native base64 encoder in the form of \"btoa/atob\"\n        if (this.HAS_NATIVE_SUPPORT && !webSafe) {\n            return atob(input);\n        }\n        return byteArrayToString(this.decodeStringToByteArray(input, webSafe));\n    },\n    /**\n     * Base64-decode a string.\n     *\n     * In base-64 decoding, groups of four characters are converted into three\n     * bytes.  If the encoder did not apply padding, the input length may not\n     * be a multiple of 4.\n     *\n     * In this case, the last group will have fewer than 4 characters, and\n     * padding will be inferred.  If the group has one or two characters, it decodes\n     * to one byte.  If the group has three characters, it decodes to two bytes.\n     *\n     * @param input Input to decode.\n     * @param webSafe True if we should use the web-safe alphabet.\n     * @return bytes representing the decoded value.\n     */\n    decodeStringToByteArray(input, webSafe) {\n        this.init_();\n        const charToByteMap = webSafe\n            ? this.charToByteMapWebSafe_\n            : this.charToByteMap_;\n        const output = [];\n        for (let i = 0; i < input.length;) {\n            const byte1 = charToByteMap[input.charAt(i++)];\n            const haveByte2 = i < input.length;\n            const byte2 = haveByte2 ? charToByteMap[input.charAt(i)] : 0;\n            ++i;\n            const haveByte3 = i < input.length;\n            const byte3 = haveByte3 ? charToByteMap[input.charAt(i)] : 64;\n            ++i;\n            const haveByte4 = i < input.length;\n            const byte4 = haveByte4 ? charToByteMap[input.charAt(i)] : 64;\n            ++i;\n            if (byte1 == null || byte2 == null || byte3 == null || byte4 == null) {\n                throw new DecodeBase64StringError();\n            }\n            const outByte1 = (byte1 << 2) | (byte2 >> 4);\n            output.push(outByte1);\n            if (byte3 !== 64) {\n                const outByte2 = ((byte2 << 4) & 0xf0) | (byte3 >> 2);\n                output.push(outByte2);\n                if (byte4 !== 64) {\n                    const outByte3 = ((byte3 << 6) & 0xc0) | byte4;\n                    output.push(outByte3);\n                }\n            }\n        }\n        return output;\n    },\n    /**\n     * Lazy static initialization function. Called before\n     * accessing any of the static map variables.\n     * @private\n     */\n    init_() {\n        if (!this.byteToCharMap_) {\n            this.byteToCharMap_ = {};\n            this.charToByteMap_ = {};\n            this.byteToCharMapWebSafe_ = {};\n            this.charToByteMapWebSafe_ = {};\n            // We want quick mappings back and forth, so we precompute two maps.\n            for (let i = 0; i < this.ENCODED_VALS.length; i++) {\n                this.byteToCharMap_[i] = this.ENCODED_VALS.charAt(i);\n                this.charToByteMap_[this.byteToCharMap_[i]] = i;\n                this.byteToCharMapWebSafe_[i] = this.ENCODED_VALS_WEBSAFE.charAt(i);\n                this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[i]] = i;\n                // Be forgiving when decoding and correctly decode both encodings.\n                if (i >= this.ENCODED_VALS_BASE.length) {\n                    this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(i)] = i;\n                    this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(i)] = i;\n                }\n            }\n        }\n    }\n};\n/**\n * An error encountered while decoding base64 string.\n */\nclass DecodeBase64StringError extends Error {\n    constructor() {\n        super(...arguments);\n        this.name = 'DecodeBase64StringError';\n    }\n}\n/**\n * URL-safe base64 encoding\n */\nconst base64Encode = function (str) {\n    const utf8Bytes = stringToByteArray$1(str);\n    return base64.encodeByteArray(utf8Bytes, true);\n};\n/**\n * URL-safe base64 encoding (without \".\" padding in the end).\n * e.g. Used in JSON Web Token (JWT) parts.\n */\nconst base64urlEncodeWithoutPadding = function (str) {\n    // Use base64url encoding and remove padding in the end (dot characters).\n    return base64Encode(str).replace(/\\./g, '');\n};\n/**\n * URL-safe base64 decoding\n *\n * NOTE: DO NOT use the global atob() function - it does NOT support the\n * base64Url variant encoding.\n *\n * @param str To be decoded\n * @return Decoded result, if possible\n */\nconst base64Decode = function (str) {\n    try {\n        return base64.decodeString(str, true);\n    }\n    catch (e) {\n        console.error('base64Decode failed: ', e);\n    }\n    return null;\n};\n\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/**\n * Do a deep-copy of basic JavaScript Objects or Arrays.\n */\nfunction deepCopy(value) {\n    return deepExtend(undefined, value);\n}\n/**\n * Copy properties from source to target (recursively allows extension\n * of Objects and Arrays).  Scalar values in the target are over-written.\n * If target is undefined, an object of the appropriate type will be created\n * (and returned).\n *\n * We recursively copy all child properties of plain Objects in the source- so\n * that namespace- like dictionaries are merged.\n *\n * Note that the target can be a function, in which case the properties in\n * the source Object are copied onto it as static properties of the Function.\n *\n * Note: we don't merge __proto__ to prevent prototype pollution\n */\nfunction deepExtend(target, source) {\n    if (!(source instanceof Object)) {\n        return source;\n    }\n    switch (source.constructor) {\n        case Date:\n            // Treat Dates like scalars; if the target date object had any child\n            // properties - they will be lost!\n            const dateValue = source;\n            return new Date(dateValue.getTime());\n        case Object:\n            if (target === undefined) {\n                target = {};\n            }\n            break;\n        case Array:\n            // Always copy the array source and overwrite the target.\n            target = [];\n            break;\n        default:\n            // Not a plain Object - treat it as a scalar.\n            return source;\n    }\n    for (const prop in source) {\n        // use isValidKey to guard against prototype pollution. See https://snyk.io/vuln/SNYK-JS-LODASH-450202\n        if (!source.hasOwnProperty(prop) || !isValidKey(prop)) {\n            continue;\n        }\n        target[prop] = deepExtend(target[prop], source[prop]);\n    }\n    return target;\n}\nfunction isValidKey(key) {\n    return key !== '__proto__';\n}\n\n/**\n * @license\n * Copyright 2022 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/**\n * Polyfill for `globalThis` object.\n * @returns the `globalThis` object for the given environment.\n * @public\n */\nfunction getGlobal() {\n    if (typeof self !== 'undefined') {\n        return self;\n    }\n    if (typeof window !== 'undefined') {\n        return window;\n    }\n    if (typeof global !== 'undefined') {\n        return global;\n    }\n    throw new Error('Unable to locate global object.');\n}\n\n/**\n * @license\n * Copyright 2022 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nconst getDefaultsFromGlobal = () => getGlobal().__FIREBASE_DEFAULTS__;\n/**\n * Attempt to read defaults from a JSON string provided to\n * process(.)env(.)__FIREBASE_DEFAULTS__ or a JSON file whose path is in\n * process(.)env(.)__FIREBASE_DEFAULTS_PATH__\n * The dots are in parens because certain compilers (Vite?) cannot\n * handle seeing that variable in comments.\n * See https://github.com/firebase/firebase-js-sdk/issues/6838\n */\nconst getDefaultsFromEnvVariable = () => {\n    if (typeof process === 'undefined' || typeof process.env === 'undefined') {\n        return;\n    }\n    const defaultsJsonString = process.env.__FIREBASE_DEFAULTS__;\n    if (defaultsJsonString) {\n        return JSON.parse(defaultsJsonString);\n    }\n};\nconst getDefaultsFromCookie = () => {\n    if (typeof document === 'undefined') {\n        return;\n    }\n    let match;\n    try {\n        match = document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/);\n    }\n    catch (e) {\n        // Some environments such as Angular Universal SSR have a\n        // `document` object but error on accessing `document.cookie`.\n        return;\n    }\n    const decoded = match && base64Decode(match[1]);\n    return decoded && JSON.parse(decoded);\n};\n/**\n * Get the __FIREBASE_DEFAULTS__ object. It checks in order:\n * (1) if such an object exists as a property of `globalThis`\n * (2) if such an object was provided on a shell environment variable\n * (3) if such an object exists in a cookie\n * @public\n */\nconst getDefaults = () => {\n    try {\n        return (getDefaultsFromPostinstall() ||\n            getDefaultsFromGlobal() ||\n            getDefaultsFromEnvVariable() ||\n            getDefaultsFromCookie());\n    }\n    catch (e) {\n        /**\n         * Catch-all for being unable to get __FIREBASE_DEFAULTS__ due\n         * to any environment case we have not accounted for. Log to\n         * info instead of swallowing so we can find these unknown cases\n         * and add paths for them if needed.\n         */\n        console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);\n        return;\n    }\n};\n/**\n * Returns emulator host stored in the __FIREBASE_DEFAULTS__ object\n * for the given product.\n * @returns a URL host formatted like `127.0.0.1:9999` or `[::1]:4000` if available\n * @public\n */\nconst getDefaultEmulatorHost = (productName) => { var _a, _b; return (_b = (_a = getDefaults()) === null || _a === void 0 ? void 0 : _a.emulatorHosts) === null || _b === void 0 ? void 0 : _b[productName]; };\n/**\n * Returns emulator hostname and port stored in the __FIREBASE_DEFAULTS__ object\n * for the given product.\n * @returns a pair of hostname and port like `[\"::1\", 4000]` if available\n * @public\n */\nconst getDefaultEmulatorHostnameAndPort = (productName) => {\n    const host = getDefaultEmulatorHost(productName);\n    if (!host) {\n        return undefined;\n    }\n    const separatorIndex = host.lastIndexOf(':'); // Finding the last since IPv6 addr also has colons.\n    if (separatorIndex <= 0 || separatorIndex + 1 === host.length) {\n        throw new Error(`Invalid host ${host} with no separate hostname and port!`);\n    }\n    // eslint-disable-next-line no-restricted-globals\n    const port = parseInt(host.substring(separatorIndex + 1), 10);\n    if (host[0] === '[') {\n        // Bracket-quoted `[ipv6addr]:port` => return \"ipv6addr\" (without brackets).\n        return [host.substring(1, separatorIndex - 1), port];\n    }\n    else {\n        return [host.substring(0, separatorIndex), port];\n    }\n};\n/**\n * Returns Firebase app config stored in the __FIREBASE_DEFAULTS__ object.\n * @public\n */\nconst getDefaultAppConfig = () => { var _a; return (_a = getDefaults()) === null || _a === void 0 ? void 0 : _a.config; };\n/**\n * Returns an experimental setting on the __FIREBASE_DEFAULTS__ object (properties\n * prefixed by \"_\")\n * @public\n */\nconst getExperimentalSetting = (name) => { var _a; return (_a = getDefaults()) === null || _a === void 0 ? void 0 : _a[`_${name}`]; };\n\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nclass Deferred {\n    constructor() {\n        this.reject = () => { };\n        this.resolve = () => { };\n        this.promise = new Promise((resolve, reject) => {\n            this.resolve = resolve;\n            this.reject = reject;\n        });\n    }\n    /**\n     * Our API internals are not promisified and cannot because our callback APIs have subtle expectations around\n     * invoking promises inline, which Promises are forbidden to do. This method accepts an optional node-style callback\n     * and returns a node-style callback which will resolve or reject the Deferred's promise.\n     */\n    wrapCallback(callback) {\n        return (error, value) => {\n            if (error) {\n                this.reject(error);\n            }\n            else {\n                this.resolve(value);\n            }\n            if (typeof callback === 'function') {\n                // Attaching noop handler just in case developer wasn't expecting\n                // promises\n                this.promise.catch(() => { });\n                // Some of our callbacks don't expect a value and our own tests\n                // assert that the parameter length is 1\n                if (callback.length === 1) {\n                    callback(error);\n                }\n                else {\n                    callback(error, value);\n                }\n            }\n        };\n    }\n}\n\n/**\n * @license\n * Copyright 2025 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/**\n * Checks whether host is a cloud workstation or not.\n * @public\n */\nfunction isCloudWorkstation(url) {\n    // `isCloudWorkstation` is called without protocol in certain connect*Emulator functions\n    // In HTTP request builders, it's called with the protocol.\n    // If called with protocol prefix, it's a valid URL, so we extract the hostname\n    // If called without, we assume the string is the hostname.\n    try {\n        const host = url.startsWith('http://') || url.startsWith('https://')\n            ? new URL(url).hostname\n            : url;\n        return host.endsWith('.cloudworkstations.dev');\n    }\n    catch (_a) {\n        return false;\n    }\n}\n/**\n * Makes a fetch request to the given server.\n * Mostly used for forwarding cookies in Firebase Studio.\n * @public\n */\nasync function pingServer(endpoint) {\n    const result = await fetch(endpoint, {\n        credentials: 'include'\n    });\n    return result.ok;\n}\n\n/**\n * @license\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nfunction createMockUserToken(token, projectId) {\n    if (token.uid) {\n        throw new Error('The \"uid\" field is no longer supported by mockUserToken. Please use \"sub\" instead for Firebase Auth User ID.');\n    }\n    // Unsecured JWTs use \"none\" as the algorithm.\n    const header = {\n        alg: 'none',\n        type: 'JWT'\n    };\n    const project = projectId || 'demo-project';\n    const iat = token.iat || 0;\n    const sub = token.sub || token.user_id;\n    if (!sub) {\n        throw new Error(\"mockUserToken must contain 'sub' or 'user_id' field!\");\n    }\n    const payload = Object.assign({ \n        // Set all required fields to decent defaults\n        iss: `https://securetoken.google.com/${project}`, aud: project, iat, exp: iat + 3600, auth_time: iat, sub, user_id: sub, firebase: {\n            sign_in_provider: 'custom',\n            identities: {}\n        } }, token);\n    // Unsecured JWTs use the empty string as a signature.\n    const signature = '';\n    return [\n        base64urlEncodeWithoutPadding(JSON.stringify(header)),\n        base64urlEncodeWithoutPadding(JSON.stringify(payload)),\n        signature\n    ].join('.');\n}\nconst emulatorStatus = {};\n// Checks whether any products are running on an emulator\nfunction getEmulatorSummary() {\n    const summary = {\n        prod: [],\n        emulator: []\n    };\n    for (const key of Object.keys(emulatorStatus)) {\n        if (emulatorStatus[key]) {\n            summary.emulator.push(key);\n        }\n        else {\n            summary.prod.push(key);\n        }\n    }\n    return summary;\n}\nfunction getOrCreateEl(id) {\n    let parentDiv = document.getElementById(id);\n    let created = false;\n    if (!parentDiv) {\n        parentDiv = document.createElement('div');\n        parentDiv.setAttribute('id', id);\n        created = true;\n    }\n    return { created, element: parentDiv };\n}\nlet previouslyDismissed = false;\n/**\n * Updates Emulator Banner. Primarily used for Firebase Studio\n * @param name\n * @param isRunningEmulator\n * @public\n */\nfunction updateEmulatorBanner(name, isRunningEmulator) {\n    if (typeof window === 'undefined' ||\n        typeof document === 'undefined' ||\n        !isCloudWorkstation(window.location.host) ||\n        emulatorStatus[name] === isRunningEmulator ||\n        emulatorStatus[name] || // If already set to use emulator, can't go back to prod.\n        previouslyDismissed) {\n        return;\n    }\n    emulatorStatus[name] = isRunningEmulator;\n    function prefixedId(id) {\n        return `__firebase__banner__${id}`;\n    }\n    const bannerId = '__firebase__banner';\n    const summary = getEmulatorSummary();\n    const showError = summary.prod.length > 0;\n    function tearDown() {\n        const element = document.getElementById(bannerId);\n        if (element) {\n            element.remove();\n        }\n    }\n    function setupBannerStyles(bannerEl) {\n        bannerEl.style.display = 'flex';\n        bannerEl.style.background = '#7faaf0';\n        bannerEl.style.position = 'fixed';\n        bannerEl.style.bottom = '5px';\n        bannerEl.style.left = '5px';\n        bannerEl.style.padding = '.5em';\n        bannerEl.style.borderRadius = '5px';\n        bannerEl.style.alignItems = 'center';\n    }\n    function setupIconStyles(prependIcon, iconId) {\n        prependIcon.setAttribute('width', '24');\n        prependIcon.setAttribute('id', iconId);\n        prependIcon.setAttribute('height', '24');\n        prependIcon.setAttribute('viewBox', '0 0 24 24');\n        prependIcon.setAttribute('fill', 'none');\n        prependIcon.style.marginLeft = '-6px';\n    }\n    function setupCloseBtn() {\n        const closeBtn = document.createElement('span');\n        closeBtn.style.cursor = 'pointer';\n        closeBtn.style.marginLeft = '16px';\n        closeBtn.style.fontSize = '24px';\n        closeBtn.innerHTML = ' &times;';\n        closeBtn.onclick = () => {\n            previouslyDismissed = true;\n            tearDown();\n        };\n        return closeBtn;\n    }\n    function setupLinkStyles(learnMoreLink, learnMoreId) {\n        learnMoreLink.setAttribute('id', learnMoreId);\n        learnMoreLink.innerText = 'Learn more';\n        learnMoreLink.href =\n            'https://firebase.google.com/docs/studio/preview-apps#preview-backend';\n        learnMoreLink.setAttribute('target', '__blank');\n        learnMoreLink.style.paddingLeft = '5px';\n        learnMoreLink.style.textDecoration = 'underline';\n    }\n    function setupDom() {\n        const banner = getOrCreateEl(bannerId);\n        const firebaseTextId = prefixedId('text');\n        const firebaseText = document.getElementById(firebaseTextId) || document.createElement('span');\n        const learnMoreId = prefixedId('learnmore');\n        const learnMoreLink = document.getElementById(learnMoreId) ||\n            document.createElement('a');\n        const prependIconId = prefixedId('preprendIcon');\n        const prependIcon = document.getElementById(prependIconId) ||\n            document.createElementNS('http://www.w3.org/2000/svg', 'svg');\n        if (banner.created) {\n            // update styles\n            const bannerEl = banner.element;\n            setupBannerStyles(bannerEl);\n            setupLinkStyles(learnMoreLink, learnMoreId);\n            const closeBtn = setupCloseBtn();\n            setupIconStyles(prependIcon, prependIconId);\n            bannerEl.append(prependIcon, firebaseText, learnMoreLink, closeBtn);\n            document.body.appendChild(bannerEl);\n        }\n        if (showError) {\n            firebaseText.innerText = `Preview backend disconnected.`;\n            prependIcon.innerHTML = `<g clip-path=\"url(#clip0_6013_33858)\">\n<path d=\"M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z\" fill=\"#212121\"/>\n</g>\n<defs>\n<clipPath id=\"clip0_6013_33858\">\n<rect width=\"24\" height=\"24\" fill=\"white\"/>\n</clipPath>\n</defs>`;\n        }\n        else {\n            prependIcon.innerHTML = `<g clip-path=\"url(#clip0_6083_34804)\">\n<path d=\"M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z\" fill=\"#212121\"/>\n</g>\n<defs>\n<clipPath id=\"clip0_6083_34804\">\n<rect width=\"24\" height=\"24\" fill=\"white\"/>\n</clipPath>\n</defs>`;\n            firebaseText.innerText = 'Preview backend running in this workspace.';\n        }\n        firebaseText.setAttribute('id', firebaseTextId);\n    }\n    if (document.readyState === 'loading') {\n        window.addEventListener('DOMContentLoaded', setupDom);\n    }\n    else {\n        setupDom();\n    }\n}\n\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/**\n * Returns navigator.userAgent string or '' if it's not defined.\n * @return user agent string\n */\nfunction getUA() {\n    if (typeof navigator !== 'undefined' &&\n        typeof navigator['userAgent'] === 'string') {\n        return navigator['userAgent'];\n    }\n    else {\n        return '';\n    }\n}\n/**\n * Detect Cordova / PhoneGap / Ionic frameworks on a mobile device.\n *\n * Deliberately does not rely on checking `file://` URLs (as this fails PhoneGap\n * in the Ripple emulator) nor Cordova `onDeviceReady`, which would normally\n * wait for a callback.\n */\nfunction isMobileCordova() {\n    return (typeof window !== 'undefined' &&\n        // @ts-ignore Setting up an broadly applicable index signature for Window\n        // just to deal with this case would probably be a bad idea.\n        !!(window['cordova'] || window['phonegap'] || window['PhoneGap']) &&\n        /ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(getUA()));\n}\n/**\n * Detect Node.js.\n *\n * @return true if Node.js environment is detected or specified.\n */\n// Node detection logic from: https://github.com/iliakan/detect-node/\nfunction isNode() {\n    var _a;\n    const forceEnvironment = (_a = getDefaults()) === null || _a === void 0 ? void 0 : _a.forceEnvironment;\n    if (forceEnvironment === 'node') {\n        return true;\n    }\n    else if (forceEnvironment === 'browser') {\n        return false;\n    }\n    try {\n        return (Object.prototype.toString.call(global.process) === '[object process]');\n    }\n    catch (e) {\n        return false;\n    }\n}\n/**\n * Detect Browser Environment.\n * Note: This will return true for certain test frameworks that are incompletely\n * mimicking a browser, and should not lead to assuming all browser APIs are\n * available.\n */\nfunction isBrowser() {\n    return typeof window !== 'undefined' || isWebWorker();\n}\n/**\n * Detect Web Worker context.\n */\nfunction isWebWorker() {\n    return (typeof WorkerGlobalScope !== 'undefined' &&\n        typeof self !== 'undefined' &&\n        self instanceof WorkerGlobalScope);\n}\n/**\n * Detect Cloudflare Worker context.\n */\nfunction isCloudflareWorker() {\n    return (typeof navigator !== 'undefined' &&\n        navigator.userAgent === 'Cloudflare-Workers');\n}\nfunction isBrowserExtension() {\n    const runtime = typeof chrome === 'object'\n        ? chrome.runtime\n        : typeof browser === 'object'\n            ? browser.runtime\n            : undefined;\n    return typeof runtime === 'object' && runtime.id !== undefined;\n}\n/**\n * Detect React Native.\n *\n * @return true if ReactNative environment is detected.\n */\nfunction isReactNative() {\n    return (typeof navigator === 'object' && navigator['product'] === 'ReactNative');\n}\n/** Detects Electron apps. */\nfunction isElectron() {\n    return getUA().indexOf('Electron/') >= 0;\n}\n/** Detects Internet Explorer. */\nfunction isIE() {\n    const ua = getUA();\n    return ua.indexOf('MSIE ') >= 0 || ua.indexOf('Trident/') >= 0;\n}\n/** Detects Universal Windows Platform apps. */\nfunction isUWP() {\n    return getUA().indexOf('MSAppHost/') >= 0;\n}\n/**\n * Detect whether the current SDK build is the Node version.\n *\n * @return true if it's the Node SDK build.\n */\nfunction isNodeSdk() {\n    return CONSTANTS.NODE_CLIENT === true || CONSTANTS.NODE_ADMIN === true;\n}\n/** Returns true if we are running in Safari. */\nfunction isSafari() {\n    return (!isNode() &&\n        !!navigator.userAgent &&\n        navigator.userAgent.includes('Safari') &&\n        !navigator.userAgent.includes('Chrome'));\n}\n/** Returns true if we are running in Safari or WebKit */\nfunction isSafariOrWebkit() {\n    return (!isNode() &&\n        !!navigator.userAgent &&\n        (navigator.userAgent.includes('Safari') ||\n            navigator.userAgent.includes('WebKit')) &&\n        !navigator.userAgent.includes('Chrome'));\n}\n/**\n * This method checks if indexedDB is supported by current browser/service worker context\n * @return true if indexedDB is supported by current browser/service worker context\n */\nfunction isIndexedDBAvailable() {\n    try {\n        return typeof indexedDB === 'object';\n    }\n    catch (e) {\n        return false;\n    }\n}\n/**\n * This method validates browser/sw context for indexedDB by opening a dummy indexedDB database and reject\n * if errors occur during the database open operation.\n *\n * @throws exception if current browser/sw context can't run idb.open (ex: Safari iframe, Firefox\n * private browsing)\n */\nfunction validateIndexedDBOpenable() {\n    return new Promise((resolve, reject) => {\n        try {\n            let preExist = true;\n            const DB_CHECK_NAME = 'validate-browser-context-for-indexeddb-analytics-module';\n            const request = self.indexedDB.open(DB_CHECK_NAME);\n            request.onsuccess = () => {\n                request.result.close();\n                // delete database only when it doesn't pre-exist\n                if (!preExist) {\n                    self.indexedDB.deleteDatabase(DB_CHECK_NAME);\n                }\n                resolve(true);\n            };\n            request.onupgradeneeded = () => {\n                preExist = false;\n            };\n            request.onerror = () => {\n                var _a;\n                reject(((_a = request.error) === null || _a === void 0 ? void 0 : _a.message) || '');\n            };\n        }\n        catch (error) {\n            reject(error);\n        }\n    });\n}\n/**\n *\n * This method checks whether cookie is enabled within current browser\n * @return true if cookie is enabled within current browser\n */\nfunction areCookiesEnabled() {\n    if (typeof navigator === 'undefined' || !navigator.cookieEnabled) {\n        return false;\n    }\n    return true;\n}\n\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/**\n * @fileoverview Standardized Firebase Error.\n *\n * Usage:\n *\n *   // TypeScript string literals for type-safe codes\n *   type Err =\n *     'unknown' |\n *     'object-not-found'\n *     ;\n *\n *   // Closure enum for type-safe error codes\n *   // at-enum {string}\n *   var Err = {\n *     UNKNOWN: 'unknown',\n *     OBJECT_NOT_FOUND: 'object-not-found',\n *   }\n *\n *   let errors: Map<Err, string> = {\n *     'generic-error': \"Unknown error\",\n *     'file-not-found': \"Could not find file: {$file}\",\n *   };\n *\n *   // Type-safe function - must pass a valid error code as param.\n *   let error = new ErrorFactory<Err>('service', 'Service', errors);\n *\n *   ...\n *   throw error.create(Err.GENERIC);\n *   ...\n *   throw error.create(Err.FILE_NOT_FOUND, {'file': fileName});\n *   ...\n *   // Service: Could not file file: foo.txt (service/file-not-found).\n *\n *   catch (e) {\n *     assert(e.message === \"Could not find file: foo.txt.\");\n *     if ((e as FirebaseError)?.code === 'service/file-not-found') {\n *       console.log(\"Could not read file: \" + e['file']);\n *     }\n *   }\n */\nconst ERROR_NAME = 'FirebaseError';\n// Based on code from:\n// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Error#Custom_Error_Types\nclass FirebaseError extends Error {\n    constructor(\n    /** The error code for this error. */\n    code, message, \n    /** Custom data for this error. */\n    customData) {\n        super(message);\n        this.code = code;\n        this.customData = customData;\n        /** The custom name for all FirebaseErrors. */\n        this.name = ERROR_NAME;\n        // Fix For ES5\n        // https://github.com/Microsoft/TypeScript-wiki/blob/master/Breaking-Changes.md#extending-built-ins-like-error-array-and-map-may-no-longer-work\n        // TODO(dlarocque): Replace this with `new.target`: https://www.typescriptlang.org/docs/handbook/release-notes/typescript-2-2.html#support-for-newtarget\n        //                   which we can now use since we no longer target ES5.\n        Object.setPrototypeOf(this, FirebaseError.prototype);\n        // Maintains proper stack trace for where our error was thrown.\n        // Only available on V8.\n        if (Error.captureStackTrace) {\n            Error.captureStackTrace(this, ErrorFactory.prototype.create);\n        }\n    }\n}\nclass ErrorFactory {\n    constructor(service, serviceName, errors) {\n        this.service = service;\n        this.serviceName = serviceName;\n        this.errors = errors;\n    }\n    create(code, ...data) {\n        const customData = data[0] || {};\n        const fullCode = `${this.service}/${code}`;\n        const template = this.errors[code];\n        const message = template ? replaceTemplate(template, customData) : 'Error';\n        // Service Name: Error message (service/code).\n        const fullMessage = `${this.serviceName}: ${message} (${fullCode}).`;\n        const error = new FirebaseError(fullCode, fullMessage, customData);\n        return error;\n    }\n}\nfunction replaceTemplate(template, data) {\n    return template.replace(PATTERN, (_, key) => {\n        const value = data[key];\n        return value != null ? String(value) : `<${key}?>`;\n    });\n}\nconst PATTERN = /\\{\\$([^}]+)}/g;\n\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/**\n * Evaluates a JSON string into a javascript object.\n *\n * @param {string} str A string containing JSON.\n * @return {*} The javascript object representing the specified JSON.\n */\nfunction jsonEval(str) {\n    return JSON.parse(str);\n}\n/**\n * Returns JSON representing a javascript object.\n * @param {*} data JavaScript object to be stringified.\n * @return {string} The JSON contents of the object.\n */\nfunction stringify(data) {\n    return JSON.stringify(data);\n}\n\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/**\n * Decodes a Firebase auth. token into constituent parts.\n *\n * Notes:\n * - May return with invalid / incomplete claims if there's no native base64 decoding support.\n * - Doesn't check if the token is actually valid.\n */\nconst decode = function (token) {\n    let header = {}, claims = {}, data = {}, signature = '';\n    try {\n        const parts = token.split('.');\n        header = jsonEval(base64Decode(parts[0]) || '');\n        claims = jsonEval(base64Decode(parts[1]) || '');\n        signature = parts[2];\n        data = claims['d'] || {};\n        delete claims['d'];\n    }\n    catch (e) { }\n    return {\n        header,\n        claims,\n        data,\n        signature\n    };\n};\n/**\n * Decodes a Firebase auth. token and checks the validity of its time-based claims. Will return true if the\n * token is within the time window authorized by the 'nbf' (not-before) and 'iat' (issued-at) claims.\n *\n * Notes:\n * - May return a false negative if there's no native base64 decoding support.\n * - Doesn't check if the token is actually valid.\n */\nconst isValidTimestamp = function (token) {\n    const claims = decode(token).claims;\n    const now = Math.floor(new Date().getTime() / 1000);\n    let validSince = 0, validUntil = 0;\n    if (typeof claims === 'object') {\n        if (claims.hasOwnProperty('nbf')) {\n            validSince = claims['nbf'];\n        }\n        else if (claims.hasOwnProperty('iat')) {\n            validSince = claims['iat'];\n        }\n        if (claims.hasOwnProperty('exp')) {\n            validUntil = claims['exp'];\n        }\n        else {\n            // token will expire after 24h by default\n            validUntil = validSince + 86400;\n        }\n    }\n    return (!!now &&\n        !!validSince &&\n        !!validUntil &&\n        now >= validSince &&\n        now <= validUntil);\n};\n/**\n * Decodes a Firebase auth. token and returns its issued at time if valid, null otherwise.\n *\n * Notes:\n * - May return null if there's no native base64 decoding support.\n * - Doesn't check if the token is actually valid.\n */\nconst issuedAtTime = function (token) {\n    const claims = decode(token).claims;\n    if (typeof claims === 'object' && claims.hasOwnProperty('iat')) {\n        return claims['iat'];\n    }\n    return null;\n};\n/**\n * Decodes a Firebase auth. token and checks the validity of its format. Expects a valid issued-at time.\n *\n * Notes:\n * - May return a false negative if there's no native base64 decoding support.\n * - Doesn't check if the token is actually valid.\n */\nconst isValidFormat = function (token) {\n    const decoded = decode(token), claims = decoded.claims;\n    return !!claims && typeof claims === 'object' && claims.hasOwnProperty('iat');\n};\n/**\n * Attempts to peer into an auth token and determine if it's an admin auth token by looking at the claims portion.\n *\n * Notes:\n * - May return a false negative if there's no native base64 decoding support.\n * - Doesn't check if the token is actually valid.\n */\nconst isAdmin = function (token) {\n    const claims = decode(token).claims;\n    return typeof claims === 'object' && claims['admin'] === true;\n};\n\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nfunction contains(obj, key) {\n    return Object.prototype.hasOwnProperty.call(obj, key);\n}\nfunction safeGet(obj, key) {\n    if (Object.prototype.hasOwnProperty.call(obj, key)) {\n        return obj[key];\n    }\n    else {\n        return undefined;\n    }\n}\nfunction isEmpty(obj) {\n    for (const key in obj) {\n        if (Object.prototype.hasOwnProperty.call(obj, key)) {\n            return false;\n        }\n    }\n    return true;\n}\nfunction map(obj, fn, contextObj) {\n    const res = {};\n    for (const key in obj) {\n        if (Object.prototype.hasOwnProperty.call(obj, key)) {\n            res[key] = fn.call(contextObj, obj[key], key, obj);\n        }\n    }\n    return res;\n}\n/**\n * Deep equal two objects. Support Arrays and Objects.\n */\nfunction deepEqual(a, b) {\n    if (a === b) {\n        return true;\n    }\n    const aKeys = Object.keys(a);\n    const bKeys = Object.keys(b);\n    for (const k of aKeys) {\n        if (!bKeys.includes(k)) {\n            return false;\n        }\n        const aProp = a[k];\n        const bProp = b[k];\n        if (isObject(aProp) && isObject(bProp)) {\n            if (!deepEqual(aProp, bProp)) {\n                return false;\n            }\n        }\n        else if (aProp !== bProp) {\n            return false;\n        }\n    }\n    for (const k of bKeys) {\n        if (!aKeys.includes(k)) {\n            return false;\n        }\n    }\n    return true;\n}\nfunction isObject(thing) {\n    return thing !== null && typeof thing === 'object';\n}\n\n/**\n * @license\n * Copyright 2022 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/**\n * Rejects if the given promise doesn't resolve in timeInMS milliseconds.\n * @internal\n */\nfunction promiseWithTimeout(promise, timeInMS = 2000) {\n    const deferredPromise = new Deferred();\n    setTimeout(() => deferredPromise.reject('timeout!'), timeInMS);\n    promise.then(deferredPromise.resolve, deferredPromise.reject);\n    return deferredPromise.promise;\n}\n\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/**\n * Returns a querystring-formatted string (e.g. &arg=val&arg2=val2) from a\n * params object (e.g. {arg: 'val', arg2: 'val2'})\n * Note: You must prepend it with ? when adding it to a URL.\n */\nfunction querystring(querystringParams) {\n    const params = [];\n    for (const [key, value] of Object.entries(querystringParams)) {\n        if (Array.isArray(value)) {\n            value.forEach(arrayVal => {\n                params.push(encodeURIComponent(key) + '=' + encodeURIComponent(arrayVal));\n            });\n        }\n        else {\n            params.push(encodeURIComponent(key) + '=' + encodeURIComponent(value));\n        }\n    }\n    return params.length ? '&' + params.join('&') : '';\n}\n/**\n * Decodes a querystring (e.g. ?arg=val&arg2=val2) into a params object\n * (e.g. {arg: 'val', arg2: 'val2'})\n */\nfunction querystringDecode(querystring) {\n    const obj = {};\n    const tokens = querystring.replace(/^\\?/, '').split('&');\n    tokens.forEach(token => {\n        if (token) {\n            const [key, value] = token.split('=');\n            obj[decodeURIComponent(key)] = decodeURIComponent(value);\n        }\n    });\n    return obj;\n}\n/**\n * Extract the query string part of a URL, including the leading question mark (if present).\n */\nfunction extractQuerystring(url) {\n    const queryStart = url.indexOf('?');\n    if (!queryStart) {\n        return '';\n    }\n    const fragmentStart = url.indexOf('#', queryStart);\n    return url.substring(queryStart, fragmentStart > 0 ? fragmentStart : undefined);\n}\n\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/**\n * @fileoverview SHA-1 cryptographic hash.\n * Variable names follow the notation in FIPS PUB 180-3:\n * http://csrc.nist.gov/publications/fips/fips180-3/fips180-3_final.pdf.\n *\n * Usage:\n *   var sha1 = new sha1();\n *   sha1.update(bytes);\n *   var hash = sha1.digest();\n *\n * Performance:\n *   Chrome 23:   ~400 Mbit/s\n *   Firefox 16:  ~250 Mbit/s\n *\n */\n/**\n * SHA-1 cryptographic hash constructor.\n *\n * The properties declared here are discussed in the above algorithm document.\n * @constructor\n * @final\n * @struct\n */\nclass Sha1 {\n    constructor() {\n        /**\n         * Holds the previous values of accumulated variables a-e in the compress_\n         * function.\n         * @private\n         */\n        this.chain_ = [];\n        /**\n         * A buffer holding the partially computed hash result.\n         * @private\n         */\n        this.buf_ = [];\n        /**\n         * An array of 80 bytes, each a part of the message to be hashed.  Referred to\n         * as the message schedule in the docs.\n         * @private\n         */\n        this.W_ = [];\n        /**\n         * Contains data needed to pad messages less than 64 bytes.\n         * @private\n         */\n        this.pad_ = [];\n        /**\n         * @private {number}\n         */\n        this.inbuf_ = 0;\n        /**\n         * @private {number}\n         */\n        this.total_ = 0;\n        this.blockSize = 512 / 8;\n        this.pad_[0] = 128;\n        for (let i = 1; i < this.blockSize; ++i) {\n            this.pad_[i] = 0;\n        }\n        this.reset();\n    }\n    reset() {\n        this.chain_[0] = 0x67452301;\n        this.chain_[1] = 0xefcdab89;\n        this.chain_[2] = 0x98badcfe;\n        this.chain_[3] = 0x10325476;\n        this.chain_[4] = 0xc3d2e1f0;\n        this.inbuf_ = 0;\n        this.total_ = 0;\n    }\n    /**\n     * Internal compress helper function.\n     * @param buf Block to compress.\n     * @param offset Offset of the block in the buffer.\n     * @private\n     */\n    compress_(buf, offset) {\n        if (!offset) {\n            offset = 0;\n        }\n        const W = this.W_;\n        // get 16 big endian words\n        if (typeof buf === 'string') {\n            for (let i = 0; i < 16; i++) {\n                // TODO(user): [bug 8140122] Recent versions of Safari for Mac OS and iOS\n                // have a bug that turns the post-increment ++ operator into pre-increment\n                // during JIT compilation.  We have code that depends heavily on SHA-1 for\n                // correctness and which is affected by this bug, so I've removed all uses\n                // of post-increment ++ in which the result value is used.  We can revert\n                // this change once the Safari bug\n                // (https://bugs.webkit.org/show_bug.cgi?id=109036) has been fixed and\n                // most clients have been updated.\n                W[i] =\n                    (buf.charCodeAt(offset) << 24) |\n                        (buf.charCodeAt(offset + 1) << 16) |\n                        (buf.charCodeAt(offset + 2) << 8) |\n                        buf.charCodeAt(offset + 3);\n                offset += 4;\n            }\n        }\n        else {\n            for (let i = 0; i < 16; i++) {\n                W[i] =\n                    (buf[offset] << 24) |\n                        (buf[offset + 1] << 16) |\n                        (buf[offset + 2] << 8) |\n                        buf[offset + 3];\n                offset += 4;\n            }\n        }\n        // expand to 80 words\n        for (let i = 16; i < 80; i++) {\n            const t = W[i - 3] ^ W[i - 8] ^ W[i - 14] ^ W[i - 16];\n            W[i] = ((t << 1) | (t >>> 31)) & 0xffffffff;\n        }\n        let a = this.chain_[0];\n        let b = this.chain_[1];\n        let c = this.chain_[2];\n        let d = this.chain_[3];\n        let e = this.chain_[4];\n        let f, k;\n        // TODO(user): Try to unroll this loop to speed up the computation.\n        for (let i = 0; i < 80; i++) {\n            if (i < 40) {\n                if (i < 20) {\n                    f = d ^ (b & (c ^ d));\n                    k = 0x5a827999;\n                }\n                else {\n                    f = b ^ c ^ d;\n                    k = 0x6ed9eba1;\n                }\n            }\n            else {\n                if (i < 60) {\n                    f = (b & c) | (d & (b | c));\n                    k = 0x8f1bbcdc;\n                }\n                else {\n                    f = b ^ c ^ d;\n                    k = 0xca62c1d6;\n                }\n            }\n            const t = (((a << 5) | (a >>> 27)) + f + e + k + W[i]) & 0xffffffff;\n            e = d;\n            d = c;\n            c = ((b << 30) | (b >>> 2)) & 0xffffffff;\n            b = a;\n            a = t;\n        }\n        this.chain_[0] = (this.chain_[0] + a) & 0xffffffff;\n        this.chain_[1] = (this.chain_[1] + b) & 0xffffffff;\n        this.chain_[2] = (this.chain_[2] + c) & 0xffffffff;\n        this.chain_[3] = (this.chain_[3] + d) & 0xffffffff;\n        this.chain_[4] = (this.chain_[4] + e) & 0xffffffff;\n    }\n    update(bytes, length) {\n        // TODO(johnlenz): tighten the function signature and remove this check\n        if (bytes == null) {\n            return;\n        }\n        if (length === undefined) {\n            length = bytes.length;\n        }\n        const lengthMinusBlock = length - this.blockSize;\n        let n = 0;\n        // Using local instead of member variables gives ~5% speedup on Firefox 16.\n        const buf = this.buf_;\n        let inbuf = this.inbuf_;\n        // The outer while loop should execute at most twice.\n        while (n < length) {\n            // When we have no data in the block to top up, we can directly process the\n            // input buffer (assuming it contains sufficient data). This gives ~25%\n            // speedup on Chrome 23 and ~15% speedup on Firefox 16, but requires that\n            // the data is provided in large chunks (or in multiples of 64 bytes).\n            if (inbuf === 0) {\n                while (n <= lengthMinusBlock) {\n                    this.compress_(bytes, n);\n                    n += this.blockSize;\n                }\n            }\n            if (typeof bytes === 'string') {\n                while (n < length) {\n                    buf[inbuf] = bytes.charCodeAt(n);\n                    ++inbuf;\n                    ++n;\n                    if (inbuf === this.blockSize) {\n                        this.compress_(buf);\n                        inbuf = 0;\n                        // Jump to the outer loop so we use the full-block optimization.\n                        break;\n                    }\n                }\n            }\n            else {\n                while (n < length) {\n                    buf[inbuf] = bytes[n];\n                    ++inbuf;\n                    ++n;\n                    if (inbuf === this.blockSize) {\n                        this.compress_(buf);\n                        inbuf = 0;\n                        // Jump to the outer loop so we use the full-block optimization.\n                        break;\n                    }\n                }\n            }\n        }\n        this.inbuf_ = inbuf;\n        this.total_ += length;\n    }\n    /** @override */\n    digest() {\n        const digest = [];\n        let totalBits = this.total_ * 8;\n        // Add pad 0x80 0x00*.\n        if (this.inbuf_ < 56) {\n            this.update(this.pad_, 56 - this.inbuf_);\n        }\n        else {\n            this.update(this.pad_, this.blockSize - (this.inbuf_ - 56));\n        }\n        // Add # bits.\n        for (let i = this.blockSize - 1; i >= 56; i--) {\n            this.buf_[i] = totalBits & 255;\n            totalBits /= 256; // Don't use bit-shifting here!\n        }\n        this.compress_(this.buf_);\n        let n = 0;\n        for (let i = 0; i < 5; i++) {\n            for (let j = 24; j >= 0; j -= 8) {\n                digest[n] = (this.chain_[i] >> j) & 255;\n                ++n;\n            }\n        }\n        return digest;\n    }\n}\n\n/**\n * Helper to make a Subscribe function (just like Promise helps make a\n * Thenable).\n *\n * @param executor Function which can make calls to a single Observer\n *     as a proxy.\n * @param onNoObservers Callback when count of Observers goes to zero.\n */\nfunction createSubscribe(executor, onNoObservers) {\n    const proxy = new ObserverProxy(executor, onNoObservers);\n    return proxy.subscribe.bind(proxy);\n}\n/**\n * Implement fan-out for any number of Observers attached via a subscribe\n * function.\n */\nclass ObserverProxy {\n    /**\n     * @param executor Function which can make calls to a single Observer\n     *     as a proxy.\n     * @param onNoObservers Callback when count of Observers goes to zero.\n     */\n    constructor(executor, onNoObservers) {\n        this.observers = [];\n        this.unsubscribes = [];\n        this.observerCount = 0;\n        // Micro-task scheduling by calling task.then().\n        this.task = Promise.resolve();\n        this.finalized = false;\n        this.onNoObservers = onNoObservers;\n        // Call the executor asynchronously so subscribers that are called\n        // synchronously after the creation of the subscribe function\n        // can still receive the very first value generated in the executor.\n        this.task\n            .then(() => {\n            executor(this);\n        })\n            .catch(e => {\n            this.error(e);\n        });\n    }\n    next(value) {\n        this.forEachObserver((observer) => {\n            observer.next(value);\n        });\n    }\n    error(error) {\n        this.forEachObserver((observer) => {\n            observer.error(error);\n        });\n        this.close(error);\n    }\n    complete() {\n        this.forEachObserver((observer) => {\n            observer.complete();\n        });\n        this.close();\n    }\n    /**\n     * Subscribe function that can be used to add an Observer to the fan-out list.\n     *\n     * - We require that no event is sent to a subscriber synchronously to their\n     *   call to subscribe().\n     */\n    subscribe(nextOrObserver, error, complete) {\n        let observer;\n        if (nextOrObserver === undefined &&\n            error === undefined &&\n            complete === undefined) {\n            throw new Error('Missing Observer.');\n        }\n        // Assemble an Observer object when passed as callback functions.\n        if (implementsAnyMethods(nextOrObserver, [\n            'next',\n            'error',\n            'complete'\n        ])) {\n            observer = nextOrObserver;\n        }\n        else {\n            observer = {\n                next: nextOrObserver,\n                error,\n                complete\n            };\n        }\n        if (observer.next === undefined) {\n            observer.next = noop;\n        }\n        if (observer.error === undefined) {\n            observer.error = noop;\n        }\n        if (observer.complete === undefined) {\n            observer.complete = noop;\n        }\n        const unsub = this.unsubscribeOne.bind(this, this.observers.length);\n        // Attempt to subscribe to a terminated Observable - we\n        // just respond to the Observer with the final error or complete\n        // event.\n        if (this.finalized) {\n            // eslint-disable-next-line @typescript-eslint/no-floating-promises\n            this.task.then(() => {\n                try {\n                    if (this.finalError) {\n                        observer.error(this.finalError);\n                    }\n                    else {\n                        observer.complete();\n                    }\n                }\n                catch (e) {\n                    // nothing\n                }\n                return;\n            });\n        }\n        this.observers.push(observer);\n        return unsub;\n    }\n    // Unsubscribe is synchronous - we guarantee that no events are sent to\n    // any unsubscribed Observer.\n    unsubscribeOne(i) {\n        if (this.observers === undefined || this.observers[i] === undefined) {\n            return;\n        }\n        delete this.observers[i];\n        this.observerCount -= 1;\n        if (this.observerCount === 0 && this.onNoObservers !== undefined) {\n            this.onNoObservers(this);\n        }\n    }\n    forEachObserver(fn) {\n        if (this.finalized) {\n            // Already closed by previous event....just eat the additional values.\n            return;\n        }\n        // Since sendOne calls asynchronously - there is no chance that\n        // this.observers will become undefined.\n        for (let i = 0; i < this.observers.length; i++) {\n            this.sendOne(i, fn);\n        }\n    }\n    // Call the Observer via one of it's callback function. We are careful to\n    // confirm that the observe has not been unsubscribed since this asynchronous\n    // function had been queued.\n    sendOne(i, fn) {\n        // Execute the callback asynchronously\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\n        this.task.then(() => {\n            if (this.observers !== undefined && this.observers[i] !== undefined) {\n                try {\n                    fn(this.observers[i]);\n                }\n                catch (e) {\n                    // Ignore exceptions raised in Observers or missing methods of an\n                    // Observer.\n                    // Log error to console. b/31404806\n                    if (typeof console !== 'undefined' && console.error) {\n                        console.error(e);\n                    }\n                }\n            }\n        });\n    }\n    close(err) {\n        if (this.finalized) {\n            return;\n        }\n        this.finalized = true;\n        if (err !== undefined) {\n            this.finalError = err;\n        }\n        // Proxy is no longer needed - garbage collect references\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\n        this.task.then(() => {\n            this.observers = undefined;\n            this.onNoObservers = undefined;\n        });\n    }\n}\n/** Turn synchronous function into one called asynchronously. */\n// eslint-disable-next-line @typescript-eslint/ban-types\nfunction async(fn, onError) {\n    return (...args) => {\n        Promise.resolve(true)\n            .then(() => {\n            fn(...args);\n        })\n            .catch((error) => {\n            if (onError) {\n                onError(error);\n            }\n        });\n    };\n}\n/**\n * Return true if the object passed in implements any of the named methods.\n */\nfunction implementsAnyMethods(obj, methods) {\n    if (typeof obj !== 'object' || obj === null) {\n        return false;\n    }\n    for (const method of methods) {\n        if (method in obj && typeof obj[method] === 'function') {\n            return true;\n        }\n    }\n    return false;\n}\nfunction noop() {\n    // do nothing\n}\n\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/**\n * Check to make sure the appropriate number of arguments are provided for a public function.\n * Throws an error if it fails.\n *\n * @param fnName The function name\n * @param minCount The minimum number of arguments to allow for the function call\n * @param maxCount The maximum number of argument to allow for the function call\n * @param argCount The actual number of arguments provided.\n */\nconst validateArgCount = function (fnName, minCount, maxCount, argCount) {\n    let argError;\n    if (argCount < minCount) {\n        argError = 'at least ' + minCount;\n    }\n    else if (argCount > maxCount) {\n        argError = maxCount === 0 ? 'none' : 'no more than ' + maxCount;\n    }\n    if (argError) {\n        const error = fnName +\n            ' failed: Was called with ' +\n            argCount +\n            (argCount === 1 ? ' argument.' : ' arguments.') +\n            ' Expects ' +\n            argError +\n            '.';\n        throw new Error(error);\n    }\n};\n/**\n * Generates a string to prefix an error message about failed argument validation\n *\n * @param fnName The function name\n * @param argName The name of the argument\n * @return The prefix to add to the error thrown for validation.\n */\nfunction errorPrefix(fnName, argName) {\n    return `${fnName} failed: ${argName} argument `;\n}\n/**\n * @param fnName\n * @param argumentNumber\n * @param namespace\n * @param optional\n */\nfunction validateNamespace(fnName, namespace, optional) {\n    if (optional && !namespace) {\n        return;\n    }\n    if (typeof namespace !== 'string') {\n        //TODO: I should do more validation here. We only allow certain chars in namespaces.\n        throw new Error(errorPrefix(fnName, 'namespace') + 'must be a valid firebase namespace.');\n    }\n}\nfunction validateCallback(fnName, argumentName, \n// eslint-disable-next-line @typescript-eslint/ban-types\ncallback, optional) {\n    if (optional && !callback) {\n        return;\n    }\n    if (typeof callback !== 'function') {\n        throw new Error(errorPrefix(fnName, argumentName) + 'must be a valid function.');\n    }\n}\nfunction validateContextObject(fnName, argumentName, context, optional) {\n    if (optional && !context) {\n        return;\n    }\n    if (typeof context !== 'object' || context === null) {\n        throw new Error(errorPrefix(fnName, argumentName) + 'must be a valid context object.');\n    }\n}\n\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n// Code originally came from goog.crypt.stringToUtf8ByteArray, but for some reason they\n// automatically replaced '\\r\\n' with '\\n', and they didn't handle surrogate pairs,\n// so it's been modified.\n// Note that not all Unicode characters appear as single characters in JavaScript strings.\n// fromCharCode returns the UTF-16 encoding of a character - so some Unicode characters\n// use 2 characters in JavaScript.  All 4-byte UTF-8 characters begin with a first\n// character in the range 0xD800 - 0xDBFF (the first character of a so-called surrogate\n// pair).\n// See http://www.ecma-international.org/ecma-262/5.1/#sec-15.1.3\n/**\n * @param {string} str\n * @return {Array}\n */\nconst stringToByteArray = function (str) {\n    const out = [];\n    let p = 0;\n    for (let i = 0; i < str.length; i++) {\n        let c = str.charCodeAt(i);\n        // Is this the lead surrogate in a surrogate pair?\n        if (c >= 0xd800 && c <= 0xdbff) {\n            const high = c - 0xd800; // the high 10 bits.\n            i++;\n            assert(i < str.length, 'Surrogate pair missing trail surrogate.');\n            const low = str.charCodeAt(i) - 0xdc00; // the low 10 bits.\n            c = 0x10000 + (high << 10) + low;\n        }\n        if (c < 128) {\n            out[p++] = c;\n        }\n        else if (c < 2048) {\n            out[p++] = (c >> 6) | 192;\n            out[p++] = (c & 63) | 128;\n        }\n        else if (c < 65536) {\n            out[p++] = (c >> 12) | 224;\n            out[p++] = ((c >> 6) & 63) | 128;\n            out[p++] = (c & 63) | 128;\n        }\n        else {\n            out[p++] = (c >> 18) | 240;\n            out[p++] = ((c >> 12) & 63) | 128;\n            out[p++] = ((c >> 6) & 63) | 128;\n            out[p++] = (c & 63) | 128;\n        }\n    }\n    return out;\n};\n/**\n * Calculate length without actually converting; useful for doing cheaper validation.\n * @param {string} str\n * @return {number}\n */\nconst stringLength = function (str) {\n    let p = 0;\n    for (let i = 0; i < str.length; i++) {\n        const c = str.charCodeAt(i);\n        if (c < 128) {\n            p++;\n        }\n        else if (c < 2048) {\n            p += 2;\n        }\n        else if (c >= 0xd800 && c <= 0xdbff) {\n            // Lead surrogate of a surrogate pair.  The pair together will take 4 bytes to represent.\n            p += 4;\n            i++; // skip trail surrogate.\n        }\n        else {\n            p += 3;\n        }\n    }\n    return p;\n};\n\n/**\n * @license\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/**\n * The amount of milliseconds to exponentially increase.\n */\nconst DEFAULT_INTERVAL_MILLIS = 1000;\n/**\n * The factor to backoff by.\n * Should be a number greater than 1.\n */\nconst DEFAULT_BACKOFF_FACTOR = 2;\n/**\n * The maximum milliseconds to increase to.\n *\n * <p>Visible for testing\n */\nconst MAX_VALUE_MILLIS = 4 * 60 * 60 * 1000; // Four hours, like iOS and Android.\n/**\n * The percentage of backoff time to randomize by.\n * See\n * http://go/safe-client-behavior#step-1-determine-the-appropriate-retry-interval-to-handle-spike-traffic\n * for context.\n *\n * <p>Visible for testing\n */\nconst RANDOM_FACTOR = 0.5;\n/**\n * Based on the backoff method from\n * https://github.com/google/closure-library/blob/master/closure/goog/math/exponentialbackoff.js.\n * Extracted here so we don't need to pass metadata and a stateful ExponentialBackoff object around.\n */\nfunction calculateBackoffMillis(backoffCount, intervalMillis = DEFAULT_INTERVAL_MILLIS, backoffFactor = DEFAULT_BACKOFF_FACTOR) {\n    // Calculates an exponentially increasing value.\n    // Deviation: calculates value from count and a constant interval, so we only need to save value\n    // and count to restore state.\n    const currBaseValue = intervalMillis * Math.pow(backoffFactor, backoffCount);\n    // A random \"fuzz\" to avoid waves of retries.\n    // Deviation: randomFactor is required.\n    const randomWait = Math.round(\n    // A fraction of the backoff value to add/subtract.\n    // Deviation: changes multiplication order to improve readability.\n    RANDOM_FACTOR *\n        currBaseValue *\n        // A random float (rounded to int by Math.round above) in the range [-1, 1]. Determines\n        // if we add or subtract.\n        (Math.random() - 0.5) *\n        2);\n    // Limits backoff to max to avoid effectively permanent backoff.\n    return Math.min(MAX_VALUE_MILLIS, currBaseValue + randomWait);\n}\n\n/**\n * @license\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/**\n * Provide English ordinal letters after a number\n */\nfunction ordinal(i) {\n    if (!Number.isFinite(i)) {\n        return `${i}`;\n    }\n    return i + indicator(i);\n}\nfunction indicator(i) {\n    i = Math.abs(i);\n    const cent = i % 100;\n    if (cent >= 10 && cent <= 20) {\n        return 'th';\n    }\n    const dec = i % 10;\n    if (dec === 1) {\n        return 'st';\n    }\n    if (dec === 2) {\n        return 'nd';\n    }\n    if (dec === 3) {\n        return 'rd';\n    }\n    return 'th';\n}\n\n/**\n * @license\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nfunction getModularInstance(service) {\n    if (service && service._delegate) {\n        return service._delegate;\n    }\n    else {\n        return service;\n    }\n}\n\nexport { CONSTANTS, DecodeBase64StringError, Deferred, ErrorFactory, FirebaseError, MAX_VALUE_MILLIS, RANDOM_FACTOR, Sha1, areCookiesEnabled, assert, assertionError, async, base64, base64Decode, base64Encode, base64urlEncodeWithoutPadding, calculateBackoffMillis, contains, createMockUserToken, createSubscribe, decode, deepCopy, deepEqual, deepExtend, errorPrefix, extractQuerystring, getDefaultAppConfig, getDefaultEmulatorHost, getDefaultEmulatorHostnameAndPort, getDefaults, getExperimentalSetting, getGlobal, getModularInstance, getUA, isAdmin, isBrowser, isBrowserExtension, isCloudWorkstation, isCloudflareWorker, isElectron, isEmpty, isIE, isIndexedDBAvailable, isMobileCordova, isNode, isNodeSdk, isReactNative, isSafari, isSafariOrWebkit, isUWP, isValidFormat, isValidTimestamp, isWebWorker, issuedAtTime, jsonEval, map, ordinal, pingServer, promiseWithTimeout, querystring, querystringDecode, safeGet, stringLength, stringToByteArray, stringify, updateEmulatorBanner, validateArgCount, validateCallback, validateContextObject, validateIndexedDBOpenable, validateNamespace };\n//# sourceMappingURL=index.esm2017.js.map\n","import { Deferred } from '@firebase/util';\n\n/**\n * Component for service name T, e.g. `auth`, `auth-internal`\n */\nclass Component {\n    /**\n     *\n     * @param name The public service name, e.g. app, auth, firestore, database\n     * @param instanceFactory Service factory responsible for creating the public interface\n     * @param type whether the service provided by the component is public or private\n     */\n    constructor(name, instanceFactory, type) {\n        this.name = name;\n        this.instanceFactory = instanceFactory;\n        this.type = type;\n        this.multipleInstances = false;\n        /**\n         * Properties to be added to the service namespace\n         */\n        this.serviceProps = {};\n        this.instantiationMode = \"LAZY\" /* InstantiationMode.LAZY */;\n        this.onInstanceCreated = null;\n    }\n    setInstantiationMode(mode) {\n        this.instantiationMode = mode;\n        return this;\n    }\n    setMultipleInstances(multipleInstances) {\n        this.multipleInstances = multipleInstances;\n        return this;\n    }\n    setServiceProps(props) {\n        this.serviceProps = props;\n        return this;\n    }\n    setInstanceCreatedCallback(callback) {\n        this.onInstanceCreated = callback;\n        return this;\n    }\n}\n\n/**\n * @license\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nconst DEFAULT_ENTRY_NAME = '[DEFAULT]';\n\n/**\n * @license\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/**\n * Provider for instance for service name T, e.g. 'auth', 'auth-internal'\n * NameServiceMapping[T] is an alias for the type of the instance\n */\nclass Provider {\n    constructor(name, container) {\n        this.name = name;\n        this.container = container;\n        this.component = null;\n        this.instances = new Map();\n        this.instancesDeferred = new Map();\n        this.instancesOptions = new Map();\n        this.onInitCallbacks = new Map();\n    }\n    /**\n     * @param identifier A provider can provide multiple instances of a service\n     * if this.component.multipleInstances is true.\n     */\n    get(identifier) {\n        // if multipleInstances is not supported, use the default name\n        const normalizedIdentifier = this.normalizeInstanceIdentifier(identifier);\n        if (!this.instancesDeferred.has(normalizedIdentifier)) {\n            const deferred = new Deferred();\n            this.instancesDeferred.set(normalizedIdentifier, deferred);\n            if (this.isInitialized(normalizedIdentifier) ||\n                this.shouldAutoInitialize()) {\n                // initialize the service if it can be auto-initialized\n                try {\n                    const instance = this.getOrInitializeService({\n                        instanceIdentifier: normalizedIdentifier\n                    });\n                    if (instance) {\n                        deferred.resolve(instance);\n                    }\n                }\n                catch (e) {\n                    // when the instance factory throws an exception during get(), it should not cause\n                    // a fatal error. We just return the unresolved promise in this case.\n                }\n            }\n        }\n        return this.instancesDeferred.get(normalizedIdentifier).promise;\n    }\n    getImmediate(options) {\n        var _a;\n        // if multipleInstances is not supported, use the default name\n        const normalizedIdentifier = this.normalizeInstanceIdentifier(options === null || options === void 0 ? void 0 : options.identifier);\n        const optional = (_a = options === null || options === void 0 ? void 0 : options.optional) !== null && _a !== void 0 ? _a : false;\n        if (this.isInitialized(normalizedIdentifier) ||\n            this.shouldAutoInitialize()) {\n            try {\n                return this.getOrInitializeService({\n                    instanceIdentifier: normalizedIdentifier\n                });\n            }\n            catch (e) {\n                if (optional) {\n                    return null;\n                }\n                else {\n                    throw e;\n                }\n            }\n        }\n        else {\n            // In case a component is not initialized and should/cannot be auto-initialized at the moment, return null if the optional flag is set, or throw\n            if (optional) {\n                return null;\n            }\n            else {\n                throw Error(`Service ${this.name} is not available`);\n            }\n        }\n    }\n    getComponent() {\n        return this.component;\n    }\n    setComponent(component) {\n        if (component.name !== this.name) {\n            throw Error(`Mismatching Component ${component.name} for Provider ${this.name}.`);\n        }\n        if (this.component) {\n            throw Error(`Component for ${this.name} has already been provided`);\n        }\n        this.component = component;\n        // return early without attempting to initialize the component if the component requires explicit initialization (calling `Provider.initialize()`)\n        if (!this.shouldAutoInitialize()) {\n            return;\n        }\n        // if the service is eager, initialize the default instance\n        if (isComponentEager(component)) {\n            try {\n                this.getOrInitializeService({ instanceIdentifier: DEFAULT_ENTRY_NAME });\n            }\n            catch (e) {\n                // when the instance factory for an eager Component throws an exception during the eager\n                // initialization, it should not cause a fatal error.\n                // TODO: Investigate if we need to make it configurable, because some component may want to cause\n                // a fatal error in this case?\n            }\n        }\n        // Create service instances for the pending promises and resolve them\n        // NOTE: if this.multipleInstances is false, only the default instance will be created\n        // and all promises with resolve with it regardless of the identifier.\n        for (const [instanceIdentifier, instanceDeferred] of this.instancesDeferred.entries()) {\n            const normalizedIdentifier = this.normalizeInstanceIdentifier(instanceIdentifier);\n            try {\n                // `getOrInitializeService()` should always return a valid instance since a component is guaranteed. use ! to make typescript happy.\n                const instance = this.getOrInitializeService({\n                    instanceIdentifier: normalizedIdentifier\n                });\n                instanceDeferred.resolve(instance);\n            }\n            catch (e) {\n                // when the instance factory throws an exception, it should not cause\n                // a fatal error. We just leave the promise unresolved.\n            }\n        }\n    }\n    clearInstance(identifier = DEFAULT_ENTRY_NAME) {\n        this.instancesDeferred.delete(identifier);\n        this.instancesOptions.delete(identifier);\n        this.instances.delete(identifier);\n    }\n    // app.delete() will call this method on every provider to delete the services\n    // TODO: should we mark the provider as deleted?\n    async delete() {\n        const services = Array.from(this.instances.values());\n        await Promise.all([\n            ...services\n                .filter(service => 'INTERNAL' in service) // legacy services\n                // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                .map(service => service.INTERNAL.delete()),\n            ...services\n                .filter(service => '_delete' in service) // modularized services\n                // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                .map(service => service._delete())\n        ]);\n    }\n    isComponentSet() {\n        return this.component != null;\n    }\n    isInitialized(identifier = DEFAULT_ENTRY_NAME) {\n        return this.instances.has(identifier);\n    }\n    getOptions(identifier = DEFAULT_ENTRY_NAME) {\n        return this.instancesOptions.get(identifier) || {};\n    }\n    initialize(opts = {}) {\n        const { options = {} } = opts;\n        const normalizedIdentifier = this.normalizeInstanceIdentifier(opts.instanceIdentifier);\n        if (this.isInitialized(normalizedIdentifier)) {\n            throw Error(`${this.name}(${normalizedIdentifier}) has already been initialized`);\n        }\n        if (!this.isComponentSet()) {\n            throw Error(`Component ${this.name} has not been registered yet`);\n        }\n        const instance = this.getOrInitializeService({\n            instanceIdentifier: normalizedIdentifier,\n            options\n        });\n        // resolve any pending promise waiting for the service instance\n        for (const [instanceIdentifier, instanceDeferred] of this.instancesDeferred.entries()) {\n            const normalizedDeferredIdentifier = this.normalizeInstanceIdentifier(instanceIdentifier);\n            if (normalizedIdentifier === normalizedDeferredIdentifier) {\n                instanceDeferred.resolve(instance);\n            }\n        }\n        return instance;\n    }\n    /**\n     *\n     * @param callback - a function that will be invoked  after the provider has been initialized by calling provider.initialize().\n     * The function is invoked SYNCHRONOUSLY, so it should not execute any longrunning tasks in order to not block the program.\n     *\n     * @param identifier An optional instance identifier\n     * @returns a function to unregister the callback\n     */\n    onInit(callback, identifier) {\n        var _a;\n        const normalizedIdentifier = this.normalizeInstanceIdentifier(identifier);\n        const existingCallbacks = (_a = this.onInitCallbacks.get(normalizedIdentifier)) !== null && _a !== void 0 ? _a : new Set();\n        existingCallbacks.add(callback);\n        this.onInitCallbacks.set(normalizedIdentifier, existingCallbacks);\n        const existingInstance = this.instances.get(normalizedIdentifier);\n        if (existingInstance) {\n            callback(existingInstance, normalizedIdentifier);\n        }\n        return () => {\n            existingCallbacks.delete(callback);\n        };\n    }\n    /**\n     * Invoke onInit callbacks synchronously\n     * @param instance the service instance`\n     */\n    invokeOnInitCallbacks(instance, identifier) {\n        const callbacks = this.onInitCallbacks.get(identifier);\n        if (!callbacks) {\n            return;\n        }\n        for (const callback of callbacks) {\n            try {\n                callback(instance, identifier);\n            }\n            catch (_a) {\n                // ignore errors in the onInit callback\n            }\n        }\n    }\n    getOrInitializeService({ instanceIdentifier, options = {} }) {\n        let instance = this.instances.get(instanceIdentifier);\n        if (!instance && this.component) {\n            instance = this.component.instanceFactory(this.container, {\n                instanceIdentifier: normalizeIdentifierForFactory(instanceIdentifier),\n                options\n            });\n            this.instances.set(instanceIdentifier, instance);\n            this.instancesOptions.set(instanceIdentifier, options);\n            /**\n             * Invoke onInit listeners.\n             * Note this.component.onInstanceCreated is different, which is used by the component creator,\n             * while onInit listeners are registered by consumers of the provider.\n             */\n            this.invokeOnInitCallbacks(instance, instanceIdentifier);\n            /**\n             * Order is important\n             * onInstanceCreated() should be called after this.instances.set(instanceIdentifier, instance); which\n             * makes `isInitialized()` return true.\n             */\n            if (this.component.onInstanceCreated) {\n                try {\n                    this.component.onInstanceCreated(this.container, instanceIdentifier, instance);\n                }\n                catch (_a) {\n                    // ignore errors in the onInstanceCreatedCallback\n                }\n            }\n        }\n        return instance || null;\n    }\n    normalizeInstanceIdentifier(identifier = DEFAULT_ENTRY_NAME) {\n        if (this.component) {\n            return this.component.multipleInstances ? identifier : DEFAULT_ENTRY_NAME;\n        }\n        else {\n            return identifier; // assume multiple instances are supported before the component is provided.\n        }\n    }\n    shouldAutoInitialize() {\n        return (!!this.component &&\n            this.component.instantiationMode !== \"EXPLICIT\" /* InstantiationMode.EXPLICIT */);\n    }\n}\n// undefined should be passed to the service factory for the default instance\nfunction normalizeIdentifierForFactory(identifier) {\n    return identifier === DEFAULT_ENTRY_NAME ? undefined : identifier;\n}\nfunction isComponentEager(component) {\n    return component.instantiationMode === \"EAGER\" /* InstantiationMode.EAGER */;\n}\n\n/**\n * @license\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/**\n * ComponentContainer that provides Providers for service name T, e.g. `auth`, `auth-internal`\n */\nclass ComponentContainer {\n    constructor(name) {\n        this.name = name;\n        this.providers = new Map();\n    }\n    /**\n     *\n     * @param component Component being added\n     * @param overwrite When a component with the same name has already been registered,\n     * if overwrite is true: overwrite the existing component with the new component and create a new\n     * provider with the new component. It can be useful in tests where you want to use different mocks\n     * for different tests.\n     * if overwrite is false: throw an exception\n     */\n    addComponent(component) {\n        const provider = this.getProvider(component.name);\n        if (provider.isComponentSet()) {\n            throw new Error(`Component ${component.name} has already been registered with ${this.name}`);\n        }\n        provider.setComponent(component);\n    }\n    addOrOverwriteComponent(component) {\n        const provider = this.getProvider(component.name);\n        if (provider.isComponentSet()) {\n            // delete the existing provider from the container, so we can register the new component\n            this.providers.delete(component.name);\n        }\n        this.addComponent(component);\n    }\n    /**\n     * getProvider provides a type safe interface where it can only be called with a field name\n     * present in NameServiceMapping interface.\n     *\n     * Firebase SDKs providing services should extend NameServiceMapping interface to register\n     * themselves.\n     */\n    getProvider(name) {\n        if (this.providers.has(name)) {\n            return this.providers.get(name);\n        }\n        // create a Provider for a service that hasn't registered with Firebase\n        const provider = new Provider(name, this);\n        this.providers.set(name, provider);\n        return provider;\n    }\n    getProviders() {\n        return Array.from(this.providers.values());\n    }\n}\n\nexport { Component, ComponentContainer, Provider };\n//# sourceMappingURL=index.esm2017.js.map\n","/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/**\n * A container for all of the Logger instances\n */\nconst instances = [];\n/**\n * The JS SDK supports 5 log levels and also allows a user the ability to\n * silence the logs altogether.\n *\n * The order is a follows:\n * DEBUG < VERBOSE < INFO < WARN < ERROR\n *\n * All of the log types above the current log level will be captured (i.e. if\n * you set the log level to `INFO`, errors will still be logged, but `DEBUG` and\n * `VERBOSE` logs will not)\n */\nvar LogLevel;\n(function (LogLevel) {\n    LogLevel[LogLevel[\"DEBUG\"] = 0] = \"DEBUG\";\n    LogLevel[LogLevel[\"VERBOSE\"] = 1] = \"VERBOSE\";\n    LogLevel[LogLevel[\"INFO\"] = 2] = \"INFO\";\n    LogLevel[LogLevel[\"WARN\"] = 3] = \"WARN\";\n    LogLevel[LogLevel[\"ERROR\"] = 4] = \"ERROR\";\n    LogLevel[LogLevel[\"SILENT\"] = 5] = \"SILENT\";\n})(LogLevel || (LogLevel = {}));\nconst levelStringToEnum = {\n    'debug': LogLevel.DEBUG,\n    'verbose': LogLevel.VERBOSE,\n    'info': LogLevel.INFO,\n    'warn': LogLevel.WARN,\n    'error': LogLevel.ERROR,\n    'silent': LogLevel.SILENT\n};\n/**\n * The default log level\n */\nconst defaultLogLevel = LogLevel.INFO;\n/**\n * By default, `console.debug` is not displayed in the developer console (in\n * chrome). To avoid forcing users to have to opt-in to these logs twice\n * (i.e. once for firebase, and once in the console), we are sending `DEBUG`\n * logs to the `console.log` function.\n */\nconst ConsoleMethod = {\n    [LogLevel.DEBUG]: 'log',\n    [LogLevel.VERBOSE]: 'log',\n    [LogLevel.INFO]: 'info',\n    [LogLevel.WARN]: 'warn',\n    [LogLevel.ERROR]: 'error'\n};\n/**\n * The default log handler will forward DEBUG, VERBOSE, INFO, WARN, and ERROR\n * messages on to their corresponding console counterparts (if the log method\n * is supported by the current log level)\n */\nconst defaultLogHandler = (instance, logType, ...args) => {\n    if (logType < instance.logLevel) {\n        return;\n    }\n    const now = new Date().toISOString();\n    const method = ConsoleMethod[logType];\n    if (method) {\n        console[method](`[${now}]  ${instance.name}:`, ...args);\n    }\n    else {\n        throw new Error(`Attempted to log a message with an invalid logType (value: ${logType})`);\n    }\n};\nclass Logger {\n    /**\n     * Gives you an instance of a Logger to capture messages according to\n     * Firebase's logging scheme.\n     *\n     * @param name The name that the logs will be associated with\n     */\n    constructor(name) {\n        this.name = name;\n        /**\n         * The log level of the given Logger instance.\n         */\n        this._logLevel = defaultLogLevel;\n        /**\n         * The main (internal) log handler for the Logger instance.\n         * Can be set to a new function in internal package code but not by user.\n         */\n        this._logHandler = defaultLogHandler;\n        /**\n         * The optional, additional, user-defined log handler for the Logger instance.\n         */\n        this._userLogHandler = null;\n        /**\n         * Capture the current instance for later use\n         */\n        instances.push(this);\n    }\n    get logLevel() {\n        return this._logLevel;\n    }\n    set logLevel(val) {\n        if (!(val in LogLevel)) {\n            throw new TypeError(`Invalid value \"${val}\" assigned to \\`logLevel\\``);\n        }\n        this._logLevel = val;\n    }\n    // Workaround for setter/getter having to be the same type.\n    setLogLevel(val) {\n        this._logLevel = typeof val === 'string' ? levelStringToEnum[val] : val;\n    }\n    get logHandler() {\n        return this._logHandler;\n    }\n    set logHandler(val) {\n        if (typeof val !== 'function') {\n            throw new TypeError('Value assigned to `logHandler` must be a function');\n        }\n        this._logHandler = val;\n    }\n    get userLogHandler() {\n        return this._userLogHandler;\n    }\n    set userLogHandler(val) {\n        this._userLogHandler = val;\n    }\n    /**\n     * The functions below are all based on the `console` interface\n     */\n    debug(...args) {\n        this._userLogHandler && this._userLogHandler(this, LogLevel.DEBUG, ...args);\n        this._logHandler(this, LogLevel.DEBUG, ...args);\n    }\n    log(...args) {\n        this._userLogHandler &&\n            this._userLogHandler(this, LogLevel.VERBOSE, ...args);\n        this._logHandler(this, LogLevel.VERBOSE, ...args);\n    }\n    info(...args) {\n        this._userLogHandler && this._userLogHandler(this, LogLevel.INFO, ...args);\n        this._logHandler(this, LogLevel.INFO, ...args);\n    }\n    warn(...args) {\n        this._userLogHandler && this._userLogHandler(this, LogLevel.WARN, ...args);\n        this._logHandler(this, LogLevel.WARN, ...args);\n    }\n    error(...args) {\n        this._userLogHandler && this._userLogHandler(this, LogLevel.ERROR, ...args);\n        this._logHandler(this, LogLevel.ERROR, ...args);\n    }\n}\nfunction setLogLevel(level) {\n    instances.forEach(inst => {\n        inst.setLogLevel(level);\n    });\n}\nfunction setUserLogHandler(logCallback, options) {\n    for (const instance of instances) {\n        let customLogLevel = null;\n        if (options && options.level) {\n            customLogLevel = levelStringToEnum[options.level];\n        }\n        if (logCallback === null) {\n            instance.userLogHandler = null;\n        }\n        else {\n            instance.userLogHandler = (instance, level, ...args) => {\n                const message = args\n                    .map(arg => {\n                    if (arg == null) {\n                        return null;\n                    }\n                    else if (typeof arg === 'string') {\n                        return arg;\n                    }\n                    else if (typeof arg === 'number' || typeof arg === 'boolean') {\n                        return arg.toString();\n                    }\n                    else if (arg instanceof Error) {\n                        return arg.message;\n                    }\n                    else {\n                        try {\n                            return JSON.stringify(arg);\n                        }\n                        catch (ignored) {\n                            return null;\n                        }\n                    }\n                })\n                    .filter(arg => arg)\n                    .join(' ');\n                if (level >= (customLogLevel !== null && customLogLevel !== void 0 ? customLogLevel : instance.logLevel)) {\n                    logCallback({\n                        level: LogLevel[level].toLowerCase(),\n                        message,\n                        args,\n                        type: instance.name\n                    });\n                }\n            };\n        }\n    }\n}\n\nexport { LogLevel, Logger, setLogLevel, setUserLogHandler };\n//# sourceMappingURL=index.esm2017.js.map\n","const instanceOfAny = (object, constructors) => constructors.some((c) => object instanceof c);\n\nlet idbProxyableTypes;\nlet cursorAdvanceMethods;\n// This is a function to prevent it throwing up in node environments.\nfunction getIdbProxyableTypes() {\n    return (idbProxyableTypes ||\n        (idbProxyableTypes = [\n            IDBDatabase,\n            IDBObjectStore,\n            IDBIndex,\n            IDBCursor,\n            IDBTransaction,\n        ]));\n}\n// This is a function to prevent it throwing up in node environments.\nfunction getCursorAdvanceMethods() {\n    return (cursorAdvanceMethods ||\n        (cursorAdvanceMethods = [\n            IDBCursor.prototype.advance,\n            IDBCursor.prototype.continue,\n            IDBCursor.prototype.continuePrimaryKey,\n        ]));\n}\nconst cursorRequestMap = new WeakMap();\nconst transactionDoneMap = new WeakMap();\nconst transactionStoreNamesMap = new WeakMap();\nconst transformCache = new WeakMap();\nconst reverseTransformCache = new WeakMap();\nfunction promisifyRequest(request) {\n    const promise = new Promise((resolve, reject) => {\n        const unlisten = () => {\n            request.removeEventListener('success', success);\n            request.removeEventListener('error', error);\n        };\n        const success = () => {\n            resolve(wrap(request.result));\n            unlisten();\n        };\n        const error = () => {\n            reject(request.error);\n            unlisten();\n        };\n        request.addEventListener('success', success);\n        request.addEventListener('error', error);\n    });\n    promise\n        .then((value) => {\n        // Since cursoring reuses the IDBRequest (*sigh*), we cache it for later retrieval\n        // (see wrapFunction).\n        if (value instanceof IDBCursor) {\n            cursorRequestMap.set(value, request);\n        }\n        // Catching to avoid \"Uncaught Promise exceptions\"\n    })\n        .catch(() => { });\n    // This mapping exists in reverseTransformCache but doesn't doesn't exist in transformCache. This\n    // is because we create many promises from a single IDBRequest.\n    reverseTransformCache.set(promise, request);\n    return promise;\n}\nfunction cacheDonePromiseForTransaction(tx) {\n    // Early bail if we've already created a done promise for this transaction.\n    if (transactionDoneMap.has(tx))\n        return;\n    const done = new Promise((resolve, reject) => {\n        const unlisten = () => {\n            tx.removeEventListener('complete', complete);\n            tx.removeEventListener('error', error);\n            tx.removeEventListener('abort', error);\n        };\n        const complete = () => {\n            resolve();\n            unlisten();\n        };\n        const error = () => {\n            reject(tx.error || new DOMException('AbortError', 'AbortError'));\n            unlisten();\n        };\n        tx.addEventListener('complete', complete);\n        tx.addEventListener('error', error);\n        tx.addEventListener('abort', error);\n    });\n    // Cache it for later retrieval.\n    transactionDoneMap.set(tx, done);\n}\nlet idbProxyTraps = {\n    get(target, prop, receiver) {\n        if (target instanceof IDBTransaction) {\n            // Special handling for transaction.done.\n            if (prop === 'done')\n                return transactionDoneMap.get(target);\n            // Polyfill for objectStoreNames because of Edge.\n            if (prop === 'objectStoreNames') {\n                return target.objectStoreNames || transactionStoreNamesMap.get(target);\n            }\n            // Make tx.store return the only store in the transaction, or undefined if there are many.\n            if (prop === 'store') {\n                return receiver.objectStoreNames[1]\n                    ? undefined\n                    : receiver.objectStore(receiver.objectStoreNames[0]);\n            }\n        }\n        // Else transform whatever we get back.\n        return wrap(target[prop]);\n    },\n    set(target, prop, value) {\n        target[prop] = value;\n        return true;\n    },\n    has(target, prop) {\n        if (target instanceof IDBTransaction &&\n            (prop === 'done' || prop === 'store')) {\n            return true;\n        }\n        return prop in target;\n    },\n};\nfunction replaceTraps(callback) {\n    idbProxyTraps = callback(idbProxyTraps);\n}\nfunction wrapFunction(func) {\n    // Due to expected object equality (which is enforced by the caching in `wrap`), we\n    // only create one new func per func.\n    // Edge doesn't support objectStoreNames (booo), so we polyfill it here.\n    if (func === IDBDatabase.prototype.transaction &&\n        !('objectStoreNames' in IDBTransaction.prototype)) {\n        return function (storeNames, ...args) {\n            const tx = func.call(unwrap(this), storeNames, ...args);\n            transactionStoreNamesMap.set(tx, storeNames.sort ? storeNames.sort() : [storeNames]);\n            return wrap(tx);\n        };\n    }\n    // Cursor methods are special, as the behaviour is a little more different to standard IDB. In\n    // IDB, you advance the cursor and wait for a new 'success' on the IDBRequest that gave you the\n    // cursor. It's kinda like a promise that can resolve with many values. That doesn't make sense\n    // with real promises, so each advance methods returns a new promise for the cursor object, or\n    // undefined if the end of the cursor has been reached.\n    if (getCursorAdvanceMethods().includes(func)) {\n        return function (...args) {\n            // Calling the original function with the proxy as 'this' causes ILLEGAL INVOCATION, so we use\n            // the original object.\n            func.apply(unwrap(this), args);\n            return wrap(cursorRequestMap.get(this));\n        };\n    }\n    return function (...args) {\n        // Calling the original function with the proxy as 'this' causes ILLEGAL INVOCATION, so we use\n        // the original object.\n        return wrap(func.apply(unwrap(this), args));\n    };\n}\nfunction transformCachableValue(value) {\n    if (typeof value === 'function')\n        return wrapFunction(value);\n    // This doesn't return, it just creates a 'done' promise for the transaction,\n    // which is later returned for transaction.done (see idbObjectHandler).\n    if (value instanceof IDBTransaction)\n        cacheDonePromiseForTransaction(value);\n    if (instanceOfAny(value, getIdbProxyableTypes()))\n        return new Proxy(value, idbProxyTraps);\n    // Return the same value back if we're not going to transform it.\n    return value;\n}\nfunction wrap(value) {\n    // We sometimes generate multiple promises from a single IDBRequest (eg when cursoring), because\n    // IDB is weird and a single IDBRequest can yield many responses, so these can't be cached.\n    if (value instanceof IDBRequest)\n        return promisifyRequest(value);\n    // If we've already transformed this value before, reuse the transformed value.\n    // This is faster, but it also provides object equality.\n    if (transformCache.has(value))\n        return transformCache.get(value);\n    const newValue = transformCachableValue(value);\n    // Not all types are transformed.\n    // These may be primitive types, so they can't be WeakMap keys.\n    if (newValue !== value) {\n        transformCache.set(value, newValue);\n        reverseTransformCache.set(newValue, value);\n    }\n    return newValue;\n}\nconst unwrap = (value) => reverseTransformCache.get(value);\n\nexport { reverseTransformCache as a, instanceOfAny as i, replaceTraps as r, unwrap as u, wrap as w };\n","import { w as wrap, r as replaceTraps } from './wrap-idb-value.js';\nexport { u as unwrap, w as wrap } from './wrap-idb-value.js';\n\n/**\n * Open a database.\n *\n * @param name Name of the database.\n * @param version Schema version.\n * @param callbacks Additional callbacks.\n */\nfunction openDB(name, version, { blocked, upgrade, blocking, terminated } = {}) {\n    const request = indexedDB.open(name, version);\n    const openPromise = wrap(request);\n    if (upgrade) {\n        request.addEventListener('upgradeneeded', (event) => {\n            upgrade(wrap(request.result), event.oldVersion, event.newVersion, wrap(request.transaction), event);\n        });\n    }\n    if (blocked) {\n        request.addEventListener('blocked', (event) => blocked(\n        // Casting due to https://github.com/microsoft/TypeScript-DOM-lib-generator/pull/1405\n        event.oldVersion, event.newVersion, event));\n    }\n    openPromise\n        .then((db) => {\n        if (terminated)\n            db.addEventListener('close', () => terminated());\n        if (blocking) {\n            db.addEventListener('versionchange', (event) => blocking(event.oldVersion, event.newVersion, event));\n        }\n    })\n        .catch(() => { });\n    return openPromise;\n}\n/**\n * Delete a database.\n *\n * @param name Name of the database.\n */\nfunction deleteDB(name, { blocked } = {}) {\n    const request = indexedDB.deleteDatabase(name);\n    if (blocked) {\n        request.addEventListener('blocked', (event) => blocked(\n        // Casting due to https://github.com/microsoft/TypeScript-DOM-lib-generator/pull/1405\n        event.oldVersion, event));\n    }\n    return wrap(request).then(() => undefined);\n}\n\nconst readMethods = ['get', 'getKey', 'getAll', 'getAllKeys', 'count'];\nconst writeMethods = ['put', 'add', 'delete', 'clear'];\nconst cachedMethods = new Map();\nfunction getMethod(target, prop) {\n    if (!(target instanceof IDBDatabase &&\n        !(prop in target) &&\n        typeof prop === 'string')) {\n        return;\n    }\n    if (cachedMethods.get(prop))\n        return cachedMethods.get(prop);\n    const targetFuncName = prop.replace(/FromIndex$/, '');\n    const useIndex = prop !== targetFuncName;\n    const isWrite = writeMethods.includes(targetFuncName);\n    if (\n    // Bail if the target doesn't exist on the target. Eg, getAll isn't in Edge.\n    !(targetFuncName in (useIndex ? IDBIndex : IDBObjectStore).prototype) ||\n        !(isWrite || readMethods.includes(targetFuncName))) {\n        return;\n    }\n    const method = async function (storeName, ...args) {\n        // isWrite ? 'readwrite' : undefined gzipps better, but fails in Edge :(\n        const tx = this.transaction(storeName, isWrite ? 'readwrite' : 'readonly');\n        let target = tx.store;\n        if (useIndex)\n            target = target.index(args.shift());\n        // Must reject if op rejects.\n        // If it's a write operation, must reject if tx.done rejects.\n        // Must reject with op rejection first.\n        // Must resolve with op value.\n        // Must handle both promises (no unhandled rejections)\n        return (await Promise.all([\n            target[targetFuncName](...args),\n            isWrite && tx.done,\n        ]))[0];\n    };\n    cachedMethods.set(prop, method);\n    return method;\n}\nreplaceTraps((oldTraps) => ({\n    ...oldTraps,\n    get: (target, prop, receiver) => getMethod(target, prop) || oldTraps.get(target, prop, receiver),\n    has: (target, prop) => !!getMethod(target, prop) || oldTraps.has(target, prop),\n}));\n\nexport { deleteDB, openDB };\n","import { Component, ComponentContainer } from '@firebase/component';\nimport { Logger, setUserLogHandler, setLogLevel as setLogLevel$1 } from '@firebase/logger';\nimport { ErrorFactory, base64Decode, getDefaultAppConfig, deepEqual, isBrowser, isWebWorker, FirebaseError, base64urlEncodeWithoutPadding, isIndexedDBAvailable, validateIndexedDBOpenable } from '@firebase/util';\nexport { FirebaseError } from '@firebase/util';\nimport { openDB } from 'idb';\n\n/**\n * @license\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nclass PlatformLoggerServiceImpl {\n    constructor(container) {\n        this.container = container;\n    }\n    // In initial implementation, this will be called by installations on\n    // auth token refresh, and installations will send this string.\n    getPlatformInfoString() {\n        const providers = this.container.getProviders();\n        // Loop through providers and get library/version pairs from any that are\n        // version components.\n        return providers\n            .map(provider => {\n            if (isVersionServiceProvider(provider)) {\n                const service = provider.getImmediate();\n                return `${service.library}/${service.version}`;\n            }\n            else {\n                return null;\n            }\n        })\n            .filter(logString => logString)\n            .join(' ');\n    }\n}\n/**\n *\n * @param provider check if this provider provides a VersionService\n *\n * NOTE: Using Provider<'app-version'> is a hack to indicate that the provider\n * provides VersionService. The provider is not necessarily a 'app-version'\n * provider.\n */\nfunction isVersionServiceProvider(provider) {\n    const component = provider.getComponent();\n    return (component === null || component === void 0 ? void 0 : component.type) === \"VERSION\" /* ComponentType.VERSION */;\n}\n\nconst name$q = \"@firebase/app\";\nconst version$1 = \"0.13.2\";\n\n/**\n * @license\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nconst logger = new Logger('@firebase/app');\n\nconst name$p = \"@firebase/app-compat\";\n\nconst name$o = \"@firebase/analytics-compat\";\n\nconst name$n = \"@firebase/analytics\";\n\nconst name$m = \"@firebase/app-check-compat\";\n\nconst name$l = \"@firebase/app-check\";\n\nconst name$k = \"@firebase/auth\";\n\nconst name$j = \"@firebase/auth-compat\";\n\nconst name$i = \"@firebase/database\";\n\nconst name$h = \"@firebase/data-connect\";\n\nconst name$g = \"@firebase/database-compat\";\n\nconst name$f = \"@firebase/functions\";\n\nconst name$e = \"@firebase/functions-compat\";\n\nconst name$d = \"@firebase/installations\";\n\nconst name$c = \"@firebase/installations-compat\";\n\nconst name$b = \"@firebase/messaging\";\n\nconst name$a = \"@firebase/messaging-compat\";\n\nconst name$9 = \"@firebase/performance\";\n\nconst name$8 = \"@firebase/performance-compat\";\n\nconst name$7 = \"@firebase/remote-config\";\n\nconst name$6 = \"@firebase/remote-config-compat\";\n\nconst name$5 = \"@firebase/storage\";\n\nconst name$4 = \"@firebase/storage-compat\";\n\nconst name$3 = \"@firebase/firestore\";\n\nconst name$2 = \"@firebase/ai\";\n\nconst name$1 = \"@firebase/firestore-compat\";\n\nconst name = \"firebase\";\nconst version = \"11.10.0\";\n\n/**\n * @license\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/**\n * The default app name\n *\n * @internal\n */\nconst DEFAULT_ENTRY_NAME = '[DEFAULT]';\nconst PLATFORM_LOG_STRING = {\n    [name$q]: 'fire-core',\n    [name$p]: 'fire-core-compat',\n    [name$n]: 'fire-analytics',\n    [name$o]: 'fire-analytics-compat',\n    [name$l]: 'fire-app-check',\n    [name$m]: 'fire-app-check-compat',\n    [name$k]: 'fire-auth',\n    [name$j]: 'fire-auth-compat',\n    [name$i]: 'fire-rtdb',\n    [name$h]: 'fire-data-connect',\n    [name$g]: 'fire-rtdb-compat',\n    [name$f]: 'fire-fn',\n    [name$e]: 'fire-fn-compat',\n    [name$d]: 'fire-iid',\n    [name$c]: 'fire-iid-compat',\n    [name$b]: 'fire-fcm',\n    [name$a]: 'fire-fcm-compat',\n    [name$9]: 'fire-perf',\n    [name$8]: 'fire-perf-compat',\n    [name$7]: 'fire-rc',\n    [name$6]: 'fire-rc-compat',\n    [name$5]: 'fire-gcs',\n    [name$4]: 'fire-gcs-compat',\n    [name$3]: 'fire-fst',\n    [name$1]: 'fire-fst-compat',\n    [name$2]: 'fire-vertex',\n    'fire-js': 'fire-js', // Platform identifier for JS SDK.\n    [name]: 'fire-js-all'\n};\n\n/**\n * @license\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/**\n * @internal\n */\nconst _apps = new Map();\n/**\n * @internal\n */\nconst _serverApps = new Map();\n/**\n * Registered components.\n *\n * @internal\n */\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nconst _components = new Map();\n/**\n * @param component - the component being added to this app's container\n *\n * @internal\n */\nfunction _addComponent(app, component) {\n    try {\n        app.container.addComponent(component);\n    }\n    catch (e) {\n        logger.debug(`Component ${component.name} failed to register with FirebaseApp ${app.name}`, e);\n    }\n}\n/**\n *\n * @internal\n */\nfunction _addOrOverwriteComponent(app, component) {\n    app.container.addOrOverwriteComponent(component);\n}\n/**\n *\n * @param component - the component to register\n * @returns whether or not the component is registered successfully\n *\n * @internal\n */\nfunction _registerComponent(component) {\n    const componentName = component.name;\n    if (_components.has(componentName)) {\n        logger.debug(`There were multiple attempts to register component ${componentName}.`);\n        return false;\n    }\n    _components.set(componentName, component);\n    // add the component to existing app instances\n    for (const app of _apps.values()) {\n        _addComponent(app, component);\n    }\n    for (const serverApp of _serverApps.values()) {\n        _addComponent(serverApp, component);\n    }\n    return true;\n}\n/**\n *\n * @param app - FirebaseApp instance\n * @param name - service name\n *\n * @returns the provider for the service with the matching name\n *\n * @internal\n */\nfunction _getProvider(app, name) {\n    const heartbeatController = app.container\n        .getProvider('heartbeat')\n        .getImmediate({ optional: true });\n    if (heartbeatController) {\n        void heartbeatController.triggerHeartbeat();\n    }\n    return app.container.getProvider(name);\n}\n/**\n *\n * @param app - FirebaseApp instance\n * @param name - service name\n * @param instanceIdentifier - service instance identifier in case the service supports multiple instances\n *\n * @internal\n */\nfunction _removeServiceInstance(app, name, instanceIdentifier = DEFAULT_ENTRY_NAME) {\n    _getProvider(app, name).clearInstance(instanceIdentifier);\n}\n/**\n *\n * @param obj - an object of type FirebaseApp or FirebaseOptions.\n *\n * @returns true if the provide object is of type FirebaseApp.\n *\n * @internal\n */\nfunction _isFirebaseApp(obj) {\n    return obj.options !== undefined;\n}\n/**\n *\n * @param obj - an object of type FirebaseApp.\n *\n * @returns true if the provided object is of type FirebaseServerAppImpl.\n *\n * @internal\n */\nfunction _isFirebaseServerApp(obj) {\n    if (obj === null || obj === undefined) {\n        return false;\n    }\n    return obj.settings !== undefined;\n}\n/**\n * Test only\n *\n * @internal\n */\nfunction _clearComponents() {\n    _components.clear();\n}\n\n/**\n * @license\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nconst ERRORS = {\n    [\"no-app\" /* AppError.NO_APP */]: \"No Firebase App '{$appName}' has been created - \" +\n        'call initializeApp() first',\n    [\"bad-app-name\" /* AppError.BAD_APP_NAME */]: \"Illegal App name: '{$appName}'\",\n    [\"duplicate-app\" /* AppError.DUPLICATE_APP */]: \"Firebase App named '{$appName}' already exists with different options or config\",\n    [\"app-deleted\" /* AppError.APP_DELETED */]: \"Firebase App named '{$appName}' already deleted\",\n    [\"server-app-deleted\" /* AppError.SERVER_APP_DELETED */]: 'Firebase Server App has been deleted',\n    [\"no-options\" /* AppError.NO_OPTIONS */]: 'Need to provide options, when not being deployed to hosting via source.',\n    [\"invalid-app-argument\" /* AppError.INVALID_APP_ARGUMENT */]: 'firebase.{$appName}() takes either no argument or a ' +\n        'Firebase App instance.',\n    [\"invalid-log-argument\" /* AppError.INVALID_LOG_ARGUMENT */]: 'First argument to `onLog` must be null or a function.',\n    [\"idb-open\" /* AppError.IDB_OPEN */]: 'Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.',\n    [\"idb-get\" /* AppError.IDB_GET */]: 'Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.',\n    [\"idb-set\" /* AppError.IDB_WRITE */]: 'Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.',\n    [\"idb-delete\" /* AppError.IDB_DELETE */]: 'Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.',\n    [\"finalization-registry-not-supported\" /* AppError.FINALIZATION_REGISTRY_NOT_SUPPORTED */]: 'FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.',\n    [\"invalid-server-app-environment\" /* AppError.INVALID_SERVER_APP_ENVIRONMENT */]: 'FirebaseServerApp is not for use in browser environments.'\n};\nconst ERROR_FACTORY = new ErrorFactory('app', 'Firebase', ERRORS);\n\n/**\n * @license\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nclass FirebaseAppImpl {\n    constructor(options, config, container) {\n        this._isDeleted = false;\n        this._options = Object.assign({}, options);\n        this._config = Object.assign({}, config);\n        this._name = config.name;\n        this._automaticDataCollectionEnabled =\n            config.automaticDataCollectionEnabled;\n        this._container = container;\n        this.container.addComponent(new Component('app', () => this, \"PUBLIC\" /* ComponentType.PUBLIC */));\n    }\n    get automaticDataCollectionEnabled() {\n        this.checkDestroyed();\n        return this._automaticDataCollectionEnabled;\n    }\n    set automaticDataCollectionEnabled(val) {\n        this.checkDestroyed();\n        this._automaticDataCollectionEnabled = val;\n    }\n    get name() {\n        this.checkDestroyed();\n        return this._name;\n    }\n    get options() {\n        this.checkDestroyed();\n        return this._options;\n    }\n    get config() {\n        this.checkDestroyed();\n        return this._config;\n    }\n    get container() {\n        return this._container;\n    }\n    get isDeleted() {\n        return this._isDeleted;\n    }\n    set isDeleted(val) {\n        this._isDeleted = val;\n    }\n    /**\n     * This function will throw an Error if the App has already been deleted -\n     * use before performing API actions on the App.\n     */\n    checkDestroyed() {\n        if (this.isDeleted) {\n            throw ERROR_FACTORY.create(\"app-deleted\" /* AppError.APP_DELETED */, { appName: this._name });\n        }\n    }\n}\n\n/**\n * @license\n * Copyright 2023 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n// Parse the token and check to see if the `exp` claim is in the future.\n// Reports an error to the console if the token or claim could not be parsed, or if `exp` is in\n// the past.\nfunction validateTokenTTL(base64Token, tokenName) {\n    const secondPart = base64Decode(base64Token.split('.')[1]);\n    if (secondPart === null) {\n        console.error(`FirebaseServerApp ${tokenName} is invalid: second part could not be parsed.`);\n        return;\n    }\n    const expClaim = JSON.parse(secondPart).exp;\n    if (expClaim === undefined) {\n        console.error(`FirebaseServerApp ${tokenName} is invalid: expiration claim could not be parsed`);\n        return;\n    }\n    const exp = JSON.parse(secondPart).exp * 1000;\n    const now = new Date().getTime();\n    const diff = exp - now;\n    if (diff <= 0) {\n        console.error(`FirebaseServerApp ${tokenName} is invalid: the token has expired.`);\n    }\n}\nclass FirebaseServerAppImpl extends FirebaseAppImpl {\n    constructor(options, serverConfig, name, container) {\n        // Build configuration parameters for the FirebaseAppImpl base class.\n        const automaticDataCollectionEnabled = serverConfig.automaticDataCollectionEnabled !== undefined\n            ? serverConfig.automaticDataCollectionEnabled\n            : true;\n        // Create the FirebaseAppSettings object for the FirebaseAppImp constructor.\n        const config = {\n            name,\n            automaticDataCollectionEnabled\n        };\n        if (options.apiKey !== undefined) {\n            // Construct the parent FirebaseAppImp object.\n            super(options, config, container);\n        }\n        else {\n            const appImpl = options;\n            super(appImpl.options, config, container);\n        }\n        // Now construct the data for the FirebaseServerAppImpl.\n        this._serverConfig = Object.assign({ automaticDataCollectionEnabled }, serverConfig);\n        // Ensure that the current time is within the `authIdtoken` window of validity.\n        if (this._serverConfig.authIdToken) {\n            validateTokenTTL(this._serverConfig.authIdToken, 'authIdToken');\n        }\n        // Ensure that the current time is within the `appCheckToken` window of validity.\n        if (this._serverConfig.appCheckToken) {\n            validateTokenTTL(this._serverConfig.appCheckToken, 'appCheckToken');\n        }\n        this._finalizationRegistry = null;\n        if (typeof FinalizationRegistry !== 'undefined') {\n            this._finalizationRegistry = new FinalizationRegistry(() => {\n                this.automaticCleanup();\n            });\n        }\n        this._refCount = 0;\n        this.incRefCount(this._serverConfig.releaseOnDeref);\n        // Do not retain a hard reference to the dref object, otherwise the FinalizationRegistry\n        // will never trigger.\n        this._serverConfig.releaseOnDeref = undefined;\n        serverConfig.releaseOnDeref = undefined;\n        registerVersion(name$q, version$1, 'serverapp');\n    }\n    toJSON() {\n        return undefined;\n    }\n    get refCount() {\n        return this._refCount;\n    }\n    // Increment the reference count of this server app. If an object is provided, register it\n    // with the finalization registry.\n    incRefCount(obj) {\n        if (this.isDeleted) {\n            return;\n        }\n        this._refCount++;\n        if (obj !== undefined && this._finalizationRegistry !== null) {\n            this._finalizationRegistry.register(obj, this);\n        }\n    }\n    // Decrement the reference count.\n    decRefCount() {\n        if (this.isDeleted) {\n            return 0;\n        }\n        return --this._refCount;\n    }\n    // Invoked by the FinalizationRegistry callback to note that this app should go through its\n    // reference counts and delete itself if no reference count remain. The coordinating logic that\n    // handles this is in deleteApp(...).\n    automaticCleanup() {\n        void deleteApp(this);\n    }\n    get settings() {\n        this.checkDestroyed();\n        return this._serverConfig;\n    }\n    /**\n     * This function will throw an Error if the App has already been deleted -\n     * use before performing API actions on the App.\n     */\n    checkDestroyed() {\n        if (this.isDeleted) {\n            throw ERROR_FACTORY.create(\"server-app-deleted\" /* AppError.SERVER_APP_DELETED */);\n        }\n    }\n}\n\n/**\n * @license\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/**\n * The current SDK version.\n *\n * @public\n */\nconst SDK_VERSION = version;\nfunction initializeApp(_options, rawConfig = {}) {\n    let options = _options;\n    if (typeof rawConfig !== 'object') {\n        const name = rawConfig;\n        rawConfig = { name };\n    }\n    const config = Object.assign({ name: DEFAULT_ENTRY_NAME, automaticDataCollectionEnabled: true }, rawConfig);\n    const name = config.name;\n    if (typeof name !== 'string' || !name) {\n        throw ERROR_FACTORY.create(\"bad-app-name\" /* AppError.BAD_APP_NAME */, {\n            appName: String(name)\n        });\n    }\n    options || (options = getDefaultAppConfig());\n    if (!options) {\n        throw ERROR_FACTORY.create(\"no-options\" /* AppError.NO_OPTIONS */);\n    }\n    const existingApp = _apps.get(name);\n    if (existingApp) {\n        // return the existing app if options and config deep equal the ones in the existing app.\n        if (deepEqual(options, existingApp.options) &&\n            deepEqual(config, existingApp.config)) {\n            return existingApp;\n        }\n        else {\n            throw ERROR_FACTORY.create(\"duplicate-app\" /* AppError.DUPLICATE_APP */, { appName: name });\n        }\n    }\n    const container = new ComponentContainer(name);\n    for (const component of _components.values()) {\n        container.addComponent(component);\n    }\n    const newApp = new FirebaseAppImpl(options, config, container);\n    _apps.set(name, newApp);\n    return newApp;\n}\nfunction initializeServerApp(_options, _serverAppConfig) {\n    if (isBrowser() && !isWebWorker()) {\n        // FirebaseServerApp isn't designed to be run in browsers.\n        throw ERROR_FACTORY.create(\"invalid-server-app-environment\" /* AppError.INVALID_SERVER_APP_ENVIRONMENT */);\n    }\n    if (_serverAppConfig.automaticDataCollectionEnabled === undefined) {\n        _serverAppConfig.automaticDataCollectionEnabled = true;\n    }\n    let appOptions;\n    if (_isFirebaseApp(_options)) {\n        appOptions = _options.options;\n    }\n    else {\n        appOptions = _options;\n    }\n    // Build an app name based on a hash of the configuration options.\n    const nameObj = Object.assign(Object.assign({}, _serverAppConfig), appOptions);\n    // However, Do not mangle the name based on releaseOnDeref, since it will vary between the\n    // construction of FirebaseServerApp instances. For example, if the object is the request headers.\n    if (nameObj.releaseOnDeref !== undefined) {\n        delete nameObj.releaseOnDeref;\n    }\n    const hashCode = (s) => {\n        return [...s].reduce((hash, c) => (Math.imul(31, hash) + c.charCodeAt(0)) | 0, 0);\n    };\n    if (_serverAppConfig.releaseOnDeref !== undefined) {\n        if (typeof FinalizationRegistry === 'undefined') {\n            throw ERROR_FACTORY.create(\"finalization-registry-not-supported\" /* AppError.FINALIZATION_REGISTRY_NOT_SUPPORTED */, {});\n        }\n    }\n    const nameString = '' + hashCode(JSON.stringify(nameObj));\n    const existingApp = _serverApps.get(nameString);\n    if (existingApp) {\n        existingApp.incRefCount(_serverAppConfig.releaseOnDeref);\n        return existingApp;\n    }\n    const container = new ComponentContainer(nameString);\n    for (const component of _components.values()) {\n        container.addComponent(component);\n    }\n    const newApp = new FirebaseServerAppImpl(appOptions, _serverAppConfig, nameString, container);\n    _serverApps.set(nameString, newApp);\n    return newApp;\n}\n/**\n * Retrieves a {@link @firebase/app#FirebaseApp} instance.\n *\n * When called with no arguments, the default app is returned. When an app name\n * is provided, the app corresponding to that name is returned.\n *\n * An exception is thrown if the app being retrieved has not yet been\n * initialized.\n *\n * @example\n * ```javascript\n * // Return the default app\n * const app = getApp();\n * ```\n *\n * @example\n * ```javascript\n * // Return a named app\n * const otherApp = getApp(\"otherApp\");\n * ```\n *\n * @param name - Optional name of the app to return. If no name is\n *   provided, the default is `\"[DEFAULT]\"`.\n *\n * @returns The app corresponding to the provided app name.\n *   If no app name is provided, the default app is returned.\n *\n * @public\n */\nfunction getApp(name = DEFAULT_ENTRY_NAME) {\n    const app = _apps.get(name);\n    if (!app && name === DEFAULT_ENTRY_NAME && getDefaultAppConfig()) {\n        return initializeApp();\n    }\n    if (!app) {\n        throw ERROR_FACTORY.create(\"no-app\" /* AppError.NO_APP */, { appName: name });\n    }\n    return app;\n}\n/**\n * A (read-only) array of all initialized apps.\n * @public\n */\nfunction getApps() {\n    return Array.from(_apps.values());\n}\n/**\n * Renders this app unusable and frees the resources of all associated\n * services.\n *\n * @example\n * ```javascript\n * deleteApp(app)\n *   .then(function() {\n *     console.log(\"App deleted successfully\");\n *   })\n *   .catch(function(error) {\n *     console.log(\"Error deleting app:\", error);\n *   });\n * ```\n *\n * @public\n */\nasync function deleteApp(app) {\n    let cleanupProviders = false;\n    const name = app.name;\n    if (_apps.has(name)) {\n        cleanupProviders = true;\n        _apps.delete(name);\n    }\n    else if (_serverApps.has(name)) {\n        const firebaseServerApp = app;\n        if (firebaseServerApp.decRefCount() <= 0) {\n            _serverApps.delete(name);\n            cleanupProviders = true;\n        }\n    }\n    if (cleanupProviders) {\n        await Promise.all(app.container\n            .getProviders()\n            .map(provider => provider.delete()));\n        app.isDeleted = true;\n    }\n}\n/**\n * Registers a library's name and version for platform logging purposes.\n * @param library - Name of 1p or 3p library (e.g. firestore, angularfire)\n * @param version - Current version of that library.\n * @param variant - Bundle variant, e.g., node, rn, etc.\n *\n * @public\n */\nfunction registerVersion(libraryKeyOrName, version, variant) {\n    var _a;\n    // TODO: We can use this check to whitelist strings when/if we set up\n    // a good whitelist system.\n    let library = (_a = PLATFORM_LOG_STRING[libraryKeyOrName]) !== null && _a !== void 0 ? _a : libraryKeyOrName;\n    if (variant) {\n        library += `-${variant}`;\n    }\n    const libraryMismatch = library.match(/\\s|\\//);\n    const versionMismatch = version.match(/\\s|\\//);\n    if (libraryMismatch || versionMismatch) {\n        const warning = [\n            `Unable to register library \"${library}\" with version \"${version}\":`\n        ];\n        if (libraryMismatch) {\n            warning.push(`library name \"${library}\" contains illegal characters (whitespace or \"/\")`);\n        }\n        if (libraryMismatch && versionMismatch) {\n            warning.push('and');\n        }\n        if (versionMismatch) {\n            warning.push(`version name \"${version}\" contains illegal characters (whitespace or \"/\")`);\n        }\n        logger.warn(warning.join(' '));\n        return;\n    }\n    _registerComponent(new Component(`${library}-version`, () => ({ library, version }), \"VERSION\" /* ComponentType.VERSION */));\n}\n/**\n * Sets log handler for all Firebase SDKs.\n * @param logCallback - An optional custom log handler that executes user code whenever\n * the Firebase SDK makes a logging call.\n *\n * @public\n */\nfunction onLog(logCallback, options) {\n    if (logCallback !== null && typeof logCallback !== 'function') {\n        throw ERROR_FACTORY.create(\"invalid-log-argument\" /* AppError.INVALID_LOG_ARGUMENT */);\n    }\n    setUserLogHandler(logCallback, options);\n}\n/**\n * Sets log level for all Firebase SDKs.\n *\n * All of the log types above the current log level are captured (i.e. if\n * you set the log level to `info`, errors are logged, but `debug` and\n * `verbose` logs are not).\n *\n * @public\n */\nfunction setLogLevel(logLevel) {\n    setLogLevel$1(logLevel);\n}\n\n/**\n * @license\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nconst DB_NAME = 'firebase-heartbeat-database';\nconst DB_VERSION = 1;\nconst STORE_NAME = 'firebase-heartbeat-store';\nlet dbPromise = null;\nfunction getDbPromise() {\n    if (!dbPromise) {\n        dbPromise = openDB(DB_NAME, DB_VERSION, {\n            upgrade: (db, oldVersion) => {\n                // We don't use 'break' in this switch statement, the fall-through\n                // behavior is what we want, because if there are multiple versions between\n                // the old version and the current version, we want ALL the migrations\n                // that correspond to those versions to run, not only the last one.\n                // eslint-disable-next-line default-case\n                switch (oldVersion) {\n                    case 0:\n                        try {\n                            db.createObjectStore(STORE_NAME);\n                        }\n                        catch (e) {\n                            // Safari/iOS browsers throw occasional exceptions on\n                            // db.createObjectStore() that may be a bug. Avoid blocking\n                            // the rest of the app functionality.\n                            console.warn(e);\n                        }\n                }\n            }\n        }).catch(e => {\n            throw ERROR_FACTORY.create(\"idb-open\" /* AppError.IDB_OPEN */, {\n                originalErrorMessage: e.message\n            });\n        });\n    }\n    return dbPromise;\n}\nasync function readHeartbeatsFromIndexedDB(app) {\n    try {\n        const db = await getDbPromise();\n        const tx = db.transaction(STORE_NAME);\n        const result = await tx.objectStore(STORE_NAME).get(computeKey(app));\n        // We already have the value but tx.done can throw,\n        // so we need to await it here to catch errors\n        await tx.done;\n        return result;\n    }\n    catch (e) {\n        if (e instanceof FirebaseError) {\n            logger.warn(e.message);\n        }\n        else {\n            const idbGetError = ERROR_FACTORY.create(\"idb-get\" /* AppError.IDB_GET */, {\n                originalErrorMessage: e === null || e === void 0 ? void 0 : e.message\n            });\n            logger.warn(idbGetError.message);\n        }\n    }\n}\nasync function writeHeartbeatsToIndexedDB(app, heartbeatObject) {\n    try {\n        const db = await getDbPromise();\n        const tx = db.transaction(STORE_NAME, 'readwrite');\n        const objectStore = tx.objectStore(STORE_NAME);\n        await objectStore.put(heartbeatObject, computeKey(app));\n        await tx.done;\n    }\n    catch (e) {\n        if (e instanceof FirebaseError) {\n            logger.warn(e.message);\n        }\n        else {\n            const idbGetError = ERROR_FACTORY.create(\"idb-set\" /* AppError.IDB_WRITE */, {\n                originalErrorMessage: e === null || e === void 0 ? void 0 : e.message\n            });\n            logger.warn(idbGetError.message);\n        }\n    }\n}\nfunction computeKey(app) {\n    return `${app.name}!${app.options.appId}`;\n}\n\n/**\n * @license\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nconst MAX_HEADER_BYTES = 1024;\nconst MAX_NUM_STORED_HEARTBEATS = 30;\nclass HeartbeatServiceImpl {\n    constructor(container) {\n        this.container = container;\n        /**\n         * In-memory cache for heartbeats, used by getHeartbeatsHeader() to generate\n         * the header string.\n         * Stores one record per date. This will be consolidated into the standard\n         * format of one record per user agent string before being sent as a header.\n         * Populated from indexedDB when the controller is instantiated and should\n         * be kept in sync with indexedDB.\n         * Leave public for easier testing.\n         */\n        this._heartbeatsCache = null;\n        const app = this.container.getProvider('app').getImmediate();\n        this._storage = new HeartbeatStorageImpl(app);\n        this._heartbeatsCachePromise = this._storage.read().then(result => {\n            this._heartbeatsCache = result;\n            return result;\n        });\n    }\n    /**\n     * Called to report a heartbeat. The function will generate\n     * a HeartbeatsByUserAgent object, update heartbeatsCache, and persist it\n     * to IndexedDB.\n     * Note that we only store one heartbeat per day. So if a heartbeat for today is\n     * already logged, subsequent calls to this function in the same day will be ignored.\n     */\n    async triggerHeartbeat() {\n        var _a, _b;\n        try {\n            const platformLogger = this.container\n                .getProvider('platform-logger')\n                .getImmediate();\n            // This is the \"Firebase user agent\" string from the platform logger\n            // service, not the browser user agent.\n            const agent = platformLogger.getPlatformInfoString();\n            const date = getUTCDateString();\n            if (((_a = this._heartbeatsCache) === null || _a === void 0 ? void 0 : _a.heartbeats) == null) {\n                this._heartbeatsCache = await this._heartbeatsCachePromise;\n                // If we failed to construct a heartbeats cache, then return immediately.\n                if (((_b = this._heartbeatsCache) === null || _b === void 0 ? void 0 : _b.heartbeats) == null) {\n                    return;\n                }\n            }\n            // Do not store a heartbeat if one is already stored for this day\n            // or if a header has already been sent today.\n            if (this._heartbeatsCache.lastSentHeartbeatDate === date ||\n                this._heartbeatsCache.heartbeats.some(singleDateHeartbeat => singleDateHeartbeat.date === date)) {\n                return;\n            }\n            else {\n                // There is no entry for this date. Create one.\n                this._heartbeatsCache.heartbeats.push({ date, agent });\n                // If the number of stored heartbeats exceeds the maximum number of stored heartbeats, remove the heartbeat with the earliest date.\n                // Since this is executed each time a heartbeat is pushed, the limit can only be exceeded by one, so only one needs to be removed.\n                if (this._heartbeatsCache.heartbeats.length > MAX_NUM_STORED_HEARTBEATS) {\n                    const earliestHeartbeatIdx = getEarliestHeartbeatIdx(this._heartbeatsCache.heartbeats);\n                    this._heartbeatsCache.heartbeats.splice(earliestHeartbeatIdx, 1);\n                }\n            }\n            return this._storage.overwrite(this._heartbeatsCache);\n        }\n        catch (e) {\n            logger.warn(e);\n        }\n    }\n    /**\n     * Returns a base64 encoded string which can be attached to the heartbeat-specific header directly.\n     * It also clears all heartbeats from memory as well as in IndexedDB.\n     *\n     * NOTE: Consuming product SDKs should not send the header if this method\n     * returns an empty string.\n     */\n    async getHeartbeatsHeader() {\n        var _a;\n        try {\n            if (this._heartbeatsCache === null) {\n                await this._heartbeatsCachePromise;\n            }\n            // If it's still null or the array is empty, there is no data to send.\n            if (((_a = this._heartbeatsCache) === null || _a === void 0 ? void 0 : _a.heartbeats) == null ||\n                this._heartbeatsCache.heartbeats.length === 0) {\n                return '';\n            }\n            const date = getUTCDateString();\n            // Extract as many heartbeats from the cache as will fit under the size limit.\n            const { heartbeatsToSend, unsentEntries } = extractHeartbeatsForHeader(this._heartbeatsCache.heartbeats);\n            const headerString = base64urlEncodeWithoutPadding(JSON.stringify({ version: 2, heartbeats: heartbeatsToSend }));\n            // Store last sent date to prevent another being logged/sent for the same day.\n            this._heartbeatsCache.lastSentHeartbeatDate = date;\n            if (unsentEntries.length > 0) {\n                // Store any unsent entries if they exist.\n                this._heartbeatsCache.heartbeats = unsentEntries;\n                // This seems more likely than emptying the array (below) to lead to some odd state\n                // since the cache isn't empty and this will be called again on the next request,\n                // and is probably safest if we await it.\n                await this._storage.overwrite(this._heartbeatsCache);\n            }\n            else {\n                this._heartbeatsCache.heartbeats = [];\n                // Do not wait for this, to reduce latency.\n                void this._storage.overwrite(this._heartbeatsCache);\n            }\n            return headerString;\n        }\n        catch (e) {\n            logger.warn(e);\n            return '';\n        }\n    }\n}\nfunction getUTCDateString() {\n    const today = new Date();\n    // Returns date format 'YYYY-MM-DD'\n    return today.toISOString().substring(0, 10);\n}\nfunction extractHeartbeatsForHeader(heartbeatsCache, maxSize = MAX_HEADER_BYTES) {\n    // Heartbeats grouped by user agent in the standard format to be sent in\n    // the header.\n    const heartbeatsToSend = [];\n    // Single date format heartbeats that are not sent.\n    let unsentEntries = heartbeatsCache.slice();\n    for (const singleDateHeartbeat of heartbeatsCache) {\n        // Look for an existing entry with the same user agent.\n        const heartbeatEntry = heartbeatsToSend.find(hb => hb.agent === singleDateHeartbeat.agent);\n        if (!heartbeatEntry) {\n            // If no entry for this user agent exists, create one.\n            heartbeatsToSend.push({\n                agent: singleDateHeartbeat.agent,\n                dates: [singleDateHeartbeat.date]\n            });\n            if (countBytes(heartbeatsToSend) > maxSize) {\n                // If the header would exceed max size, remove the added heartbeat\n                // entry and stop adding to the header.\n                heartbeatsToSend.pop();\n                break;\n            }\n        }\n        else {\n            heartbeatEntry.dates.push(singleDateHeartbeat.date);\n            // If the header would exceed max size, remove the added date\n            // and stop adding to the header.\n            if (countBytes(heartbeatsToSend) > maxSize) {\n                heartbeatEntry.dates.pop();\n                break;\n            }\n        }\n        // Pop unsent entry from queue. (Skipped if adding the entry exceeded\n        // quota and the loop breaks early.)\n        unsentEntries = unsentEntries.slice(1);\n    }\n    return {\n        heartbeatsToSend,\n        unsentEntries\n    };\n}\nclass HeartbeatStorageImpl {\n    constructor(app) {\n        this.app = app;\n        this._canUseIndexedDBPromise = this.runIndexedDBEnvironmentCheck();\n    }\n    async runIndexedDBEnvironmentCheck() {\n        if (!isIndexedDBAvailable()) {\n            return false;\n        }\n        else {\n            return validateIndexedDBOpenable()\n                .then(() => true)\n                .catch(() => false);\n        }\n    }\n    /**\n     * Read all heartbeats.\n     */\n    async read() {\n        const canUseIndexedDB = await this._canUseIndexedDBPromise;\n        if (!canUseIndexedDB) {\n            return { heartbeats: [] };\n        }\n        else {\n            const idbHeartbeatObject = await readHeartbeatsFromIndexedDB(this.app);\n            if (idbHeartbeatObject === null || idbHeartbeatObject === void 0 ? void 0 : idbHeartbeatObject.heartbeats) {\n                return idbHeartbeatObject;\n            }\n            else {\n                return { heartbeats: [] };\n            }\n        }\n    }\n    // overwrite the storage with the provided heartbeats\n    async overwrite(heartbeatsObject) {\n        var _a;\n        const canUseIndexedDB = await this._canUseIndexedDBPromise;\n        if (!canUseIndexedDB) {\n            return;\n        }\n        else {\n            const existingHeartbeatsObject = await this.read();\n            return writeHeartbeatsToIndexedDB(this.app, {\n                lastSentHeartbeatDate: (_a = heartbeatsObject.lastSentHeartbeatDate) !== null && _a !== void 0 ? _a : existingHeartbeatsObject.lastSentHeartbeatDate,\n                heartbeats: heartbeatsObject.heartbeats\n            });\n        }\n    }\n    // add heartbeats\n    async add(heartbeatsObject) {\n        var _a;\n        const canUseIndexedDB = await this._canUseIndexedDBPromise;\n        if (!canUseIndexedDB) {\n            return;\n        }\n        else {\n            const existingHeartbeatsObject = await this.read();\n            return writeHeartbeatsToIndexedDB(this.app, {\n                lastSentHeartbeatDate: (_a = heartbeatsObject.lastSentHeartbeatDate) !== null && _a !== void 0 ? _a : existingHeartbeatsObject.lastSentHeartbeatDate,\n                heartbeats: [\n                    ...existingHeartbeatsObject.heartbeats,\n                    ...heartbeatsObject.heartbeats\n                ]\n            });\n        }\n    }\n}\n/**\n * Calculate bytes of a HeartbeatsByUserAgent array after being wrapped\n * in a platform logging header JSON object, stringified, and converted\n * to base 64.\n */\nfunction countBytes(heartbeatsCache) {\n    // base64 has a restricted set of characters, all of which should be 1 byte.\n    return base64urlEncodeWithoutPadding(\n    // heartbeatsCache wrapper properties\n    JSON.stringify({ version: 2, heartbeats: heartbeatsCache })).length;\n}\n/**\n * Returns the index of the heartbeat with the earliest date.\n * If the heartbeats array is empty, -1 is returned.\n */\nfunction getEarliestHeartbeatIdx(heartbeats) {\n    if (heartbeats.length === 0) {\n        return -1;\n    }\n    let earliestHeartbeatIdx = 0;\n    let earliestHeartbeatDate = heartbeats[0].date;\n    for (let i = 1; i < heartbeats.length; i++) {\n        if (heartbeats[i].date < earliestHeartbeatDate) {\n            earliestHeartbeatDate = heartbeats[i].date;\n            earliestHeartbeatIdx = i;\n        }\n    }\n    return earliestHeartbeatIdx;\n}\n\n/**\n * @license\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nfunction registerCoreComponents(variant) {\n    _registerComponent(new Component('platform-logger', container => new PlatformLoggerServiceImpl(container), \"PRIVATE\" /* ComponentType.PRIVATE */));\n    _registerComponent(new Component('heartbeat', container => new HeartbeatServiceImpl(container), \"PRIVATE\" /* ComponentType.PRIVATE */));\n    // Register `app` package.\n    registerVersion(name$q, version$1, variant);\n    // BUILD_TARGET will be replaced by values like esm2017, cjs2017, etc during the compilation\n    registerVersion(name$q, version$1, 'esm2017');\n    // Register platform SDK identifier (no version).\n    registerVersion('fire-js', '');\n}\n\n/**\n * Firebase App\n *\n * @remarks This package coordinates the communication between the different Firebase components\n * @packageDocumentation\n */\nregisterCoreComponents('');\n\nexport { SDK_VERSION, DEFAULT_ENTRY_NAME as _DEFAULT_ENTRY_NAME, _addComponent, _addOrOverwriteComponent, _apps, _clearComponents, _components, _getProvider, _isFirebaseApp, _isFirebaseServerApp, _registerComponent, _removeServiceInstance, _serverApps, deleteApp, getApp, getApps, initializeApp, initializeServerApp, onLog, registerVersion, setLogLevel };\n//# sourceMappingURL=index.esm2017.js.map\n","import { registerVersion } from '@firebase/app';\nexport * from '@firebase/app';\n\nvar name = \"firebase\";\nvar version = \"11.10.0\";\n\n/**\n * @license\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nregisterVersion(name, version, 'app');\n//# sourceMappingURL=index.esm.js.map\n","import { _getProvider, getApp, _registerComponent, registerVersion } from '@firebase/app';\nimport { Component } from '@firebase/component';\nimport { ErrorFactory, FirebaseError } from '@firebase/util';\nimport { openDB } from 'idb';\n\nconst name = \"@firebase/installations\";\nconst version = \"0.6.18\";\n\n/**\n * @license\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nconst PENDING_TIMEOUT_MS = 10000;\nconst PACKAGE_VERSION = `w:${version}`;\nconst INTERNAL_AUTH_VERSION = 'FIS_v2';\nconst INSTALLATIONS_API_URL = 'https://firebaseinstallations.googleapis.com/v1';\nconst TOKEN_EXPIRATION_BUFFER = 60 * 60 * 1000; // One hour\nconst SERVICE = 'installations';\nconst SERVICE_NAME = 'Installations';\n\n/**\n * @license\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nconst ERROR_DESCRIPTION_MAP = {\n    [\"missing-app-config-values\" /* ErrorCode.MISSING_APP_CONFIG_VALUES */]: 'Missing App configuration value: \"{$valueName}\"',\n    [\"not-registered\" /* ErrorCode.NOT_REGISTERED */]: 'Firebase Installation is not registered.',\n    [\"installation-not-found\" /* ErrorCode.INSTALLATION_NOT_FOUND */]: 'Firebase Installation not found.',\n    [\"request-failed\" /* ErrorCode.REQUEST_FAILED */]: '{$requestName} request failed with error \"{$serverCode} {$serverStatus}: {$serverMessage}\"',\n    [\"app-offline\" /* ErrorCode.APP_OFFLINE */]: 'Could not process request. Application offline.',\n    [\"delete-pending-registration\" /* ErrorCode.DELETE_PENDING_REGISTRATION */]: \"Can't delete installation while there is a pending registration request.\"\n};\nconst ERROR_FACTORY = new ErrorFactory(SERVICE, SERVICE_NAME, ERROR_DESCRIPTION_MAP);\n/** Returns true if error is a FirebaseError that is based on an error from the server. */\nfunction isServerError(error) {\n    return (error instanceof FirebaseError &&\n        error.code.includes(\"request-failed\" /* ErrorCode.REQUEST_FAILED */));\n}\n\n/**\n * @license\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nfunction getInstallationsEndpoint({ projectId }) {\n    return `${INSTALLATIONS_API_URL}/projects/${projectId}/installations`;\n}\nfunction extractAuthTokenInfoFromResponse(response) {\n    return {\n        token: response.token,\n        requestStatus: 2 /* RequestStatus.COMPLETED */,\n        expiresIn: getExpiresInFromResponseExpiresIn(response.expiresIn),\n        creationTime: Date.now()\n    };\n}\nasync function getErrorFromResponse(requestName, response) {\n    const responseJson = await response.json();\n    const errorData = responseJson.error;\n    return ERROR_FACTORY.create(\"request-failed\" /* ErrorCode.REQUEST_FAILED */, {\n        requestName,\n        serverCode: errorData.code,\n        serverMessage: errorData.message,\n        serverStatus: errorData.status\n    });\n}\nfunction getHeaders({ apiKey }) {\n    return new Headers({\n        'Content-Type': 'application/json',\n        Accept: 'application/json',\n        'x-goog-api-key': apiKey\n    });\n}\nfunction getHeadersWithAuth(appConfig, { refreshToken }) {\n    const headers = getHeaders(appConfig);\n    headers.append('Authorization', getAuthorizationHeader(refreshToken));\n    return headers;\n}\n/**\n * Calls the passed in fetch wrapper and returns the response.\n * If the returned response has a status of 5xx, re-runs the function once and\n * returns the response.\n */\nasync function retryIfServerError(fn) {\n    const result = await fn();\n    if (result.status >= 500 && result.status < 600) {\n        // Internal Server Error. Retry request.\n        return fn();\n    }\n    return result;\n}\nfunction getExpiresInFromResponseExpiresIn(responseExpiresIn) {\n    // This works because the server will never respond with fractions of a second.\n    return Number(responseExpiresIn.replace('s', '000'));\n}\nfunction getAuthorizationHeader(refreshToken) {\n    return `${INTERNAL_AUTH_VERSION} ${refreshToken}`;\n}\n\n/**\n * @license\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nasync function createInstallationRequest({ appConfig, heartbeatServiceProvider }, { fid }) {\n    const endpoint = getInstallationsEndpoint(appConfig);\n    const headers = getHeaders(appConfig);\n    // If heartbeat service exists, add the heartbeat string to the header.\n    const heartbeatService = heartbeatServiceProvider.getImmediate({\n        optional: true\n    });\n    if (heartbeatService) {\n        const heartbeatsHeader = await heartbeatService.getHeartbeatsHeader();\n        if (heartbeatsHeader) {\n            headers.append('x-firebase-client', heartbeatsHeader);\n        }\n    }\n    const body = {\n        fid,\n        authVersion: INTERNAL_AUTH_VERSION,\n        appId: appConfig.appId,\n        sdkVersion: PACKAGE_VERSION\n    };\n    const request = {\n        method: 'POST',\n        headers,\n        body: JSON.stringify(body)\n    };\n    const response = await retryIfServerError(() => fetch(endpoint, request));\n    if (response.ok) {\n        const responseValue = await response.json();\n        const registeredInstallationEntry = {\n            fid: responseValue.fid || fid,\n            registrationStatus: 2 /* RequestStatus.COMPLETED */,\n            refreshToken: responseValue.refreshToken,\n            authToken: extractAuthTokenInfoFromResponse(responseValue.authToken)\n        };\n        return registeredInstallationEntry;\n    }\n    else {\n        throw await getErrorFromResponse('Create Installation', response);\n    }\n}\n\n/**\n * @license\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/** Returns a promise that resolves after given time passes. */\nfunction sleep(ms) {\n    return new Promise(resolve => {\n        setTimeout(resolve, ms);\n    });\n}\n\n/**\n * @license\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nfunction bufferToBase64UrlSafe(array) {\n    const b64 = btoa(String.fromCharCode(...array));\n    return b64.replace(/\\+/g, '-').replace(/\\//g, '_');\n}\n\n/**\n * @license\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nconst VALID_FID_PATTERN = /^[cdef][\\w-]{21}$/;\nconst INVALID_FID = '';\n/**\n * Generates a new FID using random values from Web Crypto API.\n * Returns an empty string if FID generation fails for any reason.\n */\nfunction generateFid() {\n    try {\n        // A valid FID has exactly 22 base64 characters, which is 132 bits, or 16.5\n        // bytes. our implementation generates a 17 byte array instead.\n        const fidByteArray = new Uint8Array(17);\n        const crypto = self.crypto || self.msCrypto;\n        crypto.getRandomValues(fidByteArray);\n        // Replace the first 4 random bits with the constant FID header of 0b0111.\n        fidByteArray[0] = 0b01110000 + (fidByteArray[0] % 0b00010000);\n        const fid = encode(fidByteArray);\n        return VALID_FID_PATTERN.test(fid) ? fid : INVALID_FID;\n    }\n    catch (_a) {\n        // FID generation errored\n        return INVALID_FID;\n    }\n}\n/** Converts a FID Uint8Array to a base64 string representation. */\nfunction encode(fidByteArray) {\n    const b64String = bufferToBase64UrlSafe(fidByteArray);\n    // Remove the 23rd character that was added because of the extra 4 bits at the\n    // end of our 17 byte array, and the '=' padding.\n    return b64String.substr(0, 22);\n}\n\n/**\n * @license\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/** Returns a string key that can be used to identify the app. */\nfunction getKey(appConfig) {\n    return `${appConfig.appName}!${appConfig.appId}`;\n}\n\n/**\n * @license\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nconst fidChangeCallbacks = new Map();\n/**\n * Calls the onIdChange callbacks with the new FID value, and broadcasts the\n * change to other tabs.\n */\nfunction fidChanged(appConfig, fid) {\n    const key = getKey(appConfig);\n    callFidChangeCallbacks(key, fid);\n    broadcastFidChange(key, fid);\n}\nfunction addCallback(appConfig, callback) {\n    // Open the broadcast channel if it's not already open,\n    // to be able to listen to change events from other tabs.\n    getBroadcastChannel();\n    const key = getKey(appConfig);\n    let callbackSet = fidChangeCallbacks.get(key);\n    if (!callbackSet) {\n        callbackSet = new Set();\n        fidChangeCallbacks.set(key, callbackSet);\n    }\n    callbackSet.add(callback);\n}\nfunction removeCallback(appConfig, callback) {\n    const key = getKey(appConfig);\n    const callbackSet = fidChangeCallbacks.get(key);\n    if (!callbackSet) {\n        return;\n    }\n    callbackSet.delete(callback);\n    if (callbackSet.size === 0) {\n        fidChangeCallbacks.delete(key);\n    }\n    // Close broadcast channel if there are no more callbacks.\n    closeBroadcastChannel();\n}\nfunction callFidChangeCallbacks(key, fid) {\n    const callbacks = fidChangeCallbacks.get(key);\n    if (!callbacks) {\n        return;\n    }\n    for (const callback of callbacks) {\n        callback(fid);\n    }\n}\nfunction broadcastFidChange(key, fid) {\n    const channel = getBroadcastChannel();\n    if (channel) {\n        channel.postMessage({ key, fid });\n    }\n    closeBroadcastChannel();\n}\nlet broadcastChannel = null;\n/** Opens and returns a BroadcastChannel if it is supported by the browser. */\nfunction getBroadcastChannel() {\n    if (!broadcastChannel && 'BroadcastChannel' in self) {\n        broadcastChannel = new BroadcastChannel('[Firebase] FID Change');\n        broadcastChannel.onmessage = e => {\n            callFidChangeCallbacks(e.data.key, e.data.fid);\n        };\n    }\n    return broadcastChannel;\n}\nfunction closeBroadcastChannel() {\n    if (fidChangeCallbacks.size === 0 && broadcastChannel) {\n        broadcastChannel.close();\n        broadcastChannel = null;\n    }\n}\n\n/**\n * @license\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nconst DATABASE_NAME = 'firebase-installations-database';\nconst DATABASE_VERSION = 1;\nconst OBJECT_STORE_NAME = 'firebase-installations-store';\nlet dbPromise = null;\nfunction getDbPromise() {\n    if (!dbPromise) {\n        dbPromise = openDB(DATABASE_NAME, DATABASE_VERSION, {\n            upgrade: (db, oldVersion) => {\n                // We don't use 'break' in this switch statement, the fall-through\n                // behavior is what we want, because if there are multiple versions between\n                // the old version and the current version, we want ALL the migrations\n                // that correspond to those versions to run, not only the last one.\n                // eslint-disable-next-line default-case\n                switch (oldVersion) {\n                    case 0:\n                        db.createObjectStore(OBJECT_STORE_NAME);\n                }\n            }\n        });\n    }\n    return dbPromise;\n}\n/** Assigns or overwrites the record for the given key with the given value. */\nasync function set(appConfig, value) {\n    const key = getKey(appConfig);\n    const db = await getDbPromise();\n    const tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\n    const objectStore = tx.objectStore(OBJECT_STORE_NAME);\n    const oldValue = (await objectStore.get(key));\n    await objectStore.put(value, key);\n    await tx.done;\n    if (!oldValue || oldValue.fid !== value.fid) {\n        fidChanged(appConfig, value.fid);\n    }\n    return value;\n}\n/** Removes record(s) from the objectStore that match the given key. */\nasync function remove(appConfig) {\n    const key = getKey(appConfig);\n    const db = await getDbPromise();\n    const tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\n    await tx.objectStore(OBJECT_STORE_NAME).delete(key);\n    await tx.done;\n}\n/**\n * Atomically updates a record with the result of updateFn, which gets\n * called with the current value. If newValue is undefined, the record is\n * deleted instead.\n * @return Updated value\n */\nasync function update(appConfig, updateFn) {\n    const key = getKey(appConfig);\n    const db = await getDbPromise();\n    const tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\n    const store = tx.objectStore(OBJECT_STORE_NAME);\n    const oldValue = (await store.get(key));\n    const newValue = updateFn(oldValue);\n    if (newValue === undefined) {\n        await store.delete(key);\n    }\n    else {\n        await store.put(newValue, key);\n    }\n    await tx.done;\n    if (newValue && (!oldValue || oldValue.fid !== newValue.fid)) {\n        fidChanged(appConfig, newValue.fid);\n    }\n    return newValue;\n}\n\n/**\n * @license\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/**\n * Updates and returns the InstallationEntry from the database.\n * Also triggers a registration request if it is necessary and possible.\n */\nasync function getInstallationEntry(installations) {\n    let registrationPromise;\n    const installationEntry = await update(installations.appConfig, oldEntry => {\n        const installationEntry = updateOrCreateInstallationEntry(oldEntry);\n        const entryWithPromise = triggerRegistrationIfNecessary(installations, installationEntry);\n        registrationPromise = entryWithPromise.registrationPromise;\n        return entryWithPromise.installationEntry;\n    });\n    if (installationEntry.fid === INVALID_FID) {\n        // FID generation failed. Waiting for the FID from the server.\n        return { installationEntry: await registrationPromise };\n    }\n    return {\n        installationEntry,\n        registrationPromise\n    };\n}\n/**\n * Creates a new Installation Entry if one does not exist.\n * Also clears timed out pending requests.\n */\nfunction updateOrCreateInstallationEntry(oldEntry) {\n    const entry = oldEntry || {\n        fid: generateFid(),\n        registrationStatus: 0 /* RequestStatus.NOT_STARTED */\n    };\n    return clearTimedOutRequest(entry);\n}\n/**\n * If the Firebase Installation is not registered yet, this will trigger the\n * registration and return an InProgressInstallationEntry.\n *\n * If registrationPromise does not exist, the installationEntry is guaranteed\n * to be registered.\n */\nfunction triggerRegistrationIfNecessary(installations, installationEntry) {\n    if (installationEntry.registrationStatus === 0 /* RequestStatus.NOT_STARTED */) {\n        if (!navigator.onLine) {\n            // Registration required but app is offline.\n            const registrationPromiseWithError = Promise.reject(ERROR_FACTORY.create(\"app-offline\" /* ErrorCode.APP_OFFLINE */));\n            return {\n                installationEntry,\n                registrationPromise: registrationPromiseWithError\n            };\n        }\n        // Try registering. Change status to IN_PROGRESS.\n        const inProgressEntry = {\n            fid: installationEntry.fid,\n            registrationStatus: 1 /* RequestStatus.IN_PROGRESS */,\n            registrationTime: Date.now()\n        };\n        const registrationPromise = registerInstallation(installations, inProgressEntry);\n        return { installationEntry: inProgressEntry, registrationPromise };\n    }\n    else if (installationEntry.registrationStatus === 1 /* RequestStatus.IN_PROGRESS */) {\n        return {\n            installationEntry,\n            registrationPromise: waitUntilFidRegistration(installations)\n        };\n    }\n    else {\n        return { installationEntry };\n    }\n}\n/** This will be executed only once for each new Firebase Installation. */\nasync function registerInstallation(installations, installationEntry) {\n    try {\n        const registeredInstallationEntry = await createInstallationRequest(installations, installationEntry);\n        return set(installations.appConfig, registeredInstallationEntry);\n    }\n    catch (e) {\n        if (isServerError(e) && e.customData.serverCode === 409) {\n            // Server returned a \"FID cannot be used\" error.\n            // Generate a new ID next time.\n            await remove(installations.appConfig);\n        }\n        else {\n            // Registration failed. Set FID as not registered.\n            await set(installations.appConfig, {\n                fid: installationEntry.fid,\n                registrationStatus: 0 /* RequestStatus.NOT_STARTED */\n            });\n        }\n        throw e;\n    }\n}\n/** Call if FID registration is pending in another request. */\nasync function waitUntilFidRegistration(installations) {\n    // Unfortunately, there is no way of reliably observing when a value in\n    // IndexedDB changes (yet, see https://github.com/WICG/indexed-db-observers),\n    // so we need to poll.\n    let entry = await updateInstallationRequest(installations.appConfig);\n    while (entry.registrationStatus === 1 /* RequestStatus.IN_PROGRESS */) {\n        // createInstallation request still in progress.\n        await sleep(100);\n        entry = await updateInstallationRequest(installations.appConfig);\n    }\n    if (entry.registrationStatus === 0 /* RequestStatus.NOT_STARTED */) {\n        // The request timed out or failed in a different call. Try again.\n        const { installationEntry, registrationPromise } = await getInstallationEntry(installations);\n        if (registrationPromise) {\n            return registrationPromise;\n        }\n        else {\n            // if there is no registrationPromise, entry is registered.\n            return installationEntry;\n        }\n    }\n    return entry;\n}\n/**\n * Called only if there is a CreateInstallation request in progress.\n *\n * Updates the InstallationEntry in the DB based on the status of the\n * CreateInstallation request.\n *\n * Returns the updated InstallationEntry.\n */\nfunction updateInstallationRequest(appConfig) {\n    return update(appConfig, oldEntry => {\n        if (!oldEntry) {\n            throw ERROR_FACTORY.create(\"installation-not-found\" /* ErrorCode.INSTALLATION_NOT_FOUND */);\n        }\n        return clearTimedOutRequest(oldEntry);\n    });\n}\nfunction clearTimedOutRequest(entry) {\n    if (hasInstallationRequestTimedOut(entry)) {\n        return {\n            fid: entry.fid,\n            registrationStatus: 0 /* RequestStatus.NOT_STARTED */\n        };\n    }\n    return entry;\n}\nfunction hasInstallationRequestTimedOut(installationEntry) {\n    return (installationEntry.registrationStatus === 1 /* RequestStatus.IN_PROGRESS */ &&\n        installationEntry.registrationTime + PENDING_TIMEOUT_MS < Date.now());\n}\n\n/**\n * @license\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nasync function generateAuthTokenRequest({ appConfig, heartbeatServiceProvider }, installationEntry) {\n    const endpoint = getGenerateAuthTokenEndpoint(appConfig, installationEntry);\n    const headers = getHeadersWithAuth(appConfig, installationEntry);\n    // If heartbeat service exists, add the heartbeat string to the header.\n    const heartbeatService = heartbeatServiceProvider.getImmediate({\n        optional: true\n    });\n    if (heartbeatService) {\n        const heartbeatsHeader = await heartbeatService.getHeartbeatsHeader();\n        if (heartbeatsHeader) {\n            headers.append('x-firebase-client', heartbeatsHeader);\n        }\n    }\n    const body = {\n        installation: {\n            sdkVersion: PACKAGE_VERSION,\n            appId: appConfig.appId\n        }\n    };\n    const request = {\n        method: 'POST',\n        headers,\n        body: JSON.stringify(body)\n    };\n    const response = await retryIfServerError(() => fetch(endpoint, request));\n    if (response.ok) {\n        const responseValue = await response.json();\n        const completedAuthToken = extractAuthTokenInfoFromResponse(responseValue);\n        return completedAuthToken;\n    }\n    else {\n        throw await getErrorFromResponse('Generate Auth Token', response);\n    }\n}\nfunction getGenerateAuthTokenEndpoint(appConfig, { fid }) {\n    return `${getInstallationsEndpoint(appConfig)}/${fid}/authTokens:generate`;\n}\n\n/**\n * @license\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/**\n * Returns a valid authentication token for the installation. Generates a new\n * token if one doesn't exist, is expired or about to expire.\n *\n * Should only be called if the Firebase Installation is registered.\n */\nasync function refreshAuthToken(installations, forceRefresh = false) {\n    let tokenPromise;\n    const entry = await update(installations.appConfig, oldEntry => {\n        if (!isEntryRegistered(oldEntry)) {\n            throw ERROR_FACTORY.create(\"not-registered\" /* ErrorCode.NOT_REGISTERED */);\n        }\n        const oldAuthToken = oldEntry.authToken;\n        if (!forceRefresh && isAuthTokenValid(oldAuthToken)) {\n            // There is a valid token in the DB.\n            return oldEntry;\n        }\n        else if (oldAuthToken.requestStatus === 1 /* RequestStatus.IN_PROGRESS */) {\n            // There already is a token request in progress.\n            tokenPromise = waitUntilAuthTokenRequest(installations, forceRefresh);\n            return oldEntry;\n        }\n        else {\n            // No token or token expired.\n            if (!navigator.onLine) {\n                throw ERROR_FACTORY.create(\"app-offline\" /* ErrorCode.APP_OFFLINE */);\n            }\n            const inProgressEntry = makeAuthTokenRequestInProgressEntry(oldEntry);\n            tokenPromise = fetchAuthTokenFromServer(installations, inProgressEntry);\n            return inProgressEntry;\n        }\n    });\n    const authToken = tokenPromise\n        ? await tokenPromise\n        : entry.authToken;\n    return authToken;\n}\n/**\n * Call only if FID is registered and Auth Token request is in progress.\n *\n * Waits until the current pending request finishes. If the request times out,\n * tries once in this thread as well.\n */\nasync function waitUntilAuthTokenRequest(installations, forceRefresh) {\n    // Unfortunately, there is no way of reliably observing when a value in\n    // IndexedDB changes (yet, see https://github.com/WICG/indexed-db-observers),\n    // so we need to poll.\n    let entry = await updateAuthTokenRequest(installations.appConfig);\n    while (entry.authToken.requestStatus === 1 /* RequestStatus.IN_PROGRESS */) {\n        // generateAuthToken still in progress.\n        await sleep(100);\n        entry = await updateAuthTokenRequest(installations.appConfig);\n    }\n    const authToken = entry.authToken;\n    if (authToken.requestStatus === 0 /* RequestStatus.NOT_STARTED */) {\n        // The request timed out or failed in a different call. Try again.\n        return refreshAuthToken(installations, forceRefresh);\n    }\n    else {\n        return authToken;\n    }\n}\n/**\n * Called only if there is a GenerateAuthToken request in progress.\n *\n * Updates the InstallationEntry in the DB based on the status of the\n * GenerateAuthToken request.\n *\n * Returns the updated InstallationEntry.\n */\nfunction updateAuthTokenRequest(appConfig) {\n    return update(appConfig, oldEntry => {\n        if (!isEntryRegistered(oldEntry)) {\n            throw ERROR_FACTORY.create(\"not-registered\" /* ErrorCode.NOT_REGISTERED */);\n        }\n        const oldAuthToken = oldEntry.authToken;\n        if (hasAuthTokenRequestTimedOut(oldAuthToken)) {\n            return Object.assign(Object.assign({}, oldEntry), { authToken: { requestStatus: 0 /* RequestStatus.NOT_STARTED */ } });\n        }\n        return oldEntry;\n    });\n}\nasync function fetchAuthTokenFromServer(installations, installationEntry) {\n    try {\n        const authToken = await generateAuthTokenRequest(installations, installationEntry);\n        const updatedInstallationEntry = Object.assign(Object.assign({}, installationEntry), { authToken });\n        await set(installations.appConfig, updatedInstallationEntry);\n        return authToken;\n    }\n    catch (e) {\n        if (isServerError(e) &&\n            (e.customData.serverCode === 401 || e.customData.serverCode === 404)) {\n            // Server returned a \"FID not found\" or a \"Invalid authentication\" error.\n            // Generate a new ID next time.\n            await remove(installations.appConfig);\n        }\n        else {\n            const updatedInstallationEntry = Object.assign(Object.assign({}, installationEntry), { authToken: { requestStatus: 0 /* RequestStatus.NOT_STARTED */ } });\n            await set(installations.appConfig, updatedInstallationEntry);\n        }\n        throw e;\n    }\n}\nfunction isEntryRegistered(installationEntry) {\n    return (installationEntry !== undefined &&\n        installationEntry.registrationStatus === 2 /* RequestStatus.COMPLETED */);\n}\nfunction isAuthTokenValid(authToken) {\n    return (authToken.requestStatus === 2 /* RequestStatus.COMPLETED */ &&\n        !isAuthTokenExpired(authToken));\n}\nfunction isAuthTokenExpired(authToken) {\n    const now = Date.now();\n    return (now < authToken.creationTime ||\n        authToken.creationTime + authToken.expiresIn < now + TOKEN_EXPIRATION_BUFFER);\n}\n/** Returns an updated InstallationEntry with an InProgressAuthToken. */\nfunction makeAuthTokenRequestInProgressEntry(oldEntry) {\n    const inProgressAuthToken = {\n        requestStatus: 1 /* RequestStatus.IN_PROGRESS */,\n        requestTime: Date.now()\n    };\n    return Object.assign(Object.assign({}, oldEntry), { authToken: inProgressAuthToken });\n}\nfunction hasAuthTokenRequestTimedOut(authToken) {\n    return (authToken.requestStatus === 1 /* RequestStatus.IN_PROGRESS */ &&\n        authToken.requestTime + PENDING_TIMEOUT_MS < Date.now());\n}\n\n/**\n * @license\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/**\n * Creates a Firebase Installation if there isn't one for the app and\n * returns the Installation ID.\n * @param installations - The `Installations` instance.\n *\n * @public\n */\nasync function getId(installations) {\n    const installationsImpl = installations;\n    const { installationEntry, registrationPromise } = await getInstallationEntry(installationsImpl);\n    if (registrationPromise) {\n        registrationPromise.catch(console.error);\n    }\n    else {\n        // If the installation is already registered, update the authentication\n        // token if needed.\n        refreshAuthToken(installationsImpl).catch(console.error);\n    }\n    return installationEntry.fid;\n}\n\n/**\n * @license\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/**\n * Returns a Firebase Installations auth token, identifying the current\n * Firebase Installation.\n * @param installations - The `Installations` instance.\n * @param forceRefresh - Force refresh regardless of token expiration.\n *\n * @public\n */\nasync function getToken(installations, forceRefresh = false) {\n    const installationsImpl = installations;\n    await completeInstallationRegistration(installationsImpl);\n    // At this point we either have a Registered Installation in the DB, or we've\n    // already thrown an error.\n    const authToken = await refreshAuthToken(installationsImpl, forceRefresh);\n    return authToken.token;\n}\nasync function completeInstallationRegistration(installations) {\n    const { registrationPromise } = await getInstallationEntry(installations);\n    if (registrationPromise) {\n        // A createInstallation request is in progress. Wait until it finishes.\n        await registrationPromise;\n    }\n}\n\n/**\n * @license\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nasync function deleteInstallationRequest(appConfig, installationEntry) {\n    const endpoint = getDeleteEndpoint(appConfig, installationEntry);\n    const headers = getHeadersWithAuth(appConfig, installationEntry);\n    const request = {\n        method: 'DELETE',\n        headers\n    };\n    const response = await retryIfServerError(() => fetch(endpoint, request));\n    if (!response.ok) {\n        throw await getErrorFromResponse('Delete Installation', response);\n    }\n}\nfunction getDeleteEndpoint(appConfig, { fid }) {\n    return `${getInstallationsEndpoint(appConfig)}/${fid}`;\n}\n\n/**\n * @license\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/**\n * Deletes the Firebase Installation and all associated data.\n * @param installations - The `Installations` instance.\n *\n * @public\n */\nasync function deleteInstallations(installations) {\n    const { appConfig } = installations;\n    const entry = await update(appConfig, oldEntry => {\n        if (oldEntry && oldEntry.registrationStatus === 0 /* RequestStatus.NOT_STARTED */) {\n            // Delete the unregistered entry without sending a deleteInstallation request.\n            return undefined;\n        }\n        return oldEntry;\n    });\n    if (entry) {\n        if (entry.registrationStatus === 1 /* RequestStatus.IN_PROGRESS */) {\n            // Can't delete while trying to register.\n            throw ERROR_FACTORY.create(\"delete-pending-registration\" /* ErrorCode.DELETE_PENDING_REGISTRATION */);\n        }\n        else if (entry.registrationStatus === 2 /* RequestStatus.COMPLETED */) {\n            if (!navigator.onLine) {\n                throw ERROR_FACTORY.create(\"app-offline\" /* ErrorCode.APP_OFFLINE */);\n            }\n            else {\n                await deleteInstallationRequest(appConfig, entry);\n                await remove(appConfig);\n            }\n        }\n    }\n}\n\n/**\n * @license\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/**\n * Sets a new callback that will get called when Installation ID changes.\n * Returns an unsubscribe function that will remove the callback when called.\n * @param installations - The `Installations` instance.\n * @param callback - The callback function that is invoked when FID changes.\n * @returns A function that can be called to unsubscribe.\n *\n * @public\n */\nfunction onIdChange(installations, callback) {\n    const { appConfig } = installations;\n    addCallback(appConfig, callback);\n    return () => {\n        removeCallback(appConfig, callback);\n    };\n}\n\n/**\n * @license\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/**\n * Returns an instance of {@link Installations} associated with the given\n * {@link @firebase/app#FirebaseApp} instance.\n * @param app - The {@link @firebase/app#FirebaseApp} instance.\n *\n * @public\n */\nfunction getInstallations(app = getApp()) {\n    const installationsImpl = _getProvider(app, 'installations').getImmediate();\n    return installationsImpl;\n}\n\n/**\n * @license\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nfunction extractAppConfig(app) {\n    if (!app || !app.options) {\n        throw getMissingValueError('App Configuration');\n    }\n    if (!app.name) {\n        throw getMissingValueError('App Name');\n    }\n    // Required app config keys\n    const configKeys = [\n        'projectId',\n        'apiKey',\n        'appId'\n    ];\n    for (const keyName of configKeys) {\n        if (!app.options[keyName]) {\n            throw getMissingValueError(keyName);\n        }\n    }\n    return {\n        appName: app.name,\n        projectId: app.options.projectId,\n        apiKey: app.options.apiKey,\n        appId: app.options.appId\n    };\n}\nfunction getMissingValueError(valueName) {\n    return ERROR_FACTORY.create(\"missing-app-config-values\" /* ErrorCode.MISSING_APP_CONFIG_VALUES */, {\n        valueName\n    });\n}\n\n/**\n * @license\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nconst INSTALLATIONS_NAME = 'installations';\nconst INSTALLATIONS_NAME_INTERNAL = 'installations-internal';\nconst publicFactory = (container) => {\n    const app = container.getProvider('app').getImmediate();\n    // Throws if app isn't configured properly.\n    const appConfig = extractAppConfig(app);\n    const heartbeatServiceProvider = _getProvider(app, 'heartbeat');\n    const installationsImpl = {\n        app,\n        appConfig,\n        heartbeatServiceProvider,\n        _delete: () => Promise.resolve()\n    };\n    return installationsImpl;\n};\nconst internalFactory = (container) => {\n    const app = container.getProvider('app').getImmediate();\n    // Internal FIS instance relies on public FIS instance.\n    const installations = _getProvider(app, INSTALLATIONS_NAME).getImmediate();\n    const installationsInternal = {\n        getId: () => getId(installations),\n        getToken: (forceRefresh) => getToken(installations, forceRefresh)\n    };\n    return installationsInternal;\n};\nfunction registerInstallations() {\n    _registerComponent(new Component(INSTALLATIONS_NAME, publicFactory, \"PUBLIC\" /* ComponentType.PUBLIC */));\n    _registerComponent(new Component(INSTALLATIONS_NAME_INTERNAL, internalFactory, \"PRIVATE\" /* ComponentType.PRIVATE */));\n}\n\n/**\n * The Firebase Installations Web SDK.\n * This SDK does not work in a Node.js environment.\n *\n * @packageDocumentation\n */\nregisterInstallations();\nregisterVersion(name, version);\n// BUILD_TARGET will be replaced by values like esm2017, cjs2017, etc during the compilation\nregisterVersion(name, version, 'esm2017');\n\nexport { deleteInstallations, getId, getInstallations, getToken, onIdChange };\n//# sourceMappingURL=index.esm2017.js.map\n","import '@firebase/installations';\nimport { Component } from '@firebase/component';\nimport { openDB, deleteDB } from 'idb';\nimport { ErrorFactory, validateIndexedDBOpenable, isIndexedDBAvailable, areCookiesEnabled, getModularInstance } from '@firebase/util';\nimport { _registerComponent, registerVersion, _getProvider, getApp } from '@firebase/app';\n\n/**\n * @license\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nconst DEFAULT_SW_PATH = '/firebase-messaging-sw.js';\nconst DEFAULT_SW_SCOPE = '/firebase-cloud-messaging-push-scope';\nconst DEFAULT_VAPID_KEY = 'BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4';\nconst ENDPOINT = 'https://fcmregistrations.googleapis.com/v1';\nconst CONSOLE_CAMPAIGN_ID = 'google.c.a.c_id';\nconst CONSOLE_CAMPAIGN_NAME = 'google.c.a.c_l';\nconst CONSOLE_CAMPAIGN_TIME = 'google.c.a.ts';\n/** Set to '1' if Analytics is enabled for the campaign */\nconst CONSOLE_CAMPAIGN_ANALYTICS_ENABLED = 'google.c.a.e';\nconst DEFAULT_REGISTRATION_TIMEOUT = 10000;\nvar MessageType$1;\n(function (MessageType) {\n    MessageType[MessageType[\"DATA_MESSAGE\"] = 1] = \"DATA_MESSAGE\";\n    MessageType[MessageType[\"DISPLAY_NOTIFICATION\"] = 3] = \"DISPLAY_NOTIFICATION\";\n})(MessageType$1 || (MessageType$1 = {}));\n\n/**\n * @license\n * Copyright 2018 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except\n * in compliance with the License. You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software distributed under the License\n * is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express\n * or implied. See the License for the specific language governing permissions and limitations under\n * the License.\n */\nvar MessageType;\n(function (MessageType) {\n    MessageType[\"PUSH_RECEIVED\"] = \"push-received\";\n    MessageType[\"NOTIFICATION_CLICKED\"] = \"notification-clicked\";\n})(MessageType || (MessageType = {}));\n\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nfunction arrayToBase64(array) {\n    const uint8Array = new Uint8Array(array);\n    const base64String = btoa(String.fromCharCode(...uint8Array));\n    return base64String.replace(/=/g, '').replace(/\\+/g, '-').replace(/\\//g, '_');\n}\nfunction base64ToArray(base64String) {\n    const padding = '='.repeat((4 - (base64String.length % 4)) % 4);\n    const base64 = (base64String + padding)\n        .replace(/\\-/g, '+')\n        .replace(/_/g, '/');\n    const rawData = atob(base64);\n    const outputArray = new Uint8Array(rawData.length);\n    for (let i = 0; i < rawData.length; ++i) {\n        outputArray[i] = rawData.charCodeAt(i);\n    }\n    return outputArray;\n}\n\n/**\n * @license\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nconst OLD_DB_NAME = 'fcm_token_details_db';\n/**\n * The last DB version of 'fcm_token_details_db' was 4. This is one higher, so that the upgrade\n * callback is called for all versions of the old DB.\n */\nconst OLD_DB_VERSION = 5;\nconst OLD_OBJECT_STORE_NAME = 'fcm_token_object_Store';\nasync function migrateOldDatabase(senderId) {\n    if ('databases' in indexedDB) {\n        // indexedDb.databases() is an IndexedDB v3 API and does not exist in all browsers. TODO: Remove\n        // typecast when it lands in TS types.\n        const databases = await indexedDB.databases();\n        const dbNames = databases.map(db => db.name);\n        if (!dbNames.includes(OLD_DB_NAME)) {\n            // old DB didn't exist, no need to open.\n            return null;\n        }\n    }\n    let tokenDetails = null;\n    const db = await openDB(OLD_DB_NAME, OLD_DB_VERSION, {\n        upgrade: async (db, oldVersion, newVersion, upgradeTransaction) => {\n            var _a;\n            if (oldVersion < 2) {\n                // Database too old, skip migration.\n                return;\n            }\n            if (!db.objectStoreNames.contains(OLD_OBJECT_STORE_NAME)) {\n                // Database did not exist. Nothing to do.\n                return;\n            }\n            const objectStore = upgradeTransaction.objectStore(OLD_OBJECT_STORE_NAME);\n            const value = await objectStore.index('fcmSenderId').get(senderId);\n            await objectStore.clear();\n            if (!value) {\n                // No entry in the database, nothing to migrate.\n                return;\n            }\n            if (oldVersion === 2) {\n                const oldDetails = value;\n                if (!oldDetails.auth || !oldDetails.p256dh || !oldDetails.endpoint) {\n                    return;\n                }\n                tokenDetails = {\n                    token: oldDetails.fcmToken,\n                    createTime: (_a = oldDetails.createTime) !== null && _a !== void 0 ? _a : Date.now(),\n                    subscriptionOptions: {\n                        auth: oldDetails.auth,\n                        p256dh: oldDetails.p256dh,\n                        endpoint: oldDetails.endpoint,\n                        swScope: oldDetails.swScope,\n                        vapidKey: typeof oldDetails.vapidKey === 'string'\n                            ? oldDetails.vapidKey\n                            : arrayToBase64(oldDetails.vapidKey)\n                    }\n                };\n            }\n            else if (oldVersion === 3) {\n                const oldDetails = value;\n                tokenDetails = {\n                    token: oldDetails.fcmToken,\n                    createTime: oldDetails.createTime,\n                    subscriptionOptions: {\n                        auth: arrayToBase64(oldDetails.auth),\n                        p256dh: arrayToBase64(oldDetails.p256dh),\n                        endpoint: oldDetails.endpoint,\n                        swScope: oldDetails.swScope,\n                        vapidKey: arrayToBase64(oldDetails.vapidKey)\n                    }\n                };\n            }\n            else if (oldVersion === 4) {\n                const oldDetails = value;\n                tokenDetails = {\n                    token: oldDetails.fcmToken,\n                    createTime: oldDetails.createTime,\n                    subscriptionOptions: {\n                        auth: arrayToBase64(oldDetails.auth),\n                        p256dh: arrayToBase64(oldDetails.p256dh),\n                        endpoint: oldDetails.endpoint,\n                        swScope: oldDetails.swScope,\n                        vapidKey: arrayToBase64(oldDetails.vapidKey)\n                    }\n                };\n            }\n        }\n    });\n    db.close();\n    // Delete all old databases.\n    await deleteDB(OLD_DB_NAME);\n    await deleteDB('fcm_vapid_details_db');\n    await deleteDB('undefined');\n    return checkTokenDetails(tokenDetails) ? tokenDetails : null;\n}\nfunction checkTokenDetails(tokenDetails) {\n    if (!tokenDetails || !tokenDetails.subscriptionOptions) {\n        return false;\n    }\n    const { subscriptionOptions } = tokenDetails;\n    return (typeof tokenDetails.createTime === 'number' &&\n        tokenDetails.createTime > 0 &&\n        typeof tokenDetails.token === 'string' &&\n        tokenDetails.token.length > 0 &&\n        typeof subscriptionOptions.auth === 'string' &&\n        subscriptionOptions.auth.length > 0 &&\n        typeof subscriptionOptions.p256dh === 'string' &&\n        subscriptionOptions.p256dh.length > 0 &&\n        typeof subscriptionOptions.endpoint === 'string' &&\n        subscriptionOptions.endpoint.length > 0 &&\n        typeof subscriptionOptions.swScope === 'string' &&\n        subscriptionOptions.swScope.length > 0 &&\n        typeof subscriptionOptions.vapidKey === 'string' &&\n        subscriptionOptions.vapidKey.length > 0);\n}\n\n/**\n * @license\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n// Exported for tests.\nconst DATABASE_NAME = 'firebase-messaging-database';\nconst DATABASE_VERSION = 1;\nconst OBJECT_STORE_NAME = 'firebase-messaging-store';\nlet dbPromise = null;\nfunction getDbPromise() {\n    if (!dbPromise) {\n        dbPromise = openDB(DATABASE_NAME, DATABASE_VERSION, {\n            upgrade: (upgradeDb, oldVersion) => {\n                // We don't use 'break' in this switch statement, the fall-through behavior is what we want,\n                // because if there are multiple versions between the old version and the current version, we\n                // want ALL the migrations that correspond to those versions to run, not only the last one.\n                // eslint-disable-next-line default-case\n                switch (oldVersion) {\n                    case 0:\n                        upgradeDb.createObjectStore(OBJECT_STORE_NAME);\n                }\n            }\n        });\n    }\n    return dbPromise;\n}\n/** Gets record(s) from the objectStore that match the given key. */\nasync function dbGet(firebaseDependencies) {\n    const key = getKey(firebaseDependencies);\n    const db = await getDbPromise();\n    const tokenDetails = (await db\n        .transaction(OBJECT_STORE_NAME)\n        .objectStore(OBJECT_STORE_NAME)\n        .get(key));\n    if (tokenDetails) {\n        return tokenDetails;\n    }\n    else {\n        // Check if there is a tokenDetails object in the old DB.\n        const oldTokenDetails = await migrateOldDatabase(firebaseDependencies.appConfig.senderId);\n        if (oldTokenDetails) {\n            await dbSet(firebaseDependencies, oldTokenDetails);\n            return oldTokenDetails;\n        }\n    }\n}\n/** Assigns or overwrites the record for the given key with the given value. */\nasync function dbSet(firebaseDependencies, tokenDetails) {\n    const key = getKey(firebaseDependencies);\n    const db = await getDbPromise();\n    const tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\n    await tx.objectStore(OBJECT_STORE_NAME).put(tokenDetails, key);\n    await tx.done;\n    return tokenDetails;\n}\n/** Removes record(s) from the objectStore that match the given key. */\nasync function dbRemove(firebaseDependencies) {\n    const key = getKey(firebaseDependencies);\n    const db = await getDbPromise();\n    const tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\n    await tx.objectStore(OBJECT_STORE_NAME).delete(key);\n    await tx.done;\n}\nfunction getKey({ appConfig }) {\n    return appConfig.appId;\n}\n\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nconst ERROR_MAP = {\n    [\"missing-app-config-values\" /* ErrorCode.MISSING_APP_CONFIG_VALUES */]: 'Missing App configuration value: \"{$valueName}\"',\n    [\"only-available-in-window\" /* ErrorCode.AVAILABLE_IN_WINDOW */]: 'This method is available in a Window context.',\n    [\"only-available-in-sw\" /* ErrorCode.AVAILABLE_IN_SW */]: 'This method is available in a service worker context.',\n    [\"permission-default\" /* ErrorCode.PERMISSION_DEFAULT */]: 'The notification permission was not granted and dismissed instead.',\n    [\"permission-blocked\" /* ErrorCode.PERMISSION_BLOCKED */]: 'The notification permission was not granted and blocked instead.',\n    [\"unsupported-browser\" /* ErrorCode.UNSUPPORTED_BROWSER */]: \"This browser doesn't support the API's required to use the Firebase SDK.\",\n    [\"indexed-db-unsupported\" /* ErrorCode.INDEXED_DB_UNSUPPORTED */]: \"This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)\",\n    [\"failed-service-worker-registration\" /* ErrorCode.FAILED_DEFAULT_REGISTRATION */]: 'We are unable to register the default service worker. {$browserErrorMessage}',\n    [\"token-subscribe-failed\" /* ErrorCode.TOKEN_SUBSCRIBE_FAILED */]: 'A problem occurred while subscribing the user to FCM: {$errorInfo}',\n    [\"token-subscribe-no-token\" /* ErrorCode.TOKEN_SUBSCRIBE_NO_TOKEN */]: 'FCM returned no token when subscribing the user to push.',\n    [\"token-unsubscribe-failed\" /* ErrorCode.TOKEN_UNSUBSCRIBE_FAILED */]: 'A problem occurred while unsubscribing the ' +\n        'user from FCM: {$errorInfo}',\n    [\"token-update-failed\" /* ErrorCode.TOKEN_UPDATE_FAILED */]: 'A problem occurred while updating the user from FCM: {$errorInfo}',\n    [\"token-update-no-token\" /* ErrorCode.TOKEN_UPDATE_NO_TOKEN */]: 'FCM returned no token when updating the user to push.',\n    [\"use-sw-after-get-token\" /* ErrorCode.USE_SW_AFTER_GET_TOKEN */]: 'The useServiceWorker() method may only be called once and must be ' +\n        'called before calling getToken() to ensure your service worker is used.',\n    [\"invalid-sw-registration\" /* ErrorCode.INVALID_SW_REGISTRATION */]: 'The input to useServiceWorker() must be a ServiceWorkerRegistration.',\n    [\"invalid-bg-handler\" /* ErrorCode.INVALID_BG_HANDLER */]: 'The input to setBackgroundMessageHandler() must be a function.',\n    [\"invalid-vapid-key\" /* ErrorCode.INVALID_VAPID_KEY */]: 'The public VAPID key must be a string.',\n    [\"use-vapid-key-after-get-token\" /* ErrorCode.USE_VAPID_KEY_AFTER_GET_TOKEN */]: 'The usePublicVapidKey() method may only be called once and must be ' +\n        'called before calling getToken() to ensure your VAPID key is used.'\n};\nconst ERROR_FACTORY = new ErrorFactory('messaging', 'Messaging', ERROR_MAP);\n\n/**\n * @license\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nasync function requestGetToken(firebaseDependencies, subscriptionOptions) {\n    const headers = await getHeaders(firebaseDependencies);\n    const body = getBody(subscriptionOptions);\n    const subscribeOptions = {\n        method: 'POST',\n        headers,\n        body: JSON.stringify(body)\n    };\n    let responseData;\n    try {\n        const response = await fetch(getEndpoint(firebaseDependencies.appConfig), subscribeOptions);\n        responseData = await response.json();\n    }\n    catch (err) {\n        throw ERROR_FACTORY.create(\"token-subscribe-failed\" /* ErrorCode.TOKEN_SUBSCRIBE_FAILED */, {\n            errorInfo: err === null || err === void 0 ? void 0 : err.toString()\n        });\n    }\n    if (responseData.error) {\n        const message = responseData.error.message;\n        throw ERROR_FACTORY.create(\"token-subscribe-failed\" /* ErrorCode.TOKEN_SUBSCRIBE_FAILED */, {\n            errorInfo: message\n        });\n    }\n    if (!responseData.token) {\n        throw ERROR_FACTORY.create(\"token-subscribe-no-token\" /* ErrorCode.TOKEN_SUBSCRIBE_NO_TOKEN */);\n    }\n    return responseData.token;\n}\nasync function requestUpdateToken(firebaseDependencies, tokenDetails) {\n    const headers = await getHeaders(firebaseDependencies);\n    const body = getBody(tokenDetails.subscriptionOptions);\n    const updateOptions = {\n        method: 'PATCH',\n        headers,\n        body: JSON.stringify(body)\n    };\n    let responseData;\n    try {\n        const response = await fetch(`${getEndpoint(firebaseDependencies.appConfig)}/${tokenDetails.token}`, updateOptions);\n        responseData = await response.json();\n    }\n    catch (err) {\n        throw ERROR_FACTORY.create(\"token-update-failed\" /* ErrorCode.TOKEN_UPDATE_FAILED */, {\n            errorInfo: err === null || err === void 0 ? void 0 : err.toString()\n        });\n    }\n    if (responseData.error) {\n        const message = responseData.error.message;\n        throw ERROR_FACTORY.create(\"token-update-failed\" /* ErrorCode.TOKEN_UPDATE_FAILED */, {\n            errorInfo: message\n        });\n    }\n    if (!responseData.token) {\n        throw ERROR_FACTORY.create(\"token-update-no-token\" /* ErrorCode.TOKEN_UPDATE_NO_TOKEN */);\n    }\n    return responseData.token;\n}\nasync function requestDeleteToken(firebaseDependencies, token) {\n    const headers = await getHeaders(firebaseDependencies);\n    const unsubscribeOptions = {\n        method: 'DELETE',\n        headers\n    };\n    try {\n        const response = await fetch(`${getEndpoint(firebaseDependencies.appConfig)}/${token}`, unsubscribeOptions);\n        const responseData = await response.json();\n        if (responseData.error) {\n            const message = responseData.error.message;\n            throw ERROR_FACTORY.create(\"token-unsubscribe-failed\" /* ErrorCode.TOKEN_UNSUBSCRIBE_FAILED */, {\n                errorInfo: message\n            });\n        }\n    }\n    catch (err) {\n        throw ERROR_FACTORY.create(\"token-unsubscribe-failed\" /* ErrorCode.TOKEN_UNSUBSCRIBE_FAILED */, {\n            errorInfo: err === null || err === void 0 ? void 0 : err.toString()\n        });\n    }\n}\nfunction getEndpoint({ projectId }) {\n    return `${ENDPOINT}/projects/${projectId}/registrations`;\n}\nasync function getHeaders({ appConfig, installations }) {\n    const authToken = await installations.getToken();\n    return new Headers({\n        'Content-Type': 'application/json',\n        Accept: 'application/json',\n        'x-goog-api-key': appConfig.apiKey,\n        'x-goog-firebase-installations-auth': `FIS ${authToken}`\n    });\n}\nfunction getBody({ p256dh, auth, endpoint, vapidKey }) {\n    const body = {\n        web: {\n            endpoint,\n            auth,\n            p256dh\n        }\n    };\n    if (vapidKey !== DEFAULT_VAPID_KEY) {\n        body.web.applicationPubKey = vapidKey;\n    }\n    return body;\n}\n\n/**\n * @license\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n// UpdateRegistration will be called once every week.\nconst TOKEN_EXPIRATION_MS = 7 * 24 * 60 * 60 * 1000; // 7 days\nasync function getTokenInternal(messaging) {\n    const pushSubscription = await getPushSubscription(messaging.swRegistration, messaging.vapidKey);\n    const subscriptionOptions = {\n        vapidKey: messaging.vapidKey,\n        swScope: messaging.swRegistration.scope,\n        endpoint: pushSubscription.endpoint,\n        auth: arrayToBase64(pushSubscription.getKey('auth')),\n        p256dh: arrayToBase64(pushSubscription.getKey('p256dh'))\n    };\n    const tokenDetails = await dbGet(messaging.firebaseDependencies);\n    if (!tokenDetails) {\n        // No token, get a new one.\n        return getNewToken(messaging.firebaseDependencies, subscriptionOptions);\n    }\n    else if (!isTokenValid(tokenDetails.subscriptionOptions, subscriptionOptions)) {\n        // Invalid token, get a new one.\n        try {\n            await requestDeleteToken(messaging.firebaseDependencies, tokenDetails.token);\n        }\n        catch (e) {\n            // Suppress errors because of #2364\n            console.warn(e);\n        }\n        return getNewToken(messaging.firebaseDependencies, subscriptionOptions);\n    }\n    else if (Date.now() >= tokenDetails.createTime + TOKEN_EXPIRATION_MS) {\n        // Weekly token refresh\n        return updateToken(messaging, {\n            token: tokenDetails.token,\n            createTime: Date.now(),\n            subscriptionOptions\n        });\n    }\n    else {\n        // Valid token, nothing to do.\n        return tokenDetails.token;\n    }\n}\n/**\n * This method deletes the token from the database, unsubscribes the token from FCM, and unregisters\n * the push subscription if it exists.\n */\nasync function deleteTokenInternal(messaging) {\n    const tokenDetails = await dbGet(messaging.firebaseDependencies);\n    if (tokenDetails) {\n        await requestDeleteToken(messaging.firebaseDependencies, tokenDetails.token);\n        await dbRemove(messaging.firebaseDependencies);\n    }\n    // Unsubscribe from the push subscription.\n    const pushSubscription = await messaging.swRegistration.pushManager.getSubscription();\n    if (pushSubscription) {\n        return pushSubscription.unsubscribe();\n    }\n    // If there's no SW, consider it a success.\n    return true;\n}\nasync function updateToken(messaging, tokenDetails) {\n    try {\n        const updatedToken = await requestUpdateToken(messaging.firebaseDependencies, tokenDetails);\n        const updatedTokenDetails = Object.assign(Object.assign({}, tokenDetails), { token: updatedToken, createTime: Date.now() });\n        await dbSet(messaging.firebaseDependencies, updatedTokenDetails);\n        return updatedToken;\n    }\n    catch (e) {\n        throw e;\n    }\n}\nasync function getNewToken(firebaseDependencies, subscriptionOptions) {\n    const token = await requestGetToken(firebaseDependencies, subscriptionOptions);\n    const tokenDetails = {\n        token,\n        createTime: Date.now(),\n        subscriptionOptions\n    };\n    await dbSet(firebaseDependencies, tokenDetails);\n    return tokenDetails.token;\n}\n/**\n * Gets a PushSubscription for the current user.\n */\nasync function getPushSubscription(swRegistration, vapidKey) {\n    const subscription = await swRegistration.pushManager.getSubscription();\n    if (subscription) {\n        return subscription;\n    }\n    return swRegistration.pushManager.subscribe({\n        userVisibleOnly: true,\n        // Chrome <= 75 doesn't support base64-encoded VAPID key. For backward compatibility, VAPID key\n        // submitted to pushManager#subscribe must be of type Uint8Array.\n        applicationServerKey: base64ToArray(vapidKey)\n    });\n}\n/**\n * Checks if the saved tokenDetails object matches the configuration provided.\n */\nfunction isTokenValid(dbOptions, currentOptions) {\n    const isVapidKeyEqual = currentOptions.vapidKey === dbOptions.vapidKey;\n    const isEndpointEqual = currentOptions.endpoint === dbOptions.endpoint;\n    const isAuthEqual = currentOptions.auth === dbOptions.auth;\n    const isP256dhEqual = currentOptions.p256dh === dbOptions.p256dh;\n    return isVapidKeyEqual && isEndpointEqual && isAuthEqual && isP256dhEqual;\n}\n\n/**\n * @license\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nfunction externalizePayload(internalPayload) {\n    const payload = {\n        from: internalPayload.from,\n        // eslint-disable-next-line camelcase\n        collapseKey: internalPayload.collapse_key,\n        // eslint-disable-next-line camelcase\n        messageId: internalPayload.fcmMessageId\n    };\n    propagateNotificationPayload(payload, internalPayload);\n    propagateDataPayload(payload, internalPayload);\n    propagateFcmOptions(payload, internalPayload);\n    return payload;\n}\nfunction propagateNotificationPayload(payload, messagePayloadInternal) {\n    if (!messagePayloadInternal.notification) {\n        return;\n    }\n    payload.notification = {};\n    const title = messagePayloadInternal.notification.title;\n    if (!!title) {\n        payload.notification.title = title;\n    }\n    const body = messagePayloadInternal.notification.body;\n    if (!!body) {\n        payload.notification.body = body;\n    }\n    const image = messagePayloadInternal.notification.image;\n    if (!!image) {\n        payload.notification.image = image;\n    }\n    const icon = messagePayloadInternal.notification.icon;\n    if (!!icon) {\n        payload.notification.icon = icon;\n    }\n}\nfunction propagateDataPayload(payload, messagePayloadInternal) {\n    if (!messagePayloadInternal.data) {\n        return;\n    }\n    payload.data = messagePayloadInternal.data;\n}\nfunction propagateFcmOptions(payload, messagePayloadInternal) {\n    var _a, _b, _c, _d, _e;\n    // fcmOptions.link value is written into notification.click_action. see more in b/232072111\n    if (!messagePayloadInternal.fcmOptions &&\n        !((_a = messagePayloadInternal.notification) === null || _a === void 0 ? void 0 : _a.click_action)) {\n        return;\n    }\n    payload.fcmOptions = {};\n    const link = (_c = (_b = messagePayloadInternal.fcmOptions) === null || _b === void 0 ? void 0 : _b.link) !== null && _c !== void 0 ? _c : (_d = messagePayloadInternal.notification) === null || _d === void 0 ? void 0 : _d.click_action;\n    if (!!link) {\n        payload.fcmOptions.link = link;\n    }\n    // eslint-disable-next-line camelcase\n    const analyticsLabel = (_e = messagePayloadInternal.fcmOptions) === null || _e === void 0 ? void 0 : _e.analytics_label;\n    if (!!analyticsLabel) {\n        payload.fcmOptions.analyticsLabel = analyticsLabel;\n    }\n}\n\n/**\n * @license\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nfunction isConsoleMessage(data) {\n    // This message has a campaign ID, meaning it was sent using the Firebase Console.\n    return typeof data === 'object' && !!data && CONSOLE_CAMPAIGN_ID in data;\n}\n\n/**\n * @license\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n_mergeStrings('AzSCbw63g1R0nCw85jG8', 'Iaya3yLKwmgvh7cF0q4');\nfunction _mergeStrings(s1, s2) {\n    const resultArray = [];\n    for (let i = 0; i < s1.length; i++) {\n        resultArray.push(s1.charAt(i));\n        if (i < s2.length) {\n            resultArray.push(s2.charAt(i));\n        }\n    }\n    return resultArray.join('');\n}\n\n/**\n * @license\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nfunction extractAppConfig(app) {\n    if (!app || !app.options) {\n        throw getMissingValueError('App Configuration Object');\n    }\n    if (!app.name) {\n        throw getMissingValueError('App Name');\n    }\n    // Required app config keys\n    const configKeys = [\n        'projectId',\n        'apiKey',\n        'appId',\n        'messagingSenderId'\n    ];\n    const { options } = app;\n    for (const keyName of configKeys) {\n        if (!options[keyName]) {\n            throw getMissingValueError(keyName);\n        }\n    }\n    return {\n        appName: app.name,\n        projectId: options.projectId,\n        apiKey: options.apiKey,\n        appId: options.appId,\n        senderId: options.messagingSenderId\n    };\n}\nfunction getMissingValueError(valueName) {\n    return ERROR_FACTORY.create(\"missing-app-config-values\" /* ErrorCode.MISSING_APP_CONFIG_VALUES */, {\n        valueName\n    });\n}\n\n/**\n * @license\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nclass MessagingService {\n    constructor(app, installations, analyticsProvider) {\n        // logging is only done with end user consent. Default to false.\n        this.deliveryMetricsExportedToBigQueryEnabled = false;\n        this.onBackgroundMessageHandler = null;\n        this.onMessageHandler = null;\n        this.logEvents = [];\n        this.isLogServiceStarted = false;\n        const appConfig = extractAppConfig(app);\n        this.firebaseDependencies = {\n            app,\n            appConfig,\n            installations,\n            analyticsProvider\n        };\n    }\n    _delete() {\n        return Promise.resolve();\n    }\n}\n\n/**\n * @license\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nasync function registerDefaultSw(messaging) {\n    try {\n        messaging.swRegistration = await navigator.serviceWorker.register(DEFAULT_SW_PATH, {\n            scope: DEFAULT_SW_SCOPE\n        });\n        // The timing when browser updates sw when sw has an update is unreliable from experiment. It\n        // leads to version conflict when the SDK upgrades to a newer version in the main page, but sw\n        // is stuck with the old version. For example,\n        // https://github.com/firebase/firebase-js-sdk/issues/2590 The following line reliably updates\n        // sw if there was an update.\n        messaging.swRegistration.update().catch(() => {\n            /* it is non blocking and we don't care if it failed */\n        });\n        await waitForRegistrationActive(messaging.swRegistration);\n    }\n    catch (e) {\n        throw ERROR_FACTORY.create(\"failed-service-worker-registration\" /* ErrorCode.FAILED_DEFAULT_REGISTRATION */, {\n            browserErrorMessage: e === null || e === void 0 ? void 0 : e.message\n        });\n    }\n}\n/**\n * Waits for registration to become active. MDN documentation claims that\n * a service worker registration should be ready to use after awaiting\n * navigator.serviceWorker.register() but that doesn't seem to be the case in\n * practice, causing the SDK to throw errors when calling\n * swRegistration.pushManager.subscribe() too soon after register(). The only\n * solution seems to be waiting for the service worker registration `state`\n * to become \"active\".\n */\nasync function waitForRegistrationActive(registration) {\n    return new Promise((resolve, reject) => {\n        const rejectTimeout = setTimeout(() => reject(new Error(`Service worker not registered after ${DEFAULT_REGISTRATION_TIMEOUT} ms`)), DEFAULT_REGISTRATION_TIMEOUT);\n        const incomingSw = registration.installing || registration.waiting;\n        if (registration.active) {\n            clearTimeout(rejectTimeout);\n            resolve();\n        }\n        else if (incomingSw) {\n            incomingSw.onstatechange = ev => {\n                var _a;\n                if (((_a = ev.target) === null || _a === void 0 ? void 0 : _a.state) === 'activated') {\n                    incomingSw.onstatechange = null;\n                    clearTimeout(rejectTimeout);\n                    resolve();\n                }\n            };\n        }\n        else {\n            clearTimeout(rejectTimeout);\n            reject(new Error('No incoming service worker found.'));\n        }\n    });\n}\n\n/**\n * @license\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nasync function updateSwReg(messaging, swRegistration) {\n    if (!swRegistration && !messaging.swRegistration) {\n        await registerDefaultSw(messaging);\n    }\n    if (!swRegistration && !!messaging.swRegistration) {\n        return;\n    }\n    if (!(swRegistration instanceof ServiceWorkerRegistration)) {\n        throw ERROR_FACTORY.create(\"invalid-sw-registration\" /* ErrorCode.INVALID_SW_REGISTRATION */);\n    }\n    messaging.swRegistration = swRegistration;\n}\n\n/**\n * @license\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nasync function updateVapidKey(messaging, vapidKey) {\n    if (!!vapidKey) {\n        messaging.vapidKey = vapidKey;\n    }\n    else if (!messaging.vapidKey) {\n        messaging.vapidKey = DEFAULT_VAPID_KEY;\n    }\n}\n\n/**\n * @license\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nasync function getToken$1(messaging, options) {\n    if (!navigator) {\n        throw ERROR_FACTORY.create(\"only-available-in-window\" /* ErrorCode.AVAILABLE_IN_WINDOW */);\n    }\n    if (Notification.permission === 'default') {\n        await Notification.requestPermission();\n    }\n    if (Notification.permission !== 'granted') {\n        throw ERROR_FACTORY.create(\"permission-blocked\" /* ErrorCode.PERMISSION_BLOCKED */);\n    }\n    await updateVapidKey(messaging, options === null || options === void 0 ? void 0 : options.vapidKey);\n    await updateSwReg(messaging, options === null || options === void 0 ? void 0 : options.serviceWorkerRegistration);\n    return getTokenInternal(messaging);\n}\n\n/**\n * @license\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nasync function logToScion(messaging, messageType, data) {\n    const eventType = getEventType(messageType);\n    const analytics = await messaging.firebaseDependencies.analyticsProvider.get();\n    analytics.logEvent(eventType, {\n        /* eslint-disable camelcase */\n        message_id: data[CONSOLE_CAMPAIGN_ID],\n        message_name: data[CONSOLE_CAMPAIGN_NAME],\n        message_time: data[CONSOLE_CAMPAIGN_TIME],\n        message_device_time: Math.floor(Date.now() / 1000)\n        /* eslint-enable camelcase */\n    });\n}\nfunction getEventType(messageType) {\n    switch (messageType) {\n        case MessageType.NOTIFICATION_CLICKED:\n            return 'notification_open';\n        case MessageType.PUSH_RECEIVED:\n            return 'notification_foreground';\n        default:\n            throw new Error();\n    }\n}\n\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nasync function messageEventListener(messaging, event) {\n    const internalPayload = event.data;\n    if (!internalPayload.isFirebaseMessaging) {\n        return;\n    }\n    if (messaging.onMessageHandler &&\n        internalPayload.messageType === MessageType.PUSH_RECEIVED) {\n        if (typeof messaging.onMessageHandler === 'function') {\n            messaging.onMessageHandler(externalizePayload(internalPayload));\n        }\n        else {\n            messaging.onMessageHandler.next(externalizePayload(internalPayload));\n        }\n    }\n    // Log to Scion if applicable\n    const dataPayload = internalPayload.data;\n    if (isConsoleMessage(dataPayload) &&\n        dataPayload[CONSOLE_CAMPAIGN_ANALYTICS_ENABLED] === '1') {\n        await logToScion(messaging, internalPayload.messageType, dataPayload);\n    }\n}\n\nconst name = \"@firebase/messaging\";\nconst version = \"0.12.22\";\n\n/**\n * @license\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nconst WindowMessagingFactory = (container) => {\n    const messaging = new MessagingService(container.getProvider('app').getImmediate(), container.getProvider('installations-internal').getImmediate(), container.getProvider('analytics-internal'));\n    navigator.serviceWorker.addEventListener('message', e => messageEventListener(messaging, e));\n    return messaging;\n};\nconst WindowMessagingInternalFactory = (container) => {\n    const messaging = container\n        .getProvider('messaging')\n        .getImmediate();\n    const messagingInternal = {\n        getToken: (options) => getToken$1(messaging, options)\n    };\n    return messagingInternal;\n};\nfunction registerMessagingInWindow() {\n    _registerComponent(new Component('messaging', WindowMessagingFactory, \"PUBLIC\" /* ComponentType.PUBLIC */));\n    _registerComponent(new Component('messaging-internal', WindowMessagingInternalFactory, \"PRIVATE\" /* ComponentType.PRIVATE */));\n    registerVersion(name, version);\n    // BUILD_TARGET will be replaced by values like esm2017, cjs2017, etc during the compilation\n    registerVersion(name, version, 'esm2017');\n}\n\n/**\n * @license\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/**\n * Checks if all required APIs exist in the browser.\n * @returns a Promise that resolves to a boolean.\n *\n * @public\n */\nasync function isWindowSupported() {\n    try {\n        // This throws if open() is unsupported, so adding it to the conditional\n        // statement below can cause an uncaught error.\n        await validateIndexedDBOpenable();\n    }\n    catch (e) {\n        return false;\n    }\n    // firebase-js-sdk/issues/2393 reveals that idb#open in Safari iframe and Firefox private browsing\n    // might be prohibited to run. In these contexts, an error would be thrown during the messaging\n    // instantiating phase, informing the developers to import/call isSupported for special handling.\n    return (typeof window !== 'undefined' &&\n        isIndexedDBAvailable() &&\n        areCookiesEnabled() &&\n        'serviceWorker' in navigator &&\n        'PushManager' in window &&\n        'Notification' in window &&\n        'fetch' in window &&\n        ServiceWorkerRegistration.prototype.hasOwnProperty('showNotification') &&\n        PushSubscription.prototype.hasOwnProperty('getKey'));\n}\n\n/**\n * @license\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nasync function deleteToken$1(messaging) {\n    if (!navigator) {\n        throw ERROR_FACTORY.create(\"only-available-in-window\" /* ErrorCode.AVAILABLE_IN_WINDOW */);\n    }\n    if (!messaging.swRegistration) {\n        await registerDefaultSw(messaging);\n    }\n    return deleteTokenInternal(messaging);\n}\n\n/**\n * @license\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nfunction onMessage$1(messaging, nextOrObserver) {\n    if (!navigator) {\n        throw ERROR_FACTORY.create(\"only-available-in-window\" /* ErrorCode.AVAILABLE_IN_WINDOW */);\n    }\n    messaging.onMessageHandler = nextOrObserver;\n    return () => {\n        messaging.onMessageHandler = null;\n    };\n}\n\n/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/**\n * Retrieves a Firebase Cloud Messaging instance.\n *\n * @returns The Firebase Cloud Messaging instance associated with the provided firebase app.\n *\n * @public\n */\nfunction getMessagingInWindow(app = getApp()) {\n    // Conscious decision to make this async check non-blocking during the messaging instance\n    // initialization phase for performance consideration. An error would be thrown latter for\n    // developer's information. Developers can then choose to import and call `isSupported` for\n    // special handling.\n    isWindowSupported().then(isSupported => {\n        // If `isWindowSupported()` resolved, but returned false.\n        if (!isSupported) {\n            throw ERROR_FACTORY.create(\"unsupported-browser\" /* ErrorCode.UNSUPPORTED_BROWSER */);\n        }\n    }, _ => {\n        // If `isWindowSupported()` rejected.\n        throw ERROR_FACTORY.create(\"indexed-db-unsupported\" /* ErrorCode.INDEXED_DB_UNSUPPORTED */);\n    });\n    return _getProvider(getModularInstance(app), 'messaging').getImmediate();\n}\n/**\n * Subscribes the {@link Messaging} instance to push notifications. Returns a Firebase Cloud\n * Messaging registration token that can be used to send push messages to that {@link Messaging}\n * instance.\n *\n * If notification permission isn't already granted, this method asks the user for permission. The\n * returned promise rejects if the user does not allow the app to show notifications.\n *\n * @param messaging - The {@link Messaging} instance.\n * @param options - Provides an optional vapid key and an optional service worker registration.\n *\n * @returns The promise resolves with an FCM registration token.\n *\n * @public\n */\nasync function getToken(messaging, options) {\n    messaging = getModularInstance(messaging);\n    return getToken$1(messaging, options);\n}\n/**\n * Deletes the registration token associated with this {@link Messaging} instance and unsubscribes\n * the {@link Messaging} instance from the push subscription.\n *\n * @param messaging - The {@link Messaging} instance.\n *\n * @returns The promise resolves when the token has been successfully deleted.\n *\n * @public\n */\nfunction deleteToken(messaging) {\n    messaging = getModularInstance(messaging);\n    return deleteToken$1(messaging);\n}\n/**\n * When a push message is received and the user is currently on a page for your origin, the\n * message is passed to the page and an `onMessage()` event is dispatched with the payload of\n * the push message.\n *\n *\n * @param messaging - The {@link Messaging} instance.\n * @param nextOrObserver - This function, or observer object with `next` defined,\n *     is called when a message is received and the user is currently viewing your page.\n * @returns To stop listening for messages execute this returned function.\n *\n * @public\n */\nfunction onMessage(messaging, nextOrObserver) {\n    messaging = getModularInstance(messaging);\n    return onMessage$1(messaging, nextOrObserver);\n}\n\n/**\n * The Firebase Cloud Messaging Web SDK.\n * This SDK does not work in a Node.js environment.\n *\n * @packageDocumentation\n */\nregisterMessagingInWindow();\n\nexport { deleteToken, getMessagingInWindow as getMessaging, getToken, isWindowSupported as isSupported, onMessage };\n//# sourceMappingURL=index.esm2017.js.map\n","import React from 'react';\r\nimport { FormattedMessage } from 'react-intl';\r\n\r\nexport default class Alert extends React.PureComponent {\r\n  render() {\r\n    return (<div className=\"alert-container\">\r\n      <div className=\"alert\">\r\n        <div className=\"title\">{this.props.title}</div>\r\n        <div className=\"content\">{this.props.content}</div>\r\n        <div className=\"dialog-buttons\">\r\n          {this.props.onReject ?\r\n            <button className=\"outline\" onClick={this.props.onReject}>\r\n              {this.props.reject || <FormattedMessage id=\"button_cancel\" defaultMessage=\"Cancel\" description=\"Button [Cancel]\" />}\r\n            </button>\r\n            :\r\n            null\r\n          }\r\n          {this.props.onConfirm ?\r\n            <button className=\"primary\" onClick={this.props.onConfirm}>\r\n              {this.props.confirm || <FormattedMessage id=\"button_ok\" defaultMessage=\"OK\" description=\"Button [OK]\"  />}\r\n            </button>\r\n            :\r\n            null\r\n          }\r\n        </div>\r\n      </div>\r\n    </div>);\r\n  }\r\n};\r\n","// Context Menu: popup/dropdown menu.\r\nimport React from 'react';\r\nimport { injectIntl, defineMessages } from 'react-intl';\r\n\r\nimport { REM_SIZE } from '../config.js';\r\n\r\nconst messages = defineMessages({\r\n  info: {\r\n    id: 'menu_item_info',\r\n    defaultMessage: 'Info',\r\n    description: 'Show extended topic information'\r\n  },\r\n  clear_messages: {\r\n    id: 'menu_item_clear_messages',\r\n    defaultMessage: 'Clear messages',\r\n    description: 'Delete all messages'\r\n  },\r\n  clear_for_all: {\r\n    id: 'menu_item_clear_messages_for_all',\r\n    defaultMessage: 'Clear for All',\r\n    description: 'Delete all message(s) for all members'\r\n  },\r\n  delete: {\r\n    id: 'menu_item_delete',\r\n    defaultMessage: 'Delete',\r\n    description: 'Delete selected messages'\r\n  },\r\n  delete_for_all: {\r\n    id: 'menu_item_delete_for_all',\r\n    defaultMessage: 'Delete for All',\r\n    description: 'Delete selected message(s) for all members'\r\n  },\r\n  send_retry: {\r\n    id: 'menu_item_send_retry',\r\n    defaultMessage: 'Retry',\r\n    description: 'Retry sending message'\r\n  },\r\n  mute: {\r\n    id: 'menu_item_mute',\r\n    defaultMessage: 'Mute',\r\n    description: 'Turn off notifications'\r\n  },\r\n  unmute: {\r\n    id: 'menu_item_unmute',\r\n    defaultMessage: 'Unmute',\r\n    description: 'Turn notifications on'\r\n  },\r\n  reply: {\r\n    id: 'menu_item_reply',\r\n    defaultMessage: 'Reply',\r\n    description: 'Reply to message'\r\n  },\r\n  forward: {\r\n    id: 'menu_item_forward',\r\n    defaultMessage: 'Forward',\r\n    description: 'Forward message'\r\n  },\r\n  edit: {\r\n    id: 'menu_item_edit',\r\n    defaultMessage: 'Edit',\r\n    description: 'Edit message'\r\n  },\r\n  topic_delete: {\r\n    id: 'menu_item_delete_topic',\r\n    defaultMessage: 'Delete',\r\n    description: 'Delete entire topic'\r\n  },\r\n  topic_delete_warning: {\r\n    id: 'topic_delete_warning',\r\n    defaultMessage: 'Are you sure you want to delete this conversation? It cannot be undone.',\r\n    description: 'Alert warning when deleting entire topic'\r\n  },\r\n  delete_messages_warning: {\r\n    id: 'delete_messages_warning',\r\n    defaultMessage: 'Are you sure you want to delete all messages for everyone? It cannot be undone.',\r\n    description: 'Alert dialog warning when hard-deleting all messages.'\r\n  },\r\n  unblock: {\r\n    id: 'menu_item_unblock',\r\n    defaultMessage: 'Unblock',\r\n    description: 'Unblock topic or user'\r\n  },\r\n  // Generic string suitable for either topic or user.\r\n  block: {\r\n    id: 'menu_item_block',\r\n    defaultMessage: 'Block',\r\n    description: 'Block topic or user'\r\n  },\r\n  topic_block_warning: {\r\n    id: 'topic_block_warning',\r\n    defaultMessage: 'Are you sure you want to block this conversation?',\r\n    description: 'Alert warning when blocking a topic.'\r\n  },\r\n  member_delete: {\r\n    id: 'menu_item_member_delete',\r\n    defaultMessage: 'Remove',\r\n    description: 'Remove user from topic'\r\n  },\r\n  archive: {\r\n    id: 'menu_item_archive_topic',\r\n    defaultMessage: 'Archive',\r\n    description: 'Move topic from the list of active chats to archive'\r\n  },\r\n  unarchive: {\r\n    id: 'menu_item_restore_topic',\r\n    defaultMessage: 'Restore',\r\n    description: 'Restore topic from archive'\r\n  },\r\n  edit_permissions: {\r\n    id: 'menu_item_edit_permissions',\r\n    defaultMessage: 'Edit permissions',\r\n    description: 'Menu item [Edit permissions]'\r\n  },\r\n  clear_messages_warning: {\r\n    id: 'clear_messages_warning',\r\n    defaultMessage: 'Are you sure you want to clear all messages? It cannot be undone.',\r\n    description: 'Alert dialog warning when deleting all messages.'\r\n  },\r\n  pin_message: {\r\n    id: 'pin_message',\r\n    defaultMessage: 'Pin',\r\n    description: 'Menu item [Pin] for pinning message to the top.'\r\n  },\r\n  unpin_message: {\r\n    id: 'unpin_message',\r\n    defaultMessage: 'Unpin',\r\n    description: 'Menu item [Unpin] for un-pinning the message.'\r\n  },\r\n});\r\n\r\nclass ContextMenu extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.selfRef = React.createRef();\r\n\r\n    const {formatMessage} = props.intl;\r\n\r\n    this.handlePageClick = this.handlePageClick.bind(this);\r\n    this.handleEscapeKey = this.handleEscapeKey.bind(this);\r\n    this.handleClick = this.handleClick.bind(this);\r\n\r\n    // Preconfigured menu items.\r\n    this.MenuItems = {\r\n      'topic_info': {\r\n        id: 'topic_info',\r\n        title: formatMessage(messages.info),\r\n        handler: null\r\n      },\r\n      'messages_clear': {\r\n        id: 'messages_clear',\r\n        title: formatMessage(messages.clear_messages),\r\n        handler: (params, errorHandler) => {\r\n          return props.onShowAlert(\r\n            formatMessage(messages.clear_messages), // title\r\n            formatMessage(messages.clear_messages_warning), // content\r\n            (_ => { this.deleteMessages(true, false, params, errorHandler); }), // onConfirm\r\n            null, // \"OK\"\r\n            true, // Show Reject button\r\n            null  // \"Cancel\"\r\n          );\r\n        }\r\n      },\r\n      'messages_clear_hard': {\r\n        id: 'messages_clear_hard',\r\n        title: formatMessage(messages.clear_for_all),\r\n        handler: (params, errorHandler) => {\r\n          return props.onShowAlert(\r\n            formatMessage(messages.clear_for_all), // title\r\n            formatMessage(messages.delete_messages_warning), // content\r\n            (_ => { return this.deleteMessages(true, true, params, errorHandler); }),\r\n            null, // \"OK\"\r\n            true, // Show Reject button\r\n            null  // \"Cancel\"\r\n          );\r\n        }\r\n      },\r\n      'message_delete': {\r\n        id: 'message_delete',\r\n        title: formatMessage(messages.delete),\r\n        handler: (params, errorHandler) => {\r\n          return this.deleteMessages(false, false, params, errorHandler);\r\n        }\r\n      },\r\n      'message_delete_hard': {\r\n        id: 'message_delete_hard',\r\n        title: formatMessage(messages.delete_for_all),\r\n        handler: (params, errorHandler) => {\r\n          return this.deleteMessages(false, true, params, errorHandler);\r\n        }\r\n      },\r\n      // Hard-delete but with just 'Delete' title.\r\n      'message_delete_generic': {\r\n        id: 'message_delete_generic',\r\n        title: formatMessage(messages.delete),\r\n        handler: (params, errorHandler) => {\r\n          return this.deleteMessages(false, true, params, errorHandler);\r\n        }\r\n      },\r\n      'menu_item_send_retry': {\r\n        id: 'menu_item_send_retry',\r\n        title: formatMessage(messages.send_retry),\r\n        handler: (params, errorHandler) => {\r\n          return this.retryMessage(params, errorHandler);\r\n        }\r\n      },\r\n      'menu_item_reply': {\r\n        id: 'menu_item_reply',\r\n        title: formatMessage(messages.reply),\r\n        handler: (params, errorHandler) => {\r\n          return this.replyToMessage(params, errorHandler);\r\n        }\r\n      },\r\n      'menu_item_forward': {\r\n        id: 'menu_item_forward',\r\n        title: formatMessage(messages.forward),\r\n        handler: _ => {} /* the action is taken directly in tinode-web */\r\n      },\r\n      'menu_item_edit': {\r\n        id: 'menu_item_edit',\r\n        title: formatMessage(messages.edit),\r\n        handler: (params, errorHandler) => {\r\n          return this.editMessage(params, errorHandler);\r\n        }\r\n      },\r\n      'menu_item_pin': {\r\n        id: 'menu_item_pin',\r\n        title: formatMessage(messages.pin_message),\r\n        handler: (params, errorHandler) => {\r\n          return this.pinMessage(true, params, errorHandler);\r\n        }\r\n      },\r\n      'menu_item_unpin': {\r\n        id: 'menu_item_unpin',\r\n        title: formatMessage(messages.unpin_message),\r\n        handler: (params, errorHandler) => {\r\n          return this.pinMessage(false, params, errorHandler);\r\n        }\r\n      },\r\n      'topic_unmute': {\r\n        id: 'topic_unmute',\r\n        title: formatMessage(messages.unmute),\r\n        handler: this.topicPermissionSetter.bind(this, '+P')\r\n      },\r\n      'topic_mute': {\r\n        id: 'topic_mute',\r\n        title: formatMessage(messages.mute),\r\n        handler: this.topicPermissionSetter.bind(this, '-P')\r\n      },\r\n      'topic_unblock': {\r\n        id: 'topic_unblock',\r\n        title: formatMessage(messages.unblock),\r\n        handler: this.topicPermissionSetter.bind(this, '+JP')\r\n      },\r\n      'topic_block': {\r\n        id: 'topic_block',\r\n        title: formatMessage(messages.block),\r\n        handler: (params, errorHandler) => {\r\n          return props.onShowAlert(\r\n            formatMessage(messages.block), // title\r\n            formatMessage(messages.topic_block_warning), // content\r\n            (_ => this.topicPermissionSetter('-JP', params, errorHandler).then(ctrl => {\r\n              this.props.onTopicRemoved(params.topicName);\r\n              return ctrl;\r\n            })),\r\n            null, // \"OK\"\r\n            true, // Show Reject button\r\n            null  // \"Cancel\"\r\n          );\r\n        }\r\n      },\r\n      'topic_delete': {\r\n        id: 'topic_delete',\r\n        title: formatMessage(messages.topic_delete),\r\n        handler: (params, errorHandler) => {\r\n          return props.onShowAlert(\r\n            formatMessage(messages.topic_delete), // title\r\n            formatMessage(messages.topic_delete_warning), // content\r\n            (_ => {\r\n              const topic = this.props.tinode.getTopic(params.topicName);\r\n              if (!topic) {\r\n                console.warn(\"Topic not found: \", params.topicName);\r\n                return;\r\n              }\r\n              return topic.delTopic(true).catch(err => {\r\n                if (errorHandler) {\r\n                  errorHandler(err.message, 'err');\r\n                }\r\n              });\r\n            }),\r\n            null, // \"OK\"\r\n            true, // Show Reject button\r\n            null  // \"Cancel\"\r\n          );\r\n        }\r\n      },\r\n      'topic_archive': {\r\n        id: 'topic_archive',\r\n        title: formatMessage(messages.archive),\r\n        handler: (params, errorHandler) => {\r\n          const topic = this.props.tinode.getTopic(params.topicName);\r\n          if (!topic) {\r\n            console.warn(\"Topic not found: \", params.topicName);\r\n            return;\r\n          }\r\n          return topic.archive(true).catch(err => {\r\n            if (errorHandler) {\r\n              errorHandler(err.message, 'err');\r\n            }\r\n          });\r\n        }\r\n      },\r\n      'topic_restore': {\r\n        id: 'topic_restore',\r\n        title: formatMessage(messages.unarchive),\r\n        handler: (params, errorHandler) => {\r\n          const topic = this.props.tinode.getTopic(params.topicName);\r\n          if (!topic) {\r\n            console.warn(\"Topic not found: \", params.topicName);\r\n            return;\r\n          }\r\n          return topic.archive(false).catch(err => {\r\n            if (errorHandler) {\r\n              errorHandler(err.message, 'err');\r\n            }\r\n          });\r\n        }\r\n      },\r\n      // menu_item_edit_permissions is defined elsewhere.\r\n      'permissions': {\r\n        id: 'permissions',\r\n        title: formatMessage(messages.edit_permissions),\r\n        handler: null\r\n      },\r\n      'member_delete': {\r\n        id: 'member_delete',\r\n        title: formatMessage(messages.member_delete),\r\n        handler: (params, errorHandler) => {\r\n          const topic = this.props.tinode.getTopic(params.topicName);\r\n          if (!topic || !params.user) {\r\n            console.warn(\"Topic or user not found: '\" + params.topicName + \"', '\" + params.user + \"'\");\r\n            return;\r\n          }\r\n          return topic.delSubscription(params.user).catch(err => {\r\n            if (errorHandler) {\r\n              errorHandler(err.message, 'err');\r\n            }\r\n          });\r\n        }\r\n      },\r\n      'member_mute': {\r\n        id: 'member_mute',\r\n        title: formatMessage(messages.mute),\r\n        handler: this.topicPermissionSetter.bind(this, '-P')\r\n      },\r\n      'member_unmute': {\r\n        id: 'member_unmute',\r\n        title: formatMessage(messages.unmute),\r\n        handler: this.topicPermissionSetter.bind(this, '+P')\r\n      },\r\n      'member_block': {\r\n        id: 'member_block',\r\n        title: formatMessage(messages.block),\r\n        handler: this.topicPermissionSetter.bind(this, '-JP')\r\n      },\r\n      'member_unblock': {\r\n        id: 'member_unblock',\r\n        title: formatMessage(messages.unblock),\r\n        handler: this.topicPermissionSetter.bind(this, '+JP')\r\n      },\r\n    };\r\n  }\r\n\r\n  componentDidMount() {\r\n    document.addEventListener('mousedown', this.handlePageClick, false);\r\n    document.addEventListener('keyup', this.handleEscapeKey, false);\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    document.removeEventListener('mousedown', this.handlePageClick, false);\r\n    document.removeEventListener('keyup', this.handleEscapeKey, false);\r\n  }\r\n\r\n  handlePageClick(e) {\r\n    if (this.selfRef.current.contains(e.target)) {\r\n      return;\r\n    }\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    this.props.hide();\r\n  }\r\n\r\n  handleEscapeKey(e) {\r\n    if (e.keyCode === 27) {\r\n      this.props.hide();\r\n    }\r\n  }\r\n\r\n  handleClick(e) {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    this.props.hide();\r\n    let item = this.props.items[e.currentTarget.dataset.id];\r\n    if (typeof item == 'string') {\r\n      item = this.MenuItems[item];\r\n    }\r\n\r\n    if (!item) {\r\n      console.error(\"Invalid menu item ID\", e.currentTarget.dataset.id);\r\n    } else {\r\n      this.props.onAction(\r\n        item.id,\r\n        item.handler(this.props.params, this.props.onError),\r\n        this.props.params);\r\n    }\r\n  }\r\n\r\n  // Menu Actions\r\n\r\n  deleteMessages(all, hard, params, errorHandler) {\r\n    const topic = this.props.tinode.getTopic(params.topicName);\r\n    if (!topic) {\r\n      console.warn(\"Topic not found: \", params.topicName);\r\n      return;\r\n    }\r\n\r\n    // We don't know if the message is still pending (e.g. attachment is being uploaded),\r\n    // so try cancelling first. No harm if we can't cancel.\r\n    // The message can be cancelled if transmission to the server has not\r\n    // started yet or if the message send has failed.\r\n    if (!all && topic.cancelSend(params.seq)) {\r\n      return;\r\n    }\r\n\r\n    const promise = all ?\r\n      topic.delMessagesAll(hard) :\r\n      params.replace > 0 ?\r\n        topic.delMessagesEdits(params.replace, hard) :\r\n        topic.delMessagesList([params.seq], hard);\r\n\r\n    return promise.catch(err => {\r\n      if (errorHandler) {\r\n        errorHandler(err.message, 'err');\r\n      }\r\n    });\r\n  }\r\n\r\n  // Retries sending failed message.\r\n  retryMessage(params, errorHandler) {\r\n    const topic = this.props.tinode.getTopic(params.topicName);\r\n    // Remove the existing message entry.\r\n    if (!topic || !topic.flushMessage(params.seq)) {\r\n      return;\r\n    }\r\n    const msg = topic.createMessage(params.content, false);\r\n    return topic.publishDraft(msg).catch(err => {\r\n      if (errorHandler) {\r\n        errorHandler(err.message, 'err');\r\n      }\r\n    });\r\n  }\r\n\r\n  // Pin or unpin the message.\r\n  pinMessage(pin, params, errorHandler) {\r\n    const topic = this.props.tinode.getTopic(params.topicName);\r\n    if (!topic) {\r\n      return;\r\n    }\r\n    topic.pinMessage(params.seq, pin)\r\n      .catch(err => errorHandler ? errorHandler(err.message, 'err') : null);\r\n  }\r\n\r\n  // Function is used by context menu to set permissions.\r\n  topicPermissionSetter(mode, params, errorHandler) {\r\n    const topic = this.props.tinode.getTopic(params.topicName);\r\n    if (!topic) {\r\n      console.warn(\"Topic not found\", params.topicName);\r\n      return;\r\n    }\r\n\r\n    let result = topic.updateMode(params.user, mode);\r\n    if (errorHandler) {\r\n      result = result.catch(err => errorHandler(err.message, 'err'));\r\n    }\r\n    return result;\r\n  }\r\n\r\n  replyToMessage(params, errorHandler) {\r\n    params.pickReply(params.seq, params.content, params.userFrom, params.userName, errorHandler);\r\n  }\r\n\r\n  editMessage(params, errorHandler) {\r\n    params.editMessage(params.replace || params.seq, params.content, errorHandler);\r\n  }\r\n\r\n  render() {\r\n    const menu = [];\r\n    let count = 0;\r\n    this.props.items.forEach(item => {\r\n      if (typeof item == 'string') {\r\n        item = this.MenuItems[item];\r\n      }\r\n      if (item && item.title) {\r\n        const className = item.disabled ? 'disabled' : undefined;\r\n        menu.push(\r\n          item.title == '-' ?\r\n            <li className=\"separator\" key={count} />\r\n            :\r\n            <li className={className} onClick={this.handleClick} data-id={count} key={count}>{item.title}</li>\r\n        );\r\n      }\r\n      count++;\r\n    });\r\n\r\n    // Ensure that menu is inside the app-container.\r\n    const hSize = 12 * REM_SIZE;\r\n    const vSize = REM_SIZE * (0.7 + menu.length * 2.5);\r\n    const left = (this.props.bounds.right - this.props.clickAt.x < hSize) ?\r\n        (this.props.clickAt.x - this.props.bounds.left - hSize) :\r\n        (this.props.clickAt.x - this.props.bounds.left);\r\n    const top = (this.props.bounds.bottom - this.props.clickAt.y < vSize) ?\r\n        (this.props.clickAt.y - this.props.bounds.top - vSize) :\r\n        (this.props.clickAt.y - this.props.bounds.top);\r\n\r\n    const position = {\r\n      left: left + 'px',\r\n      top: top + 'px'\r\n    };\r\n\r\n    return (\r\n      <ul className=\"menu\" style={position} ref={this.selfRef}>\r\n        {menu}\r\n      </ul>\r\n    );\r\n  }\r\n}\r\n\r\nexport default injectIntl(ContextMenu);\r\n","import React from 'react';\r\n\r\nconst icon_mapping = {'muted': 'notifications_off', 'banned': 'block', 'staff': 'verified_user'};\r\n\r\n/* Contact's labels: [you], or icons [muted], [blocked] */\r\nexport default class ContactBadges extends React.PureComponent {\r\n  render() {\r\n    let badges = null;\r\n    if (this.props.badges && this.props.badges.length > 0) {\r\n      badges = [];\r\n      this.props.badges.forEach(b => {\r\n        const color = (b.color ? ' ' + b.color : '');\r\n        if (b.icon) {\r\n          badges.push(<i className={'material-icons as-badge' + color} key={b.key || b.icon}>{icon_mapping[b.icon] || b.icon}</i>);\r\n        } else {\r\n          badges.push(<span className={'badge' + color} key={b.key || b.name}>{b.name}</span>);\r\n        }\r\n      });\r\n      return <>{badges}</>;\r\n    }\r\n    return null;\r\n  }\r\n};\r\n","// The counter of unread messages in the topic.\r\nimport React from 'react';\r\n\r\nexport default class UnreadBadge extends React.PureComponent {\r\n  render() {\r\n    return (this.props.count > 0 ?\r\n      <span className=\"unread\">{this.props.count > 9 ? \"9+\" : this.props.count}</span>\r\n      : null);\r\n  }\r\n};\r\n","// Chat message describing a video or voice call.\r\n\r\nimport React from 'react';\r\nimport { FormattedMessage } from 'react-intl';\r\n\r\nimport { secondsToTime } from '../lib/strformat.js';\r\n\r\nexport default class CallMessage extends React.PureComponent {\r\n  render() {\r\n    const isCallDropped = ['busy', 'declined', 'disconnected', 'missed'].includes(this.props.callState);\r\n    const successClass = 'material-icons medium ' + (isCallDropped ? 'red' : 'green');\r\n    const callIcon = this.props.incoming ?\r\n      (isCallDropped ? 'call_missed' : 'call_received') :\r\n      (isCallDropped ? 'call_missed_outgoing' : 'call_made');\r\n    const title = this.props.incoming ?\r\n          <FormattedMessage id=\"calls_incoming\" defaultMessage=\"Incoming call\" description=\"Incoming call label\" /> :\r\n          <FormattedMessage id=\"calls_outgoing\" defaultMessage=\"Outgoing call\" description=\"Outgoing call label\" />;\r\n    let duration;\r\n    if (isCallDropped) {\r\n      switch (this.props.callState) {\r\n        case 'busy':\r\n          duration = <FormattedMessage id=\"call_busy\" defaultMessage=\"busy\" description=\"Label for busy call line\" />;\r\n          break;\r\n        case 'declined':\r\n          duration = <FormattedMessage id=\"call_declined\" defaultMessage=\"declined\" description=\"Label for declined call\" />;\r\n          break;\r\n        case 'missed':\r\n          duration = this.props.incoming ?\r\n            <FormattedMessage id=\"call_missed\" defaultMessage=\"missed\" description=\"Label for missed incoming call\" /> :\r\n            <FormattedMessage id=\"call_cancelled\" defaultMessage=\"cancelled\" description=\"Label for cancelled outgoing call\" />;\r\n          break;\r\n        default:\r\n          duration = <FormattedMessage id=\"call_disconnected\" defaultMessage=\"disconnected\" description=\"Label for disconnected call\" />;\r\n          break;\r\n      }\r\n    } else {\r\n      duration = <span>{secondsToTime(this.props.duration / 1000)}</span>;\r\n    }\r\n    return <div className=\"call-message\">\r\n      <div><i className=\"material-icons big gray\">call</i></div>\r\n      <div className=\"flex-column narrow\">\r\n        <div>{title}</div>\r\n        <div className=\"duration\"><i className={successClass}>{callIcon}</i> {duration}</div>\r\n      </div>\r\n    </div>;\r\n  }\r\n}\r\n","// The counter of unread messages in the topic.\r\nimport React from 'react';\r\nimport { FormattedMessage } from 'react-intl';\r\n\r\nimport { secondsToTime } from '../lib/strformat.js';\r\n\r\n// Props:\r\n//  incoming: true | false.\r\n//  callState: 'busy' | 'declined' | 'disconnected' | 'missed'.\r\n//  duration: <number> (call duration in milliseconds).\r\nexport default class CallStatus extends React.PureComponent {\r\n  render() {\r\n    const isCallDropped = ['busy', 'declined', 'disconnected', 'missed'].includes(this.props.callState);\r\n    const icon2 = this.props.incoming ?\r\n      (isCallDropped ? 'call_missed' : 'call_received') :\r\n      (isCallDropped ? 'call_missed_outgoing' : 'call_made');\r\n    let duration;\r\n    if (isCallDropped) {\r\n      switch (this.props.callState) {\r\n        case 'busy':\r\n          duration = <FormattedMessage id=\"call_busy\" defaultMessage=\"busy\" description=\"Label for busy call line\" />;\r\n          break;\r\n        case 'declined':\r\n          duration = <FormattedMessage id=\"call_declined\" defaultMessage=\"declined\" description=\"Label for declined call\" />;\r\n          break;\r\n        case 'missed':\r\n          duration = this.props.incoming ?\r\n            <FormattedMessage id=\"call_missed\" defaultMessage=\"missed\" description=\"Label for missed incoming call\" /> :\r\n            <FormattedMessage id=\"call_cancelled\" defaultMessage=\"cancelled\" description=\"Label for cancelled outgoing call\" />;\r\n          break;\r\n        default:\r\n          duration = <FormattedMessage id=\"call_disconnected\" defaultMessage=\"disconnected\" description=\"Label for disconnected call\" />;\r\n          break;\r\n      }\r\n    } else if (['accepted', 'started'].includes(this.props.callState) && !this.props.duration) {\r\n      duration = <FormattedMessage id=\"call_in_progress\" defaultMessage=\"in progress\" description=\"Label for call in progress\" />\r\n    } else {\r\n      duration = <span>{secondsToTime(this.props.duration / 1000)}</span>;\r\n    }\r\n    return (\r\n      <>\r\n        <div className=\"composed-material\">\r\n          <i className=\"material-icons\">call</i><i className=\"material-icons second\">{icon2}</i>\r\n        </div> {duration}\r\n      </>\r\n    );\r\n  }\r\n};\r\n","// Element which shows static video preview:\r\n// an image with duration and a play button in the middle.\r\n\r\nimport React from 'react';\r\n\r\nimport { secondsToTime } from '../lib/strformat.js'\r\n\r\nexport default class InlineVideo extends React.PureComponent {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.videoRef = React.createRef();\r\n\r\n    this.handleClick = this.handleClick.bind(this);\r\n  }\r\n\r\n  handleClick(e) {\r\n    if (this.props.onClick) {\r\n      // the click target has to be the image element.\r\n      this.props.onClick(e);\r\n    }\r\n  }\r\n\r\n  render() {\r\n    const duration = secondsToTime(this.props['data-duration'] / 1000);\r\n    const className = 'inline-video' + (this.props.onClick ? ' image-clickable' : '');\r\n    return (\r\n      <div className={className}>\r\n        {React.createElement('img', this.props)}\r\n        <div className=\"play-control\">\r\n        {this.props.onClick ?\r\n          <i className=\"material-icons white x-big\">play_arrow</i>\r\n          :\r\n          <img src=\"img/broken_video.png\" style={{filter: 'invert(100%)'}} width=\"36\" height=\"36\" />}\r\n        </div>\r\n        {duration ? <div className=\"duration\">{duration}</div> : null}\r\n      </div>\r\n    );\r\n  }\r\n};\r\n","// Image with a placeholder which is replaced when the promise is resolved.\r\nimport React from 'react';\r\n\r\nexport default class LazyImage extends React.PureComponent {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      src: this.props.isvideo ? 'img/blankvid.png' : 'img/blankimg.png',\r\n      style: Object.assign({padding: '4px'}, this.props.style),\r\n      className: this.props.className,\r\n      alt: this.props.alt,\r\n      onClick: this.props.onClick,\r\n    };\r\n  }\r\n\r\n  componentDidMount() {\r\n    // whenDone is a wrapper around an actual promise to be able to cancel it.\r\n    this.props.whenDone\r\n      .promise\r\n      .then(data => this.setState({src: data.src, style: {...this.state.style, padding: 0}}))\r\n      .catch(_ => this.setState({src: this.props.isvideo ? 'img/broken_video.png' : 'img/broken_image.png'}));\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    this.props.whenDone.cancel();\r\n  }\r\n\r\n  componentDidUpdate(prevProps) {\r\n    if (prevProps.whenDone != this.props.whenDone) {\r\n      this.setState({src: this.props.isvideo ? 'img/blankvid.png' : 'img/blankimg.png', style: {...this.state.style, padding: '4px'}});\r\n      this.props.whenDone\r\n        .promise\r\n        .then(data => this.setState({src: data.src, style: {...this.state.style, padding: 0}}))\r\n        .catch(_ => this.setState({src: this.props.isvideo ? 'img/broken_video.png' : 'img/broken_image.png'}));\r\n    }\r\n  }\r\n\r\n  render() {\r\n    return React.createElement('img', this.state);\r\n  }\r\n};\r\n","// File uload/download progress indicator with a cancel inside.\r\nimport React from 'react';\r\nimport { FormattedMessage } from 'react-intl';\r\n\r\nexport default class FileProgress extends React.PureComponent {\r\n  render() {\r\n    return (\r\n      <div className=\"uploader\">\r\n        <div><span style={{width: (this.props.progress * 100) + \"%\"}}></span></div>\r\n        {this.props.progress < 0.999 ?\r\n          <a href=\"#\" onClick={(e) => {e.preventDefault(); this.props.onCancel();}}>\r\n            <i className=\"material-icons\">close</i> <FormattedMessage id=\"action_cancel\"\r\n              defaultMessage=\"cancel\" description=\"Call to action [cancel]\" />\r\n          </a>\r\n          :\r\n          <FormattedMessage id=\"upload_finishing\" defaultMessage=\"finishing...\"\r\n            description=\"Notification that upload is finishing\" />\r\n        }\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","// Image view with progress bar and a cancel button.\r\nimport React from 'react';\r\n\r\nimport FileProgress from './file-progress.jsx';\r\n\r\nexport default class UploadingImage extends React.PureComponent {\r\n  constructor(props) {\r\n    super(props);\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div className=\"inline-image\">\r\n        {React.createElement('img', this.props)}\r\n        <div className=\"rounded-container\">\r\n          <FileProgress progress={this.props.progress} onCancel={this.props.onCancelUpload} />\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n};\r\n","import React from 'react';\r\nimport { defineMessages } from 'react-intl';\r\n\r\nimport { Drafty } from 'tinode-sdk';\r\n\r\nimport AudioPlayer from '../widgets/audio-player.jsx'\r\nimport CallMessage from '../widgets/call-message.jsx'\r\nimport CallStatus from '../widgets/call-status.jsx';\r\nimport InlineVideo from '../widgets/inline-video.jsx';\r\nimport LazyImage from '../widgets/lazy-image.jsx'\r\nimport UploadingImage from '../widgets/uploading-image.jsx'\r\n\r\nimport { BROKEN_IMAGE_SIZE, CLICKABLE_URL_SCHEMES, IMAGE_THUMBNAIL_DIM, NO_DIMENSIONS_VIDEO,\r\n  REM_SIZE, VIDEO_THUMBNAIL_WIDTH } from '../config.js';\r\nimport { base64ToBlob, blobToBase64, fitImageSize, imageScaled } from './blob-helpers.js';\r\nimport { idToColorClass, secondsToTime, shortenFileName } from './strformat.js';\r\nimport { cancelablePromise, sanitizeUrl, sanitizeUrlForMime } from './utils.js';\r\n\r\nconst messages = defineMessages({\r\n  drafty_form: {\r\n    id: 'drafty_form',\r\n    defaultMessage: 'Form: ',\r\n    description: 'Comment for form in Drafty'\r\n  },\r\n  drafty_attachment: {\r\n    id: 'drafty_attachment',\r\n    defaultMessage: 'Attachment',\r\n    description: 'Comment for attachment in Drafty'\r\n  },\r\n  drafty_image: {\r\n    id: 'drafty_image',\r\n    defaultMessage: 'Picture',\r\n    description: 'Comment for embedded images in Drafty'\r\n  },\r\n  drafty_video: {\r\n    id: 'drafty_video',\r\n    defaultMessage: 'Video recording',\r\n    description: 'Comment for videos embedded in Drafty'\r\n  },\r\n  drafty_unknown: {\r\n    id: 'drafty_unknown',\r\n    defaultMessage: 'Unsupported',\r\n    description: 'Unsupported entity in drafty'\r\n  }\r\n});\r\n\r\n// The main Drafty formatter: converts Drafty elements into React classes. 'this' is set by the caller.\r\n// 'this' must contain:\r\n//    viewportWidth:\r\n//    authorizeURL:\r\n//    onImagePreview:\r\n//    onVideoPreview:\r\n//    onFormButtonClick:\r\n//    onQuoteClick:\r\nexport function fullFormatter(style, data, values, key, stack) {\r\n  if (stack.includes('QQ')) {\r\n    return quoteFormatter.call(this, style, data, values, key);\r\n  }\r\n\r\n  if (!style) {\r\n    // Unformatted.\r\n    return values;\r\n  }\r\n\r\n  let el = Drafty.tagName(style);\r\n  let attr = Drafty.attrValue(style, data) || {};\r\n  attr.key = key;\r\n  switch (style) {\r\n    case 'AU':\r\n      // Show audio player.\r\n      if (attr.src) {\r\n        attr.src = this.authorizeURL(sanitizeUrlForMime(attr.src, 'audio'));\r\n        attr.duration = data.duration > 0 ? (data.duration | 0) : undefined;\r\n        attr.preview = data.preview;\r\n        attr.loading = 'lazy';\r\n      }\r\n      el = AudioPlayer;\r\n      // Audio element cannot have content.\r\n      values = null;\r\n      break;\r\n    case 'BR':\r\n      values = null;\r\n      break;\r\n    case 'EX':\r\n      // Ignore.\r\n      break;\r\n    case 'HL':\r\n      // Highlighted text. Assign class name.\r\n      attr.className = 'highlight';\r\n      break;\r\n    case 'HD':\r\n      el = null;\r\n      values = null;\r\n      break;\r\n    case 'IM':\r\n      // Additional processing for images\r\n      el = handleImageData.call(this, el, data, attr);\r\n      // Image element cannot have content.\r\n      values = null;\r\n      break;\r\n    case 'BN':\r\n      // Button\r\n      attr.onClick = this.onFormButtonClick;\r\n      let inner = React.Children.map(values, (child) => {\r\n        return typeof child == 'string' ? child : undefined;\r\n      });\r\n      if (!inner || inner.length == 0) {\r\n        inner = [attr.name]\r\n      }\r\n      // Get text which will be sent back when the button is clicked.\r\n      attr['data-title'] = inner.join('');\r\n      break;\r\n    case 'LN':\r\n      if (attr) {\r\n        // Ensure only safe URL schemes are clickable.\r\n        attr.href = typeof attr.href == 'string' ? sanitizeUrl(attr.href, CLICKABLE_URL_SCHEMES) : '';\r\n      }\r\n      break;\r\n    case 'MN':\r\n      // Mention\r\n      attr.className = 'mention'\r\n      if (data) {\r\n        attr.className += ' ' + idToColorClass(data.val, false, true);\r\n      }\r\n      break;\r\n    case 'FM':\r\n      // Form\r\n      attr.className = 'bot-form';\r\n      break;\r\n    case 'RW':\r\n      // Form element formatting is dependent on element content.\r\n      break;\r\n    case 'QQ':\r\n      // Quote/citation.\r\n      attr.className = 'reply-quote'\r\n      attr.onClick = this.onQuoteClick;\r\n      break;\r\n    case 'VC':\r\n      el = CallMessage;\r\n      // Video call messages do not have content.\r\n      values = null;\r\n      if (data) {\r\n        attr.callState = data.state;\r\n        attr.incoming = data.incoming;\r\n        attr.duration = data.duration;\r\n      }\r\n      break;\r\n    case 'VD':\r\n      // Additional processing for videos.\r\n      el = handleVideoData.call(this, el, data, attr);\r\n      // Video element cannot have content.\r\n      values = null;\r\n      break;\r\n    default:\r\n      if (!el) {\r\n        // Unknown element.\r\n        el = React.Fragment;\r\n        attr = {key: key};\r\n        // Generate comment for unknown element.\r\n        let body = values;\r\n        if (!Array.isArray(values) || !values.join('').trim()) {\r\n          body = [<span key=\"x1\" className=\"gray\">{this.formatMessage(messages.drafty_unknown)}</span>];\r\n        }\r\n        values = [<i key=\"x0\" className=\"material-icons gray\">extension</i>, ' '].concat(body);\r\n      }\r\n      break;\r\n  }\r\n  if (!el) {\r\n    return values;\r\n  }\r\n  return React.createElement(el, attr, values);\r\n}\r\n\r\n// Additional processing of image data.\r\nfunction handleImageData(el, data, attr) {\r\n  if (!data) {\r\n    attr.src = 'img/broken_image.png';\r\n    attr.style = {\r\n      width: IMAGE_THUMBNAIL_DIM + 'px',\r\n      height: IMAGE_THUMBNAIL_DIM + 'px',\r\n    };\r\n    return el;\r\n  }\r\n\r\n  attr.className = 'inline-image';\r\n  const dim = fitImageSize(data.width, data.height,\r\n    this.viewportWidth > 0 ? Math.min(this.viewportWidth - REM_SIZE * 6.5, REM_SIZE * 34.5) :\r\n      REM_SIZE * 34.5, REM_SIZE * 24, false) ||\r\n      {dstWidth: BROKEN_IMAGE_SIZE, dstHeight: BROKEN_IMAGE_SIZE};\r\n  attr.style = {\r\n    width: dim.dstWidth + 'px',\r\n    height: dim.dstHeight + 'px',\r\n    // Looks like a Chrome bug: broken image does not respect 'width' and 'height'.\r\n    minWidth: dim.dstWidth + 'px',\r\n    minHeight: dim.dstHeight + 'px'\r\n  };\r\n  if (!Drafty.isProcessing(data)) {\r\n    attr.src = this.authorizeURL(sanitizeUrlForMime(attr.src, 'image'));\r\n    attr.alt = data.name;\r\n    if (attr.src) {\r\n      if (Math.max(data.width || 0, data.height || 0) > IMAGE_THUMBNAIL_DIM) {\r\n        // Allow previews for large enough images.\r\n        attr.onClick = this.onImagePreview;\r\n        attr.className += ' image-clickable';\r\n      }\r\n      attr.loading = 'lazy';\r\n    } else {\r\n      attr.src = null;\r\n    }\r\n  } else {\r\n    // Use custom element instead of <img> or <video>.\r\n    el = UploadingImage;\r\n  }\r\n\r\n  return el;\r\n}\r\n\r\n// Additional processing of attached video data.\r\nfunction handleVideoData(el, data, attr) {\r\n  if (!data) {\r\n    attr.src = 'img/broken_video.png';\r\n    attr.style = {\r\n      width: IMAGE_THUMBNAIL_DIM + 'px',\r\n      height: IMAGE_THUMBNAIL_DIM + 'px',\r\n    };\r\n    return el;\r\n  }\r\n  attr.className = 'inline-image';\r\n  const dim = fitImageSize(data.width, data.height,\r\n    this.viewportWidth > 0 ? Math.min(this.viewportWidth - REM_SIZE * 6.5, REM_SIZE * 34.5) :\r\n      REM_SIZE * 34.5, REM_SIZE * 24, false) ||\r\n      {dstWidth: NO_DIMENSIONS_VIDEO, dstHeight: NO_DIMENSIONS_VIDEO};\r\n  attr.style = {\r\n    width: dim.dstWidth + 'px',\r\n    height: dim.dstHeight + 'px',\r\n    // Looks like a Chrome bug: broken image does not respect 'width' and 'height'.\r\n    minWidth: dim.dstWidth + 'px',\r\n    minHeight: dim.dstHeight + 'px'\r\n  };\r\n  if (!Drafty.isProcessing(data)) {\r\n    attr.src = this.authorizeURL(sanitizeUrlForMime(attr.src, 'image'));\r\n    attr.alt = data.name;\r\n    if (data.ref || data.val) {\r\n      attr.onClick = this.onVideoPreview;\r\n      attr.loading = 'lazy';\r\n    }\r\n    el = InlineVideo;\r\n  } else {\r\n    // Use custom element instead of <img> or <video>.\r\n    el = UploadingImage;\r\n  }\r\n\r\n  return el;\r\n}\r\n\r\n// Converts Drafty object into a one-line preview. 'this' is set by the caller.\r\n// 'this' must contain:\r\n//    formatMessage: this.props.intl.formatMessage\r\n//    messages: formatjs messages defined with defineMessages.\r\nexport function previewFormatter(style, data, values, key) {\r\n  if (!style) {\r\n    // Unformatted.\r\n    return values;\r\n  }\r\n\r\n  let el = Drafty.tagName(style);\r\n  const attr = { key: key };\r\n  switch (style) {\r\n    case 'AU':\r\n      // Voicemail as '[mic] 0:00'.\r\n      el = React.Fragment;\r\n      values = [<i key=\"au\" className=\"material-icons\">mic</i>, ' ', secondsToTime(data.duration/1000)];\r\n      break;\r\n    case 'BR':\r\n      // Replace new line with a space.\r\n      el = React.Fragment;\r\n      values = [' '];\r\n      break;\r\n    case 'HL':\r\n      // Make highlight less prominent in preview.\r\n      attr.className = 'highlight preview';\r\n      break;\r\n    case 'LN':\r\n    case 'MN':\r\n      // Disable links in previews.\r\n      el = 'span';\r\n      break;\r\n    case 'IM':\r\n      // Replace image with '[icon] Image'.\r\n      el = React.Fragment;\r\n      values = [<i key=\"im\" className=\"material-icons\">photo</i>, ' ', this.formatMessage(messages.drafty_image)];\r\n      break;\r\n    case 'BN':\r\n      el = 'span';\r\n      attr.className = 'flat-button faux';\r\n      break;\r\n    case 'FM':\r\n      el = React.Fragment;\r\n      values = [<i key=\"fm\" className=\"material-icons\">dashboard</i>,\r\n        this.formatMessage(messages.drafty_form)].concat(' ', values || []);\r\n      break;\r\n    case 'RW':\r\n      el = React.Fragment;\r\n      break;\r\n    case 'EX':\r\n      if (data) {\r\n        if (Drafty.isFormResponseType(data.mime)) {\r\n          // Ignore JSON attachments: they are form response payloads.\r\n          return null;\r\n        }\r\n        // Clear payload.\r\n        delete data.val;\r\n        delete data.ref;\r\n      }\r\n      el = React.Fragment;\r\n      values = [<i key=\"ex\" className=\"material-icons\">attachment</i>, ' ', this.formatMessage(messages.drafty_attachment)];\r\n      break;\r\n    case 'VC':\r\n      el = CallStatus;\r\n      if (data) {\r\n        attr.callState = data.state;\r\n        attr.incoming = data.incoming;\r\n        attr.duration = data.duration;\r\n      }\r\n      values = null;\r\n      break;\r\n    case 'QQ':\r\n    case 'HD':\r\n      el = null;\r\n      values = null;\r\n      break;\r\n    case 'VD':\r\n      // Replace image with '[icon] Video'.\r\n      el = React.Fragment;\r\n      values = [<i key=\"im\" className=\"material-icons\">play_circle_outline</i>, ' ', this.formatMessage(messages.drafty_video)];\r\n      break;\r\n    default:\r\n      if (!el) {\r\n        // Unknown element.\r\n        el = React.Fragment;\r\n        values = [<i key=\"x0\" className=\"material-icons gray\">extension</i>, ' ', this.formatMessage(messages.drafty_unknown)];\r\n      }\r\n      break;\r\n  }\r\n  if (!el) {\r\n    return values;\r\n  }\r\n  return React.createElement(el, attr, values);\r\n};\r\n\r\n// Converts Drafty object into a quoted reply; 'this' is set by the caller.\r\nfunction inlineImageAttr(attr, data) {\r\n  attr.style = {\r\n    width: IMAGE_THUMBNAIL_DIM + 'px',\r\n    height: IMAGE_THUMBNAIL_DIM + 'px',\r\n    maxWidth: IMAGE_THUMBNAIL_DIM + 'px',\r\n    maxHeight: IMAGE_THUMBNAIL_DIM + 'px',\r\n  }\r\n  attr.className = 'inline-image';\r\n  attr.alt = this.formatMessage(messages.drafty_image);\r\n  if (!data) {\r\n    attr.src = 'img/broken_image.png';\r\n  } else {\r\n    attr.src = attr.src || 'img/broken_image.png';\r\n  }\r\n  attr.title = attr.alt;\r\n  return attr;\r\n}\r\n\r\n// Converts Drafty object into a quoted reply; 'this' is set by the caller.\r\nfunction inlineVideoAttr(attr, data) {\r\n  const dim = fitImageSize(data.width, data.height, VIDEO_THUMBNAIL_WIDTH, IMAGE_THUMBNAIL_DIM);\r\n  attr.style = {\r\n    width: dim.width + 'px',\r\n    height: dim.height + 'px',\r\n    maxWidth: VIDEO_THUMBNAIL_WIDTH + 'px',\r\n    maxHeight: IMAGE_THUMBNAIL_DIM + 'px',\r\n  }\r\n  attr.className = 'inline-image';\r\n  attr.alt = this.formatMessage(messages.drafty_video);\r\n  attr.title = attr.alt;\r\n  if (!data) {\r\n    attr.src = 'img/broken_video.png';\r\n  } else {\r\n    attr.src = attr.src || 'img/broken_video.png';\r\n  }\r\n  return attr;\r\n}\r\n\r\n// Displays a portion of Drafty within 'QQ' quotes. 'this' is set by the caller.\r\n// 'this' must contain:\r\n//    formatMessage: this.props.intl.formatMessage\r\n//    messages: formatjs messages defined with defineMessages.\r\n//    authorizeURL: this.props.tinode.authorizeURL\r\n//    onQuoteClick: this.handleQuoteClick (optional)\r\nfunction quoteFormatter(style, data, values, key) {\r\n  if (['BR', 'EX', 'IM', 'MN', 'VD'].includes(style)) {\r\n    let el = Drafty.tagName(style);\r\n    let attr = Drafty.attrValue(style, data) || {};\r\n    attr.key = key;\r\n    switch(style) {\r\n      case 'BR':\r\n        values = null;\r\n        break;\r\n      case 'IM':\r\n        attr = inlineImageAttr.call(this, attr, data);\r\n        values = [React.createElement('img', attr, null), ' ', attr.alt];\r\n        el = React.Fragment;\r\n        // Fragment attributes.\r\n        attr = {key: key};\r\n        break;\r\n      case 'VD':\r\n        attr = inlineVideoAttr.call(this, attr, data);\r\n        values = [React.createElement('img', attr, null), ' ', attr.alt];\r\n        el = React.Fragment;\r\n        // Fragment attributes.\r\n        attr = {key: key};\r\n        break;\r\n      case 'MN':\r\n        el = 'span';\r\n        attr.className = 'mention'\r\n        if (data) {\r\n          attr.className += ' ' + idToColorClass(data.val, false, true);\r\n        }\r\n        break;\r\n      case 'EX':\r\n        let fname;\r\n        if (data) {\r\n          if (Drafty.isFormResponseType(data.mime)) {\r\n            // Ignore JSON attachments: they are form response payloads.\r\n            return null;\r\n          }\r\n          fname = data.name;\r\n          // Clear payload.\r\n          delete data.val;\r\n          delete data.ref;\r\n        }\r\n        el = React.Fragment;\r\n        values = [<i key=\"ex\" className=\"material-icons\">attachment</i>,\r\n          shortenFileName(fname, 16) || this.formatMessage(messages.drafty_attachment)];\r\n        break;\r\n    }\r\n    return React.createElement(el, attr, values);\r\n  }\r\n  return previewFormatter.call(this, style, data, values, key);\r\n}\r\n\r\n// Create image thumbnail suitable for inclusion in a quote.\r\nfunction quoteImageOrVideo(data, isVideo) {\r\n  let promise;\r\n  let bits, ref, mime;\r\n  if (isVideo) {\r\n    bits = data.preview;\r\n    mime = data.premime || 'image/jpeg';\r\n    ref = data.preref;\r\n  } else {\r\n    bits = data.val;\r\n    mime = data.mime;\r\n    ref = data.ref;\r\n  }\r\n  // Get the blob from the image data.\r\n  if (bits) {\r\n    const blob = base64ToBlob(bits, mime);\r\n    if (!blob) {\r\n      throw new Error(\"Invalid image\");\r\n    }\r\n    promise = Promise.resolve(blob);\r\n  } else if (ref) {\r\n    promise = fetch(this.authorizeURL(sanitizeUrlForMime(ref, 'image')))\r\n      .then(evt => {\r\n        if (evt.ok) {\r\n          return evt.blob();\r\n        } else {\r\n          throw new Error(`Image fetch unsuccessful: ${evt.status} ${evt.statusText}`);\r\n        }\r\n      });\r\n  } else {\r\n    throw new Error(\"Missing image data\");\r\n  }\r\n\r\n  // Scale the blob.\r\n  return promise\r\n    .then(blob => {\r\n      // If it's an image, cut the square from the center of the image and shrink it.\r\n      // If it's a video, allow it to be rectantular.\r\n      return imageScaled(blob, isVideo ? VIDEO_THUMBNAIL_WIDTH : IMAGE_THUMBNAIL_DIM, IMAGE_THUMBNAIL_DIM, -1, !isVideo)\r\n    }).then(scaled => {\r\n      if (isVideo) {\r\n        data.premime = scaled.mime;\r\n      } else {\r\n        data.mime = scaled.mime;\r\n      }\r\n      data.size = scaled.blob.size;\r\n      data.width = scaled.width;\r\n      data.height = scaled.height;\r\n      delete data.ref;\r\n      delete data.preref;\r\n      // Keeping the original file name, if provided: ex.data.name;\r\n\r\n      data.src = URL.createObjectURL(scaled.blob);\r\n      return blobToBase64(scaled.blob);\r\n    }).then(b64 => {\r\n      if (isVideo) {\r\n        data.preview = b64.bits;\r\n      } else {\r\n        data.val = b64.bits;\r\n      }\r\n      return data;\r\n    }).catch(err => {\r\n      delete data.val;\r\n      delete data.preview;\r\n      delete data.src;\r\n      data.width = IMAGE_THUMBNAIL_DIM;\r\n      data.height = IMAGE_THUMBNAIL_DIM;\r\n      // Rethrow.\r\n      throw err;\r\n    });\r\n}\r\n\r\n// Create a preview of a reply.\r\nexport function replyFormatter(style, data, values, key, stack) {\r\n  if (style == 'IM' || style == 'VD') {\r\n    const isImage = style == 'IM';\r\n    const attr = isImage ? inlineImageAttr.call(this, {key: key}, data) :\r\n      inlineVideoAttr.call(this, {key: key}, data);\r\n\r\n    let loadedPromise;\r\n    try {\r\n      loadedPromise = cancelablePromise(quoteImageOrVideo.call(this, data, style == 'VD'));\r\n    } catch (error) {\r\n      console.warn(\"Failed to quote image:\", error.message);\r\n      loadedPromise = cancelablePromise(error);\r\n    }\r\n    attr.whenDone = loadedPromise;\r\n    values = [React.createElement(LazyImage, attr, null), ' ', attr.alt];\r\n    return React.createElement(React.Fragment, {key: key}, values);\r\n  } else if (style == 'QQ') {\r\n    if (stack.includes('QQ')) {\r\n      // Quote inside quote when forwarding a message.\r\n      return React.createElement('span', {key: key},\r\n        [<i key=\"qq\" className=\"material-icons\">format_quote</i>, ' ']);\r\n    }\r\n\r\n    const attr = Drafty.attrValue('QQ', data) || {};\r\n    attr.key = key;\r\n    attr.className = 'reply-quote'\r\n    return React.createElement(Drafty.tagName('QQ'), attr, values);\r\n  }\r\n  return quoteFormatter.call(this, style, data, values, key);\r\n}\r\n","// A single topic or user.\r\nimport React from 'react';\r\nimport { FormattedMessage, defineMessages, injectIntl } from 'react-intl';\r\n\r\nimport { Tinode } from 'tinode-sdk';\r\n\r\nimport ContactBadges from './contact-badges.jsx';\r\nimport LetterTile from './letter-tile.jsx';\r\nimport UnreadBadge from './unread-badge.jsx';\r\n\r\nimport { Drafty } from 'tinode-sdk';\r\n\r\nimport { previewFormatter } from '../lib/formatters.js';\r\nimport { deliveryMarker } from '../lib/utils.js';\r\n\r\nconst messages = defineMessages({\r\n  self_topic_name: {\r\n    id: 'self_topic_name',\r\n    defaultMessage: 'Saved messages',\r\n    description: 'Name of self topic for UI'\r\n  },\r\n  self_topic_comment: {\r\n    id: 'self_topic_comment',\r\n    defaultMessage: 'Notes, messages, links, files saved for posterity',\r\n    description: 'Comment for self topic for UI'\r\n  }\r\n});\r\n\r\nclass Contact extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.handleClick = this.handleClick.bind(this);\r\n    this.handleContextClick = this.handleContextClick.bind(this);\r\n  }\r\n\r\n  handleClick(e) {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    if (this.props.onSelected) {\r\n      // Index this.props.index is used by GroupManager.\r\n      this.props.onSelected(this.props.item, this.props.index);\r\n    }\r\n  }\r\n\r\n  handleContextClick(e) {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    this.props.showContextMenu({ topicName: this.props.item, y: e.pageY, x: e.pageX });\r\n  }\r\n\r\n  render() {\r\n    let title = this.props.title;\r\n    const self = Tinode.isSelfTopicName(this.props.item);\r\n    if (!title) {\r\n      if (self) {\r\n        title = this.props.intl.formatMessage(messages.self_topic_name);\r\n      } else {\r\n        title = <i><FormattedMessage id=\"unnamed_topic\" defaultMessage=\"Unnamed\"\r\n          description=\"Title shown when the topic has no name\" /></i>;\r\n      }\r\n    } else if (title.length > 30) {\r\n      // FIXME: this is probably wrong for RTL languages.\r\n      title = title.substring(0, 28) + '…';\r\n    }\r\n    const online = this.props.now ? 'online' : 'offline';\r\n    const avatar = this.props.avatar ? this.props.avatar : true;\r\n    const badges = this.props.badges ? this.props.badges.slice() : [];\r\n    const icon_badges = [];\r\n    if (this.props.isVerified) {\r\n      icon_badges.push({icon: 'verified', color: 'verified-color'});\r\n    }\r\n    if (this.props.isStaff) {\r\n      icon_badges.push({icon: 'staff', color: 'staff-color'});\r\n    }\r\n    if (this.props.isDangerous) {\r\n      icon_badges.push({icon: 'dangerous', color: 'danger-color'});\r\n    }\r\n    if (this.props.acs) {\r\n      if (this.props.showMode) {\r\n        badges.push({name: this.props.acs.getMode(), key: 'mode'});\r\n      }\r\n      if (this.props.acs.isMuted()) {\r\n        icon_badges.push({icon: 'muted'});\r\n      }\r\n      if (!this.props.acs.isJoiner()) {\r\n        icon_badges.push({icon: 'banned'});\r\n      }\r\n    }\r\n\r\n    // The this.props.preview contains alreay shortened Drafty or string.\r\n    let preview;\r\n    if (typeof this.props.preview == 'string') {\r\n      preview = this.props.preview;\r\n    } else if (Drafty.isValid(this.props.preview)) {\r\n      preview = React.createElement(React.Fragment, null, Drafty.format(this.props.preview, previewFormatter,\r\n        {formatMessage: this.props.intl.formatMessage, previewIsResponse: this.props.previewIsResponse}));\r\n    } else if (this.props.preview) {\r\n      preview =\r\n        <><i className=\"material-icons gray\">warning_amber</i> <i className=\"gray\">\r\n          <FormattedMessage id=\"invalid_content\"\r\n            defaultMessage=\"invalid content\" description=\"Shown when the message is unreadable\" /></i>\r\n        </>;\r\n    }\r\n\r\n    const icon = deliveryMarker(this.props.received);\r\n    const marker = icon ? <i className={'material-icons small space-right' +\r\n      (icon.color ? ' ' + icon.color : '')}>{icon.name}</i> : null;\r\n    const titleClass = 'contact-title' + (this.props.deleted ? ' deleted' : '');\r\n\r\n    const comment = preview || this.props.comment ||\r\n      (self ? this.props.intl.formatMessage(messages.self_topic_comment) : '\\u00A0');\r\n    return (\r\n      <li className={!this.props.showCheckmark && this.props.selected ? 'selected' : null} onClick={this.handleClick}>\r\n        <div className=\"avatar-box\">\r\n          <LetterTile\r\n            tinode={this.props.tinode}\r\n            avatar={avatar}\r\n            title={this.props.title}\r\n            topic={this.props.item}\r\n            deleted={this.props.deleted} />\r\n          {this.props.deleted ? <i className=\"deleted material-icons\">cancel</i> :\r\n            (!self && this.props.showOnline) ? <span className={online} /> :\r\n            (this.props.showCheckmark && this.props.selected) ?\r\n            <i className=\"checkmark material-icons\">check_circle</i>\r\n            : null}\r\n        </div>\r\n        <div className=\"text-box\">\r\n          <div><span className={titleClass}>{title}</span>\r\n            {this.props.isGroup ? <i className=\"material-icons as-badge\">group</i> : null}\r\n            {this.props.isChannel ? <img src=\"/img/channel.png\" className=\"channel\" alt=\"channel\" /> : null}\r\n            {!self ? <ContactBadges badges={icon_badges} /> : null}\r\n            {!this.props.deleted ? <UnreadBadge count={this.props.unread} /> : null}\r\n          </div>\r\n          {this.props.showMode ?\r\n            <span><ContactBadges badges={badges} /></span> :\r\n            this.props.small ? null : <div className=\"contact-comment\">{marker}<span>{comment}</span></div>}\r\n        </div>\r\n        {this.props.showContextMenu ?\r\n          <span className=\"menuTrigger\">\r\n            <a href=\"#\" onClick={this.handleContextClick}>\r\n              <i className=\"material-icons\">expand_more</i>\r\n            </a>\r\n          </span> : null}\r\n      </li>\r\n    );\r\n  }\r\n};\r\n\r\nexport default injectIntl(Contact);\r\n","// A panel included into a list of contacts with an action text.\r\nimport React from 'react';\r\nimport { injectIntl } from 'react-intl';\r\n\r\nclass ContactAction extends React.PureComponent {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.handleClick = this.handleClick.bind(this);\r\n  }\r\n\r\n  handleClick(e) {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    this.props.onAction(this.props.action);\r\n  }\r\n\r\n  render() {\r\n    const {formatMessage} = this.props.intl;\r\n    return (\r\n      <li onClick={this.handleClick} className=\"action\">\r\n        <div className=\"action-text\">{formatMessage(this.props.title, this.props.values)}</div>\r\n      </li>\r\n    );\r\n  }\r\n};\r\n\r\nexport default injectIntl(ContactAction);\r\n","// ContactList: component for showing a list of contacts,\r\n// such as a list of group members in a group chat.\r\nimport React from 'react';\r\nimport { defineMessages, injectIntl } from 'react-intl';\r\n\r\nimport { Drafty, Tinode } from 'tinode-sdk';\r\n\r\nimport Contact from './contact.jsx';\r\nimport ContactAction from './contact-action.jsx';\r\n\r\nimport { makeImageUrl } from '../lib/blob-helpers.js';\r\n\r\nimport { MESSAGE_PREVIEW_LENGTH } from '../config.js';\r\n\r\nconst messages = defineMessages({\r\n  badge_you: {\r\n    id: 'badge_you',\r\n    defaultMessage: 'you',\r\n    description: 'Badge for indicating the current user'\r\n  },\r\n  badge_owner: {\r\n    id: 'badge_owner',\r\n    defaultMessage: 'owner',\r\n    description: 'Badge for indicating the owner'\r\n  }\r\n});\r\n\r\nclass ContactList extends React.Component {\r\n  render() {\r\n    const { formatMessage } = this.props.intl;\r\n    const showCheckmark = Array.isArray(this.props.topicSelected);\r\n    const contactNodes = [];\r\n\r\n    // Count of contacts, excluding action items.\r\n    let contactsCount = 0;\r\n    // do not show self topic\r\n    // if (this.props.showSelfTopic) {\r\n    //   const selected = showCheckmark ?\r\n    //     (this.props.topicSelected.indexOf('slf') > -1) :\r\n    //     (this.props.topicSelected === 'slf');\r\n    //   contactNodes.push(\r\n    //     <Contact\r\n    //       tinode={this.props.tinode}\r\n    //       avatar={true}\r\n    //       showMode={this.props.showMode}\r\n    //       selected={selected}\r\n    //       showCheckmark={showCheckmark}\r\n    //       onSelected={this.props.onTopicSelected}\r\n    //       showContextMenu={this.props.showContextMenu}\r\n    //       index={contactNodes.length}\r\n    //       item='slf'\r\n    //       key='slf' />\r\n    //   );\r\n    //   contactsCount ++;\r\n    // }\r\n    if (this.props.contacts && this.props.contacts.length > 0) {\r\n      this.props.contacts.forEach(c => {\r\n        if (c.action) {\r\n          // Action item\r\n          contactNodes.push(\r\n            <ContactAction\r\n              title={c.title} action={c.action} values={c.values}\r\n              key={c.action}\r\n              onAction={this.props.onAction}\r\n              />);\r\n        } else {\r\n          // Normal contact\r\n          const key = this.props.showMode ? c.user : (c.topic || c.user);\r\n          // If filter function is provided, filter out the items\r\n          // which don't satisfy the condition.\r\n          if (this.props.filterFunc && this.props.filter) {\r\n            const filterOn = [key];\r\n            if (c.private && c.private.comment) {\r\n              filterOn.push(('' + c.private.comment).toLowerCase());\r\n            }\r\n            if (c.public && c.public.fn) {\r\n              filterOn.push(('' + c.public.fn).toLowerCase());\r\n            }\r\n            if (!this.props.filterFunc(this.props.filter, filterOn)) {\r\n              return;\r\n            }\r\n          }\r\n\r\n          const isChannel = Tinode.isChannelTopicName(key);\r\n          const isGroup = !isChannel && Tinode.isGroupTopicName(key);\r\n          const selected = showCheckmark ?\r\n            (this.props.topicSelected.indexOf(key) > -1) :\r\n            (this.props.topicSelected === key);\r\n          const badges = [];\r\n          if (this.props.showMode) {\r\n            if (key == this.props.myUserId) {\r\n              badges.push({name: formatMessage(messages.badge_you), color: 'green'});\r\n            }\r\n            if (c.acs && c.acs.isOwner()) {\r\n              badges.push({name: formatMessage(messages.badge_owner), color: 'blue'});\r\n            }\r\n          }\r\n\r\n          const comment = Array.isArray(c.private) ?\r\n            c.private.join(',') : (c.private ? c.private.comment : null);\r\n          let preview;\r\n          let forwarded;\r\n          let previewIsResponse;\r\n          let deliveryStatus;\r\n          if (!this.props.showMode && c.latestMessage) {\r\n            const msg = c.latestMessage();\r\n            if (msg) {\r\n              // console.log('msg', msg.content, c.name);// TODO 打印所有会话最新消息\r\n              forwarded = msg.head ? msg.head.forwarded : null;\r\n              // console.log(444444, msg);\r\n              deliveryStatus = msg._status || c.msgStatus(msg, true);\r\n              previewIsResponse = msg.from != this.props.myUserId;\r\n              if (msg.content) {\r\n                preview = typeof msg.content == 'string' ?\r\n                  msg.content.substr(0, MESSAGE_PREVIEW_LENGTH) :\r\n                  Drafty.preview(msg.content, MESSAGE_PREVIEW_LENGTH);\r\n              }\r\n            } else {\r\n              // console.log('msg', msg, c.name); // TODO 打印所有会话最新消息\r\n            }\r\n          }\r\n\r\n          contactNodes.push(\r\n            <Contact\r\n              tinode={this.props.tinode}\r\n              title={c.public ? c.public.fn : null}\r\n              avatar={makeImageUrl(c.public ? c.public.photo : null)}\r\n              comment={comment}\r\n              preview={preview}\r\n              previewIsResponse={previewIsResponse}\r\n              forwarded={forwarded}\r\n              received={deliveryStatus}\r\n              unread={this.props.showUnread ? c.unread : 0}\r\n              now={c.online && this.props.connected}\r\n              acs={c.acs}\r\n              showMode={this.props.showMode}\r\n              badges={badges}\r\n              showCheckmark={showCheckmark}\r\n              selected={selected}\r\n              showOnline={this.props.showOnline && !isChannel}\r\n              isChannel={isChannel}\r\n              isGroup={isGroup}\r\n              showContextMenu={this.props.showContextMenu}\r\n              isVerified={c.trusted && c.trusted.verified}\r\n              isStaff={c.trusted && c.trusted.staff}\r\n              isDangerous={c.trusted && c.trusted.danger}\r\n              deleted={c._deleted}\r\n              onSelected={this.props.onTopicSelected}\r\n              item={key}\r\n              index={contactNodes.length}\r\n              key={key} />\r\n          );\r\n          contactsCount ++;\r\n        }\r\n      }, this);\r\n    }\r\n\r\n    return (\r\n      <div className={this.props.noScroll ? null : \"scrollable-panel\"}>\r\n        {contactsCount == 0 ?\r\n          <div className=\"center-medium-text\"\r\n            dangerouslySetInnerHTML={{__html: this.props.emptyListMessage}} />\r\n          :\r\n          null\r\n        }\r\n        {contactNodes.length > 0 ?\r\n          <ul className=\"contact-box\">\r\n            {contactNodes}\r\n          </ul>\r\n          :\r\n          null\r\n        }\r\n      </div>\r\n    );\r\n  }\r\n};\r\n\r\nexport default injectIntl(ContactList);\r\n","import React from 'react';\r\n\r\nimport { Tinode } from 'tinode-sdk';\r\n\r\nexport default class SearchContacts extends React.PureComponent {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      edited: false,\r\n      search: ''\r\n    };\r\n\r\n    this.handleSearchChange = this.handleSearchChange.bind(this);\r\n    this.handleSearch = this.handleSearch.bind(this);\r\n    this.handleClear = this.handleClear.bind(this);\r\n    this.handleKeyDown = this.handleKeyDown.bind(this);\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    if (this.state.edited) {\r\n      this.setState({search: '', edited: false});\r\n      this.props.onSearchContacts(Tinode.DEL_CHAR);\r\n    }\r\n  }\r\n\r\n  handleSearchChange(e) {\r\n    this.setState({search: e.target.value});\r\n  }\r\n\r\n  handleSearch(e) {\r\n    e.preventDefault();\r\n    const query = this.state.search.trim();\r\n    this.setState({edited: (query.length > 0)});\r\n    this.props.onSearchContacts(query.length > 0 ? query : Tinode.DEL_CHAR);\r\n  }\r\n\r\n  handleClear(e) {\r\n    e.preventDefault();\r\n    if (this.state.edited) {\r\n      this.props.onSearchContacts(Tinode.DEL_CHAR);\r\n    }\r\n    this.setState({search: '', edited: false});\r\n  }\r\n\r\n  handleKeyDown(e) {\r\n    if (e.key === 'Enter') {\r\n      this.handleSearch(e);\r\n    } else if (e.key === 'Escape') {\r\n      this.handleClear();\r\n    }\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div className=\"panel-form\">\r\n        <div className=\"panel-form-row\">\r\n          <i className=\"material-icons search\">search</i>\r\n          <input className=\"search\" type=\"text\"\r\n              placeholder={this.props.placeholder}\r\n              value={this.state.search} onChange={this.handleSearchChange}\r\n              onKeyDown={this.handleKeyDown} required autoFocus />\r\n          {this.state.search ?\r\n            <a href=\"#\" onClick={this.handleClear}><i className=\"material-icons\">highlight_off</i></a>\r\n            :\r\n            <span><i className=\"material-icons\">&nbsp;</i></span>}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n};\r\n","// Forward Menu: message forwarding popup/dropdown menu.\r\nimport React from 'react';\r\nimport { FormattedMessage } from 'react-intl';\r\n\r\nimport { Tinode } from 'tinode-sdk';\r\n\r\nimport ContactList from './contact-list.jsx';\r\nimport SearchContacts from './search-contacts.jsx';\r\n\r\nexport default class ForwardDialog extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      query: null\r\n    };\r\n\r\n    this.handleEscapeKey = this.handleEscapeKey.bind(this);\r\n    this.handleClose = this.handleClose.bind(this);\r\n\r\n    this.handleSearchContacts = this.handleSearchContacts.bind(this);\r\n    this.handleContactSelected = this.handleContactSelected.bind(this);\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.props.onInitFind();\r\n  }\r\n\r\n  handleEscapeKey(e) {\r\n    if (e.keyCode === 27) {\r\n      // Not forwarding the message.\r\n      this.props.hide(false);\r\n    }\r\n  }\r\n\r\n  handleClose(e) {\r\n    e.preventDefault();\r\n    this.props.hide(false);\r\n  }\r\n\r\n  handleSearchContacts(query) {\r\n    this.setState({ query: Tinode.isNullValue(query) ? null : query });\r\n    this.props.onSearchContacts(query);\r\n  }\r\n\r\n  handleContactSelected(uid) {\r\n    this.props.onTopicSelected(uid);\r\n    this.props.hide(true);\r\n  }\r\n\r\n  render() {\r\n    let contacts = this.state.query != null ? this.props.searchResults : this.props.contacts;\r\n    // Filter out contacts without a 'W' or 'J' permissions as well as the current topic.\r\n    contacts = contacts.filter((c) => {\r\n      return (c.name != this.props.topicSelected) && c.acs.isJoiner() && c.acs.isWriter();\r\n    });\r\n\r\n    return (\r\n      <div className=\"alert-container\">\r\n        <div className=\"forward-dialog\">\r\n          <div className=\"title with-control\">\r\n            <div><FormattedMessage id=\"forward_to\" defaultMessage=\"Forward to\"\r\n              desription=\"Title of the contact selector dialog when forwarding a message\" /></div>\r\n            <div><a href=\"#\" onClick={this.handleClose}><i className=\"material-icons\">close</i></a></div>\r\n          </div>\r\n          <FormattedMessage id=\"forward_to_search_placeholder\" defaultMessage=\"Search contacts\"\r\n            description=\"Contact search prompt when forwarding a message.\">{\r\n            (search_placeholder) => <SearchContacts\r\n              placeholder={search_placeholder}\r\n              onSearchContacts={this.handleSearchContacts} />\r\n          }</FormattedMessage>\r\n          <FormattedMessage id=\"search_no_results\" defaultMessage=\"Search returned no results\"\r\n              description=\"Text shown in contacts view when query returned no results.\">{\r\n            (not_found_placeholder) => <ContactList\r\n              tinode={this.props.tinode}\r\n              contacts={contacts}\r\n              myUserId={this.props.myUserId}\r\n              emptyListMessage={not_found_placeholder}\r\n              showOnline={false}\r\n              showUnread={false}\r\n              showContextMenu={false}\r\n              onTopicSelected={this.handleContactSelected} />\r\n          }</FormattedMessage>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","// Video call states.\r\nexport const CALL_STATE_NONE = 0;\r\nexport const CALL_STATE_OUTGOING_INITATED = 1;\r\nexport const CALL_STATE_INCOMING_RECEIVED = 2;\r\nexport const CALL_STATE_IN_PROGRESS = 3;\r\n\r\n// Video call message headers representing call state.\r\nexport const CALL_HEAD_STARTED = 'started';\r\n\r\n","// IncomingCall: displays Accept & Reject buttons for incoming calls.\r\nimport React from 'react';\r\n\r\nimport BadgeList from './badge-list.jsx';\r\nimport LetterTile from './letter-tile.jsx';\r\n\r\nimport { MAX_TITLE_LENGTH, MAX_PEER_TITLE_LENGTH } from '../config.js';\r\nimport { CALL_STATE_INCOMING_RECEIVED } from '../constants.js';\r\n\r\nimport { makeImageUrl } from '../lib/blob-helpers.js';\r\nimport { clipStr } from '../lib/utils.js'\r\n\r\nconst RING_SOUND = new Audio('audio/call-in.m4a');\r\n\r\nexport default class CallIncoming extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      topic: null,\r\n      fullName: undefined,\r\n      avatar: null,\r\n      trustedBadges: [],\r\n      previousMetaDesc: undefined,\r\n    };\r\n\r\n    this.resetDesc = this.resetDesc.bind(this);\r\n    this.onMetaDesc = this.onMetaDesc.bind(this);\r\n    this.handleRejectCall = this.handleRejectCall.bind(this);\r\n    this.handleAcceptCall = this.handleAcceptCall.bind(this);\r\n    this.ringTimer = null;\r\n  }\r\n\r\n  componentDidMount() {\r\n    const topic = this.props.tinode.getTopic(this.props.topic);\r\n    if (!topic) {\r\n      return;\r\n    }\r\n\r\n    this.resetDesc(topic);\r\n    if (this.props.callState == CALL_STATE_INCOMING_RECEIVED) {\r\n      // play() throws if the user did not click the app first: https://goo.gl/xX8pDD.\r\n      RING_SOUND.play().catch(_ => {});\r\n      this.ringTimer = setInterval(_ => {RING_SOUND.play().catch(_ => {})}, 2000);\r\n      this.props.onRinging(this.props.topic, this.props.seq);\r\n    }\r\n  }\r\n\r\n  // No need to separately handle component mount.\r\n  componentDidUpdate(props) {\r\n    const topic = this.props.tinode.getTopic(props.topic);\r\n    if (!topic) {\r\n      return;\r\n    }\r\n\r\n    if (this.onMetaDesc != topic.onMetaDesc) {\r\n      this.previousMetaDesc = topic.onMetaDesc;\r\n      topic.onMetaDesc = this.onMetaDesc;\r\n    }\r\n\r\n    if (this.state.topic != props.topic) {\r\n      this.setState({topic: props.topic});\r\n      this.resetDesc(topic, props);\r\n    }\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    if (this.ringTimer != null) {\r\n      clearInterval(this.ringTimer);\r\n      RING_SOUND.pause();\r\n    }\r\n    const topic = this.props.tinode.getTopic(this.props.topic);\r\n    if (!topic) {\r\n      return;\r\n    }\r\n    this.setState({topic: null});\r\n    topic.onMetaDesc = this.previousMetaDesc;\r\n  }\r\n\r\n  resetDesc(topic) {\r\n    const badges = [];\r\n    if (topic.trusted) {\r\n      for (const [key, val] of Object.entries(topic.trusted)) {\r\n        if (val) {\r\n          badges.push(key);\r\n        }\r\n      }\r\n    }\r\n\r\n    this.setState({\r\n      fullName: clipStr(topic.public ? topic.public.fn : undefined, MAX_TITLE_LENGTH),\r\n      avatar: makeImageUrl(topic.public ? topic.public.photo : null),\r\n      trustedBadges: badges,\r\n    });\r\n  }\r\n\r\n  onMetaDesc(desc) {\r\n    const topic = this.props.tinode.getTopic(this.props.topic);\r\n    if (!topic) {\r\n      return;\r\n    }\r\n    this.resetDesc(topic);\r\n\r\n    if (this.previousMetaDesc && this.previousMetaDesc != this.onMetaDesc) {\r\n      this.previousMetaDesc(desc);\r\n    }\r\n  }\r\n\r\n  handleAcceptCall() {\r\n    this.props.onAcceptCall(this.props.topic);\r\n  }\r\n\r\n  handleRejectCall() {\r\n    this.props.onReject(this.props.topic, this.props.seq);\r\n    this.props.onClose();\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div className=\"alert-container\">\r\n        <div className=\"incoming-call\">\r\n          <div className=\"caller-card incoming pulse\">\r\n            <div className=\"avatar-box\">\r\n              <LetterTile\r\n                tinode={this.props.tinode}\r\n                avatar={this.state.avatar || true}\r\n                topic={this.props.topic}\r\n                title={this.state.fullName} />\r\n            </div>\r\n            <div className=\"caller-name\">{clipStr(this.state.fullName, MAX_PEER_TITLE_LENGTH)}\r\n              <BadgeList short={true} trustedBadges={this.state.trustedBadges} /></div>\r\n          </div>\r\n          <div className=\"controls\">\r\n            {this.props.callState == CALL_STATE_INCOMING_RECEIVED ?\r\n              <>\r\n                <button className=\"danger\" onClick={this.handleRejectCall}>\r\n                  <i className=\"material-icons\">call_end</i>\r\n                </button>\r\n                <button className=\"positive\" onClick={this.handleAcceptCall}>\r\n                  <i className=\"material-icons\">call</i>\r\n                </button>\r\n              </>\r\n              :\r\n              null\r\n            }\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n};\r\n","// The X menu to be displayed in title bars.\r\nimport React from 'react';\r\n\r\nexport default class MenuCancel extends React.PureComponent {\r\n  render() {\r\n    return (\r\n      <a href=\"#\" onClick={(e) => {e.preventDefault(); this.props.onCancel();}}>\r\n        <i className=\"material-icons\">close</i>\r\n      </a>\r\n    );\r\n  }\r\n}\r\n","import React from 'react';\r\n\r\nimport MenuCancel from './menu-cancel.jsx';\r\n\r\nexport default class ErrorPanel extends React.PureComponent {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      show: false,\r\n    };\r\n\r\n    this.hide = this.hide.bind(this);\r\n  }\r\n\r\n  componentDidUpdate(prevProps) {\r\n    if (prevProps.level !== this.props.level) {\r\n      this.setState({\r\n        show: !(!this.props.level)\r\n      });\r\n    }\r\n  }\r\n\r\n  hide() {\r\n    this.setState({show: false});\r\n    if (this.props.onClearError) {\r\n      this.props.onClearError();\r\n    }\r\n  }\r\n\r\n  render() {\r\n    const icons = {err: 'error', warn: 'warning', info: 'info'}\r\n    const level = icons[this.props.level] || '';\r\n    const className = 'info-box ' + level;\r\n    return (\r\n      <div className={className}>\r\n        <div className=\"icon\"><i className=\"material-icons\">{level}</i></div>\r\n        <span>\r\n          {this.props.text}\r\n          {this.props.action ?\r\n            <>\r\n              &nbsp;&#32;<a href=\"#\"\r\n                style={{ whiteSpace: 'nowrap' }}\r\n                onClick={(e) => {e.preventDefault(); this.props.action();}}>\r\n                {this.props.actionText}\r\n              </a>\r\n            </>\r\n          : null}\r\n        </span>\r\n        <div className=\"cancel\"><MenuCancel onCancel={this.hide} /></div>\r\n      </div>\r\n    );\r\n  }\r\n};\r\n","import React from 'react';\r\n\r\nimport LetterTile from './letter-tile.jsx';\r\n\r\nexport default class Chip extends React.PureComponent {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.handleCancel = this.handleCancel.bind(this);\r\n  }\r\n\r\n  handleCancel(e) {\r\n    e.preventDefault();\r\n    this.props.onCancel(this.props.topic, this.props.index);\r\n  }\r\n\r\n  render() {\r\n    const title = this.props.title || this.props.topic;\r\n    const className = this.props.invalid ? 'chip invalid' : 'chip';\r\n    return (\r\n      <div className={className}>\r\n        {this.props.noAvatar ?\r\n          <span className=\"spacer\" /> :\r\n          <div className=\"avatar-box\">\r\n            <LetterTile\r\n              tinode={this.props.tinode}\r\n              avatar={this.props.avatar || true}\r\n              topic={this.props.topic}\r\n              title={this.props.title} />\r\n          </div>\r\n        }\r\n        <span>{title}</span>\r\n        {this.props.onCancel && !this.props.required ?\r\n          <a href=\"#\" onClick={this.handleCancel} >&times;</a>\r\n          : <span className=\"spacer\" />}\r\n      </div>\r\n    );\r\n  }\r\n};\r\n","import React from 'react';\r\n\r\nimport Chip from './chip.jsx';\r\n\r\nimport { makeImageUrl } from '../lib/blob-helpers.js';\r\n\r\n/* BEGIN ChipInput: group membership widget */\r\nexport default class ChipInput extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.state = ChipInput.deriveStateFromProps(props);\r\n    this.state.input = '';\r\n    this.state.focused = false;\r\n\r\n    this.handleTextInput = this.handleTextInput.bind(this);\r\n    this.removeChipAt = this.removeChipAt.bind(this);\r\n    this.handleChipCancel = this.handleChipCancel.bind(this);\r\n    this.handleFocusGained = this.handleFocusGained.bind(this);\r\n    this.handleFocusLost = this.handleFocusLost.bind(this);\r\n    this.handleKeyDown = this.handleKeyDown.bind(this);\r\n  }\r\n\r\n  static deriveStateFromProps(props) {\r\n    return {\r\n      placeholder: props.chips ? '' : props.prompt,\r\n      sortedChips: ChipInput.sortChips(props.chips, props.staticMembers),\r\n      chipIndex: ChipInput.indexChips(props.chips)\r\n    };\r\n  }\r\n\r\n  componentDidUpdate(prevProps, prevState) {\r\n    if (prevProps.chips != this.props.chips ||\r\n      prevProps.staticMembers != this.props.staticMembers ||\r\n      prevProps.prompt != this.props.prompt) {\r\n      this.setState(ChipInput.deriveStateFromProps(this.props));\r\n    }\r\n    if (!prevState || this.props.chips.length > prevState.sortedChips.length) {\r\n      this.setState({input: ''});\r\n    }\r\n  }\r\n\r\n  // Map chip index to user name\r\n  static indexChips(chips) {\r\n    const index = {};\r\n    let count = 0;\r\n    chips.forEach(item => {\r\n      index[item.user] = count;\r\n      count ++;\r\n    });\r\n    return index;\r\n  }\r\n\r\n  // Have non-removable chips appear before all other chips.\r\n  static sortChips(chips, keep) {\r\n    const required = [];\r\n    const normal = [];\r\n    chips.forEach(item => {\r\n      if (keep && keep.includes(item.user)) {\r\n        required.push(item);\r\n      } else {\r\n        normal.push(item);\r\n      }\r\n    });\r\n    return required.concat(normal);\r\n  }\r\n\r\n  handleTextInput(e) {\r\n    this.setState({input: e.target.value});\r\n    if (this.props.filterFunc) {\r\n      this.props.filterFunc(e.target.value);\r\n    }\r\n  }\r\n\r\n  removeChipAt(idx) {\r\n    const removed = this.state.sortedChips[idx];\r\n    this.props.onChipRemoved(removed.user, this.state.chipIndex[removed.user]);\r\n  }\r\n\r\n  handleChipCancel(item, idx) {\r\n    this.removeChipAt(idx);\r\n  }\r\n\r\n  handleFocusGained() {\r\n    this.setState({focused: true});\r\n  }\r\n\r\n  handleFocusLost() {\r\n    this.setState({focused: false});\r\n    if (this.props.onFocusLost) {\r\n      this.props.onFocusLost(this.state.input);\r\n    }\r\n  }\r\n\r\n  handleKeyDown(e) {\r\n    if (e.key === 'Backspace') {\r\n      if (this.state.input.length == 0 && this.state.sortedChips.length > 0) {\r\n        const at = this.state.sortedChips.length - 1;\r\n        if (this.state.sortedChips[at].user !== this.props.staticMembers) {\r\n          this.removeChipAt(at);\r\n        }\r\n      }\r\n    } else if (e.key === 'Enter') {\r\n      if (this.props.onEnter) {\r\n        this.props.onEnter(this.state.input);\r\n      }\r\n    } else if (e.key === 'Escape') {\r\n      if (this.props.onCancel) {\r\n        this.props.onCancel();\r\n      }\r\n    }\r\n  }\r\n\r\n  render() {\r\n    const chips = [];\r\n    let count = 0;\r\n    const staticMembers = this.props.staticMembers || [];\r\n    this.state.sortedChips.forEach(item => {\r\n      chips.push(\r\n        <Chip\r\n          tinode={this.props.tinode}\r\n          onCancel={this.handleChipCancel}\r\n          avatar={makeImageUrl(item.public ? item.public.photo : null)}\r\n          title={item.public ? item.public.fn : undefined}\r\n          noAvatar={this.props.avatarDisabled}\r\n          topic={item.user}\r\n          required={staticMembers.includes(item.user)}\r\n          invalid={item.invalid}\r\n          index={count}\r\n          key={item.user} />\r\n      );\r\n      count++;\r\n    });\r\n    const className = \"chip-input\" + (this.state.focused ? ' focused' : '');\r\n    const autoFocus = !(this.props.tabIndex > 0);\r\n    return (\r\n      <div className={className}>\r\n        {chips}\r\n        <input type=\"text\"\r\n          placeholder={this.state.placeholder}\r\n          onChange={this.handleTextInput}\r\n          onFocus={this.handleFocusGained}\r\n          onBlur={this.handleFocusLost}\r\n          onKeyDown={this.handleKeyDown}\r\n          value={this.state.input}\r\n          tabIndex={this.props.tabIndex}\r\n          autoFocus={autoFocus} />\r\n      </div>\r\n    );\r\n  }\r\n};\r\n","// GroupMembers: control for managing a list of group members.\r\nimport React from 'react';\r\nimport { FormattedMessage, defineMessages, injectIntl } from 'react-intl';\r\n\r\nimport ChipInput from './chip-input.jsx';\r\nimport ContactList from './contact-list.jsx';\r\n\r\nconst messages = defineMessages({\r\n  no_contacts: {\r\n    id: 'no_contacts',\r\n    defaultMessage: 'You have no contacts :-(',\r\n    description: 'Shown in ContactsView when the user has no contacts'\r\n  },\r\n  contacts_not_found_short: {\r\n    id: 'contacts_not_found_short',\r\n    defaultMessage: \"No contacts match ''{query}''\",\r\n    description: 'Shown in ContactsView when search returned no results'\r\n  }\r\n});\r\n\r\nclass GroupManager extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      // Array of topic members\r\n      members: props.members,\r\n      index: GroupManager.indexMembers(props.members),\r\n      staticMembers: GroupManager.staticMembers(props.members, props.keepInitialMembers, props.requiredMember),\r\n      contactFilter: '',\r\n      noContactsMessage: props.intl.formatMessage(messages.no_contacts),\r\n      selectedContacts: GroupManager.selectedContacts(props.members)\r\n    };\r\n\r\n    this.handleContactSelected = this.handleContactSelected.bind(this);\r\n    this.handleMemberRemoved = this.handleMemberRemoved.bind(this);\r\n    this.handleContactFilter = this.handleContactFilter.bind(this);\r\n    this.handleSubmit = this.handleSubmit.bind(this);\r\n    this.handleCancel = this.handleCancel.bind(this);\r\n  }\r\n\r\n  static indexMembers(members) {\r\n    let index = {};\r\n    members.forEach(m => {\r\n      index[m.user] = {delta: 0, present: true}; // Delta: 0 unchanged, +1 added, -1 removed\r\n    });\r\n    return index;\r\n  }\r\n\r\n  static staticMembers(members, keepInitial, requiredMember) {\r\n    let stat = [];\r\n    members.forEach(m => {\r\n      if (keepInitial || m.user == requiredMember) {\r\n        stat.push(m.user);\r\n      }\r\n    });\r\n    return stat;\r\n  }\r\n\r\n  static selectedContacts(members) {\r\n    let sel = [];\r\n    members.forEach(m => {\r\n      sel.push(m.user);\r\n    });\r\n    return sel;\r\n  }\r\n\r\n  handleContactSelected(userId, index) {\r\n    let status = this.state.index[userId];\r\n    if (status) {\r\n      if (status.present) {\r\n        // Prevent duplicate members\r\n        return;\r\n      }\r\n      status.delta += 1;\r\n      status.present = true;\r\n    } else {\r\n      status = {delta: 1, present: true};\r\n    }\r\n\r\n    let m = this.state.members.slice();\r\n    m.push(this.props.contacts[index]);\r\n\r\n    const sel = GroupManager.selectedContacts(m);\r\n\r\n    const i = this.state.index;\r\n    i[userId] = status;\r\n\r\n    this.setState({members: m, index: i, selectedContacts: sel});\r\n  }\r\n\r\n  handleMemberRemoved(userId, index) {\r\n    const status = this.state.index[userId];\r\n    if (!status || !status.present) {\r\n      return;\r\n    }\r\n    status.present = false;\r\n    status.delta -= 1;\r\n\r\n    let m = this.state.members.slice();\r\n    m.splice(index, 1);\r\n\r\n    const sel = GroupManager.selectedContacts(m);\r\n\r\n    const i = this.state.index;\r\n    i[userId] = status;\r\n\r\n    this.setState({members: m, index: i, selectedContacts: sel});\r\n  }\r\n\r\n  handleContactFilter(val) {\r\n    const {formatMessage} = this.props.intl;\r\n    const msg = !val ?\r\n      formatMessage(messages.no_contacts) :\r\n      formatMessage(messages.contacts_not_found_short, {query: val});\r\n\r\n    this.setState({contactFilter: val, noContactsMessage: msg});\r\n  }\r\n\r\n  static doContactFiltering(filter, values) {\r\n    if (filter) {\r\n      for (let i=0; i<values.length; i++) {\r\n        if (values[i].indexOf(filter) >= 0) {\r\n          return true;\r\n        }\r\n      }\r\n      return false;\r\n    }\r\n    return true;\r\n  }\r\n\r\n  handleSubmit() {\r\n    const members = [];\r\n    const added = [];\r\n    const removed = [];\r\n\r\n    const keys = Object.keys(this.state.index);\r\n    keys.forEach(k => {\r\n      if (this.state.index[k].present) {\r\n        members.push(k);\r\n      }\r\n\r\n      if (this.state.index[k].delta > 0) {\r\n        added.push(k);\r\n      } else if (this.state.index[k].delta < 0) {\r\n        removed.push(k);\r\n      }\r\n    });\r\n    this.props.onSubmit(members, added, removed);\r\n  }\r\n\r\n  handleCancel() {\r\n    this.props.onCancel();\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div id=\"group-manager\">\r\n        <div className=\"panel-form-row\">\r\n          <label className=\"small\">\r\n            <FormattedMessage id=\"title_group_members\" defaultMessage=\"Group Members\" description=\"Section title\" />\r\n          </label>\r\n        </div>\r\n        <div className=\"panel-form-row\">\r\n          <ChipInput\r\n            tinode={this.props.tinode}\r\n            chips={this.state.members}\r\n            staticMembers={this.state.staticMembers}\r\n            prompt=\"add members\"\r\n            filterFunc={this.handleContactFilter}\r\n            onChipRemoved={this.handleMemberRemoved} />\r\n        </div>\r\n        <div className=\"panel-form-row\">\r\n          <label className=\"small\">\r\n            <FormattedMessage id=\"title_all_contacts\" defaultMessage=\"All Contacts\"\r\n              description=\"Section title [All Contacts]\" />\r\n          </label>\r\n        </div>\r\n        <ContactList\r\n          tinode={this.props.tinode}\r\n          contacts={this.props.contacts}\r\n          myUserId={this.props.myUserId}\r\n          topicSelected={this.state.selectedContacts}\r\n          filter={this.state.contactFilter}\r\n          filterFunc={GroupManager.doContactFiltering}\r\n          emptyListMessage={this.state.noContactsMessage}\r\n          showOnline={false}\r\n          showUnread={false}\r\n          onTopicSelected={this.handleContactSelected} />\r\n        <div id=\"group-manager-buttons\" className=\"panel-form-row\">\r\n          <button className=\"secondary\" onClick={this.handleCancel}>\r\n            <FormattedMessage id=\"button_cancel\" defaultMessage=\"Cancel\" description=\"Button [Cancel]\" />\r\n          </button>\r\n          <button className=\"primary\" onClick={this.handleSubmit}>\r\n            <FormattedMessage id=\"button_ok\" defaultMessage=\"OK\" description=\"Button [OK]\" />\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n};\r\n\r\nexport default injectIntl(GroupManager);\r\n","// PermissionsEditor: Component for editing permissions\r\n// <PermissionsEditor mode=\"JWROD\" skip=\"O\" onChange={this.handleCheckboxTest} />\r\nimport React from 'react';\r\nimport { FormattedMessage, defineMessages, injectIntl } from 'react-intl';\r\n\r\nimport CheckBox from './checkbox.jsx';\r\nimport Contact from './contact.jsx';\r\n\r\nimport { makeImageUrl } from '../lib/blob-helpers.js';\r\n\r\n// Translatable permission names.\r\nconst messages = defineMessages({\r\n  joiner: {\r\n    id: 'permission_join',\r\n    defaultMessage: \"Join ({val})\",\r\n    description: 'Name of J permission'\r\n  },\r\n  reader: {\r\n    id: 'permission_read',\r\n    defaultMessage: \"Read ({val})\",\r\n    description: 'Name of R permission'\r\n  },\r\n  writer: {\r\n    id: 'permission_write',\r\n    defaultMessage: \"Write ({val})\",\r\n    description: 'Name of W permission'\r\n  },\r\n  preser: {\r\n    id: 'permission_pres',\r\n    defaultMessage: \"Get notified ({val})\",\r\n    description: 'Name of P permission'\r\n  },\r\n  approver: {\r\n    id: 'permission_admin',\r\n    defaultMessage: \"Approve ({val})\",\r\n    description: 'Name of A permission'\r\n  },\r\n  sharer: {\r\n    id: 'permission_share',\r\n    defaultMessage: \"Share ({val})\",\r\n    description: 'Name of S permission'\r\n  },\r\n  deleter: {\r\n    id: 'permission_delete',\r\n    defaultMessage: \"Delete ({val})\",\r\n    description: 'Name of D permission'\r\n  },\r\n  owner: {\r\n    id: 'permission_owner',\r\n    defaultMessage: \"Owner ({val})\",\r\n    description: 'Name of O permission'\r\n  }\r\n});\r\n\r\nclass PermissionsEditor extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      mode: (props.mode || '').replace('N', '')\r\n    };\r\n\r\n    this.handleChange = this.handleChange.bind(this);\r\n    this.handleSubmit = this.handleSubmit.bind(this);\r\n    this.handleCancel = this.handleCancel.bind(this);\r\n  }\r\n\r\n  handleChange(val) {\r\n    let mode = this.state.mode;\r\n    const idx = mode.indexOf(val);\r\n    if (idx == -1) {\r\n      mode += val;\r\n    } else {\r\n      mode = mode.replace(val, '');\r\n    }\r\n    this.setState({mode: mode});\r\n  }\r\n\r\n  handleSubmit() {\r\n    // Normalize string, otherwise cannot check if mode has changed.\r\n    const mode = (this.state.mode || 'N').split('').sort().join('');\r\n    const before = (this.props.mode || 'N').split('').sort().join('')\r\n    if (mode !== before) {\r\n      this.props.onSubmit(mode);\r\n    } else {\r\n      this.props.onCancel();\r\n    }\r\n  }\r\n\r\n  handleCancel() {\r\n    this.props.onCancel();\r\n  }\r\n\r\n  render() {\r\n    const {formatMessage} = this.props.intl;\r\n    const all = 'JRWPASDO';\r\n    const names = {\r\n      'J': formatMessage(messages.joiner, {val: 'J'}),\r\n      'R': formatMessage(messages.reader, {val: 'R'}),\r\n      'W': formatMessage(messages.writer, {val: 'W'}),\r\n      'P': formatMessage(messages.preser, {val: 'P'}),\r\n      'A': formatMessage(messages.approver, {val: 'A'}),\r\n      'S': formatMessage(messages.sharer, {val: 'S'}),\r\n      'D': formatMessage(messages.deleter, {val: 'D'}),\r\n      'O': formatMessage(messages.owner, {val: 'O'})\r\n    };\r\n\r\n    let skip = this.props.skip || '';\r\n    let mode = this.state.mode;\r\n    let compare = (this.props.compare || '').replace('N', '');\r\n    let items = [];\r\n    for (let i=0; i<all.length; i++) {\r\n      let c = all.charAt(i);\r\n      if (skip.indexOf(c) >= 0 && mode.indexOf(c) < 0) {\r\n        // Permission is marked as inactive: hide unchecked permissions, disable checked permissions\r\n        continue;\r\n      }\r\n      items.push(\r\n        <tr key={c}>\r\n          <td>{names[c]}</td>\r\n          <td className=\"checkbox\">{skip.indexOf(c) < 0 ?\r\n            <CheckBox name={c} checked={(mode.indexOf(c) >= 0)} onChange={this.handleChange}/>\r\n            :\r\n            <CheckBox name={c} checked={(mode.indexOf(c) >= 0)} />\r\n          }</td>{this.props.compare ? <td className=\"checkbox\">\r\n            <CheckBox name={c} checked={(compare.indexOf(c) >= 0)}/>\r\n          </td> : null}\r\n        </tr>\r\n      );\r\n    }\r\n\r\n    return (\r\n      <div className=\"panel-form-column\">\r\n        {this.props.userTitle ?\r\n          <ul className=\"contact-box small\"><Contact\r\n            tinode={this.props.tinode}\r\n            item={this.props.item}\r\n            title={this.props.userTitle}\r\n            small={true}\r\n            avatar={makeImageUrl(this.props.userAvatar ? this.props.userAvatar : null)} /></ul> : null}\r\n        <label className=\"small\"><FormattedMessage id=\"title_permissions\"\r\n          defaultMessage=\"Permissions\" description=\"Section title\"/></label>\r\n        <table className=\"permission-editor\">\r\n        {this.props.compare ?\r\n          <thead><tr>\r\n            <th></th><th>{this.props.modeTitle}</th>\r\n            <th>{this.props.compareTitle}</th>\r\n          </tr></thead> :\r\n          null}\r\n        <tbody>\r\n          {items}\r\n        </tbody></table>\r\n        <br />\r\n        <div className=\"dialog-buttons\">\r\n          <button className=\"outline\" onClick={this.handleCancel}>\r\n            <FormattedMessage id=\"button_cancel\" defaultMessage=\"Cancel\" description=\"Button [Cancel]\" />\r\n          </button>\r\n          <button className=\"primary\" onClick={this.handleSubmit}>\r\n            <FormattedMessage id=\"button_ok\" defaultMessage=\"OK\" description=\"Button [OK]\" />\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n};\r\n\r\nexport default injectIntl(PermissionsEditor);\r\n","var __WEBPACK_NAMESPACE_OBJECT__ = QRCode;","import QRCode from 'qrcodejs';\r\nimport React from 'react';\r\nimport { FormattedMessage } from 'react-intl';\r\n\r\nimport { QRCODE_SIZE } from '../config';\r\n\r\nexport default class ShowQRCode extends React.PureComponent {\r\n  constructor(props) {\r\n    super(props);\r\n    this.qrCodeRef = React.createRef();\r\n  }\r\n\r\n  componentDidMount() {\r\n    new QRCode(this.qrCodeRef.current, {\r\n      text: this.props.uri,\r\n      width: QRCODE_SIZE,\r\n      height: QRCODE_SIZE,\r\n    });\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div className=\"panel-form-column\">\r\n        <br />\r\n        <div className=\"qr-code\" ref={this.qrCodeRef} />\r\n        <div className=\"dialog-buttons\">\r\n          <button className=\"outline\" onClick={this.props.onCancel}>\r\n            <FormattedMessage id=\"button_ok\" defaultMessage=\"OK\" description=\"Button [OK]\" />\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n};\r\n","// In-place text editor. Shows text with an icon which toggles it into an input field.\r\nimport React from 'react';\r\n\r\nimport VisiblePassword from './visible-password.jsx';\r\n\r\nexport default class InPlaceEdit extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.selfRef = React.createRef();\r\n\r\n    this.state = {\r\n      active: props.active,\r\n      initialValue: props.value || '',\r\n      value: props.value || '',\r\n      valid: true\r\n    };\r\n\r\n    this.handeTextChange = this.handeTextChange.bind(this);\r\n    this.handleKeyDown = this.handleKeyDown.bind(this);\r\n    this.handleStartEditing = this.handleStartEditing.bind(this);\r\n    this.handleEditingFinished = this.handleEditingFinished.bind(this);\r\n    this.handlePasswordFinished = this.handlePasswordFinished.bind(this);\r\n  }\r\n\r\n  componentDidUpdate(prevProps, prevState) {\r\n    // If text has changed while in read mode, update text and discard changes.\r\n    // Ignore update if in edit mode.\r\n    const newValue = this.props.value || '';\r\n    if (prevState.initialValue != newValue && !prevState.active) {\r\n      this.setState({\r\n        initialValue: newValue,\r\n        value: newValue\r\n      });\r\n    }\r\n  }\r\n\r\n  handeTextChange(e) {\r\n    this.setState({value: e.target.value || ''});\r\n    if (this.props.validator) {\r\n      Promise.resolve(this.props.validator(e.target.value))\r\n        .then(valid => {\r\n          this.setState({valid: valid});\r\n        })\r\n        .catch(err => {\r\n          // If it's interrupted, then the err is undefined. Ignore it.\r\n          if (err) {\r\n            this.setState({valid: false});\r\n          }\r\n        });\r\n    }\r\n  }\r\n\r\n  handleKeyDown(e) {\r\n    if (e.keyCode === 27) {\r\n      // Escape pressed\r\n      this.setState({value: this.props.value, active: false});\r\n    } else if (e.keyCode === 13) {\r\n      // Enter pressed\r\n      this.handleEditingFinished(e);\r\n    }\r\n  }\r\n\r\n   handleStartEditing() {\r\n    if (!this.props.readOnly) {\r\n      this.setState({active: true}, _ => {\r\n        if (this.selfRef.current) {\r\n          this.selfRef.current.focus();\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  handleEditingFinished(event) {\r\n    const value = this.state.value.trim();\r\n    if (this.props.required && (!event.target.checkValidity() || !value)) {\r\n      // Empty input\r\n      this.setState({value: this.props.value, active: false});\r\n      return;\r\n    }\r\n    this.setState({active: false});\r\n    if ((value || this.props.value) && (value !== this.props.value) && this.state.valid) {\r\n      this.props.onFinished(value);\r\n    }\r\n  }\r\n\r\n  handlePasswordFinished(value) {\r\n    this.setState({active: false});\r\n    if (value && (value !== this.props.value)) {\r\n      this.props.onFinished(value);\r\n    }\r\n  }\r\n\r\n  render() {\r\n    if (!this.state.active) {\r\n      let spanText = this.props.type == 'password' ? '••••••••' : this.state.value;\r\n      let spanClass = 'in-place-edit' + (this.props.readOnly ? ' disabled' : '');\r\n      if (!spanText) {\r\n        spanText = this.props.placeholder;\r\n        spanClass += ' placeholder';\r\n      }\r\n      if (!this.props.multiline || this.props.multiline == 1) {\r\n        spanClass += ' short';\r\n      }\r\n\r\n      return (<span className={spanClass} onClick={this.handleStartEditing}>\r\n        {this.props.iconLeft && <i className=\"material-icons light-gray\">{this.props.iconLeft}</i>}\r\n        <span>{spanText}</span>\r\n        {this.props.iconRight && <i className=\"material-icons light-gray\">{this.props.iconRight}</i>}\r\n      </span>);\r\n    }\r\n\r\n    let element;\r\n    const attr = {};\r\n    if (this.props.type == 'password') {\r\n      element = VisiblePassword;\r\n      attr.onFinished = this.handlePasswordFinished;\r\n    } else {\r\n      if (this.props.multiline > 1) {\r\n        element = 'textarea';\r\n        attr.rows = this.props.multiline;\r\n        attr.className = 'in-place-edit';\r\n      } else {\r\n        element = 'input';\r\n        attr.type = this.props.type || 'text';\r\n        attr.className = 'in-place-edit' + (this.props.iconLeft ? ' with-icon-left'\r\n          : this.props.iconRight ?  ' with-icon-right' : '');\r\n        if (this.props.maxLength) {\r\n          attr.maxLength=this.props.maxLength;\r\n        }\r\n      }\r\n      attr.value = this.state.value;\r\n      attr.className += this.state.valid ? '' : ' invalid';\r\n      attr.ref = this.selfRef;\r\n      attr.onChange = this.handeTextChange;\r\n      attr.onKeyDown = this.handleKeyDown;\r\n      attr.onBlur = this.handleEditingFinished;\r\n    }\r\n    attr.placeholder = this.props.placeholder;\r\n    attr.required = this.props.required ? 'required' : '';\r\n    attr.autoComplete = this.props.autoComplete;\r\n    attr.autoFocus = true;\r\n    if (this.props.spellCheck !== undefined) {\r\n      attr.spellCheck = this.props.spellCheck ? 'true' : 'false';\r\n    }\r\n\r\n    if (this.props.iconLeft || this.props.iconRight) {\r\n      return (\r\n        <>\r\n          {this.props.iconLeft && <i className=\"material-icons light-gray\">{this.props.iconLeft}</i>}\r\n          {React.createElement(element, attr, null)}\r\n          {this.props.iconRight && <i className=\"material-icons light-gray\">{this.props.iconRight}</i>}\r\n        </>\r\n      );\r\n    }\r\n    return React.createElement(element, attr, null);\r\n  }\r\n};\r\n","// TagManager: edit topic or user tags.\r\nimport React from 'react';\r\nimport { FormattedMessage } from 'react-intl';\r\n\r\nimport ChipInput from './chip-input.jsx';\r\n\r\nimport { Tinode } from 'tinode-sdk';\r\n\r\nimport { MAX_TAG_COUNT, MAX_TAG_LENGTH, MIN_TAG_LENGTH } from '../config.js';\r\nimport { arrayEqual } from '../lib/utils.js';\r\n\r\nexport default class TagManager extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      tags: this.props.tags || [],\r\n      alias: Tinode.tagByPrefix(this.props.tags, Tinode.TAG_ALIAS) || '',\r\n      tagInput: '',\r\n      activated: this.props.activated\r\n    };\r\n\r\n    this.handleTagInput = this.handleTagInput.bind(this);\r\n    this.handleAddTag = this.handleAddTag.bind(this);\r\n    this.handleRemoveTag = this.handleRemoveTag.bind(this);\r\n    this.handleSubmit = this.handleSubmit.bind(this);\r\n    this.handleCancel = this.handleCancel.bind(this);\r\n  }\r\n\r\n  static getDerivedStateFromProps(nextProps, prevState) {\r\n    const tags = nextProps.tags || [];\r\n    if (!arrayEqual(tags, prevState.tags) && !prevState.activated) {\r\n      return {\r\n        tags: tags || [],\r\n        alias: Tinode.tagByPrefix(tags, Tinode.TAG_ALIAS) || '',\r\n      };\r\n    }\r\n    return null;\r\n  }\r\n\r\n  handleTagInput(text) {\r\n    this.setState({tagInput: text});\r\n    if (text.length > 0) {\r\n      const last = text[text.length-1];\r\n      if (text[0] == '\"') {\r\n        // This is a quoted string.\r\n        if (text.length > 1 && last == '\"') {\r\n          this.handleAddTag(text.substring(1, text.length-1));\r\n        }\r\n      } else if (last == ',' || last == ' ' || last == ';' || last == '\"') {\r\n        // User entered ',', ' ' or ';'\r\n        this.handleAddTag(text.substring(0, text.length-1).trim());\r\n      }\r\n    }\r\n  }\r\n\r\n  handleAddTag(tag) {\r\n    const maxTagCount = this.props.tinode.getServerParam(Tinode.MAX_TAG_COUNT, MAX_TAG_COUNT);\r\n\r\n    if (tag.length > 0 && this.state.tags.length < maxTagCount) {\r\n      const tags = this.state.tags.slice(0);\r\n      tags.push(tag);\r\n\r\n      this.setState({tags: tags, tagInput: ''});\r\n      if (this.props.onTagsChanged) {\r\n        this.props.onTagsChanged(tags);\r\n      }\r\n      return tags;\r\n    }\r\n    return this.state.tags;\r\n  }\r\n\r\n  handleRemoveTag(tag, index) {\r\n    const tags = this.state.tags.slice(0);\r\n    tags.splice(index, 1);\r\n    this.setState({tags: tags});\r\n    if (this.props.onTagsChanged) {\r\n      this.props.onTagsChanged(tags);\r\n    }\r\n  }\r\n\r\n  handleSubmit() {\r\n    // Add unprocessed input to tags.\r\n    let tags = this.handleAddTag(this.state.tagInput.trim());\r\n    // Add back the alias (and overwrite one possibly added by hand).\r\n    tags = Tinode.setUniqueTag(tags, this.state.alias);\r\n    // Submit the updated list.\r\n    this.props.onSubmit(tags);\r\n    this.setState({activated: false, tags: this.props.tags || []});\r\n  }\r\n\r\n  handleCancel() {\r\n    this.setState({activated: false, tagInput: '', tags: this.props.tags || []});\r\n    if (this.props.onCancel) {\r\n      this.props.onCancel();\r\n    }\r\n  }\r\n\r\n  render() {\r\n    const minTagLength = this.props.tinode.getServerParam(Tinode.MIN_TAG_LENGTH, MIN_TAG_LENGTH);\r\n    const maxTagLength = this.props.tinode.getServerParam(Tinode.MAX_TAG_LENGTH, MAX_TAG_LENGTH);\r\n\r\n    let tags = [];\r\n    if (this.state.activated) {\r\n      this.state.tags.forEach(tag => {\r\n        if (tag != this.state.alias) {\r\n          tags.push({user: tag, invalid: (tag.length < minTagLength || tag.length > maxTagLength)});\r\n        }\r\n      });\r\n\r\n    } else {\r\n      this.state.tags.forEach(tag => {\r\n        if (tag != this.state.alias) {\r\n          tags.push(<span className=\"badge\" key={tags.length}>{tag}</span>);\r\n        }\r\n      });\r\n      if (tags.length == 0) {\r\n        tags = (\r\n          <i>\r\n            <FormattedMessage id=\"tags_not_found\" defaultMessage=\"No tags defined. Add some.\" description=\"\" />\r\n          </i>\r\n        );\r\n      }\r\n    }\r\n    return (\r\n      <div className=\"panel-form-column\">\r\n        <div className=\"panel-form-row\">\r\n          <label className=\"small\">{this.props.title}</label>\r\n        </div>\r\n        {this.state.activated ?\r\n        <div>\r\n          <FormattedMessage id=\"tags_editor_no_tags\" defaultMessage=\"Add some tags\"\r\n            description=\"Tag editor prompt when no tags are found.\">{\r\n            (add_tags_prompt) => <ChipInput\r\n              tinode={this.props.tinode}\r\n              chips={tags}\r\n              avatarDisabled={true}\r\n              prompt={add_tags_prompt}\r\n              tabIndex={this.props.tabIndex}\r\n              onEnter={this.handleAddTag}\r\n              onFocusLost={this.handleAddTag}\r\n              onCancel={this.handleCancel}\r\n              onChipRemoved={this.handleRemoveTag}\r\n              filterFunc={this.handleTagInput} />\r\n          }</FormattedMessage>\r\n          {this.props.onSubmit || this.props.onCancel ?\r\n            <div id=\"tag-manager-buttons\" className=\"dialog-buttons panel-form-row\">\r\n              <button className=\"outline\" onClick={this.handleCancel}>\r\n                <FormattedMessage id=\"button_cancel\" defaultMessage=\"Cancel\" description=\"Button [Cancel]\" />\r\n              </button>\r\n              <button className=\"primary\" onClick={this.handleSubmit}>\r\n                <FormattedMessage id=\"button_ok\" defaultMessage=\"OK\" description=\"Button [OK]\" />\r\n              </button>\r\n            </div>\r\n          : null}\r\n        </div>\r\n        :\r\n        <div className=\"quoted\">\r\n          <a href=\"#\" className=\"flat-button\" onClick={(e) => {e.preventDefault(); this.setState({activated: true});}}>\r\n            <i className=\"material-icons\">edit</i> &nbsp;<FormattedMessage id=\"title_manage_tags\" defaultMessage=\"Manage\"\r\n              description=\"Section title for the list of tags\" />\r\n          </a>\r\n          <>{tags}</>\r\n        </div>\r\n      }\r\n      </div>\r\n    );\r\n  }\r\n};\r\n","// Widget for editing topic description.\r\n\r\nimport React from 'react';\r\nimport { defineMessages, FormattedMessage, injectIntl } from 'react-intl';\r\n\r\nimport { Tinode } from 'tinode-sdk';\r\n\r\nimport AvatarCrop from './avatar-crop.jsx';\r\nimport AvatarUpload from './avatar-upload.jsx';\r\nimport InPlaceEdit from './in-place-edit.jsx';\r\nimport TagManager from './tag-manager.jsx';\r\n\r\nimport { AVATAR_SIZE, MAX_AVATAR_BYTES, MAX_EXTERN_ATTACHMENT_SIZE, MAX_TITLE_LENGTH,\r\n  MAX_TOPIC_DESCRIPTION_LENGTH } from '../config.js';\r\nimport { imageScaled, blobToBase64, makeImageUrl } from '../lib/blob-helpers.js';\r\nimport { arrayEqual, theCard } from '../lib/utils.js';\r\n\r\nconst messages = defineMessages({\r\n  alias_invalid: {\r\n    id: 'alias_invalid',\r\n    defaultMessage: '(invalid)',\r\n    description: 'Error message for invalid alias'\r\n  },\r\n  alias_already_taken: {\r\n    id: 'alias_already_taken',\r\n    defaultMessage: '(already taken)',\r\n    description: 'Error message for alias already taken'\r\n  },\r\n  self_topic_name: {\r\n    id: 'self_topic_name',\r\n    defaultMessage: 'Saved messages',\r\n    description: 'Name of self topic for UI'\r\n  },\r\n  self_topic_comment: {\r\n    id: 'self_topic_comment',\r\n    defaultMessage: 'Notes, messages, links, files saved for posterity',\r\n    description: 'Comment for self topic for UI'\r\n  }\r\n});\r\n\r\nconst ALIAS_AVAILABILITY_CHECK_DELAY = 1000; // milliseconds\r\n\r\nclass TopicDescEdit extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    const topic = this.props.tinode.getTopic(this.props.topic);\r\n    const acs = topic.getAccessMode();\r\n    const isSelf = Tinode.isSelfTopicName(this.props.topic);\r\n    this.state = {\r\n      isMe: Tinode.isMeTopicName(this.props.topic),\r\n      isSelf: isSelf,\r\n      owner: acs && acs.isOwner(),\r\n      fullName: topic.public ? topic.public.fn :\r\n        isSelf ? this.props.intl.formatMessage(messages.self_topic_name) : null,\r\n      private: topic.private ? topic.private.comment : null,\r\n      description: topic.public ? topic.public.note :\r\n        isSelf ? this.props.intl.formatMessage(messages.self_topic_comment) : null,\r\n      avatar: makeImageUrl(topic.public ? topic.public.photo : null),\r\n      tags: topic.tags() || [],\r\n      newAvatar: null,\r\n      newAvatarMime: null,\r\n      aliasError: ''\r\n    };\r\n\r\n    this.previousOnTags = null;\r\n    this.aliasCheckTimer = null;\r\n    this.aliasCheckPromise = null;\r\n\r\n    this.tnNewTags = this.tnNewTags.bind(this);\r\n    this.handleFullNameUpdate = this.handleFullNameUpdate.bind(this);\r\n    this.handleImageUpdated = this.handleImageUpdated.bind(this);\r\n    this.handleAvatarCropped = this.handleAvatarCropped.bind(this);\r\n    this.handleAvatarCropCancel = this.handleAvatarCropCancel.bind(this);\r\n    this.uploadAvatar = this.uploadAvatar.bind(this);\r\n    this.handlePrivateUpdate = this.handlePrivateUpdate.bind(this);\r\n    this.handleAliasUpdate = this.handleAliasUpdate.bind(this);\r\n    this.handleDescriptionUpdate = this.handleDescriptionUpdate.bind(this);\r\n    this.handleTagsUpdated = this.handleTagsUpdated.bind(this);\r\n    this.validateAlias = this.validateAlias.bind(this);\r\n    this.cancelValidator = this.cancelValidator.bind(this);\r\n  }\r\n\r\n  componentDidMount() {\r\n    const topic = this.props.tinode.getTopic(this.props.topic);\r\n    this.previousOnTags = topic.onTagsUpdated;\r\n    topic.onTagsUpdated = this.tnNewTags;\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    const topic = this.props.tinode.getTopic(this.props.topic);\r\n    topic.onTagsUpdated = this.previousOnTags;\r\n    this.cancelValidator();\r\n  }\r\n\r\n  tnNewTags(tags) {\r\n    this.setState({tags: tags});\r\n  }\r\n\r\n  handleFullNameUpdate(fn) {\r\n    fn = fn.trim().substring(0, MAX_TITLE_LENGTH);\r\n    if (fn && this.state.fullName !== fn) {\r\n      this.setState({fullName: fn});\r\n      this.props.onUpdateTopicDesc(this.props.topic, theCard(fn, null));\r\n    }\r\n  }\r\n\r\n  handlePrivateUpdate(comment) {\r\n    comment = comment.trim().substring(0, MAX_TITLE_LENGTH);\r\n    if (this.state.private !== comment) {\r\n      this.setState({private: comment});\r\n      this.props.onUpdateTopicDesc(this.props.topic, null, comment || Tinode.DEL_CHAR);\r\n    }\r\n  }\r\n\r\n  handleDescriptionUpdate(desc) {\r\n    desc = desc.trim().substring(0, MAX_TOPIC_DESCRIPTION_LENGTH);\r\n    if (desc) {\r\n      this.setState({description: desc});\r\n      this.props.onUpdateTopicDesc(this.props.topic, theCard(null, null, null, desc));\r\n    }\r\n  }\r\n\r\n  // AvatarUpload widget has changed the avatar: received a new file or deleted the avatar.\r\n  handleImageUpdated(mime, img) {\r\n    // This will show the AvatarCropView is img is not null.\r\n    this.setState({newAvatar: img, newAvatarMime: mime});\r\n    if (!img) {\r\n      // Deleting the avatar.\r\n      this.setState({avatar: null});\r\n      this.props.onUpdateTopicDesc(this.props.topic, theCard(null, Tinode.DEL_CHAR));\r\n    }\r\n  }\r\n\r\n  // AvatarCropView calls this method when the user has cropped the image.\r\n  handleAvatarCropped(mime, blob, width, height) {\r\n    const url = blob ? URL.createObjectURL(blob) : null;\r\n    this.setState({avatar: url, newAvatar: null, newAvatarMime: null});\r\n    if (blob) {\r\n      this.uploadAvatar(mime, blob, width, height);\r\n    }\r\n  }\r\n\r\n  // Utility method for converting cropped avatar blob to bytes for sending inband or\r\n  // for uploading it to the server out of band.\r\n  uploadAvatar(mime, blob, width, height) {\r\n    const readyToUpload = image => {\r\n      let {mime, blob} = image;\r\n      if (blob.size > MAX_AVATAR_BYTES) {\r\n        // Too large to send inband - uploading out of band and sending as a link.\r\n        const uploader = this.props.tinode.getLargeFileHelper();\r\n        uploader.upload(blob)\r\n          .then(url => this.props.onUpdateTopicDesc(this.props.topic, theCard(null, url)))\r\n          .catch(err => this.props.onError(err.message, 'err'));\r\n      } else {\r\n        // Convert blob to base64-encoded bits.\r\n        blobToBase64(blob)\r\n          .then(b64 => {\r\n            const du = makeImageUrl({data: b64.bits, type: mime});\r\n            this.setState({source: du});\r\n            this.props.onUpdateTopicDesc(this.props.topic, theCard(null, du));\r\n          });\r\n      }\r\n    };\r\n\r\n    if (width > AVATAR_SIZE || height > AVATAR_SIZE || width != height) {\r\n      // Avatar is not square or too large even after cropping. Shrink it and make square.\r\n      imageScaled(blob, AVATAR_SIZE, AVATAR_SIZE, MAX_EXTERN_ATTACHMENT_SIZE, true)\r\n        .then(scaled => readyToUpload(scaled))\r\n        .catch(err => this.props.onError(err.message, 'err'));\r\n    } else {\r\n      readyToUpload({mime: mime, blob: blob, width: width, height: height});\r\n    }\r\n  }\r\n\r\n  handleAvatarCropCancel() {\r\n    this.setState({newAvatar: null, newAvatarMime: null});\r\n  }\r\n\r\n  handleAliasUpdate(alias) {\r\n    alias = (alias || '').trim();\r\n    const tags = alias ?\r\n      Tinode.setUniqueTag(this.state.tags, Tinode.TAG_ALIAS + alias.toLowerCase()) :\r\n      Tinode.clearTagPrefix(this.state.tags, Tinode.TAG_ALIAS);\r\n    this.handleTagsUpdated(tags);\r\n  }\r\n\r\n  validateAlias(alias) {\r\n    // Reset pending delayed check.\r\n    this.cancelValidator();\r\n\r\n    alias = alias.trim();\r\n    if (!alias) {\r\n      this.setState({aliasError: ''});\r\n      return true;\r\n    }\r\n\r\n    const valid = Tinode.isValidTagValue(alias);\r\n    if (!valid) {\r\n      this.setState({aliasError: this.props.intl.formatMessage(messages.alias_invalid)});\r\n      return false;\r\n    }\r\n    this.setState({aliasError: ''});\r\n\r\n    // Setup a delayed check for alias availability.\r\n    const fnd = this.props.tinode.getFndTopic();\r\n    if (!fnd) {\r\n      // Unable to check alias availability.\r\n      this.setState({aliasError: ''});\r\n      return true;\r\n    }\r\n    this.aliasCheckPromise = {};\r\n    const validationPromise = new Promise((resolve, reject) => {\r\n      this.aliasCheckPromise.resolve = resolve;\r\n      this.aliasCheckPromise.reject = reject;\r\n    });\r\n    this.aliasCheckTimer = setTimeout(_ => {\r\n      this.aliasCheckTimer = null;\r\n      fnd.checkTagUniqueness(`${Tinode.TAG_ALIAS}${alias}`, this.props.topic)\r\n        .then(ok => {\r\n          this.aliasCheckPromise.resolve(ok)\r\n          this.setState({aliasError: ok ? '' : this.props.intl.formatMessage(messages.alias_already_taken)});\r\n        })\r\n        .catch(err => {\r\n          this.aliasCheckPromise.reject(err);\r\n          this.setState({aliasError: err.message});\r\n        });\r\n    }, ALIAS_AVAILABILITY_CHECK_DELAY);\r\n    return validationPromise;\r\n  }\r\n\r\n  cancelValidator() {\r\n    // Reset pending delayed check.\r\n    if (this.aliasCheckTimer) {\r\n      clearTimeout(this.aliasCheckTimer);\r\n      this.aliasCheckTimer = null;\r\n      this.aliasCheckPromise.reject(null);\r\n    }\r\n  }\r\n\r\n  handleTagsUpdated(tags) {\r\n    // Check if tags have actually changed.\r\n    if (arrayEqual(this.state.tags.slice(0), tags.slice(0))) {\r\n      return;\r\n    }\r\n    this.props.onUpdateTags(tags);\r\n  }\r\n\r\n  render() {\r\n    if (this.state.newAvatar) {\r\n      return (\r\n        <AvatarCrop\r\n          avatar={this.state.newAvatar}\r\n          mime={this.state.newAvatarMime}\r\n          onSubmit={this.handleAvatarCropped}\r\n          onCancel={this.handleAvatarCropCancel}\r\n          onError={this.props.onError} />\r\n      );\r\n    }\r\n\r\n    const editable = this.state.isMe || (this.state.owner && !this.state.isSelf);\r\n    let alias = this.state.tags && this.state.tags.find(t => t.startsWith('alias:'));\r\n    if (alias) {\r\n      // Remove 'alias:' prefix.\r\n      alias = alias.substring(6);\r\n    }\r\n\r\n    return (\r\n      <>\r\n      <div className=\"panel-form-column\">\r\n        <center>\r\n          <AvatarUpload\r\n            tinode={this.props.tinode}\r\n            avatar={this.state.avatar}\r\n            readOnly={!editable}\r\n            uid={this.props.topic}\r\n            title={this.state.fullName}\r\n            onImageUpdated={this.handleImageUpdated}\r\n            onError={this.props.onError} />\r\n        </center>\r\n        {this.state.isMe ?\r\n          <div className=\"group\">\r\n            <label className=\"small\">\r\n              <FormattedMessage id=\"label_your_name\" defaultMessage=\"Your name\"\r\n              description=\"Label for full name editing\" />\r\n            </label>\r\n            <div>\r\n              <FormattedMessage id=\"full_name_prompt\" defaultMessage=\"Full name, e.g. John Doe\"\r\n                description=\"Input placeholder for person's full name\">{\r\n                (full_name_placeholder) => <InPlaceEdit\r\n                  placeholder={full_name_placeholder}\r\n                  value={this.state.fullName}\r\n                  required={true}\r\n                  onFinished={this.handleFullNameUpdate} />\r\n              }</FormattedMessage>\r\n            </div>\r\n          </div>\r\n        :\r\n          <>\r\n            <div className=\"group\">\r\n              <div><label className=\"small\">\r\n                <FormattedMessage id=\"label_topic_name\" defaultMessage=\"Name\"\r\n                  description=\"Label for editing topic name\" />\r\n              </label></div>\r\n              <div>\r\n                <FormattedMessage id=\"topic_name_editing_placeholder\" defaultMessage=\"Freeform name of the group\"\r\n                  description=\"Prompt for entering topic name\">{\r\n                  (group_name_placeholder) => <InPlaceEdit\r\n                    placeholder={group_name_placeholder}\r\n                    readOnly={!editable}\r\n                    value={this.state.fullName}\r\n                    required={true}\r\n                    maxLength={32}\r\n                    onFinished={this.handleFullNameUpdate} />\r\n                }</FormattedMessage>\r\n              </div>\r\n            </div>\r\n            <div className=\"group\">\r\n              <div>\r\n                <label className=\"small\">\r\n                  <FormattedMessage id=\"label_private\" defaultMessage=\"Private comment\"\r\n                    description=\"Label for editing 'private'\" />\r\n                </label>\r\n              </div>\r\n              <div>\r\n                <FormattedMessage id=\"private_editing_placeholder\" defaultMessage=\"Visible to you only\"\r\n                  description=\"Placeholder for editing 'private'\">{\r\n                  (private_placeholder) => <InPlaceEdit\r\n                    placeholder={private_placeholder}\r\n                    value={this.state.private}\r\n                    onFinished={this.handlePrivateUpdate} />\r\n                }</FormattedMessage>\r\n              </div>\r\n            </div>\r\n          </>\r\n        }\r\n        {editable || alias ?\r\n          <div className=\"group\">\r\n            <div><label className={'small ' + (this.state.aliasError ? 'invalid' : '')}>\r\n              <FormattedMessage id=\"label_alias_edit\" defaultMessage=\"Alias\"\r\n                description=\"Label for editing user or topic alias\" /> {this.state.aliasError}\r\n            </label></div>\r\n            <div>\r\n              <FormattedMessage id=\"alias_editing_placeholder\"\r\n                defaultMessage=\"Alias (optional)\"\r\n                description=\"Placeholder for editing user or topic alias\">{\r\n                (private_placeholder) => <InPlaceEdit\r\n                  placeholder={private_placeholder}\r\n                  readOnly={!editable}\r\n                  value={alias}\r\n                  validator={this.validateAlias}\r\n                  iconLeft='alternate_email'\r\n                  maxLength={24}\r\n                  spellCheck={false}\r\n                  onFinished={this.handleAliasUpdate} />\r\n              }</FormattedMessage>\r\n            </div>\r\n          </div>\r\n          : null\r\n        }\r\n        {editable || this.state.description ?\r\n          <div className=\"group\">\r\n            <div><label className=\"small\">\r\n              <FormattedMessage id=\"label_description\" defaultMessage=\"Description\"\r\n                description=\"Label for editing topic description\" />\r\n            </label></div>\r\n            <div>\r\n              <FormattedMessage id=\"description_editing_placeholder\"\r\n                defaultMessage=\"Description (optional)\"\r\n                description=\"Placeholder for editing topic description\">{\r\n                (private_placeholder) => <InPlaceEdit\r\n                  placeholder={private_placeholder}\r\n                  readOnly={!editable}\r\n                  value={this.state.description}\r\n                  multiline={2}\r\n                  onFinished={this.handleDescriptionUpdate} />\r\n              }</FormattedMessage>\r\n            </div>\r\n          </div>\r\n          : null\r\n        }\r\n      </div>\r\n      {editable && !this.state.isMe ?\r\n        <>\r\n          <div className=\"hr\" />\r\n          <FormattedMessage id=\"title_tag_manager\" defaultMessage=\"Tags (search & discovery)\"\r\n            description=\"Section title for TagManager\">{\r\n              (title_tag_manager) => <TagManager\r\n                tinode={this.props.tinode}\r\n                title={title_tag_manager}\r\n                activated={false}\r\n                tags={this.state.tags}\r\n                onSubmit={this.handleTagsUpdated} />\r\n          }</FormattedMessage>\r\n        </>\r\n        : null\r\n      }\r\n      </>\r\n    );\r\n  }\r\n};\r\n\r\nexport default injectIntl(TopicDescEdit);\r\n","// View for editing topic parameters (including 'me' topic).\r\n\r\nimport React from 'react';\r\n\r\nimport TopicDescEdit from '../widgets/topic-desc-edit.jsx';\r\n\r\nimport { arrayEqual } from '../lib/utils.js';\r\n\r\nexport default class TopicCommonView extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    const topic = this.props.tinode.getTopic(this.props.topic);\r\n    const acs = topic.getAccessMode();\r\n    this.state = {\r\n      tags: []\r\n    };\r\n\r\n    this.previousTagsUpdated = undefined;\r\n\r\n    this.onTagsUpdated = this.onTagsUpdated.bind(this);\r\n    this.handleTagsUpdated = this.handleTagsUpdated.bind(this);\r\n  }\r\n\r\n  // No need to separately handle component mount.\r\n  componentDidUpdate(props) {\r\n    const topic = this.props.tinode.getTopic(props.topic);\r\n    if (!topic) {\r\n      return;\r\n    }\r\n\r\n    if (topic.onTagsUpdated != this.onTagsUpdated) {\r\n      if (topic.getType() == 'grp') {\r\n        this.previousTagsUpdated = topic.onTagsUpdated;\r\n        topic.onTagsUpdated = this.onTagsUpdated;\r\n      } else {\r\n        this.previousTagsUpdated = undefined;\r\n      }\r\n    }\r\n\r\n    if (this.state.topic != props.topic) {\r\n      this.setState({topic: props.topic});\r\n    }\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    const topic = this.props.tinode.getTopic(this.props.topic);\r\n    topic.onTagsUpdated = this.previousTagsUpdated;\r\n  }\r\n\r\n  // Server informs that the tags have been updated.\r\n  onTagsUpdated(tags) {\r\n    this.setState({tags: tags});\r\n\r\n    if (this.previousTagsUpdated && this.previousTagsUpdated != this.onTagsUpdated) {\r\n      this.previousTagsUpdated(tags);\r\n    }\r\n  }\r\n\r\n  // Request server to change tags.\r\n  handleTagsUpdated(tags) {\r\n    if (!arrayEqual(this.state.tags.slice(0), tags.slice(0))) {\r\n      this.props.onUpdateTagsRequest(this.props.topic, tags);\r\n    }\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div className=\"scrollable-panel\">\r\n        <TopicDescEdit\r\n          tinode={this.props.tinode}\r\n          topic={this.props.topic}\r\n          onUpdateTopicDesc={this.props.onUpdateTopicDesc}\r\n          onUpdateTags={this.handleTagsUpdated}\r\n          onError={this.props.onError} />\r\n      </div>\r\n    );\r\n  }\r\n};\r\n","// Edit account parameters.\r\nimport React from 'react';\r\nimport { FormattedMessage, defineMessages, injectIntl } from 'react-intl';\r\nimport {MAX_TITLE_LENGTH} from \"../config\";\r\nimport {theCard} from \"../lib/utils\";\r\n\r\nconst messages = defineMessages({\r\n  clear_messages: {\r\n    id: 'action_clear_messages',\r\n    defaultMessage: 'Clear Messages',\r\n    description: 'Flat button [Clear Messages] (soft-delete messages)'\r\n  },\r\n  clear_messages_warning: {\r\n    id: 'clear_messages_warning',\r\n    defaultMessage: 'Are you sure you want to clear all messages? It cannot be undone.',\r\n    description: 'Alert dialog warning when deleting all messages.'\r\n  },\r\n  delete_messages: {\r\n    id: 'action_delete_messages',\r\n    defaultMessage: 'Clear Messages for All',\r\n    description: 'Flat button [Clear for All] (hard-delete all messages)'\r\n  },\r\n  delete_messages_warning: {\r\n    id: 'delete_messages_warning',\r\n    defaultMessage: 'Are you sure you want to delete all messages for everyone? It cannot be undone.',\r\n    description: 'Alert dialog warning when hard-deleting all messages.'\r\n  },\r\n  topic_delete: {\r\n    id: 'topic_delete',\r\n    defaultMessage: 'Delete Conversation',\r\n    description: 'Alert title when deleting the topic.'\r\n  },\r\n  topic_delete_warning: {\r\n    id: 'topic_delete_warning',\r\n    defaultMessage: 'Are you sure you want to delete this conversation? It cannot be undone.',\r\n    description: 'Alert warning when deleting entire topic'\r\n  },\r\n  leave_chat: {\r\n    id: 'action_leave_chat',\r\n    defaultMessage: 'Leave Conversation',\r\n    description: 'Flat button [Leave Conversation]'\r\n  },\r\n  leave_chat_warning: {\r\n    id: 'leave_chat_warning',\r\n    defaultMessage: 'Are you sure you want to leave this conversation?',\r\n    description: 'Alert dialog warning when unsubscribing from a chat.'\r\n  },\r\n  block_contact: {\r\n    id: 'action_block_contact',\r\n    defaultMessage: \"Block Contact\",\r\n    description: \"Flat button [Block Contact]\"\r\n  },\r\n  block_contact_warning: {\r\n    id: 'block_contact_warning',\r\n    defaultMessage: 'Are you sure you want to block this contact?',\r\n    description: 'Alert dialog warning when blocking a contact.'\r\n  },\r\n  report_chat: {\r\n    id: 'action_report_chat',\r\n    defaultMessage: 'Report Conversation',\r\n    description: 'Flat button [Report Group]'\r\n  },\r\n  report_chat_warning: {\r\n    id: 'report_chat_warning',\r\n    defaultMessage: 'Are you sure you want to block and report this conversation?',\r\n    description: 'Alert dialog warning when reporting a conversation for abuse'\r\n  },\r\n  other_user: {\r\n    id: 'label_other_user',\r\n    defaultMessage: 'Other',\r\n    description: 'Label for the other user when the user is unnamed'\r\n  },\r\n});\r\n\r\nclass TopicSecurity extends React.PureComponent {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      expire: props.expirePeriod\r\n    };\r\n\r\n    this.handleDeleteTopic = this.handleDeleteTopic.bind(this);\r\n    this.handleDeleteMessages = this.handleDeleteMessages.bind(this);\r\n    this.handleLeave = this.handleLeave.bind(this);\r\n    this.handleBlock = this.handleBlock.bind(this);\r\n    this.handleReport = this.handleReport.bind(this);\r\n    this.handleChangeExpirePeriod = this.handleChangeExpirePeriod.bind(this);\r\n  }\r\n\r\n  handleDeleteTopic(e) {\r\n    e.preventDefault();\r\n    const {formatMessage} = this.props.intl;\r\n    this.props.onShowAlert(\r\n      formatMessage(messages.topic_delete), // title\r\n      formatMessage(messages.topic_delete_warning), // content\r\n      _ => this.props.onDeleteTopic(this.props.topic), // onConfirm\r\n      null, // \"OK\"\r\n      true, // Show Reject button\r\n      null  // \"Cancel\"\r\n    );\r\n  }\r\n\r\n  handleDeleteMessages(e) {\r\n    e.preventDefault();\r\n    const {formatMessage} = this.props.intl;\r\n    this.props.onShowAlert(\r\n      formatMessage(this.props.deleter ? messages.delete_messages : messages.clear_messages), // title\r\n      formatMessage(this.props.deleter ? messages.delete_messages_warning : messages.clear_messages_warning), // content\r\n      _ => this.props.onDeleteMessages(this.props.topic), // onConfirm\r\n      null, // \"OK\"\r\n      true, // Show Reject button\r\n      null  // \"Cancel\"\r\n    );\r\n  }\r\n\r\n  handleLeave(e) {\r\n    e.preventDefault();\r\n    const {formatMessage} = this.props.intl;\r\n    this.props.onShowAlert(\r\n      formatMessage(messages.leave_chat), // title\r\n      formatMessage(messages.leave_chat_warning), // content\r\n      _ => this.props.onLeaveTopic(this.props.topic), // onConfirm\r\n      null, // \"OK\"\r\n      true, // Show Reject button\r\n      null  // \"Cancel\"\r\n    );\r\n  }\r\n\r\n  handleBlock(e) {\r\n    e.preventDefault();\r\n    const {formatMessage} = this.props.intl;\r\n    this.props.onShowAlert(\r\n      formatMessage(messages.block_contact), // title\r\n      formatMessage(messages.block_contact_warning), // content\r\n      _ => this.props.onBlockTopic(this.props.topic), // onConfirm\r\n      null, // \"OK\"\r\n      true, // Show Reject button\r\n      null  // \"Cancel\"\r\n    );\r\n  }\r\n\r\n  handleReport(e) {\r\n    e.preventDefault();\r\n    const {formatMessage} = this.props.intl;\r\n    this.props.onShowAlert(\r\n      formatMessage(messages.report_chat), // title\r\n      formatMessage(messages.report_chat_warning), // content\r\n      (_ => { this.props.onReportTopic(this.props.topic); }), // onConfirm\r\n      null, // \"OK\"\r\n      true, // Show Reject button\r\n      null  // \"Cancel\"\r\n    );\r\n  }\r\n\r\n  handleChangeExpirePeriod(e) {\r\n    this.setState({expire: parseInt(e.target.value)})\r\n    this.props.onExpirePeriodChanged(parseInt(e.target.value));\r\n  }\r\n\r\n  render() {\r\n    const {formatMessage} = this.props.intl;\r\n    return (\r\n      <div className=\"scrollable-panel\">\r\n        <div className=\"panel-form-column\">\r\n          {!this.props.channel ?\r\n            <a href=\"#\" className=\"flat-button\" onClick={this.handleDeleteMessages}>\r\n              <i className=\"material-icons\">delete_outline</i> &nbsp;{\r\n              formatMessage(this.props.deleter ? messages.delete_messages : messages.clear_messages)\r\n            }\r\n            </a>\r\n          :\r\n          null\r\n          }\r\n          {this.props.owner ?\r\n            <>\r\n              <a href=\"#\" className=\"danger flat-button\" onClick={this.handleDeleteTopic}>\r\n                <i className=\"material-icons\">delete</i> &nbsp;{formatMessage(messages.topic_delete)}\r\n              </a>\r\n              <select value={this.state.expire} onChange={this.handleChangeExpirePeriod}>\r\n                {[...Array(24)].map((_, index) => (\r\n                    <option key={(index + 1) * 60 * 60} value={(index + 1) * 60 * 60}>{index + 1} 小时</option>\r\n                ))}\r\n              </select>\r\n            </>\r\n              :\r\n              <a href=\"#\" className=\"danger flat-button\" onClick={this.handleLeave}>\r\n              <i className=\"material-icons\">exit_to_app</i> &nbsp;{formatMessage(messages.leave_chat)}\r\n            </a>\r\n          }\r\n          {!this.props.owner ?\r\n              <a href=\"#\" className=\"danger flat-button\" onClick={this.handleReport}>\r\n                <i className=\"material-icons\">report</i> &nbsp;{formatMessage(messages.report_chat)}\r\n              </a>\r\n              :\r\n              null\r\n          }\r\n          {!this.props.groupTopic ?\r\n            <>\r\n              <a href=\"#\" className=\"danger flat-button\" onClick={this.handleBlock}>\r\n                <i className=\"material-icons\">block</i> &nbsp;{formatMessage(messages.block_contact)}\r\n              </a>\r\n              <select value={this.state.expire} onChange={this.handleChangeExpirePeriod}>\r\n                {[...Array(24)].map((_, index) => (\r\n                    <option key={(index + 1) * 60 * 60} value={(index + 1) * 60 * 60}>{index + 1} 小时</option>\r\n                ))}\r\n              </select>\r\n            </>\r\n              :\r\n              null\r\n          }\r\n        </div>\r\n        <div className=\"hr\" />\r\n        <div className=\"panel-form-column\">\r\n          {this.props.groupTopic ?\r\n            <>\r\n              <div className=\"group\">\r\n                <label>\r\n                  <FormattedMessage id=\"label_your_permissions\" defaultMessage=\"Your permissions:\"\r\n                    description=\"Label for current user permissions\" />\r\n                </label> <tt className=\"clickable\"\r\n                  onClick={(e) => {e.preventDefault(); this.props.onLaunchPermissionsEditor('want')}}>\r\n                  {this.props.access}\r\n                </tt>\r\n              </div>\r\n              {!this.props.channel ?\r\n                <div className=\"group\">\r\n                  <div>\r\n                    <label className=\"small\">\r\n                      <FormattedMessage id=\"label_default_access_mode\" defaultMessage=\"Default access mode:\"\r\n                      description=\"Label for default access mode\" />\r\n                    </label>\r\n                  </div>\r\n                  <div className=\"quoted\">\r\n                    <div>Auth: <tt className={this.props.owner ? 'clickable' : null}\r\n                      onClick={(e) => {\r\n                        e.preventDefault();\r\n                        if (this.props.owner) {\r\n                          this.props.onLaunchPermissionsEditor('auth');\r\n                        }\r\n                      }}>{this.props.auth}</tt>\r\n                    </div>\r\n                    <div>Anon: <tt className={this.props.owner ? 'clickable' : null}\r\n                      onClick={(e) => {\r\n                        e.preventDefault();\r\n                        if (this.props.owner) {\r\n                          this.props.onLaunchPermissionsEditor('anon');\r\n                        }\r\n                      }}>{this.props.anon}</tt>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              :\r\n                null\r\n              }\r\n            </>\r\n            :\r\n            <div className=\"group\">\r\n              <div>\r\n                <label className=\"small\">\r\n                  <FormattedMessage id=\"label_permissions\" defaultMessage=\"Permissions:\"\r\n                    description=\"Section title\" />\r\n                </label>\r\n              </div>\r\n              <div className=\"quoted\">\r\n                <div>\r\n                  <FormattedMessage id=\"label_you\" defaultMessage=\"You:\"\r\n                    description=\"Label for the current user\" /> <tt className=\"clickable\"\r\n                    onClick={(e) => {e.preventDefault(); this.props.onLaunchPermissionsEditor('want')}}>\r\n                    {this.props.access}\r\n                  </tt>\r\n                </div>\r\n                <div>{this.props.fullName ? this.props.fullName : formatMessage(messages.other_user)}:\r\n                  &nbsp;<tt className=\"clickable\"\r\n                    onClick={(e) => {e.preventDefault(); this.props.onLaunchPermissionsEditor('given')}}>\r\n                    {this.props.modeGiven2}\r\n                  </tt>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          }\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n};\r\n\r\nexport default injectIntl(TopicSecurity);\r\n","// InfoView: panel with topic/user info.\r\nimport React from 'react';\r\nimport { FormattedMessage, defineMessages, injectIntl } from 'react-intl';\r\n\r\nimport { AccessMode, Tinode } from 'tinode-sdk';\r\n\r\nimport AvatarUpload from '../widgets/avatar-upload.jsx';\r\nimport BadgeList from '../widgets/badge-list.jsx';\r\nimport CheckBox from '../widgets/checkbox.jsx';\r\nimport ContactList from '../widgets/contact-list.jsx';\r\nimport ErrorPanel from '../widgets/error-panel.jsx';\r\nimport GroupManager from '../widgets/group-manager.jsx';\r\nimport MenuCancel from '../widgets/menu-cancel.jsx';\r\nimport PermissionsEditor from '../widgets/permissions-editor.jsx';\r\nimport ShowQRCode from '../widgets/show-qrcode.jsx';\r\nimport TopicCommonView from './topic-common-view.jsx';\r\nimport TopicSecurity from '../widgets/topic-security.jsx';\r\n\r\nimport { MAX_TITLE_LENGTH, MAX_TOPIC_DESCRIPTION_LENGTH,\r\n  NO_ACCESS_MODE, TOAST_DURATION } from '../config.js';\r\n\r\nimport { makeImageUrl } from '../lib/blob-helpers.js';\r\nimport { theCard, clipStr } from '../lib/utils.js';\r\n\r\nconst messages = defineMessages({\r\n  info: {\r\n    id: 'panel_title_info',\r\n    description: 'Title for InfoView',\r\n    defaultMessage: 'Info'\r\n  },\r\n  general: {\r\n    id: 'panel_title_general',\r\n    description: 'Title for TopicCommon.',\r\n    defaultMessage: 'General'\r\n  },\r\n  security: {\r\n    id: 'panel_title_security',\r\n    description: 'Title for TopicSecirity and AccSecurity.',\r\n    defaultMessage: 'Security'\r\n  },\r\n  members: {\r\n    id: 'panel_title_members',\r\n    description: 'Title for managing group members view.',\r\n    defaultMessage: 'Members'\r\n  },\r\n  crop: {\r\n    id: 'panel_title_crop',\r\n    description: 'Title for AvatarCropView.',\r\n    defaultMessage: 'Drag to Adjust'\r\n  },\r\n  perm_want: {\r\n    id: 'requested_permissions',\r\n    defaultMessage: 'Requested',\r\n    description: 'Title for permissions'\r\n  },\r\n  perm_given: {\r\n    id: 'granted_permissions',\r\n    defaultMessage: 'Granted',\r\n    description: 'Title for permissions'\r\n  },\r\n  perm_auth: {\r\n    id: 'permissions_authenticated',\r\n    defaultMessage: 'Authenticated',\r\n    description: 'Title for editing default authenticated permissions'\r\n  },\r\n  perm_anon: {\r\n    id: 'permissions_anonymous',\r\n    defaultMessage: 'Anonymous',\r\n    description: 'Title for editing default anonymous permissions'\r\n  },\r\n  perm_user: {\r\n    id: 'permissions_user',\r\n    defaultMessage: 'User\\'s Permissions',\r\n    description: 'Title for editing user\\'s permissions'\r\n  },\r\n  edit_permissions: {\r\n    id: 'menu_item_edit_permissions',\r\n    defaultMessage: 'Edit permissions',\r\n    description: 'Menu item [Edit permissions]'\r\n  },\r\n  qrcode: {\r\n    id: 'scan_qr_code',\r\n    defaultMessage: 'Scan QR Code',\r\n    description: 'Title for scanning QR code'\r\n  },\r\n  text_copied: {\r\n    id: 'text_copied',\r\n    defaultMessage: 'Copied to clipboard',\r\n    description: 'Notification that text has been copied to clipboard'\r\n  },\r\n  self_topic_name: {\r\n    id: 'self_topic_name',\r\n    defaultMessage: 'Saved messages',\r\n    description: 'Name of self topic for UI',\r\n  },\r\n  self_topic_comment: {\r\n    id: 'self_topic_comment',\r\n    defaultMessage: 'Notes, messages, links, files saved for posterity',\r\n    description: 'Comment for self topic for UI',\r\n  },\r\n});\r\n\r\nclass InfoView extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      topic: null,\r\n      owner: false,\r\n      admin: false,\r\n      sharer: false,\r\n      deleter: false,\r\n      muted: false,\r\n      address: null,\r\n      groupTopic: undefined,\r\n      isSelf: false,\r\n      channel: undefined,\r\n      fullName: undefined,\r\n      description: undefined,\r\n      avatar: null,\r\n      private: null,\r\n      selectedContact: null,\r\n      access: null,\r\n      modeGiven: null,\r\n      modeWant: null,\r\n      modeGiven2: null, // P2P topic, the other user mode given\r\n      modeWant2: null,  // P2P topic, the other user mode want\r\n      auth: null,\r\n      anon: null,\r\n      contactList: [],\r\n      trustedBadges: [],\r\n      previousMetaDesc: undefined,\r\n      previousSubsUpdated: undefined,\r\n      expirePeriod: 86400\r\n    };\r\n\r\n    this.resetSubs = this.resetSubs.bind(this);\r\n    this.resetDesc = this.resetDesc.bind(this);\r\n    this.resetTags = this.resetTags.bind(this);\r\n    this.onMetaDesc = this.onMetaDesc.bind(this);\r\n    this.onSubsUpdated = this.onSubsUpdated.bind(this);\r\n    this.handleImageChanged = this.handleImageChanged.bind(this);\r\n    this.handleMuted = this.handleMuted.bind(this);\r\n    this.handleUnarchive = this.handleUnarchive.bind(this);\r\n    this.handlePermissionsChanged = this.handlePermissionsChanged.bind(this);\r\n    this.handleLaunchPermissionsEditor = this.handleLaunchPermissionsEditor.bind(this);\r\n    this.handleShowQRCode = this.handleShowQRCode.bind(this);\r\n    this.handleCopyToClipboard = this.handleCopyToClipboard.bind(this);\r\n    this.handleShowAddMembers = this.handleShowAddMembers.bind(this);\r\n    this.handleMemberUpdateRequest = this.handleMemberUpdateRequest.bind(this);\r\n    this.handleMemberSelected = this.handleMemberSelected.bind(this);\r\n    this.handleContextMenu = this.handleContextMenu.bind(this);\r\n    this.handleBackNavigate = this.handleBackNavigate.bind(this);\r\n    this.handleExpirePeriodChanged = this.handleExpirePeriodChanged.bind(this);\r\n  }\r\n\r\n  // No need to separately handle component mount.\r\n  componentDidUpdate(props) {\r\n    const topic = this.props.tinode.getTopic(props.topic);\r\n    if (!topic) {\r\n      return;\r\n    }\r\n\r\n    if (this.onMetaDesc != topic.onMetaDesc) {\r\n      this.previousMetaDesc = topic.onMetaDesc;\r\n      topic.onMetaDesc = this.onMetaDesc;\r\n\r\n      this.previousSubsUpdated = topic.onSubsUpdated;\r\n      topic.onSubsUpdated = this.onSubsUpdated;\r\n    }\r\n\r\n    if (this.state.topic != props.topic) {\r\n      this.setState({topic: props.topic});\r\n      this.resetDesc(topic, props);\r\n      this.resetSubs(topic, props);\r\n      this.resetTags(topic);\r\n    }\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    const topic = this.props.tinode.getTopic(this.props.topic);\r\n    if (!topic) {\r\n      return;\r\n    }\r\n    this.setState({topic: null});\r\n    topic.onMetaDesc = this.previousMetaDesc;\r\n    topic.onSubsUpdated = this.previousSubsUpdated;\r\n  }\r\n\r\n  resetSubs(topic, props) {\r\n    const newState = {contactList: []};\r\n    if (topic.getType() == 'p2p') {\r\n      // Fetch the other party in the p2p conversation.\r\n      // Topic may not be ready yet, so check if user is found.\r\n      const user2 = topic.subscriber(props.topic);\r\n      if (user2) {\r\n        newState.modeGiven2 = user2.acs.getGiven();\r\n        newState.modeWant2 = user2.acs.getWant();\r\n      } else {\r\n        newState.modeGiven2 = NO_ACCESS_MODE;\r\n        newState.modeWant2 = NO_ACCESS_MODE;\r\n      }\r\n    } else {\r\n      topic.subscribers((sub) => {\r\n        newState.contactList.push(sub);\r\n      }, this);\r\n    }\r\n\r\n    this.setState(newState);\r\n  }\r\n\r\n  resetDesc(topic, props) {\r\n    const defacs = topic.getDefaultAccess() || {};\r\n    const acs = topic.getAccessMode();\r\n\r\n    const badges = [];\r\n    if (topic.trusted) {\r\n      for (const [key, val] of Object.entries(topic.trusted)) {\r\n        if (val) {\r\n          badges.push(key);\r\n        }\r\n      }\r\n    }\r\n\r\n    const isSelf = topic.isSelfType();\r\n\r\n    this.setState({\r\n      owner: acs && acs.isOwner(),\r\n      admin: acs && acs.isAdmin(),\r\n      sharer: acs && acs.isSharer(),\r\n      deleter: acs && acs.isDeleter(),\r\n      muted: acs && acs.isMuted(),\r\n\r\n      fullName: isSelf ?\r\n        props.intl.formatMessage(messages.self_topic_name) :\r\n        clipStr(topic.public && topic.public.fn, MAX_TITLE_LENGTH),\r\n      description: isSelf ?\r\n        props.intl.formatMessage(messages.self_topic_comment) :\r\n        clipStr(topic.public && topic.public.note, MAX_TOPIC_DESCRIPTION_LENGTH),\r\n      avatar: makeImageUrl(topic.public ? topic.public.photo : null),\r\n      trustedBadges: badges,\r\n      private: clipStr(topic.private && topic.private.comment, MAX_TITLE_LENGTH),\r\n      archived: topic.isArchived(),\r\n      address: topic.name,\r\n      groupTopic: topic.isGroupType(),\r\n      isSelf: isSelf,\r\n      channel: topic.isChannelType() || topic.chan,\r\n      access: acs ? acs.getMode() : undefined,\r\n      modeGiven: acs ? acs.getGiven() : undefined,\r\n      modeWant: acs ? acs.getWant() : undefined,\r\n      auth: defacs.auth,\r\n      anon: defacs.anon,\r\n      expirePeriod: topic.expirePeriod ? topic.expirePeriod: 86400\r\n    });\r\n  }\r\n\r\n  resetTags(topic) {\r\n    if (topic.getType() != 'grp') {\r\n      return;\r\n    }\r\n\r\n    const acs = topic.getAccessMode();\r\n    if (acs && acs.isOwner()) {\r\n      // Requesting tags: owner is editing the topic.\r\n      topic.getMeta(topic.startMetaQuery().withTags().build());\r\n    }\r\n  }\r\n\r\n  onMetaDesc(desc) {\r\n    const topic = this.props.tinode.getTopic(this.props.topic);\r\n    if (!topic) {\r\n      return;\r\n    }\r\n    this.resetDesc(topic, this.props);\r\n\r\n    if (this.previousMetaDesc && this.previousMetaDesc != this.onMetaDesc) {\r\n      this.previousMetaDesc(desc);\r\n    }\r\n  }\r\n\r\n  onSubsUpdated(subs) {\r\n    const topic = this.props.tinode.getTopic(this.props.topic);\r\n    if (!topic) {\r\n      return;\r\n    }\r\n    this.resetSubs(topic, this.props);\r\n\r\n    if (this.previousSubsUpdated && this.previousSubsUpdated != this.onSubsUpdated) {\r\n      this.previousSubsUpdated(subs);\r\n    }\r\n  }\r\n\r\n  handleImageChanged(mime, img) {\r\n    this.setState({avatar: img});\r\n    this.props.onTopicDescUpdate(this.props.topic, theCard(null, img || Tinode.DEL_CHAR), null);\r\n  }\r\n\r\n  handleMuted(ignored, checked) {\r\n    this.setState({muted: checked});\r\n    this.props.onChangePermissions(this.props.topic, checked ? '-P' : '+P');\r\n  }\r\n\r\n  handleUnarchive(ignored, ignored2) {\r\n    this.props.onTopicUnArchive(this.props.topic);\r\n  }\r\n\r\n  handlePermissionsChanged(which, perm) {\r\n    switch (which) {\r\n      case 'auth':\r\n        this.props.onTopicDescUpdateRequest(this.props.topic, null, null, {auth: perm});\r\n        break;\r\n      case 'anon':\r\n        this.props.onTopicDescUpdateRequest(this.props.topic, null, null, {anon: perm});\r\n        break;\r\n      case 'mode':\r\n      case 'want':\r\n        this.props.onChangePermissions(this.props.topic, perm);\r\n        break;\r\n      case 'given':\r\n        this.props.onChangePermissions(this.props.topic, perm, this.props.topic);\r\n        break;\r\n      case 'user':\r\n        this.props.onChangePermissions(this.props.topic, perm, this.state.userPermissionsEdited);\r\n        break;\r\n    }\r\n\r\n    this.handleBackNavigate();\r\n  }\r\n\r\n  handleLaunchPermissionsEditor(which, uid) {\r\n    const {formatMessage} = this.props.intl;\r\n    let toEdit, toCompare, toSkip, titleEdit, titleCompare, userTitle, userAvatar;\r\n    switch (which) {\r\n      case 'mode':\r\n        toEdit = this.state.access;\r\n        break;\r\n      case 'want':\r\n        toEdit = this.state.modeWant;\r\n        toCompare = this.state.modeGiven;\r\n        if (this.state.owner) {\r\n          // Don't allow owner to unset 'O' permission. All other permissions are OK.\r\n          toSkip = 'O';\r\n        } else {\r\n          // Allow accepting any of 'ASDO' permissions but don't allow asking for them.\r\n          toSkip = AccessMode.encode(AccessMode.diff('ASDO', this.state.modeGiven));\r\n          if (this.state.channel) {\r\n            // Channels are read-only.\r\n            toSkip += 'W';\r\n          }\r\n        }\r\n        titleEdit = formatMessage(messages.perm_want);\r\n        titleCompare = formatMessage(messages.perm_given);\r\n        break;\r\n      case 'given':\r\n        toEdit = this.state.modeGiven2;\r\n        toCompare = this.state.modeWant2;\r\n        toSkip = this.state.groupTopic ? (this.state.owner ? '' : 'O') : 'ASDO';\r\n        titleEdit = formatMessage(messages.perm_given);\r\n        titleCompare = formatMessage(messages.perm_want);\r\n        break;\r\n      case 'auth':\r\n        toEdit = this.state.auth;\r\n        toSkip = 'O';\r\n        break;\r\n      case 'anon':\r\n        toEdit = this.state.anon;\r\n        toSkip = 'O';\r\n        break;\r\n      case 'user': {\r\n        const topic = this.props.tinode.getTopic(this.props.topic);\r\n        if (!topic) {\r\n          return;\r\n        }\r\n        const user = topic.subscriber(uid);\r\n        if (!user || !user.acs) {\r\n          return;\r\n        }\r\n        toEdit = user.acs.getGiven();\r\n        toCompare = user.acs.getWant();\r\n        toSkip = this.state.owner ? '' : 'O';\r\n        titleEdit = formatMessage(messages.perm_given);\r\n        titleCompare = formatMessage(messages.perm_want);\r\n        if (user.public) {\r\n          userTitle = user.public.fn;\r\n          userAvatar = user.public.photo;\r\n        }\r\n        break;\r\n      }\r\n      default:\r\n        console.error(\"Unknown permission editing mode '\" + which + \"'\");\r\n        return;\r\n    }\r\n    this.setState({\r\n      userPermissionsEdited: uid,\r\n      userPermissionsTitle: userTitle,\r\n      userPermissionsAvatar: userAvatar,\r\n      editedPermissions: toEdit,\r\n      immutablePermissions: toCompare,\r\n      editedPermissionsTitle: titleEdit,\r\n      immutablePermissionsTitle: titleCompare,\r\n      editedPermissionsSkipped: toSkip,\r\n    });\r\n    this.props.onNavigate(`perm/${which}`);\r\n  }\r\n\r\n  handleShowQRCode(e) {\r\n    e.preventDefault();\r\n    this.props.onNavigate('qrcode');\r\n  }\r\n\r\n  handleCopyToClipboard(e, text) {\r\n    e.preventDefault();\r\n    navigator.clipboard.writeText(text).then(_ => {\r\n      this.setState({toast: this.props.intl.formatMessage(messages.text_copied)});\r\n      setTimeout(_ => { this.setState({toast: ''}); }, TOAST_DURATION);\r\n    });\r\n\r\n  }\r\n\r\n  handleShowAddMembers(e) {\r\n    e.preventDefault();\r\n    this.props.onInitFind();\r\n    this.props.onNavigate('members');\r\n  }\r\n\r\n  handleMemberUpdateRequest(members, added, removed) {\r\n    this.props.onMemberUpdateRequest(this.props.topic, added, removed);\r\n    this.props.onNavigate('info');\r\n  }\r\n\r\n  handleMemberSelected(uid) {\r\n    this.setState({selectedContact: uid});\r\n  }\r\n\r\n  handleBackNavigate() {\r\n    const args = (this.props.panel || 'info').split('/');\r\n    if (args[0] == 'info') {\r\n      this.props.onNavigate(null);\r\n    } else if (args[0] == 'perm') {\r\n      if (args[1] == 'user') {\r\n        this.props.onNavigate('info');\r\n      } else {\r\n        this.props.onNavigate('security');\r\n      }\r\n    } else {\r\n      this.props.onNavigate('info');\r\n    }\r\n  }\r\n\r\n  handleContextMenu(params) {\r\n    const {formatMessage} = this.props.intl;\r\n    const topic = this.props.tinode.getTopic(this.props.topic);\r\n    if (!topic) {\r\n      return;\r\n    }\r\n    const user = topic.subscriber(params.topicName);\r\n    if (!user || !user.acs) {\r\n      return;\r\n    }\r\n\r\n    const isMe = this.props.tinode.isMe(params.topicName);\r\n    const menuItems = [{\r\n      title: formatMessage(messages.edit_permissions),\r\n      handler: _ => this.handleLaunchPermissionsEditor(isMe ? 'want' : 'user', params.topicName)\r\n    }];\r\n    if (!isMe) {\r\n      menuItems.push('member_delete');\r\n    }\r\n    menuItems.push(user.acs.isMuted() ? 'member_unmute' : 'member_mute');\r\n    if (!isMe) {\r\n      menuItems.push(user.acs.isJoiner() ? 'member_block' : 'member_unblock');\r\n    }\r\n    this.props.showContextMenu({\r\n      topicName: this.props.topic,\r\n      x: params.x,\r\n      y: params.y,\r\n      user: params.topicName}, menuItems);\r\n  }\r\n\r\n  handleExpirePeriodChanged(expirePeriod) {\r\n    if (this.state.expirePeriod !== expirePeriod) {\r\n      this.setState({expirePeriod: expirePeriod});\r\n      // 通知服务端改了 过期时间\r\n      this.props.onExpirePeriodChanged(this.props.topic, expirePeriod);\r\n    }\r\n  }\r\n\r\n  render() {\r\n    const args = (this.props.panel || 'info').split('/');\r\n    const view = args[0];\r\n    args.shift();\r\n\r\n    const {formatMessage} = this.props.intl;\r\n    const panelTitle = formatMessage((view == 'perm' ? messages['perm_' + args[0]] : messages[view])\r\n      || messages['info']);\r\n\r\n    const topic = this.props.tinode.getTopic(this.state.topic);\r\n    const alias = topic && topic.alias();\r\n\r\n    return (\r\n      <div id=\"info-view\">\r\n        <div className={`toast${this.state.toast ? ' show' : ''}`}>{this.state.toast}</div>\r\n        <div className=\"caption-panel\" id=\"info-caption-panel\">\r\n          <div className=\"panel-title\" id=\"info-title\">{panelTitle}</div>\r\n          <div>\r\n            <MenuCancel onCancel={this.handleBackNavigate} />\r\n          </div>\r\n        </div>\r\n        {this.props.displayMobile ?\r\n          <ErrorPanel\r\n            level={this.props.errorLevel}\r\n            text={this.props.errorText}\r\n            onClearError={this.props.onError} /> : null}\r\n        {view == 'members' ?\r\n          <GroupManager\r\n            tinode={this.props.tinode}\r\n            members={this.state.contactList}\r\n            requiredMember={this.props.myUserId}\r\n            keepInitialMembers={!this.state.admin && !this.state.owner}\r\n            myUserId={this.props.myUserId}\r\n            contacts={this.props.searchableContacts}\r\n            onCancel={this.handleBackNavigate}\r\n            onSubmit={this.handleMemberUpdateRequest} />\r\n          :\r\n        view == 'perm' && args.length > 0 ?\r\n          <PermissionsEditor\r\n            tinode={this.props.tinode}\r\n            mode={this.state.editedPermissions}\r\n            compare={this.state.immutablePermissions}\r\n            skip={this.state.editedPermissionsSkipped}\r\n            modeTitle={this.state.editedPermissionsTitle}\r\n            compareTitle={this.state.immutablePermissionsTitle}\r\n            userTitle={this.state.userPermissionsTitle}\r\n            item={this.state.userPermissionsEdited}\r\n            userAvatar={this.state.userPermissionsAvatar}\r\n            onSubmit={(mode) => this.handlePermissionsChanged(args[0], mode)}\r\n            onCancel={this.handleBackNavigate} />\r\n          :\r\n        view == 'general' ?\r\n          <TopicCommonView\r\n            tinode={this.props.tinode}\r\n            topic={this.props.topic}\r\n            reqCredMethod={this.props.reqCredMethod}\r\n            onCredAdd={this.props.onCredAdd}\r\n            onUpdateTagsRequest={this.props.onTopicTagsUpdateRequest}\r\n            onCredConfirm={this.props.onCredConfirm}\r\n            onCredDelete={this.props.onCredDelete}\r\n            onUpdateTopicDesc={this.props.onTopicDescUpdateRequest}\r\n            onError={this.props.onError} />\r\n          :\r\n        view == 'security' ?\r\n          <TopicSecurity\r\n            topic={this.props.topic}\r\n            owner={this.state.owner}\r\n            admin={this.state.admin}\r\n            sharer={this.state.sharer}\r\n            deleter={this.state.deleter}\r\n            muted={this.state.muted}\r\n\r\n            groupTopic={this.state.groupTopic}\r\n            channel={this.state.channel}\r\n            access={this.state.access}\r\n            modeGiven={this.state.modeGiven}\r\n            modeWant={this.state.modeWant}\r\n            modeGiven2={this.state.modeGiven2}\r\n            modeWant2={this.state.modeWant2}\r\n            auth={this.state.auth}\r\n            anon={this.state.anon}\r\n            expirePeriod={this.state.expirePeriod}\r\n\r\n            onShowAlert={this.props.onShowAlert}\r\n            onDeleteMessages={this.props.onDeleteMessages}\r\n            onLeaveTopic={this.props.onLeaveTopic}\r\n            onBlockTopic={this.props.onBlockTopic}\r\n            onReportTopic={this.props.onReportTopic}\r\n            onLaunchPermissionsEditor={this.handleLaunchPermissionsEditor}\r\n            onExpirePeriodChanged={this.handleExpirePeriodChanged}\r\n            onNavigate={this.props.onNavigate} />\r\n          :\r\n        view == 'qrcode' ?\r\n          <ShowQRCode\r\n            uri={Tinode.URI_TOPIC_ID_PREFIX + this.props.topic}\r\n            onCancel={this.handleBackNavigate} />\r\n          :\r\n          <div id=\"info-view-content\" className=\"scrollable-panel\">\r\n            <div className=\"panel-form-column\">\r\n              {!this.state.isSelf ?\r\n                <a href=\"#\" className=\"flat-button float-right\" onClick={e => {e.preventDefault(); this.props.onNavigate('general');}}>\r\n                  <i className=\"material-icons\">edit</i>&nbsp;\r\n                  <FormattedMessage id=\"button_edit\" defaultMessage=\"Edit\" description=\"Call to action [Edit]\" />\r\n                </a>\r\n                : null\r\n              }\r\n              <center>\r\n                <AvatarUpload\r\n                  tinode={this.props.tinode}\r\n                  avatar={this.state.avatar}\r\n                  readOnly={true}\r\n                  uid={this.props.topic}\r\n                  title={this.state.fullName} />\r\n              </center>\r\n              <div className=\"group\">\r\n                <div><label className=\"small\">\r\n                  <FormattedMessage id=\"label_topic_name\" defaultMessage=\"Name\"\r\n                    description=\"Label for editing topic name\" />\r\n                </label></div>\r\n                <div className=\"large ellipsized\">{this.state.fullName}\r\n                {this.state.channel ? <img src=\"/img/channel.png\" className=\"channel\" alt=\"channel\" /> : null}</div>\r\n              </div>\r\n              {this.state.private ?\r\n                <div className=\"group\">\r\n                  <div><label className=\"small\">\r\n                    <FormattedMessage id=\"label_private\" defaultMessage=\"Private comment\"\r\n                      description=\"Label for editing 'private'\" />\r\n                  </label></div>\r\n                  <div className=\"large ellipsized\">{this.state.private}</div>\r\n                </div>\r\n                : null\r\n              }\r\n              {!this.state.isSelf ?\r\n                <>\r\n                <div className=\"panel-form-row\">\r\n                  <div>\r\n                    <label className=\"small\"><FormattedMessage id=\"label_user_id\" defaultMessage=\"ID:\"\r\n                      description=\"Label for user address (ID)\" /></label>&nbsp;\r\n                    <tt>{this.state.address}</tt>\r\n                  </div>\r\n                  <div style={{marginLeft: 'auto'}}>\r\n                    &nbsp;<a href=\"#\" onClick={e => {this.handleCopyToClipboard(e, this.state.address);}}>\r\n                      <i className=\"material-icons\">content_copy</i>\r\n                    </a>&nbsp;\r\n                    &nbsp;<a href=\"#\" onClick={this.handleShowQRCode}>\r\n                      <i className=\"material-icons\">qr_code</i>\r\n                    </a>&nbsp;\r\n                  </div>\r\n                </div>\r\n                {alias ?\r\n                  <div className=\"panel-form-row\">\r\n                    <div>\r\n                      <label className=\"small\"><FormattedMessage id=\"label_alias\" defaultMessage=\"Alias:\"\r\n                        description=\"Label for user or topic alias\" /></label>&nbsp;\r\n                      <tt>{alias}</tt>\r\n                    </div>\r\n                    <div style={{marginLeft: 'auto'}}>\r\n                      &nbsp;<a href=\"#\" onClick={e => {this.handleCopyToClipboard(e, alias);}}>\r\n                        <i className=\"material-icons\">content_copy</i>\r\n                      </a>&nbsp;\r\n                      &nbsp;<i className=\"material-icons\" style={{opacity: 0}}>qr_code</i>&nbsp;\r\n                    </div>\r\n                  </div>\r\n                : null}\r\n                </>\r\n                : null\r\n              }\r\n              {this.state.trustedBadges.length > 0 ?\r\n                <div className=\"group\">\r\n                  <BadgeList trustedBadges={this.state.trustedBadges} />\r\n                </div>\r\n                : null\r\n              }\r\n              {this.state.description ?\r\n                <div className=\"group\">\r\n                  <label className=\"small\">\r\n                    <FormattedMessage id=\"label_description\" defaultMessage=\"Description\"\r\n                      description=\"Label for editing topic description\" />\r\n                  </label>\r\n                  <div>{this.state.description}</div>\r\n                </div> : null}\r\n            </div>\r\n            {!this.state.isSelf ?\r\n              <><div className=\"hr\" />\r\n              <div className=\"panel-form-row\">\r\n                <label>\r\n                  <FormattedMessage id=\"label_muting_topic\" defaultMessage=\"Muted:\"\r\n                    description=\"Label for Muting/unmuting the topic\" />\r\n                </label>\r\n                <CheckBox name=\"P\" checked={this.state.muted} onChange={this.handleMuted} />\r\n              </div></>\r\n              : null\r\n            }\r\n            {this.state.archived ?\r\n              <div className=\"panel-form-row\">\r\n                <label>\r\n                  <FormattedMessage id=\"label_unarchive_topic\" defaultMessage=\"Archived:\"\r\n                    description=\"Label for unarchiving the topic\" />\r\n                </label>\r\n                <CheckBox name=\"archived\" checked={true} onChange={this.handleUnarchive} />\r\n              </div>\r\n              :\r\n              null\r\n            }\r\n            {!this.state.isSelf ?\r\n              <><div className=\"hr\" />\r\n              <div className=\"panel-form-row\">\r\n                <a href=\"#\" className=\"flat-button\" onClick={(e) => {e.preventDefault(); this.props.onNavigate('security');}}>\r\n                  <i className=\"material-icons\">security</i>&nbsp;<FormattedMessage id=\"button_security\"\r\n                    defaultMessage=\"Security\" description=\"Navigaton button for security panel.\" />\r\n                </a>\r\n              </div></>\r\n              : null\r\n            }\r\n            {this.state.groupTopic && this.state.sharer ?\r\n              <>\r\n                <div className=\"hr\" />\r\n                <div className=\"panel-form-row\">\r\n                  <label className=\"small\">\r\n                    <FormattedMessage id=\"label_group_members\" defaultMessage=\"Group members:\"\r\n                      description=\"Section title or label\" />\r\n                  </label>\r\n                </div>\r\n                <div className=\"panel-form-row\">\r\n                  <a href=\"#\" className=\"flat-button\" onClick={this.handleShowAddMembers}>\r\n                    <i className=\"material-icons\">person_add</i> &nbsp;<FormattedMessage id=\"button_add_members\"\r\n                      defaultMessage=\"Add members\" description=\"Flat button [Add members] (to topic)\" />\r\n                  </a>\r\n                </div>\r\n                <FormattedMessage id=\"group_has_no_members\" defaultMessage=\"No members\"\r\n                  description=\"Shown in place of group members\">{\r\n                  (no_members) => <ContactList\r\n                    tinode={this.props.tinode}\r\n                    contacts={this.state.contactList}\r\n                    myUserId={this.props.myUserId}\r\n                    emptyListMessage={no_members}\r\n                    topicSelected={this.state.selectedContact}\r\n                    showOnline={false}\r\n                    showUnread={false}\r\n                    showMode={true}\r\n                    noScroll={true}\r\n                    onTopicSelected={this.handleMemberSelected}\r\n                    showContextMenu={this.state.admin ? this.handleContextMenu : false}\r\n                  />\r\n                }</FormattedMessage>\r\n              </>\r\n              :\r\n              null\r\n            }\r\n          </div>\r\n        }\r\n      </div>\r\n    );\r\n  }\r\n};\r\n\r\nexport default injectIntl(InfoView);\r\n","// CallPanel displays call in progress: local and remote viewports and controls.\r\nimport React from 'react';\r\nimport { FormattedMessage, defineMessages, injectIntl } from 'react-intl';\r\n\r\nimport LetterTile from './letter-tile.jsx';\r\n\r\nimport { MAX_PEER_TITLE_LENGTH } from '../config.js';\r\nimport { CALL_STATE_OUTGOING_INITATED, CALL_STATE_IN_PROGRESS } from '../constants.js';\r\n\r\nimport { clipStr } from '../lib/utils.js'\r\n\r\nconst RING_SOUND = new Audio('audio/call-out.m4a');\r\nRING_SOUND.loop = true;\r\nconst CALL_ENDED_SOUND = new Audio('audio/call-end.m4a');\r\nCALL_ENDED_SOUND.loop = true;\r\nconst DIALING_SOUND = new Audio('audio/dialing.m4a');\r\n\r\nconst VIDEO_MUTED_EVENT = 'video:muted';\r\nconst VIDEO_UNMUTED_EVENT = 'video:unmuted';\r\n\r\nconst messages = defineMessages({\r\n  already_in_call: {\r\n    id: 'already_in_call',\r\n    defaultMessage: 'You already in an ongoing call!',\r\n    description: 'Error message when the user tried to accept a new call without finishing pervious one',\r\n  }\r\n});\r\n\r\nclass CallPanel extends React.PureComponent {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      localStream: undefined,\r\n      remoteStream: undefined,\r\n      pc: undefined,\r\n      dataChannel: undefined,\r\n\r\n      previousOnInfo: undefined,\r\n      waitingForPeer: false,\r\n      // If true, the client has received a remote SDP from the peer and has sent a local SDP to the peer.\r\n      callInitialSetupComplete: false,\r\n      audioOnly: props.callAudioOnly,\r\n      // Video mute/unmute in progress.\r\n      videoToggleInProgress: false,\r\n      // Indicates if the remote peer has informed us that their camera is on.\r\n      remoteVideoLive: false,\r\n    };\r\n\r\n    this.localStreamConstraints = {\r\n      audio: true,\r\n      video: !props.callAudioOnly\r\n    };\r\n    this.isOutgoingCall = props.callState == CALL_STATE_OUTGOING_INITATED;\r\n\r\n    this.localRef = React.createRef();\r\n    this.remoteRef = React.createRef();\r\n    // Cache for remote ice candidates until initial setup gets completed.\r\n    this.remoteIceCandidatesCache = [];\r\n\r\n    this.onInfo = this.onInfo.bind(this);\r\n    this.start = this.start.bind(this);\r\n    this.stop = this.stop.bind(this);\r\n\r\n    this.createPeerConnection = this.createPeerConnection.bind(this);\r\n    this.canSendOffer = this.canSendOffer.bind(this);\r\n    this.drainRemoteIceCandidatesCache = this.drainRemoteIceCandidatesCache.bind(this);\r\n\r\n    this.handleNegotiationNeededEvent = this.handleNegotiationNeededEvent.bind(this);\r\n    this.handleICECandidateEvent = this.handleICECandidateEvent.bind(this);\r\n    this.handleNewICECandidateMsg = this.handleNewICECandidateMsg.bind(this);\r\n    this.handleICEConnectionStateChangeEvent = this.handleICEConnectionStateChangeEvent.bind(this);\r\n    this.handleSignalingStateChangeEvent = this.handleSignalingStateChangeEvent.bind(this);\r\n    this.handleICEGatheringStateChangeEvent = this.handleICEGatheringStateChangeEvent.bind(this);\r\n    this.handleIceCandidateErrorEvent = this.handleIceCandidateErrorEvent.bind(this);\r\n    this.handleTrackEvent = this.handleTrackEvent.bind(this);\r\n\r\n    this.handleVideoOfferMsg = this.handleVideoOfferMsg.bind(this);\r\n    this.handleVideoAnswerMsg = this.handleVideoAnswerMsg.bind(this);\r\n    this.handleNewICECandidateMsg = this.handleNewICECandidateMsg.bind(this);\r\n\r\n    this.reportError = this.reportError.bind(this);\r\n    this.handleGetUserMediaError = this.handleGetUserMediaError.bind(this);\r\n\r\n    this.stopTracks = this.stopTracks.bind(this);\r\n    this.disconnectMedia = this.disconnectMedia.bind(this);\r\n\r\n    this.handleCloseClick = this.handleCloseClick.bind(this);\r\n    this.handleToggleCameraClick = this.handleToggleCameraClick.bind(this);\r\n    this.handleToggleMicClick = this.handleToggleMicClick.bind(this);\r\n\r\n    this.handleRemoteHangup = this.handleRemoteHangup.bind(this);\r\n    this.handleVideoCallAccepted = this.handleVideoCallAccepted.bind(this);\r\n\r\n    this.muteVideo = this.muteVideo.bind(this);\r\n    this.unmuteVideo = this.unmuteVideo.bind(this);\r\n    this.emptyVideoTrack = this.emptyVideoTrack.bind(this);\r\n\r\n    this.handleDataChannelEvent = this.handleDataChannelEvent.bind(this);\r\n    this.handleDataChannelError = this.handleDataChannelError.bind(this);\r\n    this.handleDataChannelMessage = this.handleDataChannelMessage.bind(this);\r\n    this.handleDataChannelOpen = this.handleDataChannelOpen.bind(this);\r\n    this.handleDataChannelClose = this.handleDataChannelClose.bind(this);\r\n  }\r\n\r\n  componentDidMount() {\r\n    const topic = this.props.tinode.getTopic(this.props.topic);\r\n    this.previousOnInfo = topic.onInfo;\r\n    topic.onInfo = this.onInfo;\r\n    if ((this.props.callState == CALL_STATE_OUTGOING_INITATED ||\r\n         this.props.callState == CALL_STATE_IN_PROGRESS) && this.localRef.current) {\r\n      this.start();\r\n    }\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    const topic = this.props.tinode.getTopic(this.props.topic);\r\n    topic.onInfo = this.previousOnInfo;\r\n    this.stop();\r\n  }\r\n\r\n  handleVideoCallAccepted(info) {\r\n    RING_SOUND.pause();\r\n    // Create peer connection with a data channel.\r\n    const pc = this.createPeerConnection(true);\r\n    const stream = this.state.localStream;\r\n    stream.getTracks().forEach(track => {\r\n      pc.addTrack(track, stream);\r\n\r\n      if (track.kind == 'video' && this.state.audioOnly) {\r\n        // This is an audio-only call.\r\n        // Remove dummy video track (placeholder remains).\r\n        track.enabled = false;\r\n        track.stop();\r\n        stream.removeTrack(track);\r\n      }\r\n    });\r\n  }\r\n\r\n  onInfo(info) {\r\n    if (info.what != 'call') {\r\n      return;\r\n    }\r\n    switch (info.event) {\r\n      case 'accept':\r\n        this.handleVideoCallAccepted(info);\r\n        break;\r\n      case 'answer':\r\n        this.handleVideoAnswerMsg(info);\r\n        break;\r\n      case 'ice-candidate':\r\n        this.handleNewICECandidateMsg(info);\r\n        break;\r\n      case 'hang-up':\r\n        this.handleRemoteHangup(info);\r\n        break;\r\n      case 'offer':\r\n        this.handleVideoOfferMsg(info);\r\n        break;\r\n      case 'ringing':\r\n        // play() throws if the user did not click the app first: https://goo.gl/xX8pDD.\r\n        RING_SOUND.play().catch(_ => {});\r\n        break;\r\n      default:\r\n        console.warn(\"Unknown call event\", info.event);\r\n        break;\r\n    }\r\n  }\r\n\r\n  // Creates an empty video track placeholder.\r\n  emptyVideoTrack() {\r\n    const width = 640;\r\n    const height = 480;\r\n    const canvas = Object.assign(document.createElement(\"canvas\"), {width, height});\r\n    canvas.getContext('2d').fillRect(0, 0, width, height);\r\n    const stream = canvas.captureStream(0);\r\n    return Object.assign(stream.getVideoTracks()[0], {enabled: false});\r\n  }\r\n\r\n  start() {\r\n    if (this.state.localStream) {\r\n      this.props.onError(this.props.intl.formatMessage(messages.already_in_call), 'info');\r\n      return;\r\n    }\r\n\r\n    if (this.props.callState == CALL_STATE_IN_PROGRESS) {\r\n      // We apparently just accepted the call.\r\n      this.props.onInvite(this.props.topic, this.props.seq, CALL_STATE_IN_PROGRESS, this.props.callAudioOnly);\r\n      return;\r\n    }\r\n\r\n    // This is an outgoing call waiting for the other side to pick up.\r\n    // Start local video.\r\n    navigator.mediaDevices.getUserMedia(this.localStreamConstraints)\r\n      .then(stream => {\r\n        if (!this.localStreamConstraints.video) {\r\n          // Starting an audio-only call. Create a dummy video track\r\n          // (so video can be enabled during the call if the user desires).\r\n          stream.addTrack(this.emptyVideoTrack());\r\n        }\r\n        this.setState({localStream: stream, waitingForPeer: true});\r\n        this.localRef.current.srcObject = stream;\r\n\r\n        DIALING_SOUND.play();\r\n\r\n        // Send call invitation.\r\n        this.props.onInvite(this.props.topic, this.props.seq, this.props.callState, this.props.callAudioOnly);\r\n      })\r\n      .catch(this.handleGetUserMediaError);\r\n  }\r\n\r\n  stop() {\r\n    CALL_ENDED_SOUND.pause();\r\n    CALL_ENDED_SOUND.currentTime = 0;\r\n    RING_SOUND.pause();\r\n    RING_SOUND.currentTime = 0;\r\n\r\n    this.stopTracks(this.state.localStream);\r\n    this.stopTracks(this.state.remoteStream);\r\n    this.disconnectMedia(this.localRef.current);\r\n    this.disconnectMedia(this.remoteRef.current);\r\n    if (this.state.pc) {\r\n      this.state.pc.ontrack = null;\r\n      this.state.pc.onremovetrack = null;\r\n      this.state.pc.onremovestream = null;\r\n      this.state.pc.onicecandidate = null;\r\n      this.state.pc.oniceconnectionstatechange = null;\r\n      this.state.pc.onsignalingstatechange = null;\r\n      this.state.pc.onicegatheringstatechange = null;\r\n      this.state.pc.onnegotiationneeded = null;\r\n      this.state.pc.onicecandidateerror = null;\r\n      this.state.pc.ondatachannel = null;\r\n\r\n      if (this.state.dataChannel && (this.state.dataChannel.readyState == 'open' || this.state.dataChannel.readyState == 'connecting')) {\r\n        this.state.dataChannel.close();\r\n      }\r\n      this.state.pc.close();\r\n    }\r\n    this.setState({pc: null, waitingForPeer: false});\r\n  }\r\n\r\n  disconnectMedia(el) {\r\n    if (!el) {\r\n      return;\r\n    }\r\n\r\n    el.srcObject = null;\r\n    el.src = '';\r\n  }\r\n\r\n  stopTracks(stream) {\r\n    if (!stream) {\r\n      return;\r\n    }\r\n\r\n    let tracks = stream.getTracks();\r\n    if (tracks) {\r\n      tracks.forEach(track => {\r\n        track.stop();\r\n        track.enabled = false;\r\n      });\r\n    }\r\n  }\r\n\r\n  handleDataChannelError(error) {\r\n    console.error('data channel error', error);\r\n  }\r\n\r\n  handleDataChannelMessage(event) {\r\n    switch (event.data) {\r\n    case VIDEO_MUTED_EVENT:\r\n      this.setState({remoteVideoLive: false}, _ => { this.remoteRef.current.srcObject = this.state.remoteStream; });\r\n      break;\r\n    case VIDEO_UNMUTED_EVENT:\r\n      this.setState({remoteVideoLive: true}, _ => { this.remoteRef.current.srcObject = this.state.remoteStream; });\r\n      break;\r\n    default:\r\n      break;\r\n    }\r\n  }\r\n\r\n  handleDataChannelOpen(event) {\r\n    if (!this.state.audioOnly) {\r\n      event.target.send(VIDEO_UNMUTED_EVENT);\r\n    }\r\n  }\r\n\r\n  handleDataChannelClose(event) {\r\n    console.log('close data channel:', event);\r\n  }\r\n\r\n  handleDataChannelEvent(event) {\r\n    console.log('data channel event:', event);\r\n    const channel = event.channel;\r\n    channel.onerror = this.handleDataChannelError;\r\n    channel.onmessage = this.handleDataChannelMessage;\r\n    channel.onopen = this.handleDataChannelOpen;\r\n    channel.onclose = this.handleDataChannelClose;\r\n    this.setState({dataChannel: channel});\r\n  }\r\n\r\n  createPeerConnection(withDataChannel) {\r\n    const iceServers = this.props.tinode.getServerParam('iceServers', null);\r\n    const pc = iceServers ? new RTCPeerConnection({iceServers: iceServers}) : new RTCPeerConnection();\r\n\r\n    pc.onicecandidate = this.handleICECandidateEvent;\r\n    pc.oniceconnectionstatechange = this.handleICEConnectionStateChangeEvent;\r\n    pc.onicegatheringstatechange = this.handleICEGatheringStateChangeEvent;\r\n    pc.onsignalingstatechange = this.handleSignalingStateChangeEvent;\r\n    pc.onnegotiationneeded = this.handleNegotiationNeededEvent;\r\n    pc.onicecandidateerror = this.handleIceCandidateErrorEvent;\r\n    pc.ontrack = this.handleTrackEvent;\r\n    pc.ondatachannel = this.handleDataChannelEvent;\r\n\r\n    let stateUpdate = {pc: pc, waitingForPeer: false};\r\n    if (withDataChannel) {\r\n      // Create data channel for exchanging events.\r\n      const channel = pc.createDataChannel(\"events\", {ordered: true});\r\n      channel.onerror = this.handleDataChannelError;\r\n      channel.onmessage = this.handleDataChannelMessage;\r\n      channel.onopen = this.handleDataChannelOpen;\r\n      channel.onclose = this.handleDataChannelClose;\r\n      stateUpdate.dataChannel = channel;\r\n    }\r\n    this.setState(stateUpdate);\r\n    return pc;\r\n  }\r\n\r\n  handleVideoAnswerMsg(info) {\r\n    // Configure the remote description, which is the SDP payload\r\n    // in 'info' message.\r\n    const desc = new RTCSessionDescription(info.payload);\r\n    this.state.pc.setRemoteDescription(desc)\r\n      .then(_ => {\r\n        this.setState({ callInitialSetupComplete: true }, _ => this.drainRemoteIceCandidatesCache());\r\n      })\r\n      .catch(err => this.reportError(err));\r\n  }\r\n\r\n  reportError(err) {\r\n    this.props.onError(err.message, 'err');\r\n  }\r\n\r\n  canSendOffer() {\r\n    return this.isOutgoingCall || this.state.callInitialSetupComplete;\r\n  }\r\n\r\n  handleNegotiationNeededEvent(event) {\r\n    const pc = event.target;\r\n    if (!this.canSendOffer()) {\r\n      return;\r\n    }\r\n    pc.createOffer().then(offer => {\r\n      return pc.setLocalDescription(offer);\r\n    })\r\n    .then(_ => {\r\n      this.props.onSendOffer(this.props.topic, this.props.seq, pc.localDescription.toJSON());\r\n    })\r\n    .catch(err => this.reportError(err));\r\n  }\r\n\r\n  handleIceCandidateErrorEvent(event) {\r\n    console.warn(\"ICE candidate error:\", event);\r\n  }\r\n\r\n  handleICECandidateEvent(event) {\r\n    if (event.candidate) {\r\n      this.props.onIceCandidate(this.props.topic, this.props.seq, event.candidate.toJSON());\r\n    }\r\n  }\r\n\r\n  handleNewICECandidateMsg(info) {\r\n    const candidate = new RTCIceCandidate(info.payload);\r\n    if (this.state.callInitialSetupComplete) {\r\n      this.state.pc.addIceCandidate(candidate)\r\n        .catch(err => {\r\n          if (candidate.candidate) {\r\n            this.reportError(err);\r\n          }\r\n          console.warn(\"Error adding new ice candidate\", candidate, err);\r\n        });\r\n    } else {\r\n      this.remoteIceCandidatesCache.push(candidate);\r\n    }\r\n  }\r\n\r\n  drainRemoteIceCandidatesCache() {\r\n    this.remoteIceCandidatesCache.forEach(candidate => {\r\n      this.state.pc.addIceCandidate(candidate)\r\n        .catch(err => {\r\n          if (candidate.candidate) {\r\n            this.reportError(err);\r\n          }\r\n          console.warn(\"Error adding cached ice candidate\", candidate, err);\r\n        });\r\n    });\r\n    this.remoteIceCandidatesCache = [];\r\n  }\r\n\r\n  handleICEConnectionStateChangeEvent(event) {\r\n    switch (event.target.iceConnectionState) {\r\n      case 'closed':\r\n      case 'failed':\r\n        this.handleCloseClick();\r\n        break;\r\n    }\r\n  }\r\n\r\n  handleSignalingStateChangeEvent(event) {\r\n    if (event.target.signalingState == 'closed') {\r\n      this.handleCloseClick();\r\n    }\r\n  }\r\n\r\n  handleICEGatheringStateChangeEvent(event) {\r\n    // ICE gathering change state\r\n  }\r\n\r\n  handleTrackEvent(event) {\r\n    // Remote video becomes available.\r\n    this.remoteRef.current.srcObject = event.streams[0];\r\n    this.setState({remoteStream: event.streams[0]});\r\n  }\r\n\r\n  handleGetUserMediaError(e) {\r\n    console.error(\"Error opening camera and/or microphone\", e);\r\n    switch(e.name) {\r\n      case 'NotFoundError':\r\n        // Cannot start the call b/c no camera and/or microphone found.\r\n        this.reportError(e);\r\n        break;\r\n      case 'SecurityError':\r\n      case 'PermissionDeniedError':\r\n        // Do nothing; this is the same as the user canceling the call.\r\n        break;\r\n      default:\r\n        this.reportError(e);\r\n        break;\r\n    }\r\n\r\n    // Make sure we shut down our end of the RTCPeerConnection so we're\r\n    // ready to try again.\r\n    this.handleCloseClick();\r\n  }\r\n\r\n  handleVideoOfferMsg(info) {\r\n    let localStream = null;\r\n    // If needed, create peer connection.\r\n    // Not creating data channel since it should be created by the peer.\r\n    const pc = this.state.pc ? this.state.pc : this.createPeerConnection(false);\r\n    const desc = new RTCSessionDescription(info.payload);\r\n\r\n    pc.setRemoteDescription(desc).then(_ => {\r\n      return navigator.mediaDevices.getUserMedia(this.localStreamConstraints);\r\n    })\r\n    .then(stream => {\r\n      let dummyVideo;\r\n      if (!this.localStreamConstraints.video) {\r\n        // Starting an audio-only call. Create an empty video track so\r\n        // so the user can enable the video during the call.\r\n        dummyVideo = this.emptyVideoTrack();\r\n        stream.addTrack(dummyVideo);\r\n      }\r\n      localStream = stream;\r\n      this.localRef.current.srcObject = stream;\r\n      this.setState({localStream: stream});\r\n\r\n      localStream.getTracks().forEach(track => {\r\n        pc.addTrack(track, localStream);\r\n      });\r\n\r\n      if (dummyVideo) {\r\n        dummyVideo.enabled = false;\r\n        dummyVideo.stop();\r\n        stream.removeTrack(dummyVideo);\r\n      }\r\n    })\r\n    .then(_ => {\r\n      return pc.createAnswer();\r\n    })\r\n    .then(answer => {\r\n      return pc.setLocalDescription(answer);\r\n    })\r\n    .then(_ => {\r\n      this.props.onSendAnswer(this.props.topic, this.props.seq, pc.localDescription.toJSON());\r\n      this.setState({ callInitialSetupComplete: true }, _ => this.drainRemoteIceCandidatesCache());\r\n    })\r\n    .catch(this.handleGetUserMediaError);\r\n  }\r\n\r\n  // Call disconnected by remote.\r\n  handleRemoteHangup() {\r\n    if (!this.state.waitingForPeer) {\r\n      // This is live call, just hang up.\r\n      this.handleCloseClick();\r\n    } else {\r\n      // This is a call which is not yet connected.\r\n      // Stop pulse animation.\r\n      this.setState({waitingForPeer: false});\r\n      // Change sound and wait a bit before ending it.\r\n      RING_SOUND.pause();\r\n      RING_SOUND.currentTime = 0;\r\n      CALL_ENDED_SOUND.loop = true;\r\n      CALL_ENDED_SOUND.play().catch(_ => {});\r\n      setTimeout(_ => {\r\n        this.handleCloseClick();\r\n      }, 2000);\r\n    }\r\n  }\r\n\r\n  handleCloseClick() {\r\n    this.stop();\r\n    this.props.onHangup(this.props.topic, this.props.seq);\r\n  }\r\n\r\n  // Ends video track and turns off the camera.\r\n  muteVideo() {\r\n    if (!this.state.pc || !this.state.dataChannel) {\r\n      return;\r\n    }\r\n\r\n    const stream = this.state.localStream;\r\n    const t = stream.getVideoTracks()[0];\r\n    t.enabled = false;\r\n    t.stop();\r\n\r\n    stream.removeTrack(t);\r\n    this.state.dataChannel.send(VIDEO_MUTED_EVENT);\r\n    this.setState({videoToggleInProgress: false});\r\n  }\r\n\r\n  unmuteVideo() {\r\n    if (!this.state.pc || !this.state.dataChannel) {\r\n      return;\r\n    }\r\n    navigator.mediaDevices.getUserMedia({ video: true })\r\n      .then(stream => {\r\n        // Will extract video track from stream and throw stream away,\r\n        // and replace video track in the media sender.\r\n        this.localRef.current.srcObject = null;\r\n        const sender = this.state.pc.getSenders().find(s => s.track.kind == 'video');\r\n        const track = stream.getVideoTracks()[0];\r\n        // Remote track from new stream.\r\n        stream.removeTrack(track);\r\n        // Add this track to the existing local stream.\r\n        this.state.localStream.addTrack(track);\r\n        return sender.replaceTrack(track);\r\n      })\r\n      .then(_ => {\r\n        this.localRef.current.srcObject = this.state.localStream;\r\n        this.state.dataChannel.send(VIDEO_UNMUTED_EVENT);\r\n      })\r\n      .catch(err => this.handleGetUserMediaError(err))\r\n      .finally(_ => { this.setState({videoToggleInProgress: false}); }); // Make sure we redraw the mute/unmute icons (e.g. camera -> camera_off).\r\n  }\r\n\r\n  handleToggleCameraClick() {\r\n    if (this.state.videoToggleInProgress) {\r\n      // Toggle currently in progress.\r\n      return;\r\n    }\r\n    const tracks = this.state.localStream.getVideoTracks();\r\n    this.setState({videoToggleInProgress: true}, _ => {\r\n      if (tracks && tracks.length > 0 && tracks[0].enabled && tracks[0].readyState == 'live') {\r\n        this.muteVideo();\r\n      } else {\r\n        this.unmuteVideo();\r\n      }\r\n      this.setState({audioOnly: !this.state.audioOnly});\r\n    });\r\n  }\r\n\r\n  handleToggleMicClick() {\r\n    const stream = this.state.localStream;\r\n    const t = stream.getAudioTracks()[0];\r\n    t.enabled = !t.enabled;\r\n    // Make sure we redraw the mute/unmute icons (e.g. mic -> mic_off).\r\n    this.forceUpdate();\r\n  }\r\n\r\n  render() {\r\n    const audioTracks = this.state.localStream && this.state.localStream.getAudioTracks();\r\n    const videoTracks = !this.state.audioOnly && this.state.localStream && this.state.localStream.getVideoTracks();\r\n    const disabled = !this.state.pc || !this.state.dataChannel || !(audioTracks && audioTracks[0]);\r\n    const audioIcon = audioTracks && audioTracks[0] && audioTracks[0].enabled ? 'mic' : 'mic_off';\r\n    const videoIcon = videoTracks && videoTracks[0] && videoTracks[0].enabled && videoTracks[0].readyState == 'live' ? 'videocam' : 'videocam_off';\r\n    const peerTitle = clipStr(this.props.title, MAX_PEER_TITLE_LENGTH);\r\n    const pulseAnimation = this.state.waitingForPeer ? ' pulse' : '';\r\n\r\n    let remoteActive = false;\r\n    if (this.remoteRef.current && this.remoteRef.current.srcObject && this.state.remoteVideoLive) {\r\n      const rstream = this.remoteRef.current.srcObject;\r\n      if (rstream.getVideoTracks().length > 0) {\r\n        const t = rstream.getVideoTracks()[0];\r\n        remoteActive = t.enabled && t.readyState == 'live';\r\n      }\r\n    }\r\n\r\n    return (\r\n      <>\r\n        <div id=\"video-container\">\r\n          <div id=\"video-container-panel\">\r\n            <div className=\"call-party self\" disabled={this.state.audioOnly}>\r\n              <video ref={this.localRef} autoPlay muted playsInline />\r\n              <div className=\"caller-name inactive\">\r\n                <FormattedMessage id=\"calls_you_label\"\r\n                  defaultMessage=\"You\" description=\"Shown over the local video screen\" />\r\n              </div>\r\n            </div>\r\n            <div className=\"call-party peer\" disabled={!remoteActive}>\r\n              {remoteActive ?\r\n                <>\r\n                  <video ref={this.remoteRef} autoPlay playsInline />\r\n                  <div className=\"caller-name inactive\">{peerTitle}</div>\r\n                </> :\r\n                <>\r\n                  <audio ref={this.remoteRef} autoPlay />\r\n                  <div className={`caller-card${pulseAnimation}`}>\r\n                    <div className=\"avatar-box\">\r\n                      <LetterTile\r\n                        tinode={this.props.tinode}\r\n                        avatar={this.props.avatar}\r\n                        topic={this.props.topic}\r\n                        title={this.props.title} />\r\n                    </div>\r\n                    <div className=\"caller-name\">{peerTitle}</div>\r\n                  </div>\r\n                </>\r\n              }\r\n            </div>\r\n          </div>\r\n          <div className=\"controls\">\r\n            <button className=\"danger\" onClick={this.handleCloseClick}>\r\n              <i className=\"material-icons\">call_end</i>\r\n            </button>\r\n            <button className=\"secondary\" onClick={this.handleToggleCameraClick} disabled={disabled}>\r\n              <i className=\"material-icons\">{videoIcon}</i>\r\n            </button>\r\n            <button className=\"secondary\" onClick={this.handleToggleMicClick} disabled={disabled}>\r\n              <i className=\"material-icons\">{audioIcon}</i>\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </>\r\n    );\r\n  }\r\n};\r\n\r\nexport default injectIntl(CallPanel);\r\n","import React from 'react';\r\nimport { FormattedMessage } from 'react-intl';\r\n\r\nimport FileProgress from './file-progress.jsx';\r\nimport { bytesToHumanSize } from '../lib/strformat.js';\r\nimport { isUrlRelative, sanitizeUrl } from '../lib/utils.js';\r\n\r\nexport default class Attachment extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      downloader: null,\r\n      progress: 0\r\n    };\r\n\r\n    this.downloadFile = this.downloadFile.bind(this);\r\n    this.handleCancel = this.handleCancel.bind(this);\r\n  }\r\n\r\n  downloadFile(url, filename, mimetype) {\r\n    if (!url) {\r\n      this.props.onError(\"Invalid download URL '\" + url + \"'\");\r\n      return;\r\n    }\r\n\r\n    const downloader = this.props.tinode.getLargeFileHelper();\r\n    this.setState({downloader: downloader});\r\n    downloader.download(url, filename, mimetype,\r\n      loaded => this.setState({progress: loaded / this.props.size}),\r\n      err => this.props.onError(err, 'err')\r\n    )\r\n    .then(_ => this.setState({downloader: null, progress: 0}))\r\n    .catch(err => {\r\n      if (err) {\r\n        this.props.onError(\"Error downloading file: \" + err.message, 'err');\r\n      }\r\n      this.setState({downloader: null, progress: 0});\r\n    });\r\n  }\r\n\r\n  handleCancel() {\r\n    if (this.props.uploading) {\r\n      this.props.onCancelUpload();\r\n    } else if (this.state.downloader) {\r\n      this.state.downloader.cancel();\r\n    }\r\n  }\r\n\r\n  render() {\r\n    let filename = this.props.filename || 'file_attachment';\r\n    if (filename.length > 36) {\r\n      filename = filename.substr(0, 16) + '...' + filename.substr(-16);\r\n    }\r\n    let size = this.props.size > 0 ?\r\n      <span className=\"small gray\">({bytesToHumanSize(this.props.size)})</span> :\r\n      null;\r\n\r\n    // Detect if the download URL is relative or absolute.\r\n    // If the URL is relative use LargeFileHelper to attach authentication\r\n    // credentials to the request.\r\n    let url, helperFunc;\r\n    if (!this.props.uploading && !this.state.downloader && isUrlRelative(this.props.downloadUrl)) {\r\n      // Relative URL. Use download helper.\r\n      url = '#';\r\n      helperFunc = (e) => {\r\n        e.preventDefault();\r\n        this.downloadFile(this.props.downloadUrl, this.props.filename, this.props.mimetype);\r\n      };\r\n    } else {\r\n      url = sanitizeUrl(this.props.downloadUrl);\r\n      helperFunc = null;\r\n    }\r\n    const downloadWidget = <><i className=\"material-icons\">file_download</i> <FormattedMessage id=\"save_attachment\"\r\n      defaultMessage=\"save\" description=\"Call to save an attachment\" /></>;\r\n    return (\r\n      <div className=\"attachment\">\r\n        <div><i className=\"material-icons big gray\">insert_drive_file</i></div>\r\n        <div className=\"flex-column\">\r\n          <div>{filename} {size}</div>\r\n          {this.props.uploading || this.state.downloader ?\r\n            <FileProgress progress={this.props.uploading ? this.props.progress : this.state.progress}\r\n              onCancel={this.handleCancel} />\r\n            :\r\n            <div>{url ?\r\n              <a href={url} download={this.props.filename} onClick={helperFunc}>{downloadWidget}</a>\r\n              :\r\n              <span className=\"light-gray\">{downloadWidget}</span>\r\n            }</div>\r\n          }\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n};\r\n","// Received/read indicator.\r\nimport React from 'react';\r\nimport { defineMessages, injectIntl } from 'react-intl';\r\n\r\nimport { Tinode } from 'tinode-sdk';\r\n\r\nimport { deliveryMarker } from '../lib/utils.js';\r\n\r\nconst messages = defineMessages({\r\n  message_sending: {\r\n    id: 'message_sending',\r\n    defaultMessage: 'sending...',\r\n    description: 'Message being sent, in place of time stamp'\r\n  },\r\n  message_sending_failed: {\r\n    id: 'message_sending_failed',\r\n    defaultMessage: 'failed',\r\n    description: 'Failed to send message, in place of time stamp'\r\n  },\r\n  message_edited_marker: {\r\n    id: 'message_edited_marker',\r\n    defaultMessage: ', edited',\r\n    description: 'Marker indicating that the message was edited'\r\n  }\r\n});\r\n\r\nclass ReceivedMarker extends React.PureComponent {\r\n  render() {\r\n    const {formatMessage} = this.props.intl;\r\n    let timestamp;\r\n    if (this.props.received <= Tinode.MESSAGE_STATUS_SENDING) {\r\n      timestamp = formatMessage(messages.message_sending);\r\n    } else if (this.props.received == Tinode.MESSAGE_STATUS_FAILED ||\r\n        this.props.received == Tinode.MESSAGE_STATUS_FATAL) {\r\n      timestamp = formatMessage(messages.message_sending_failed);\r\n    } else {\r\n      timestamp = this.props.timestamp.toLocaleTimeString(this.props.intl.locale, { timeStyle: 'short' });\r\n    }\r\n\r\n    const icon = deliveryMarker(this.props.received);\r\n    const marker = icon ? <i className={'material-icons small ' + icon.color}>{icon.name}</i> : null;\r\n    const edited = this.props.edited ? formatMessage(messages.message_edited_marker) : null;\r\n\r\n    return (\r\n      <span className=\"timestamp\">\r\n        {timestamp}{edited}{'\\u00a0'}{marker}\r\n      </span>\r\n    );\r\n  }\r\n};\r\n\r\nexport default injectIntl(ReceivedMarker);\r\n","// Single chat message bubble, sent or received.\r\n\r\nimport React from 'react';\r\nimport { FormattedMessage, injectIntl } from 'react-intl';\r\nimport { Drafty, Tinode } from 'tinode-sdk';\r\n\r\nimport Attachment from './attachment.jsx';\r\nimport LetterTile from './letter-tile.jsx';\r\nimport ReceivedMarker from './received-marker.jsx'\r\n\r\nimport { fullFormatter } from '../lib/formatters.js';\r\nimport { sanitizeUrl } from '../lib/utils.js';\r\n\r\nclass BaseChatMessage extends React.PureComponent {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      progress: 0\r\n    };\r\n\r\n    if (props.uploader) {\r\n      props.uploader.onProgress = this.handleProgress.bind(this);\r\n    }\r\n\r\n    this.handleExpandImage = this.handleExpandImage.bind(this);\r\n    this.handlePlayVideo = this.handlePlayVideo.bind(this);\r\n    this.handleFormButtonClick = this.handleFormButtonClick.bind(this);\r\n    this.handleContextClick = this.handleContextClick.bind(this);\r\n    this.handleCancelUpload = this.handleCancelUpload.bind(this);\r\n    this.handleQuoteClick = this.handleQuoteClick.bind(this);\r\n\r\n    this.formatterContext = {\r\n      formatMessage: props.intl.formatMessage.bind(props.intl),\r\n      viewportWidth: props.viewportWidth,\r\n      authorizeURL: props.tinode.authorizeURL.bind(props.tinode),\r\n\r\n      onImagePreview: this.handleExpandImage,\r\n      onVideoPreview: this.handlePlayVideo,\r\n      onFormButtonClick: this.handleFormButtonClick,\r\n      onQuoteClick: this.handleQuoteClick\r\n    };\r\n  }\r\n\r\n  handleExpandImage(e) {\r\n    e.preventDefault();\r\n    this.props.onExpandMedia({\r\n      url: e.target.src,\r\n      filename: e.target.dataset.name,\r\n      width: e.target.dataset.width,\r\n      height: e.target.dataset.height,\r\n      size: e.target.dataset.size,\r\n      type: e.target.dataset.mime\r\n    });\r\n  }\r\n\r\n  handlePlayVideo(e) {\r\n    e.preventDefault();\r\n    this.props.onExpandMedia({\r\n      video: true,\r\n      url: e.target.dataset.src,\r\n      preview: e.target.src,\r\n      filename: e.target.dataset.name,\r\n      width: e.target.dataset.width,\r\n      height: e.target.dataset.height,\r\n      duration: e.target.dataset.duration,\r\n      size: e.target.dataset.size,\r\n      type: e.target.dataset.mime\r\n    });\r\n  }\r\n\r\n  handleFormButtonClick(e) {\r\n    e.preventDefault();\r\n    const data = {\r\n      seq: this.props.seq\r\n    };\r\n    data.resp = {};\r\n    if (e.target.dataset.name) {\r\n      data.resp[e.target.dataset.name] = e.target.dataset.val ? e.target.dataset.val :\r\n        e.target.dataset.val === undefined ? 1 : '' + e.target.dataset.val;\r\n    }\r\n    if (e.target.dataset.act == 'url') {\r\n      data.ref = sanitizeUrl(e.target.dataset.ref) || 'about:blank';\r\n    }\r\n    const text = e.target.dataset.title || 'unknown';\r\n    this.props.onFormResponse(e.target.dataset.act, text, data);\r\n  }\r\n\r\n  handleContextClick(e) {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    const menuItems = [];\r\n    if (this.props.received == Tinode.MESSAGE_STATUS_FAILED) {\r\n      menuItems.push('menu_item_send_retry');\r\n    }\r\n    if (this.props.received > Tinode.MESSAGE_STATUS_FATAL) {\r\n      if (this.props.userIsWriter) {\r\n        menuItems.push('menu_item_reply');\r\n        if (!this.props.response) {\r\n          let immutable = false;\r\n          Drafty.entities(this.props.content, (_0, _1, tp) => {\r\n            immutable = ['AU', 'EX', 'FM', 'IM', 'VC', 'VD'].includes(tp);\r\n            return immutable;\r\n          });\r\n          if (!immutable) {\r\n            Drafty.styles(this.props.content, tp => {\r\n              immutable = ['QQ'].includes(tp);\r\n              return immutable;\r\n            });\r\n          }\r\n          if (!immutable) {\r\n            menuItems.push('menu_item_edit');\r\n          }\r\n        }\r\n      }\r\n      if (this.props.userIsAdmin) {\r\n        menuItems.push(this.props.pinned ? 'menu_item_unpin' : 'menu_item_pin');\r\n      }\r\n    }\r\n    menuItems.push('menu_item_forward');\r\n\r\n    this.props.showContextMenu({\r\n      seq: this.props.seq,\r\n      replace: this.props.edited ? parseInt(this.props.edited.split(':')[1]) : 0,\r\n      content: this.props.content,\r\n      userFrom: this.props.userFrom,\r\n      userName: this.props.userName,\r\n      y: e.pageY,\r\n      x: e.pageX,\r\n      pickReply: this.props.pickReply,\r\n      editMessage: this.props.editMessage,\r\n      timestamp: this.props.timestamp,\r\n    }, menuItems);\r\n  }\r\n\r\n  handleProgress(ratio) {\r\n    this.setState({progress: ratio});\r\n  }\r\n\r\n  handleCancelUpload() {\r\n    this.props.onCancelUpload(this.props.seq, this.props.uploader);\r\n  }\r\n\r\n  handleQuoteClick(e) {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    const replyToSeq = this.props.replyToSeq;\r\n    if (replyToSeq) {\r\n      this.props.onQuoteClick(replyToSeq);\r\n    }\r\n  }\r\n\r\n  render() {\r\n    const sideClass = this.props.sequence + ' ' + (this.props.response ? 'left' : 'right');\r\n    const bubbleClass = (this.props.sequence == 'single' || this.props.sequence == 'last') ? 'bubble tip' : 'bubble';\r\n    const avatar = this.props.userAvatar || true;\r\n    let textSizeClass = 'message-content';\r\n    const fullDisplay = (this.props.isGroup && this.props.response &&\r\n      (this.props.sequence == 'single' || this.props.sequence == 'last'));\r\n\r\n    let content = this.props.content;\r\n    const attachments = [];\r\n    if (this.props.mimeType == Drafty.getContentType() && Drafty.isValid(content)) {\r\n      Drafty.attachments(content, (att, i) => {\r\n        if (Drafty.isFormResponseType(att.mime)) {\r\n          // Don't show json drafty form response objects as attachments.\r\n          // They are not meant for users.\r\n          return;\r\n        }\r\n        attachments.push(<Attachment\r\n          tinode={this.props.tinode}\r\n          downloadUrl={Drafty.getDownloadUrl(att)}\r\n          filename={att.name}\r\n          uploading={Drafty.isProcessing(att)}\r\n          mimetype={att.mime}\r\n          size={Drafty.getEntitySize(att)}\r\n          progress={this.state.progress}\r\n          onCancelUpload={this.handleCancelUpload}\r\n          onError={this.props.onError}\r\n          key={i} />);\r\n      }, this);\r\n      const tree = Drafty.format(content, fullFormatter, this.formatterContext);\r\n      content = React.createElement(React.Fragment, null, tree);\r\n    } else if (typeof content == 'string') {\r\n      // Make font bigger for emoji-only messages.\r\n      // Must use 'new RegExp(...)' because React does not like /{1-5}/.\r\n      if (new RegExp('^\\\\p{RGI_Emoji}{1,5}$', 'v').test(content || '')) {\r\n        // Content consists of 1-5 emoji characters. Count how many and use it to increase the font size.\r\n        textSizeClass += ' emoji-' + (content || '').match(/\\p{RGI_Emoji}/vg).length;\r\n      }\r\n    } else {\r\n      content = <><i className=\"material-icons gray\">warning_amber</i> <i className=\"gray\">\r\n        <FormattedMessage id=\"invalid_content\"\r\n          defaultMessage=\"invalid content\" description=\"Shown when the message is unreadable\" /></i></>\r\n    }\r\n\r\n    return (\r\n      <li ref={this.props.innerRef} className={sideClass}>\r\n        {this.props.isGroup && this.props.response ?\r\n          <div className=\"avatar-box\">\r\n            {fullDisplay ?\r\n              <LetterTile\r\n                tinode={this.props.tinode}\r\n                topic={this.props.userFrom}\r\n                title={this.props.userName}\r\n                avatar={avatar} /> :\r\n              null}\r\n          </div> :\r\n          null}\r\n        <div>\r\n          <div className={bubbleClass}>\r\n            <div className=\"content-meta\">\r\n              <div className={textSizeClass}>\r\n                {content}\r\n                {attachments}\r\n              </div>\r\n              {this.props.timestamp ?\r\n                <ReceivedMarker\r\n                  edited={this.props.edited}\r\n                  timestamp={this.props.timestamp}\r\n                  received={this.props.received} />\r\n                : null}\r\n            </div>\r\n            {this.props.showContextMenu ?\r\n              <span className=\"menuTrigger\">\r\n                <a href=\"#\" onClick={this.handleContextClick}>\r\n                  <i className=\"material-icons\">expand_more</i>\r\n                </a>\r\n              </span> : null\r\n            }\r\n          </div>\r\n          {fullDisplay ?\r\n            <div className=\"author\">\r\n              {this.props.userName ||\r\n                <i><FormattedMessage id=\"user_not_found\" defaultMessage=\"Not found\"\r\n                description=\"In place of a user's full name when the user is not found.\" /></i>\r\n              }\r\n            </div>\r\n            : null\r\n          }\r\n        </div>\r\n      </li>\r\n    );\r\n  }\r\n};\r\n\r\nconst IntlChatMessage = injectIntl(BaseChatMessage);\r\nconst ChatMessage = React.forwardRef((props, ref) => <IntlChatMessage innerRef = {ref} {...props} />);\r\n\r\nexport default ChatMessage;\r\n","// Send message form.\r\nimport React, { Suspense } from 'react';\r\nimport { FormattedMessage, defineMessages, injectIntl } from 'react-intl';\r\nimport { Drafty } from 'tinode-sdk';\r\n\r\n// Lazy-loading AudioRecorder because it's quite large due to\r\n// a dependency on webm-duration-fix.\r\nconst AudioRecorder = React.lazy(_ => import('./audio-recorder.jsx'));\r\n\r\nimport { KEYPRESS_DELAY } from '../config.js';\r\nimport { filePasted } from '../lib/blob-helpers.js';\r\nimport { replyFormatter } from '../lib/formatters.js';\r\n\r\nconst messages = defineMessages({\r\n  messaging_disabled: {\r\n    id: 'messaging_disabled_prompt',\r\n    defaultMessage: 'Messaging disabled',\r\n    description: 'Prompt in SendMessage in read-only topic'\r\n  },\r\n  type_new_message: {\r\n    id: 'new_message_prompt',\r\n    defaultMessage: 'New message',\r\n    description: 'Prompt in send message field'\r\n  },\r\n  add_image_caption: {\r\n    id: 'image_caption_prompt',\r\n    defaultMessage: 'Image caption',\r\n    description: 'Prompt in SendMessage for attached image'\r\n  },\r\n  file_attachment_too_large: {\r\n    id: 'file_attachment_too_large',\r\n    defaultMessage: 'The file size {size} exceeds the {limit} limit.',\r\n    description: 'Error message when attachment is too large'\r\n  },\r\n  cannot_initiate_upload: {\r\n    id: 'cannot_initiate_file_upload',\r\n    defaultMessage: 'Cannot initiate file upload.',\r\n    description: 'Generic error messagewhen attachment fails'\r\n  },\r\n  icon_title_record_voice: {\r\n    id: 'icon_title_record_voice',\r\n    defaultMessage: 'Record voice message',\r\n    description: 'Icon tool tip for recording a voice message'\r\n  },\r\n  icon_title_attach_file: {\r\n    id: 'icon_title_attach_file',\r\n    defaultMessage: 'Attach file',\r\n    description: 'Icon tool tip for attaching a file'\r\n  },\r\n  icon_title_add_image: {\r\n    id: 'icon_title_add_image',\r\n    defaultMessage: 'Add image',\r\n    description: 'Icon tool tip for attaching an image'\r\n  },\r\n  icon_title_send: {\r\n    id: 'icon_title_send',\r\n    defaultMessage: 'Send message',\r\n    description: 'Icon tool tip for sending a message'\r\n  },\r\n});\r\n\r\nclass SendMessage extends React.PureComponent {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      quote: null,\r\n      message: '',\r\n      audioRec: false,\r\n      audioAvailable: !!(navigator.mediaDevices && navigator.mediaDevices.getUserMedia),\r\n    };\r\n\r\n    // Timestamp when the previous key press was sent to the server.\r\n    this.keypressTimestamp = 0;\r\n\r\n    this.handlePasteEvent = this.handlePasteEvent.bind(this);\r\n    this.handleAttachImage = this.handleAttachImage.bind(this);\r\n    this.handleAttachFile = this.handleAttachFile.bind(this);\r\n    this.handleAttachAudio = this.handleAttachAudio.bind(this);\r\n    this.handleSend = this.handleSend.bind(this);\r\n    this.handleKeyPress = this.handleKeyPress.bind(this);\r\n    this.handleMessageTyping = this.handleMessageTyping.bind(this);\r\n    this.handleDropAttach = this.handleDropAttach.bind(this);\r\n\r\n    this.handleQuoteClick = this.handleQuoteClick.bind(this);\r\n\r\n    this.formatReply = this.formatReply.bind(this);\r\n  }\r\n\r\n  componentDidMount() {\r\n    console.log('paste', this.messageEditArea);\r\n    if (this.messageEditArea) {\r\n      console.log('paste', this.handlePasteEvent);\r\n      this.messageEditArea.addEventListener('paste', this.handlePasteEvent, false);\r\n      console.log('paste', 'success');\r\n      if (window.getComputedStyle(this.messageEditArea).getPropertyValue('transition-property') == 'all') {\r\n        // Set focus on desktop, but not on mobile: focus causes soft keyboard to pop up.\r\n        this.messageEditArea.focus();\r\n      }\r\n    }\r\n\r\n    this.setState({quote: this.formatReply()});\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    if (this.messageEditArea) {\r\n      this.messageEditArea.removeEventListener('paste', this.handlePasteEvent, false);\r\n    }\r\n  }\r\n\r\n  componentDidUpdate(prevProps) {\r\n    if (this.messageEditArea) {\r\n      if (window.getComputedStyle(this.messageEditArea).getPropertyValue('transition-property') == 'all') {\r\n        // Set focus on desktop, but not on mobile: focus causes soft keyboard to pop up.\r\n        this.messageEditArea.focus();\r\n      }\r\n\r\n      // Adjust height of the message area for the amount of text.\r\n      this.messageEditArea.style.height = '0px';\r\n      this.messageEditArea.style.height = this.messageEditArea.scrollHeight + 'px';\r\n    }\r\n\r\n    if (prevProps.topicName != this.props.topicName) {\r\n      this.setState({message: this.props.initMessage || '', audioRec: false, quote: null});\r\n    } else if (prevProps.initMessage != this.props.initMessage) {\r\n      const msg = this.props.initMessage || '';\r\n      this.setState({message: msg}, _ => {\r\n        // If there is text, scroll to bottom and set caret to the end.\r\n        this.messageEditArea.scrollTop = this.messageEditArea.scrollHeight;\r\n        this.messageEditArea.setSelectionRange(msg.length, msg.length);\r\n      });\r\n    }\r\n    if (prevProps.reply != this.props.reply) {\r\n      this.setState({quote: this.formatReply()});\r\n    }\r\n  }\r\n\r\n  formatReply() {\r\n    return this.props.reply ?\r\n      Drafty.format(this.props.reply.content, replyFormatter, {\r\n        formatMessage: this.props.intl.formatMessage.bind(this.props.intl),\r\n        authorizeURL: this.props.tinode.authorizeURL.bind(this.props.tinode)\r\n      }) : null;\r\n  }\r\n\r\n  handlePasteEvent(e) {\r\n    console.log('paste', this.props.disabled);\r\n    if (this.props.disabled) {\r\n      return;\r\n    }\r\n    console.log('paste', 'no disabled');\r\n    // FIXME: handle large files too.\r\n    if (filePasted(e,\r\n      file => { this.props.onAttachImage(file); },\r\n      file => { this.props.onAttachFile(file); },\r\n      this.props.onError)) {\r\n\r\n      console.log('paste', e);\r\n      // If a file was pasted, don't paste base64 data into input field.\r\n      e.preventDefault();\r\n    }\r\n  }\r\n\r\n  handleAttachImage(e) {\r\n    if (e.target.files && e.target.files.length > 0) {\r\n      this.props.onAttachImage(e.target.files[0]);\r\n    }\r\n    // Clear the value so the same file can be uploaded again.\r\n    e.target.value = '';\r\n  }\r\n\r\n  handleAttachFile(e) {\r\n    if (e.target.files && e.target.files.length > 0) {\r\n      this.props.onAttachFile(e.target.files[0]);\r\n    }\r\n    // Clear the value so the same file can be uploaded again.\r\n    e.target.value = '';\r\n  }\r\n\r\n  handleDropAttach(files) {\r\n    if (files && files.length > 0) {\r\n      this.props.onAttachFile(files[0]);\r\n    }\r\n  }\r\n\r\n  handleAttachAudio(url, preview, duration) {\r\n    this.setState({audioRec: false});\r\n    this.props.onAttachAudio(url, preview, duration);\r\n  }\r\n\r\n  handleSend(e) {\r\n    e.preventDefault();\r\n    const message = this.state.message.trim();\r\n    if (message || this.props.acceptBlank || this.props.noInput) {\r\n      this.props.onSendMessage(message);\r\n      this.setState({message: ''});\r\n    }\r\n  }\r\n\r\n  /* Send on Enter key */\r\n  handleKeyPress(e) {\r\n    if (this.state.audioRec) {\r\n      // Ignore key presses while audio is being recorded.\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n      return;\r\n    }\r\n\r\n    // Remove this if you don't want Enter to trigger send\r\n    if (e.key === 'Enter') {\r\n      // Have Shift-Enter insert a line break instead\r\n      if (!e.shiftKey) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n\r\n        this.handleSend(e);\r\n      }\r\n    }\r\n  }\r\n\r\n  handleMessageTyping(e) {\r\n    this.setState({message: e.target.value});\r\n    if (this.props.onKeyPress) {\r\n      const now = new Date().getTime();\r\n      if (now - this.keypressTimestamp > KEYPRESS_DELAY) {\r\n        this.props.onKeyPress();\r\n        this.keypressTimestamp = now;\r\n      }\r\n    }\r\n  }\r\n\r\n  handleQuoteClick(e) {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    if (this.props.reply && this.props.onQuoteClick) {\r\n      const replyToSeq = this.props.reply.seq;\r\n      this.props.onQuoteClick(replyToSeq);\r\n    }\r\n  }\r\n\r\n  render() {\r\n    const { formatMessage } = this.props.intl;\r\n    const prompt = this.props.disabled ?\r\n      formatMessage(messages.messaging_disabled) :\r\n      (this.props.messagePrompt ?\r\n        formatMessage(messages[this.props.messagePrompt]) :\r\n        formatMessage(messages.type_new_message));\r\n\r\n    const sendIcon = (this.props.reply && this.props.reply.editing) ?\r\n      'check_circle' : 'send';\r\n\r\n    const quote = this.state.quote ?\r\n      (<div id=\"reply-quote-preview\">\r\n        <div className=\"cancel\">\r\n          <a href=\"#\" onClick={e => {e.preventDefault(); this.props.onCancelReply();}}><i className=\"material-icons gray\">close</i></a>\r\n        </div>\r\n        {this.state.quote}\r\n      </div>) : null;\r\n    const audioEnabled = this.state.audioAvailable && this.props.onAttachAudio;\r\n    return (\r\n      <div id=\"send-message-wrapper\">\r\n        {!this.props.noInput ? quote : null}\r\n        <div id=\"send-message-panel\">\r\n          {!this.props.disabled ?\r\n            <>\r\n              {this.props.onAttachFile && !this.state.audioRec ?\r\n                <>\r\n                  <a href=\"#\" onClick={e => {e.preventDefault(); this.attachImage.click();}} title={formatMessage(messages.icon_title_add_image)}>\r\n                    <i className=\"material-icons secondary\">photo</i>\r\n                  </a>\r\n                  <a href=\"#\" onClick={e => {e.preventDefault(); this.attachFile.click();}} title={formatMessage(messages.icon_title_attach_file)}>\r\n                    <i className=\"material-icons secondary\">attach_file</i>\r\n                  </a>\r\n                </>\r\n                :\r\n                null}\r\n              {this.props.noInput ?\r\n                (quote || <div className=\"hr thin\" />) :\r\n                (this.state.audioRec ?\r\n                  (<Suspense fallback={<div><FormattedMessage id=\"loading_note\" defaultMessage=\"Loading...\"\r\n                  description=\"Message shown when component is loading\"/></div>}>\r\n                    <AudioRecorder\r\n                      onRecordingProgress={_ => this.props.onKeyPress(true)}\r\n                      onDeleted={_ => this.setState({audioRec: false})}\r\n                      onFinished={this.handleAttachAudio}/>\r\n                  </Suspense>) :\r\n                  <textarea id=\"send-message-input\" placeholder={prompt}\r\n                    value={this.state.message} onChange={this.handleMessageTyping}\r\n                    onKeyDown={this.handleKeyPress}\r\n                    ref={ref => {this.messageEditArea = ref;}} />)}\r\n              {this.state.message || !audioEnabled ?\r\n                <a href=\"#\" onClick={this.handleSend} title={formatMessage(messages.icon_title_send)}>\r\n                  <i className=\"material-icons\">{sendIcon}</i>\r\n                </a> :\r\n                !this.state.audioRec ?\r\n                  <a href=\"#\" onClick={e => {e.preventDefault(); this.setState({audioRec: true})}} title={formatMessage(messages.icon_title_record_voice)}>\r\n                    <i className=\"material-icons\">mic</i>\r\n                  </a> :\r\n                  null\r\n              }\r\n              <input type=\"file\" ref={ref => {this.attachFile = ref}}\r\n                onChange={this.handleAttachFile} style={{display: 'none'}} />\r\n              <input type=\"file\" ref={ref => {this.attachImage = ref}} accept=\"image/*, video/*\"\r\n                onChange={this.handleAttachImage} style={{display: 'none'}} />\r\n            </>\r\n            :\r\n            <div id=\"writing-disabled\">{prompt}</div>\r\n          }\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n};\r\n\r\nexport default injectIntl(SendMessage);\r\n","import React from 'react';\r\nimport { FormattedMessage } from 'react-intl';\r\nimport SendMessage from '../widgets/send-message.jsx';\r\n\r\nimport { bytesToHumanSize, shortenFileName } from '../lib/strformat.js';\r\n\r\n// Get material icon name from mime type.\r\nfunction iconFromMime(mime) {\r\n  // If more icons become available in material icons, add them to this mime-to-icon mapping.\r\n  const mimeToIcon = {default: 'insert_drive_file', image: 'image', text: 'description', video: 'theaters'};\r\n\r\n  return mimeToIcon[mime] || mimeToIcon[(mime || '').split('/')[0]] || mimeToIcon['default'];\r\n}\r\n\r\nexport default class DocPreview extends React.PureComponent {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.handleSendDoc = this.handleSendDoc.bind(this);\r\n    this.handleKeyDown = this.handleKeyDown.bind(this);\r\n  }\r\n\r\n  componentDidMount() {\r\n    document.addEventListener('keydown', this.handleKeyDown);\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    document.removeEventListener('keydown', this.handleKeyDown);\r\n  }\r\n\r\n  handleKeyDown(e) {\r\n    e.preventDefault();\r\n    if (e.key === 'Escape') {\r\n      this.props.onClose();\r\n    }\r\n  }\r\n\r\n  handleSendDoc(caption) {\r\n    this.props.onClose();\r\n    this.props.onSendMessage(this.props.content.file);\r\n  }\r\n\r\n  render() {\r\n    if (!this.props.content) {\r\n      return null;\r\n    }\r\n    return (\r\n      <div id=\"image-preview\">\r\n        <div id=\"image-preview-caption-panel\">\r\n          <span>{this.props.content.name}</span>\r\n          <a href=\"#\" onClick={(e) => {e.preventDefault(); this.props.onClose();}}><i className=\"material-icons gray\">close</i></a>\r\n        </div>\r\n        <div id=\"image-preview-container\">\r\n          <div className=\"doc-card\">\r\n            <i className=\"material-icons gray\">{iconFromMime(this.props.content.type)}</i>\r\n            <div><b><FormattedMessage id=\"label_file_name\" defaultMessage=\"File name:\"\r\n              description=\"Label for a file name\" /></b> {shortenFileName(this.props.content.name, 24) || '-'}</div>\r\n            <div><b><FormattedMessage id=\"label_content_type\" defaultMessage=\"Content type:\"\r\n              description=\"Label for file content type (mime)\" /></b> {this.props.content.type || 'application/octet-stream'}</div>\r\n            <div><b><FormattedMessage id=\"label_size\" defaultMessage=\"Size:\"\r\n              description=\"Label for file size\" /></b> {bytesToHumanSize(this.props.content.size)}</div>\r\n          </div>\r\n        </div>\r\n        <SendMessage\r\n          noInput={true}\r\n          tinode={this.props.tinode}\r\n          reply={this.props.reply}\r\n          onCancelReply={this.props.onCancelReply}\r\n          onSendMessage={this.handleSendDoc}\r\n          onError={this.props.onError} />\r\n      </div>\r\n    );\r\n  }\r\n};\r\n","// GroupSubs: a list of group subscribers currently online.\r\n// Show in the topic title bar\r\nimport React from 'react';\r\nimport { FormattedMessage } from 'react-intl';\r\n\r\nimport { MAX_ONLINE_IN_TOPIC } from '../config.js'\r\n\r\nimport LetterTile from './letter-tile.jsx';\r\nimport { makeImageUrl } from '../lib/blob-helpers.js';\r\n\r\nexport default class GroupSubs extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n  }\r\n\r\n  render() {\r\n    const usersOnline = [];\r\n    const totalCount = (this.props.subscribers || []).length;\r\n    const countToShow = Math.min(MAX_ONLINE_IN_TOPIC, totalCount);\r\n\r\n    (this.props.subscribers || []).some((sub) => {\r\n      usersOnline.push(\r\n        <div className=\"avatar-box\" key={sub.user}>\r\n          <LetterTile\r\n            tinode={this.props.tinode}\r\n            topic={sub.user}\r\n            avatar={makeImageUrl(sub.public ? sub.public.photo : null) || true}\r\n            title={sub.public ? sub.public.fn : null} />\r\n        </div>\r\n      );\r\n      return usersOnline.length == countToShow;\r\n    });\r\n    if (usersOnline.length == 0) {\r\n      return null;\r\n    }\r\n    return (\r\n      <div id=\"topic-users\">{usersOnline} {totalCount > countToShow ?\r\n        <span>\r\n          <FormattedMessage id=\"more_online_members\" defaultMessage=\"+{overflow} more\"\r\n              description=\"Shown in MessagesView title bar when the number of online subscribers exceeds MAX_ONLINE_IN_TOPIC\"\r\n              values={{ overflow: (totalCount - countToShow) }} />\r\n        </span> : null}\r\n      </div>\r\n    );\r\n  }\r\n};\r\n","import React from 'react';\r\nimport { FormattedMessage } from 'react-intl';\r\nimport SendMessage from './send-message.jsx';\r\n\r\nimport { REM_SIZE } from '../config.js';\r\nimport { fitImageSize } from '../lib/blob-helpers.js';\r\nimport { bytesToHumanSize, shortenFileName } from '../lib/strformat.js';\r\nimport { urlAsAttachment } from '../lib/utils.js';\r\n\r\nexport default class ImagePreview extends React.PureComponent {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      width: 0,\r\n      height: 0\r\n    };\r\n\r\n    this.handleSendImage = this.handleSendImage.bind(this);\r\n    this.handleKeyDown = this.handleKeyDown.bind(this);\r\n  }\r\n\r\n  componentDidMount() {\r\n    document.addEventListener('keydown', this.handleKeyDown);\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    document.removeEventListener('keydown', this.handleKeyDown);\r\n  }\r\n\r\n  handleKeyDown(e) {\r\n    if (this.props.onSendMessage) {\r\n      return;\r\n    }\r\n\r\n    e.preventDefault();\r\n    if (e.key === 'Escape') {\r\n      this.props.onClose();\r\n    }\r\n  }\r\n\r\n  assignWidth(node) {\r\n    if (node && !this.state.width) {\r\n      const bounds = node.getBoundingClientRect();\r\n      this.setState({\r\n        width: bounds.width | 0,\r\n        height: bounds.height | 0\r\n      });\r\n    }\r\n  }\r\n\r\n  handleSendImage(caption) {\r\n    this.props.onClose();\r\n    this.props.onSendMessage(caption, this.props.content.blob);\r\n  }\r\n\r\n  render() {\r\n    if (!this.props.content) {\r\n      return null;\r\n    }\r\n\r\n    const dim = fitImageSize(this.props.content.width, this.props.content.height,\r\n      this.state.width, this.state.height, false);\r\n    const size = dim ? { width: dim.dstWidth + 'px', height: dim.dstHeight + 'px' } :\r\n      ((this.props.content.width > this.props.content.height) ? {width: '100%'} : {height: '100%'});\r\n    size.maxWidth = '100%';\r\n    size.maxHeight = '100%';\r\n\r\n    // Average font aspect ratio is ~0.5; File name takes 1/3 of the viewport width.\r\n    const maxlength = Math.max(((this.state.width / REM_SIZE / 1.5) | 0) - 2, 12);\r\n    const fname = shortenFileName(this.props.content.filename, maxlength) || '-';\r\n\r\n    const width = this.props.content.width || '-';\r\n    const height = this.props.content.height || '-';\r\n\r\n    const download_url = urlAsAttachment(this.props.content.url);\r\n\r\n    return (\r\n      <div id=\"image-preview\">\r\n        <div id=\"image-preview-caption-panel\">\r\n          {this.props.onSendMessage ?\r\n            <span>{fname}</span>\r\n            :\r\n            <a href={download_url} download={this.props.content.filename}>\r\n              <i className=\"material-icons\">file_download</i> <FormattedMessage\r\n                id=\"download_action\" defaultMessage=\"download\" description=\"Call to action [download]\" />\r\n            </a>\r\n          }\r\n          <a href=\"#\" onClick={(e) => {e.preventDefault(); this.props.onClose();}}><i className=\"material-icons gray\">close</i></a>\r\n        </div>\r\n        <div id=\"image-preview-container\" ref={node => this.assignWidth(node)}>\r\n          <img src={this.props.content.url} style={size} className=\"image-preview\" alt={this.props.content.filename} />\r\n        </div>\r\n        {this.props.onSendMessage ?\r\n          <SendMessage\r\n            messagePrompt=\"add_image_caption\"\r\n            acceptBlank={true}\r\n            tinode={this.props.tinode}\r\n            reply={this.props.reply}\r\n            onCancelReply={this.props.onCancelReply}\r\n            onSendMessage={this.handleSendImage}\r\n            onError={this.props.onError} />\r\n          :\r\n          <div id=\"image-preview-footer\">\r\n            <div>\r\n              <div><b><FormattedMessage id=\"label_file_name\" defaultMessage=\"File name:\"\r\n                description=\"Label for a file name\" /></b></div>\r\n              <div><span title={this.props.content.filename}>{fname}</span></div>\r\n            </div>\r\n            <div>\r\n              <div><b><FormattedMessage id=\"label_content_type\" defaultMessage=\"Content type:\"\r\n                description=\"Label for file content type (mime)\" /></b></div>\r\n              <div>{this.props.content.type}</div>\r\n            </div>\r\n            <div>\r\n              <div><b><FormattedMessage id=\"label_size\" defaultMessage=\"Size:\"\r\n                description=\"Label for file size\" /></b></div>\r\n              <div>{width} &times; {height} px; {bytesToHumanSize(this.props.content.size)}</div>\r\n            </div>\r\n          </div>}\r\n      </div>\r\n    );\r\n  }\r\n};\r\n","// A single topic or user.\r\nimport React from 'react';\r\nimport { FormattedMessage } from 'react-intl';\r\n\r\nexport default class Invitation extends React.PureComponent {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.handleButtonAction = this.handleButtonAction.bind(this);\r\n  }\r\n\r\n  handleButtonAction(evt, data) {\r\n    evt.preventDefault();\r\n    this.props.onAction(data);\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div className=\"accept-invite-panel\">\r\n        <div className=\"title\">\r\n          <FormattedMessage id=\"chat_invitation\"\r\n            defaultMessage=\"You are invited to start a new chat. What would you like to do?\"\r\n            description=\"New chat invitation message: [Accept] [Ignore] [Block].\" />\r\n        </div>\r\n        <div className=\"footer\">\r\n          <button className=\"primary\" onClick={event => { this.handleButtonAction(event, \"accept\"); }}>\r\n            <FormattedMessage id=\"chat_invitation_accept\"\r\n              defaultMessage=\"Accept\" description=\"Action [Accept] for chat invitation.\" />\r\n          </button>\r\n          <button className=\"secondary\" onClick={event => { this.handleButtonAction(event, \"delete\"); }}>\r\n            <FormattedMessage id=\"chat_invitation_ignore\"\r\n              defaultMessage=\"Ignore\" description=\"Action [Ignore] for chat invitation.\" />\r\n          </button>\r\n          <button className=\"secondary\" onClick={event => { this.handleButtonAction(event, \"block\"); }}>\r\n            <FormattedMessage id=\"chat_invitation_block\"\r\n              defaultMessage=\"Block\" description=\"Action [Block] for chat invitation.\" />\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n};\r\n","/* This is just a static page to display when no conversation is selected. */\r\nimport React from 'react';\r\nimport { FormattedMessage } from 'react-intl';\r\n\r\nimport { Tinode } from 'tinode-sdk';\r\n\r\nimport { APP_NAME } from '../config.js';\r\n\r\nexport default class LogoView extends React.PureComponent {\r\n  render() {\r\n    const version = APP_NAME + ' (' + Tinode.getLibrary() + ')';\r\n    return (\r\n      <div id=\"dummy-view\">\r\n        <div>\r\n          <a href=\"https://github.com/tinode/chat/\">\r\n            <img id=\"logo\" alt=\"logo\" src=\"img/logo.svg\" />\r\n            <h2>Tinode Web</h2>\r\n          </a>\r\n          <p><FormattedMessage id=\"label_client\" defaultMessage=\"Client:\"\r\n            description=\"Label for a client version\" /> {version}</p>\r\n          <p><FormattedMessage id=\"label_server\" defaultMessage=\"Server:\"\r\n            description=\"Label for a server version\" /> {this.props.serverVersion} ({this.props.serverAddress})</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n};\r\n","// Message bubble with non-payload content, such as an indicator of deleted content or a date stamp.\r\n\r\nimport React from 'react';\r\n\r\nexport default class MetaMessage extends React.PureComponent {\r\n  constructor(props) {\r\n    super(props);\r\n  }\r\n\r\n  render() {\r\n    let content = null;\r\n    let bubbleClass = 'bubble';\r\n    if (this.props.date) {\r\n      // A date badge.\r\n      content = <>{this.props.date}</>\r\n      bubbleClass += ' date';\r\n    }\r\n\r\n    if (!content) {\r\n      return <>{null}</>\r\n    }\r\n\r\n    return (\r\n      <li className=\"meta\">\r\n        <div className={bubbleClass}>\r\n          <div className=\"message-content\">\r\n            {content}\r\n          </div>\r\n        </div>\r\n      </li>\r\n    );\r\n  }\r\n};\r\n","// Send message form.\r\nimport React from 'react';\r\nimport { defineMessages, injectIntl } from 'react-intl';\r\nimport { Drafty } from 'tinode-sdk';\r\n\r\nimport { previewFormatter } from '../lib/formatters.js';\r\nimport { MIN_SWIPE_DISTANCE } from '../config.js';\r\n\r\nconst messages = defineMessages({\r\n  message_not_found: {\r\n    id: 'message_not_found',\r\n    defaultMessage: 'message not found',\r\n    description: 'Pinned message is not found'\r\n  },\r\n  message_deleted: {\r\n    id: 'message_deleted',\r\n    defaultMessage: 'message deleted',\r\n    description: 'Pinned message is deleted'\r\n  }\r\n});\r\n\r\nclass PinnedMessages extends React.PureComponent {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    // Starting location of the touch gesture.\r\n    this.touchX = null;\r\n    this.touchY = null;\r\n\r\n    this.touchSurface = React.createRef();\r\n\r\n    this.getSelectedIndex = this.getSelectedIndex.bind(this);\r\n    this.handleCancel = this.handleCancel.bind(this);\r\n    this.handleSelected = this.handleSelected.bind(this);\r\n    this.handleMoveNext = this.handleMoveNext.bind(this);\r\n    this.handleMovePrev = this.handleMovePrev.bind(this);\r\n    this.handleTouchEventStart = this.handleTouchEventStart.bind(this);\r\n    this.handleTouchEventEnd = this.handleTouchEventEnd.bind(this);\r\n    this.handleTouchCancel = this.handleTouchCancel.bind(this);\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.touchSurface.current.addEventListener('touchstart', this.handleTouchEventStart, {passive: true});\r\n    this.touchSurface.current.addEventListener('touchend', this.handleTouchEventEnd, {passive: true});\r\n    this.touchSurface.current.addEventListener('touchcancel', this.handleTouchCancel, {passive: true});\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    this.touchSurface.current.removeEventListener('touchstart', this.handleTouchEventStart);\r\n    this.touchSurface.current.removeEventListener('touchend', this.handleTouchEventEnd);\r\n    this.touchSurface.current.removeEventListener('touchcancel', this.handleTouchCancel);\r\n  }\r\n  getSelectedIndex() {\r\n    const list = (this.props.pins || []);\r\n    return list.length - this.props.selected - 1;\r\n  }\r\n\r\n  handleCancel(e) {\r\n    e.preventDefault();\r\n    this.props.onCancel(this.props.pins[this.getSelectedIndex()]);\r\n  }\r\n\r\n  handleSelected(e) {\r\n    e.preventDefault();\r\n    this.props.onSelected(this.props.pins[this.getSelectedIndex()]);\r\n  }\r\n\r\n  handleMoveNext(e, isTouch) {\r\n    // Don't call preventDefault for touch events.\r\n    isTouch || e.preventDefault();\r\n    e.stopPropagation();\r\n    const idx = Math.max(this.props.selected - 1, 0);\r\n    if (idx != this.props.selected) {\r\n      this.props.setSelected(idx);\r\n    }\r\n  }\r\n\r\n  handleMovePrev(e, isTouch) {\r\n    // Don't call preventDefault for touch events.\r\n    isTouch || e.preventDefault();\r\n    e.stopPropagation();\r\n    const idx = Math.min(this.props.selected + 1, (this.props.pins || []).length - 1);\r\n    if (idx != this.props.selected) {\r\n      this.props.setSelected(idx);\r\n    }\r\n  }\r\n\r\n  handleTouchEventStart(e) {\r\n    if (e.touches.length == 1) {\r\n      this.touchX = e.touches[0].clientX;\r\n      this.touchY = e.touches[0].clientY;\r\n    }\r\n  }\r\n\r\n  handleTouchEventEnd(e) {\r\n    if (this.touchX === null || e.changedTouches.length != 1) {\r\n      this.touchX = null;\r\n      return;\r\n    }\r\n\r\n    const dX = this.touchX - e.changedTouches[0].clientX;\r\n    const dY = this.touchY - e.changedTouches[0].clientY;\r\n    this.touchX = null;\r\n\r\n    if (Math.abs(dX) > Math.abs(dY) || Math.abs(dY) < MIN_SWIPE_DISTANCE) {\r\n      // Horizontal swipe or too short vertical swipe.\r\n      return;\r\n    }\r\n\r\n    if (dY > 0) {\r\n      this.handleMovePrev(e, true);\r\n    } else {\r\n      this.handleMoveNext(e, true);\r\n    }\r\n  }\r\n\r\n  handleTouchCancel() {\r\n    this.touchX = null;\r\n  }\r\n\r\n  render() {\r\n    const selected = this.getSelectedIndex();\r\n    let messageShown = (this.props.messages || [])[selected];\r\n    messageShown = messageShown ?\r\n        messageShown._deleted ?\r\n        <i className=\"gray\">{this.props.intl.formatMessage(messages.message_deleted)}</i>\r\n        :\r\n        Drafty.format(messageShown.content, previewFormatter, {\r\n          formatMessage: this.props.intl.formatMessage.bind(this.props.intl),\r\n          authorizeURL: this.props.tinode.authorizeURL.bind(this.props.tinode)\r\n        })\r\n      :\r\n      <i className=\"gray\">{this.props.intl.formatMessage(messages.message_not_found)}</i>;\r\n\r\n    const dots = [];\r\n    this.props.pins.forEach(seq => {\r\n      const cn = dots.length == selected ? 'adot' : 'dot';\r\n      dots.push(<div key={seq} className={cn} />);\r\n    });\r\n\r\n    return (\r\n      <div id=\"pinned-wrapper\" ref={this.touchSurface}>\r\n        {this.props.isAdmin ?\r\n          <div className=\"cancel\">\r\n            <a href=\"#\" onClick={this.handleCancel}><i className=\"material-icons gray\">close</i></a>\r\n          </div> :\r\n          <div><i className=\"material-icons gray\">push_pin</i></div>\r\n        }\r\n        <div className=\"pinned-scroll\">{dots}</div>\r\n        <div className=\"pinned\" onClick={this.handleSelected}><p>{messageShown}</p></div>\r\n        <div className=\"pinned-menu\">\r\n          <span className=\"menuTrigger upper\">\r\n            {selected > 0 ?\r\n              <a href=\"#\" onClick={this.handleMovePrev}>\r\n                <i className=\"material-icons\">expand_less</i>\r\n              </a>\r\n              : null\r\n            }\r\n          </span>\r\n          <span className=\"menuTrigger lower\">\r\n            {this.props.selected > 0 ?\r\n              <a href=\"#\" onClick={this.handleMoveNext}>\r\n                <i className=\"material-icons\">expand_more</i>\r\n              </a>\r\n              : null\r\n            }\r\n          </span>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default injectIntl(PinnedMessages);\r\n","import React from 'react';\r\nimport { FormattedMessage, defineMessages, injectIntl } from 'react-intl';\r\nimport SendMessage from './send-message.jsx';\r\n\r\nimport { bytesToHumanSize } from '../lib/strformat.js';\r\n\r\nconst messages = defineMessages({\r\n  unrecognized_video_format: {\r\n    id: 'unrecognized_video_format',\r\n    defaultMessage: 'Format of this video is not recognized',\r\n    description: 'Error message when uploaded video is invalid',\r\n  }\r\n});\r\n\r\nclass VideoPreview extends React.PureComponent {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.videoRef = React.createRef();\r\n\r\n    this.handleSendVideo = this.handleSendVideo.bind(this);\r\n    this.handleKeyDown = this.handleKeyDown.bind(this);\r\n  }\r\n\r\n  componentDidMount() {\r\n    document.addEventListener('keydown', this.handleKeyDown);\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    document.removeEventListener('keydown', this.handleKeyDown);\r\n  }\r\n\r\n  handleKeyDown(e) {\r\n    if (this.props.onSendMessage) {\r\n      return;\r\n    }\r\n\r\n    e.preventDefault();\r\n    if (e.key === 'Escape') {\r\n      this.props.onClose();\r\n    }\r\n  }\r\n\r\n  handleSendVideo(caption) {\r\n    this.props.onClose();\r\n    const params = {\r\n      width: this.videoRef.current.videoWidth,\r\n      height: this.videoRef.current.videoHeight,\r\n      duration: (this.videoRef.current.duration * 1000) | 0,\r\n      mime: this.props.content.mime,\r\n      name: this.props.content.filename\r\n    }\r\n\r\n    if (params.width == 0 || params.height == 0) {\r\n      this.props.onError(this.props.intl.formatMessage(messages.unrecognized_video_format), 'err');\r\n      return;\r\n    }\r\n\r\n    // Capture screen from a video.\r\n    const canvas = document.createElement('canvas');\r\n    canvas.width = params.width;\r\n    canvas.height = params.height;\r\n    const ctx = canvas.getContext('2d');\r\n    ctx.drawImage(this.videoRef.current, 0, 0, canvas.width, canvas.height);\r\n    ctx.canvas.toBlob(\r\n        preview => this.props.onSendMessage(caption, this.props.content.blob, preview, params),\r\n        'image/jpeg', 0.75\r\n    );\r\n  }\r\n\r\n  render() {\r\n    if (!this.props.content) {\r\n      return null;\r\n    }\r\n\r\n    const width = this.props.content.width || '-';\r\n    const height = this.props.content.height || '-';\r\n\r\n    const controlist = this.props.onSendMessage ? 'nodownload' : '';\r\n    const autoPlay = !this.props.onSendMessage;\r\n\r\n    return (\r\n      <div id=\"image-preview\">\r\n        <div id=\"image-preview-caption-panel\">\r\n          <span>{this.props.content.filename}</span>\r\n          <a href=\"#\" onClick={e => {e.preventDefault(); this.props.onClose();}}><i className=\"material-icons gray\">close</i></a>\r\n        </div>\r\n        <div id=\"image-preview-container\">\r\n          <video\r\n            className=\"image-preview\"\r\n            controls controlsList={controlist}\r\n            disablePictureInPicture ref={this.videoRef}\r\n            autoPlay={autoPlay}\r\n            src={this.props.tinode.authorizeURL(this.props.content.url)}\r\n            poster={this.props.content.preview}\r\n            alt={this.props.content.filename} />\r\n        </div>\r\n        {this.props.onSendMessage ?\r\n        <SendMessage\r\n          messagePrompt=\"add_image_caption\"\r\n          acceptBlank={true}\r\n          tinode={this.props.tinode}\r\n          reply={this.props.reply}\r\n          onCancelReply={this.props.onCancelReply}\r\n          onSendMessage={this.handleSendVideo}\r\n          onError={this.props.onError} />\r\n          :\r\n          <div id=\"image-preview-footer\">\r\n            <div>\r\n              <div><b><FormattedMessage id=\"label_file_name\" defaultMessage=\"File name:\"\r\n                description=\"Label for a file name\" /></b></div>\r\n              <div><span title={this.props.content.filename}>{this.props.content.filename}</span></div>\r\n            </div>\r\n            <div>\r\n              <div><b><FormattedMessage id=\"label_content_type\" defaultMessage=\"Content type:\"\r\n                description=\"Label for file content type (mime)\" /></b></div>\r\n              <div>{this.props.content.type}</div>\r\n            </div>\r\n            <div>\r\n              <div><b><FormattedMessage id=\"label_size\" defaultMessage=\"Size:\"\r\n                description=\"Label for file size\" /></b></div>\r\n              <div>{width} &times; {height} px; {bytesToHumanSize(this.props.content.size)}</div>\r\n            </div>\r\n          </div>}\r\n      </div>\r\n    );\r\n  }\r\n};\r\n\r\nexport default injectIntl(VideoPreview);\r\n","// Panel with a chat.\r\n\r\nimport React from 'react';\r\nimport { FormattedMessage, defineMessages, injectIntl } from 'react-intl';\r\n\r\nimport { Drafty, Tinode } from 'tinode-sdk';\r\n\r\nimport CallPanel from '../widgets/call-panel.jsx';\r\nimport ChatMessage from '../widgets/chat-message.jsx';\r\nimport ContactBadges from '../widgets/contact-badges.jsx';\r\nimport DocPreview from '../widgets/doc-preview.jsx';\r\nimport ErrorPanel from '../widgets/error-panel.jsx';\r\nimport GroupSubs from '../widgets/group-subs.jsx';\r\nimport ImagePreview from '../widgets/image-preview.jsx';\r\nimport Invitation from '../widgets/invitation.jsx';\r\nimport LetterTile from '../widgets/letter-tile.jsx';\r\nimport LoadSpinner from '../widgets/load-spinner.jsx';\r\nimport LogoView from './logo-view.jsx';\r\nimport MetaMessage from '../widgets/meta-message.jsx';\r\nimport PinnedMessages from '../widgets/pinned-messages.jsx';\r\nimport SendMessage from '../widgets/send-message.jsx';\r\nimport VideoPreview from '../widgets/video-preview.jsx';\r\n\r\nimport { DEFAULT_P2P_ACCESS_MODE, EDIT_PREVIEW_LENGTH, IMAGE_PREVIEW_DIM, IMMEDIATE_P2P_SUBSCRIPTION,\r\n  DRAFTY_FR_MIME_TYPE_LEGACY, KEYPRESS_DELAY, MESSAGES_PAGE, MAX_EXTERN_ATTACHMENT_SIZE, MAX_IMAGE_DIM,\r\n  MAX_INBAND_ATTACHMENT_SIZE, READ_DELAY, QUOTED_REPLY_LENGTH, VIDEO_PREVIEW_DIM } from '../config.js';\r\nimport { CALL_STATE_OUTGOING_INITATED, CALL_STATE_IN_PROGRESS } from '../constants.js';\r\nimport { blobToBase64, fileToBase64, imageScaled, makeImageUrl } from '../lib/blob-helpers.js';\r\nimport HashNavigation from '../lib/navigation.js';\r\nimport { bytesToHumanSize, relativeDateFormat, shortDateFormat } from '../lib/strformat.js';\r\n\r\n// Run timer with this frequency (ms) for checking notification queue.\r\nconst NOTIFICATION_EXEC_INTERVAL = 300;\r\n// Scroll distance before [go to latest message] button is shown.\r\nconst SHOW_GO_TO_LAST_DIST = 100;\r\n// Sctoll distance from the top when fetching the page of earlier messages is triggered.\r\nconst FETCH_PAGE_TRIGGER = 40;\r\n\r\nconst messages = defineMessages({\r\n  online_now: {\r\n    id: 'online_now',\r\n    defaultMessage: 'online now',\r\n    description: 'Indicator that the user or topic is currently online',\r\n  },\r\n  last_seen: {\r\n    id: 'last_seen_timestamp',\r\n    defaultMessage: 'Last seen',\r\n    description: 'Label for the timestamp of when the user or topic was last online'\r\n  },\r\n  not_found: {\r\n    id: 'title_not_found',\r\n    defaultMessage: 'Not found',\r\n    description: 'Title shown when topic is not found'\r\n  },\r\n  channel: {\r\n    id: 'channel',\r\n    defaultMessage: 'channel',\r\n    description: 'Subtitle shown for channels in MessagesView instead of last seen'\r\n  },\r\n  file_attachment_too_large: {\r\n    id: 'file_attachment_too_large',\r\n    defaultMessage: 'The file size {size} exceeds the {limit} limit.',\r\n    description: 'Error message when attachment is too large'\r\n  },\r\n  invalid_content: {\r\n    id: 'invalid_content',\r\n    defaultMessage: 'invalid content',\r\n    description: 'Shown when the message is unreadable'\r\n  },\r\n  editing_message: {\r\n    id: 'editing_message',\r\n    defaultMessage: 'Editing',\r\n    description: 'Title over message editing preview'\r\n  },\r\n  drag_file: {\r\n    id: 'drag_file',\r\n    defaultMessage: 'Drag file here',\r\n    description: 'Prompt on the file drag-n-drop overlay banner'\r\n  },\r\n  self_topic_name: {\r\n    id: 'self_topic_name',\r\n    defaultMessage: 'Saved messages',\r\n    description: 'Name of self topic for UI'\r\n  },\r\n});\r\n\r\n// Checks if the access permissions are granted but not yet accepted.\r\nfunction isUnconfirmed(acs) {\r\n  if (acs) {\r\n    const ex = acs.getExcessive() || '';\r\n    return acs.isJoiner('given') && (ex.includes('R') || ex.includes('W'));\r\n  }\r\n  return false;\r\n}\r\n\r\nfunction isPeerRestricted(acs) {\r\n  if (acs) {\r\n    const ms = acs.getMissing() || '';\r\n    return acs.isJoiner('want') && (ms.includes('R') || ms.includes('W'));\r\n  }\r\n  return false;\r\n}\r\n\r\nfunction shouldPresentCallPanel(callState) {\r\n  // Show call panel if either:\r\n  // - call is outgoing (and the client is waiting for the other side to pick up) or,\r\n  // - call is already in progress.\r\n  return callState == CALL_STATE_OUTGOING_INITATED || callState == CALL_STATE_IN_PROGRESS;\r\n}\r\n\r\nclass MessagesView extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.state = MessagesView.getDerivedStateFromProps(props, {});\r\n\r\n    this.componentSetup = this.componentSetup.bind(this);\r\n    this.leave = this.leave.bind(this);\r\n    this.sendMessage = this.sendMessage.bind(this);\r\n    this.retrySend = this.retrySend.bind(this);\r\n    this.sendImageAttachment = this.sendImageAttachment.bind(this);\r\n    this.sendVideoAttachment = this.sendVideoAttachment.bind(this);\r\n    this.sendFileAttachment = this.sendFileAttachment.bind(this);\r\n    this.sendAudioAttachment = this.sendAudioAttachment.bind(this);\r\n    this.sendKeyPress = this.sendKeyPress.bind(this);\r\n    this.subscribe = this.subscribe.bind(this);\r\n    this.handleScrollReference = this.handleScrollReference.bind(this);\r\n    this.mountDnDEvents = this.mountDnDEvents.bind(this);\r\n    this.handleScrollEvent = this.handleScrollEvent.bind(this);\r\n    this.handleDescChange = this.handleDescChange.bind(this);\r\n    this.handleSubsUpdated = this.handleSubsUpdated.bind(this);\r\n    this.handleMessageUpdate = this.handleMessageUpdate.bind(this);\r\n    this.handleAuxUpdate = this.handleAuxUpdate.bind(this);\r\n    this.handleAllMessagesReceived = this.handleAllMessagesReceived.bind(this);\r\n    this.handleInfoReceipt = this.handleInfoReceipt.bind(this);\r\n    this.handleExpandMedia = this.handleExpandMedia.bind(this);\r\n    this.handleClosePreview = this.handleClosePreview.bind(this);\r\n    this.handleFormResponse = this.handleFormResponse.bind(this);\r\n    this.handleContextClick = this.handleContextClick.bind(this);\r\n    this.handleShowMessageContextMenu = this.handleShowMessageContextMenu.bind(this);\r\n    this.handleNewChatAcceptance = this.handleNewChatAcceptance.bind(this);\r\n    this.handleEnablePeer = this.handleEnablePeer.bind(this);\r\n    this.handleAttachFile = this.handleAttachFile.bind(this);\r\n    this.handleAttachImageOrVideo = this.handleAttachImageOrVideo.bind(this);\r\n    this.handleCancelUpload = this.handleCancelUpload.bind(this);\r\n    this.postReadNotification = this.postReadNotification.bind(this);\r\n    this.clearNotificationQueue = this.clearNotificationQueue.bind(this);\r\n    this.goToLatestMessage = this.goToLatestMessage.bind(this);\r\n    this.handleFileDrop = this.handleFileDrop.bind(this);\r\n\r\n    this.handlePickReply = this.handlePickReply.bind(this);\r\n    this.handleEditMessage = this.handleEditMessage.bind(this);\r\n    this.handleCancelReply = this.handleCancelReply.bind(this);\r\n    this.handleQuoteClick = this.handleQuoteClick.bind(this);\r\n    this.handleUnpinMessage = this.handleUnpinMessage.bind(this);\r\n    this.handleCallHangup = this.handleCallHangup.bind(this);\r\n\r\n    this.isDragEnabled = this.isDragEnabled.bind(this);\r\n    this.handleDragStart = this.handleDragStart.bind(this);\r\n    this.handleDragIn = this.handleDragIn.bind(this);\r\n    this.handleDragOut = this.handleDragOut.bind(this);\r\n    this.handleDrag = this.handleDrag.bind(this);\r\n    this.handleDrop = this.handleDrop.bind(this);\r\n\r\n    this.chatMessageRefs = [];\r\n    this.getOrCreateMessageRef = this.getOrCreateMessageRef.bind(this);\r\n    this.getVisibleMessageRange = this.getVisibleMessageRange.bind(this);\r\n\r\n    // Keeps track of the drag event.\r\n    // Need a counter b/c the browser's 'drag' events may fire multiple times\r\n    // when the user takes the mouse pointer over the container:\r\n    // for the component itself and for all nested/child elements.\r\n    this.dragCounter = 0;\r\n    this.dndRef = null;\r\n\r\n    this.readNotificationQueue = [];\r\n    this.readNotificationTimer = null;\r\n\r\n    this.keyPressTimer = null;\r\n  }\r\n\r\n  getOrCreateMessageRef(seqId) {\r\n    if (this.chatMessageRefs[seqId]) {\r\n      return this.chatMessageRefs[seqId];\r\n    }\r\n    const ref = React.createRef();\r\n    this.chatMessageRefs[seqId] = ref;\r\n    return ref;\r\n  }\r\n\r\n  getVisibleMessageRange(holderRect) {\r\n    let min = Number.MAX_SAFE_INTEGER, max = -1;\r\n    let visibilityStatus = false;\r\n    this.chatMessageRefs.every((ref, seq) => {\r\n      if (ref.current) {\r\n        const { top, bottom, height } = ref.current.getBoundingClientRect();\r\n        const visible = top <= holderRect.top ? holderRect.top - top <= height : bottom - holderRect.bottom <= height;\r\n        if (visible) {\r\n          visibilityStatus = true;\r\n          min = Math.min(min, seq);\r\n          max = Math.max(max, seq);\r\n        } else if (visibilityStatus) {\r\n          // The remaining elements are no longer visible, no need to iterate them.\r\n          return false;\r\n        }\r\n      }\r\n      return true;\r\n    });\r\n\r\n    return max >= min ? {min: min, max: max} : {min: 0, max: 0};\r\n  }\r\n\r\n  componentDidMount() {\r\n    if (this.messagesScroller) {\r\n      this.messagesScroller.addEventListener('scroll', this.handleScrollEvent);\r\n    }\r\n\r\n    // Drag and drop events\r\n    this.mountDnDEvents(this.dndRef);\r\n\r\n    this.componentSetup({}, {});\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    if (this.messagesScroller) {\r\n      this.messagesScroller.removeEventListener('scroll', this.handleScrollEvent);\r\n    }\r\n\r\n    // Flush all notifications.\r\n    this.clearNotificationQueue();\r\n\r\n    // Drag and drop events\r\n    if (this.dndRef) {\r\n      this.dndRef.removeEventListener('dragstart', this.handleDragStart);\r\n      this.dndRef.removeEventListener('dragenter', this.handleDragIn);\r\n      this.dndRef.removeEventListener('dragleave', this.handleDragOut);\r\n      this.dndRef.removeEventListener('dragover', this.handleDrag);\r\n      this.dndRef.removeEventListener('drop', this.handleDrop);\r\n    }\r\n  }\r\n\r\n  componentDidUpdate(prevProps, prevState) {\r\n    // Scroll last message into view on component update e.g. on message received\r\n    // or vertical shrinking.\r\n    if (this.messagesScroller &&\r\n      (prevState.topic != this.state.topic || prevState.maxSeqId != this.state.maxSeqId ||\r\n        prevState.minSeqId != this.state.minSeqId)) {\r\n      // New message.\r\n      if (this.state.scrollPosition < SHOW_GO_TO_LAST_DIST) {\r\n        this.messagesScroller.scrollTop = this.messagesScroller.scrollHeight -\r\n          this.state.scrollPosition - this.messagesScroller.offsetHeight;\r\n      }\r\n    }\r\n\r\n    if (!this.props.applicationVisible) {\r\n      // If application is not visible, flush all unsent 'read' notifications.\r\n      this.clearNotificationQueue();\r\n    } else {\r\n      // Otherwise assume there are unread messages.\r\n      this.postReadNotification(0);\r\n    }\r\n\r\n    this.componentSetup(prevProps, prevState);\r\n  }\r\n\r\n  componentSetup(prevProps, prevState) {\r\n    const topic = this.props.tinode ? this.props.tinode.getTopic(this.state.topic) : undefined;\r\n    if (this.state.topic != prevState.topic) {\r\n      if (prevState.topic && !Tinode.isNewGroupTopicName(prevState.topic)) {\r\n        this.leave(prevState.topic);\r\n        if (prevState.rtcPanel) {\r\n          this.handleCallHangup(prevState.topic, prevProps.callSeq);\r\n        }\r\n      }\r\n\r\n      if (topic) {\r\n        topic.onData = this.handleMessageUpdate;\r\n        topic.onAllMessagesReceived = this.handleAllMessagesReceived;\r\n        topic.onInfo = this.handleInfoReceipt;\r\n        topic.onMetaDesc = this.handleDescChange;\r\n        topic.onSubsUpdated = this.handleSubsUpdated;\r\n        topic.onPres = this.handleSubsUpdated;\r\n        topic.onAuxUpdated = this.handleAuxUpdate;\r\n      }\r\n    }\r\n\r\n    if (topic) {\r\n      if ((this.state.topic != prevState.topic) || (this.props.myUserId && !prevProps.myUserId)) {\r\n        // Don't immediately subscribe to a new p2p topic, wait for the first message.\r\n        const newTopic = (this.props.newTopicParams && this.props.newTopicParams._topicName == this.props.topic);\r\n        if (topic.isP2PType() && newTopic && !IMMEDIATE_P2P_SUBSCRIPTION) {\r\n          topic.getMeta(topic.startMetaQuery().withDesc().build());\r\n        } else if (this.props.myUserId) {\r\n          this.subscribe(topic);\r\n        }\r\n      } else if (topic.isSubscribed() && this.state.isReader && !prevState.isReader) {\r\n        // If reader status has changed and data became available.\r\n        topic.getMeta(topic.startMetaQuery().withLaterData().build());\r\n      }\r\n    }\r\n  }\r\n\r\n  static getDerivedStateFromProps(nextProps, prevState) {\r\n    let nextState = {};\r\n    if (!nextProps.topic) {\r\n      // Default state: no topic.\r\n      nextState = {\r\n        minSeqId: -1,\r\n        maxSeqId: -1,\r\n        latestClearId: -1,\r\n        onlineSubs: [],\r\n        topic: null,\r\n        title: '',\r\n        avatar: null,\r\n        isVerified: false,\r\n        isStaff: false,\r\n        isDangerous: false,\r\n        deleted: false,\r\n        docPreview: null,\r\n        imagePreview: null,\r\n        imagePostview: null,\r\n        videoPreview: null,\r\n        videoPostview: null,\r\n        rtcPanel: null,\r\n        typingIndicator: false,\r\n        scrollPosition: 0,\r\n        fetchingMessages: false,\r\n        peerMessagingDisabled: false,\r\n        channel: false,\r\n        reply: null,\r\n        contentToEdit: null,\r\n        showGoToLastButton: false,\r\n        dragging: false,\r\n        pins: [],\r\n        pinsLoaded: false,\r\n        selectedPin: 0,\r\n        subsVersion: 0\r\n      };\r\n    } else if (nextProps.topic != prevState.topic) {\r\n      const topic = nextProps.tinode.getTopic(nextProps.topic);\r\n\r\n      nextState = {\r\n        topic: nextProps.topic,\r\n        deleted: topic._deleted,\r\n        docPreview: null,\r\n        imagePreview: null,\r\n        imagePostview: null,\r\n        videoPreview: null,\r\n        videoPostview: null,\r\n        rtcPanel: null,\r\n        typingIndicator: false,\r\n        scrollPosition: 0,\r\n        fetchingMessages: false,\r\n        showGoToLastButton: false,\r\n        contentToEdit: null,\r\n        dragging: false,\r\n        selectedPin: 0\r\n      };\r\n\r\n      if (nextProps.forwardMessage) {\r\n        // We are forwarding a message. Show preview.\r\n        nextState.reply = {\r\n          content: nextProps.forwardMessage.preview,\r\n          seq: null\r\n        };\r\n      } else {\r\n        nextState.reply = null;\r\n      }\r\n\r\n      if (topic) {\r\n        // Topic exists.\r\n        const subs = [];\r\n\r\n        if (nextProps.connected) {\r\n          topic.subscribers((sub) => {\r\n            if (sub.online && sub.user != nextProps.myUserId) {\r\n              subs.push(sub);\r\n            }\r\n          });\r\n        }\r\n\r\n        Object.assign(nextState, {\r\n          onlineSubs: subs\r\n        });\r\n\r\n        if (topic.isSelfType()) {\r\n          Object.assign(nextState, {\r\n            title: nextProps.intl.formatMessage(messages.self_topic_name),\r\n            avatar: true\r\n          });\r\n        } else if (topic.public) {\r\n          Object.assign(nextState, {\r\n            title: topic.public.fn,\r\n            avatar: makeImageUrl(topic.public.photo)\r\n          });\r\n        } else {\r\n          Object.assign(nextState, {\r\n            title: '',\r\n            avatar: null\r\n          });\r\n        }\r\n\r\n        const peer = topic.p2pPeerDesc();\r\n        if (peer) {\r\n          Object.assign(nextState, {\r\n            peerMessagingDisabled: isPeerRestricted(peer.acs)\r\n          });\r\n        } else if (prevState.peerMessagingDisabled) {\r\n          Object.assign(nextState, {\r\n            peerMessagingDisabled: false\r\n          });\r\n        }\r\n        Object.assign(nextState, {\r\n          minSeqId: topic.minMsgSeq(),\r\n          maxSeqId: topic.maxMsgSeq(),\r\n          latestClearId: topic.maxClearId(),\r\n          channel: topic.isChannelType(),\r\n          pins: (topic.aux('pins') || []).slice(),\r\n          pinsLoaded: false\r\n        });\r\n\r\n        if (nextProps.callTopic == topic.name && shouldPresentCallPanel(nextProps.callState)) {\r\n          nextState.rtcPanel = nextProps.callTopic;\r\n        }\r\n      } else {\r\n        // Invalid topic.\r\n        Object.assign(nextState, {\r\n          minSeqId: -1,\r\n          maxSeqId: -1,\r\n          latestClearId: -1,\r\n          onlineSubs: [],\r\n          title: '',\r\n          avatar: null,\r\n          peerMessagingDisabled: false,\r\n          channel: false,\r\n          pins: [],\r\n          pinsLoaded: false\r\n        });\r\n      }\r\n    } else {\r\n      // We are still in same topic. Show the call panel if necessary.\r\n      if (nextProps.callTopic == prevState.topic && !prevState.rtcPanel &&\r\n          shouldPresentCallPanel(nextProps.callState)) {\r\n        nextState.rtcPanel = nextProps.callTopic;\r\n      }\r\n    }\r\n\r\n    if (nextProps.acs) {\r\n      if (nextProps.acs.isWriter() != prevState.isWriter) {\r\n        nextState.isWriter = !prevState.isWriter;\r\n      }\r\n      if (nextProps.acs.isReader() != prevState.isReader) {\r\n        nextState.isReader = !prevState.isReader;\r\n      }\r\n      if (nextProps.acs.isAdmin() != prevState.isAdmin) {\r\n        nextState.isAdmin = !prevState.isAdmin;\r\n      }\r\n      if (!nextProps.acs.isReader('given') != prevState.readingBlocked) {\r\n        nextState.readingBlocked = !prevState.readingBlocked;\r\n      }\r\n      if (nextProps.acs.isSharer() != prevState.isSharer) {\r\n        nextState.isSharer = !prevState.isSharer;\r\n      }\r\n    } else {\r\n      if (prevState.isWriter) {\r\n        nextState.isWriter = false;\r\n      }\r\n      if (prevState.isReader) {\r\n        nextState.isReader = false;\r\n      }\r\n      if (prevState.isAdmin) {\r\n        nextState.isAdmin = false;\r\n      }\r\n      if (!prevState.readingBlocked) {\r\n        prevState.readingBlocked = true;\r\n      }\r\n      if (prevState.isSharer) {\r\n        nextState.isSharer = false;\r\n      }\r\n    }\r\n\r\n    if (isUnconfirmed(nextProps.acs) == !prevState.unconformed) {\r\n      nextState.unconfirmed = !prevState.unconformed;\r\n    }\r\n\r\n    // Clear subscribers online when there is no connection.\r\n    if (!nextProps.connected && prevState.onlineSubs && prevState.onlineSubs.length > 0) {\r\n      nextState.onlineSubs = [];\r\n    }\r\n\r\n    return nextState;\r\n  }\r\n\r\n  subscribe(topic) {\r\n    if (topic.isSubscribed() || !this.props.ready) {\r\n      return;\r\n    }\r\n\r\n    // Is this a new topic?\r\n    const newTopic = (this.props.newTopicParams && this.props.newTopicParams._topicName == this.props.topic);\r\n    // Don't request the tags. They are useless unless the user\r\n    // is the owner and is editing the topic.\r\n    let getQuery = topic.startMetaQuery().withLaterDesc().withLaterSub().withAux();\r\n    if (this.state.isReader || newTopic) {\r\n      // Reading is either permitted or we don't know because it's a new topic. Ask for messages.\r\n      getQuery = getQuery.withLaterData(MESSAGES_PAGE);\r\n      if (this.state.isReader) {\r\n        getQuery = getQuery.withLaterDel();\r\n      }\r\n      // And show \"loading\" spinner.\r\n      this.setState({ fetchingMessages: true });\r\n    }\r\n\r\n    const setQuery = newTopic ? this.props.newTopicParams : undefined;\r\n    topic.subscribe(getQuery.build(), setQuery)\r\n      .then(ctrl => {\r\n        if (ctrl.code == 303) {\r\n          // Redirect to another topic requested.\r\n          HashNavigation.navigateTo(HashNavigation.setUrlTopic('', ctrl.params.topic));\r\n          return;\r\n        }\r\n        if (this.state.topic != ctrl.topic) {\r\n          this.setState({topic: ctrl.topic});\r\n        }\r\n        if (this.state.deleted) {\r\n          this.setState({deleted: false});\r\n        }\r\n        this.props.onNewTopicCreated(this.props.topic, ctrl.topic);\r\n        // If there are unsent messages (except hard-failed and video call messages),\r\n        // try sending them now. Hard-failed and unsent video call messages will be dropped.\r\n        let discard = [];\r\n        topic.queuedMessages(pub => {\r\n          if (pub._sending) {\r\n            return;\r\n          }\r\n          if (pub._fatal || (pub.head && pub.head.webrtc)) {\r\n            // Filter out unsent failed & video call messages.\r\n            discard.push(pub.seq);\r\n            return;\r\n          }\r\n          if (topic.isSubscribed()) {\r\n            this.retrySend(pub);\r\n          }\r\n        });\r\n        if (discard.length > 0) {\r\n          topic.delMessagesList(discard, true);\r\n        }\r\n      })\r\n      .catch(err => {\r\n        console.error(\"Failed subscription to\", this.state.topic, err);\r\n        this.props.onError(err.message, 'err');\r\n        const blankState = MessagesView.getDerivedStateFromProps({}, {});\r\n        blankState.title = this.props.intl.formatMessage(messages.not_found);\r\n        this.setState(blankState);\r\n      });\r\n  }\r\n\r\n  leave(oldTopicName) {\r\n    if (!oldTopicName || !this.props.tinode.isTopicCached(oldTopicName)) {\r\n      return;\r\n    }\r\n\r\n    const oldTopic = this.props.tinode.getTopic(oldTopicName);\r\n    if (oldTopic && oldTopic.isSubscribed()) {\r\n      oldTopic.leave(false)\r\n        .catch(_ => { /* do nothing here */ })\r\n        .finally(_ => {\r\n          // We don't care if the request succeeded or failed.\r\n          // The topic is dead regardless.\r\n          this.setState({fetchingMessages: false});\r\n          oldTopic.onData = undefined;\r\n          oldTopic.onAllMessagesReceived = undefined;\r\n          oldTopic.onInfo = undefined;\r\n          oldTopic.onMetaDesc = undefined;\r\n          oldTopic.onSubsUpdated = undefined;\r\n          oldTopic.onPres = undefined;\r\n          oldTopic.onAuxUpdated = undefined;\r\n        });\r\n    }\r\n  }\r\n\r\n  // Don't use React.createRef as the ref.current is not available in componentDidMount in this component.\r\n  handleScrollReference(node) {\r\n    if (node) {\r\n      node.addEventListener('scroll', this.handleScrollEvent);\r\n      this.messagesScroller = node;\r\n      this.messagesScroller.scrollTop = this.messagesScroller.scrollHeight -\r\n        this.state.scrollPosition - this.messagesScroller.offsetHeight;\r\n    }\r\n  }\r\n\r\n  // Get older messages and show/hide [go to latest message] button.\r\n  handleScrollEvent(event) {\r\n    const pos = event.target.scrollHeight - event.target.scrollTop - event.target.offsetHeight;\r\n    this.setState({\r\n      scrollPosition: pos,\r\n      // Show [go to latest message] if far enough from bottom and scrolling down.\r\n      showGoToLastButton: (pos > SHOW_GO_TO_LAST_DIST) && (pos < this.state.scrollPosition),\r\n    });\r\n\r\n    if (this.state.fetchingMessages || this.processingScrollEvent) {\r\n      return;\r\n    }\r\n\r\n    if (event.target.scrollTop <= FETCH_PAGE_TRIGGER) {\r\n      const topic = this.props.tinode.getTopic(this.state.topic);\r\n      if (topic && topic.isSubscribed()) {\r\n        this.processingScrollEvent = true;\r\n        const {min, max} = this.getVisibleMessageRange(event.target.getBoundingClientRect());\r\n        const gaps = topic.msgHasMoreMessages(min, max, false);\r\n        if (gaps.length > 0) {\r\n          this.setState({fetchingMessages: true}, _ => {\r\n            topic.getMessagesPage(MESSAGES_PAGE, gaps, min, max)\r\n              .catch(err => this.props.onError(err.message, 'err'))\r\n              .finally(_ => this.setState({fetchingMessages: false}));\r\n            });\r\n        }\r\n      }\r\n    }\r\n    this.processingScrollEvent = false;\r\n  }\r\n\r\n  /* Mount drag and drop events */\r\n  mountDnDEvents(dnd) {\r\n    console.log('drop', dnd);\r\n    if (dnd) {\r\n      dnd.addEventListener('dragstart', this.handleDragStart);\r\n      dnd.addEventListener('dragenter', this.handleDragIn);\r\n      dnd.addEventListener('dragleave', this.handleDragOut);\r\n      dnd.addEventListener('dragover', this.handleDrag);\r\n      dnd.addEventListener('drop', this.handleDrop);\r\n      this.dndRef = dnd;\r\n      console.log('drop', 'success');\r\n    }\r\n  }\r\n\r\n  goToLatestMessage() {\r\n    this.setState({scrollPosition: 0});\r\n    if (this.messagesScroller) {\r\n      this.messagesScroller.scrollTop = this.messagesScroller.scrollHeight - this.messagesScroller.offsetHeight;\r\n    }\r\n  }\r\n\r\n  handleDescChange(desc) {\r\n    if (Tinode.isSelfTopicName(this.props.topic)) {\r\n      this.setState({\r\n        title: this.props.intl.formatMessage(messages.self_topic_name),\r\n        avatar: true\r\n      });\r\n    } else if (desc.public) {\r\n      this.setState({\r\n        title: desc.public.fn,\r\n        avatar: makeImageUrl(desc.public.photo)\r\n      });\r\n    } else {\r\n      this.setState({\r\n        title: '',\r\n        avatar: null\r\n      });\r\n    }\r\n\r\n    if (desc.acs) {\r\n      this.setState({\r\n        isWriter: desc.acs.isWriter(),\r\n        isReader: desc.acs.isReader(),\r\n        isAdmin: desc.acs.isAdmin(),\r\n        readingBlocked: !desc.acs.isReader('given'),\r\n        unconfirmed: isUnconfirmed(desc.acs),\r\n      });\r\n    }\r\n  }\r\n\r\n  postReadNotification(seq) {\r\n    // Ignore notifications if the app is invisible or topic is not yet available.\r\n    if (!this.props.applicationVisible || !this.state.topic) {\r\n      return;\r\n    }\r\n\r\n    // Set up the timer if it's not running already.\r\n    if (!this.readNotificationTimer) {\r\n      this.readNotificationTimer = setInterval(_ => {\r\n        if (this.readNotificationQueue.length == 0) {\r\n          // Shut down the timer if the queue is empty.\r\n          clearInterval(this.readNotificationTimer);\r\n          this.readNotificationTimer = null;\r\n          return;\r\n        }\r\n\r\n        let seq = -1;\r\n        while (this.readNotificationQueue.length > 0) {\r\n          const n = this.readNotificationQueue[0];\r\n          if (n.topicName != this.state.topic) {\r\n            // Topic has changed. Drop the notification.\r\n            this.readNotificationQueue.shift();\r\n            continue;\r\n          }\r\n\r\n          const now = new Date();\r\n          if (n.sendAt <= now) {\r\n            // Remove expired notification from queue.\r\n            this.readNotificationQueue.shift();\r\n            if (n.seq == 0 || Tinode.isServerAssignedSeq(n.seq)) {\r\n              seq = Math.max(seq, n.seq);\r\n            }\r\n          } else {\r\n            break;\r\n          }\r\n        }\r\n\r\n        // Send only one notification for the whole batch of messages.\r\n        if (seq >= 0) {\r\n          const topic = this.props.tinode.getTopic(this.state.topic);\r\n          if (topic) {\r\n            try {\r\n              topic.noteRead(seq);\r\n                if (window.electronAPI) {\r\n                    window.electronAPI.readMsg(this.state.topic, seq);\r\n                }\r\n            } catch (err) {\r\n              console.error(\"Failed to send read notification\", err);\r\n            }\r\n          }\r\n        }\r\n      }, NOTIFICATION_EXEC_INTERVAL);\r\n    }\r\n\r\n    const now = new Date();\r\n    this.readNotificationQueue.push({\r\n      topicName: this.state.topic,\r\n      seq: seq,\r\n      sendAt: now.setMilliseconds(now.getMilliseconds() + READ_DELAY)\r\n    });\r\n  }\r\n\r\n  // Clear notification queue and timer.\r\n  clearNotificationQueue() {\r\n    this.readNotificationQueue = [];\r\n    if (this.readNotificationTimer) {\r\n      clearInterval(this.readNotificationTimer);\r\n      this.readNotificationTimer = null;\r\n    }\r\n  }\r\n\r\n  handleSubsUpdated() {\r\n    if (this.state.topic) {\r\n      console.log(123123, 'handleSubsUpdated');\r\n      const subs = [];\r\n      const topic = this.props.tinode.getTopic(this.state.topic);\r\n      topic.subscribers(sub => {\r\n        if (sub.online && sub.user != this.props.myUserId) {\r\n          subs.push(sub);\r\n        }\r\n      });\r\n      const newState = {onlineSubs: subs, subsVersion: this.state.subsVersion + 1};\r\n      const peer = topic.p2pPeerDesc();\r\n      if (peer) {\r\n        Object.assign(newState, {\r\n          peerMessagingDisabled: isPeerRestricted(peer.acs)\r\n        });\r\n      } else if (this.state.peerMessagingDisabled) {\r\n        Object.assign(newState, {\r\n          peerMessagingDisabled: false\r\n        });\r\n      }\r\n      this.setState(newState);\r\n    }\r\n  }\r\n\r\n  // The 'msg' could be false-ish if some message ranges were deleted.\r\n  handleMessageUpdate(msg) {\r\n    // console.log('111', msg, this.state.topic);\r\n    if (!this.state.topic) {\r\n      return;\r\n    }\r\n    const topic = this.props.tinode.getTopic(this.state.topic);\r\n    if (!msg) {\r\n      console.log(123, '触发到更新视图啦', this.state.topic);\r\n      // msg could be null if one or more messages were deleted.\r\n      // Updating state to force redraw.\r\n      this.setState({latestClearId: topic.maxClearId()});\r\n      this.props.onResetContactList();\r\n      this.forceUpdate();\r\n      return;\r\n    }\r\n    // console.log(2222, topic, msg);\r\n    clearTimeout(this.keyPressTimer)\r\n    this.setState({maxSeqId: topic.maxMsgSeq(), minSeqId: topic.minMsgSeq(), typingIndicator: false}, _ => {\r\n      // Scroll to the bottom if the message is added to the end of the message\r\n      // list if already at the bottom, otherwise show [go to latest] button.\r\n      // Implemented as a callback to be sure the scroll height has been updated.\r\n      if (topic.isNewMessage(msg.seq)) {\r\n        if (this.state.scrollPosition > SHOW_GO_TO_LAST_DIST) {\r\n          this.setState({showGoToLastButton: true});\r\n        } else {\r\n          this.goToLatestMessage();\r\n        }\r\n      } else {\r\n        if (this.messagesScroller) {\r\n          this.messagesScroller.scrollTop = this.messagesScroller.scrollHeight - this.state.scrollPosition -\r\n            this.messagesScroller.offsetHeight;\r\n        }\r\n      }\r\n    });\r\n\r\n    // Aknowledge messages except own messages. They are\r\n    // automatically assumed to be read and recived.\r\n    // console.log(666666, msg);\r\n    const status = topic.msgStatus(msg, true);\r\n    if (status >= Tinode.MESSAGE_STATUS_SENT && msg.from != this.props.myUserId) {\r\n      this.postReadNotification(msg.seq);\r\n    }\r\n    this.props.onResetContactList();\r\n  }\r\n\r\n  handleAllMessagesReceived(count) {\r\n    this.setState({fetchingMessages: false});\r\n    if (!count) {\r\n      // All messages received. Nothing left to receive.\r\n      const topic = this.props.tinode.getTopic(this.state.topic);\r\n      if (topic) {\r\n        // Send read notification for the absolute last message.\r\n        this.postReadNotification(topic.seq);\r\n      }\r\n      return;\r\n    }\r\n\r\n    // Load pinned message too (if any);\r\n    if (!this.state.pinsLoaded) {\r\n      // This needs to be guarded to avoid an infinite loop.\r\n      // The loop may happen if some pinned messages are deleted.\r\n      const topic = this.props.tinode.getTopic(this.state.topic);\r\n      this.setState({pinsLoaded: true}, _ => {\r\n        topic.getPinnedMessages();\r\n      });\r\n    } else {\r\n      this.setState({pinsLoaded: false});\r\n    }\r\n  }\r\n\r\n  handleAuxUpdate(aux) {\r\n    const pins = (aux['pins'] || []).slice();\r\n    let selectedPin = this.state.selectedPin;\r\n    if (pins.length > this.state.pins.length) {\r\n      // New pins added, show the latest.\r\n      selectedPin = 0;\r\n    } else if (selectedPin >= pins.length) {\r\n      selectedPin =  Math.max(0, pins.length - 1);\r\n    }\r\n    this.setState({pins: pins, selectedPin: selectedPin});\r\n  }\r\n\r\n  handleInfoReceipt(info) {\r\n    switch (info.what) {\r\n      case 'kp': {\r\n        clearTimeout(this.keyPressTimer);\r\n        this.keyPressTimer = setTimeout(_ => this.setState({typingIndicator: false}), KEYPRESS_DELAY + 1000);\r\n        if (!this.state.typingIndicator) {\r\n          this.setState({typingIndicator: true});\r\n        }\r\n        break;\r\n      }\r\n      case 'read':\r\n      case 'recv':\r\n        // Redraw due to changed recv/read status.\r\n        this.forceUpdate();\r\n        break;\r\n      default:\r\n        console.info(\"Other change in topic: \", info.what);\r\n    }\r\n  }\r\n\r\n  handleExpandMedia(content) {\r\n    if (!content) {\r\n      return;\r\n    }\r\n\r\n    if (content.video) {\r\n      this.setState({videoPostview: content});\r\n    } else {\r\n      this.setState({imagePostview: content});\r\n    }\r\n  }\r\n\r\n  handleClosePreview() {\r\n    if (this.state.imagePreview && this.state.imagePreview.url) {\r\n      URL.revokeObjectURL(this.state.imagePreview.url);\r\n    }\r\n    if (this.state.videoPreview && this.state.videoPreview.url) {\r\n      URL.revokeObjectURL(this.state.videoPreview.url);\r\n    }\r\n    this.setState({ imagePostview: null, imagePreview: null, docPreview: null, videoPreview: null, videoPostview: null});\r\n  }\r\n\r\n  handleFormResponse(action, text, data) {\r\n    if (action == 'pub') {\r\n      this.sendMessage(Drafty.attachJSON(Drafty.parse(text), data));\r\n    } else if (action == 'url') {\r\n      const url = new URL(data.ref);\r\n      const params = url.searchParams;\r\n      for (let key in data.resp) {\r\n        if (data.resp.hasOwnProperty(key)) {\r\n          params.set(key, data.resp[key]);\r\n        }\r\n      }\r\n      ['name', 'seq'].forEach(key => {\r\n        if (data[key]) {\r\n          params.set(key, data[key]);\r\n        }\r\n      });\r\n      params.set('uid', this.props.myUserId);\r\n      params.set('topic', this.state.topic);\r\n      url.search = params;\r\n      window.open(url, '_blank');\r\n    } else {\r\n      console.info(\"Unknown action in form\", action);\r\n    }\r\n  }\r\n\r\n  handleContextClick(e) {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    this.props.showContextMenu({ topicName: this.state.topic, y: e.pageY, x: e.pageX });\r\n  }\r\n\r\n  handleShowMessageContextMenu(params, messageSpecificMenuItems) {\r\n    if (params.userFrom == 'chan') {\r\n      params.userFrom = this.state.topic;\r\n      params.userName = this.state.title;\r\n    }\r\n    params.topicName = this.state.topic;\r\n    const menuItems = messageSpecificMenuItems || [];\r\n    const topic = this.props.tinode.getTopic(params.topicName);\r\n    if (topic) {\r\n      if (!topic.isChannelType()) {\r\n        menuItems.push('message_delete');\r\n      }\r\n      const acs = topic.getAccessMode();\r\n      if (acs && acs.isDeleter()) {\r\n        menuItems.push('message_delete_hard');\r\n      } else if (params.userFrom === this.props.myUserId && !topic.isChannelType()) {\r\n        menuItems.push('message_delete_hard');\r\n      }\r\n    }\r\n    this.props.showContextMenu(params, menuItems);\r\n  }\r\n\r\n  handleNewChatAcceptance(action) {\r\n    this.props.onNewChat(this.state.topic, action);\r\n  }\r\n\r\n  handleEnablePeer(e) {\r\n    e.preventDefault();\r\n    this.props.onChangePermissions(this.state.topic, DEFAULT_P2P_ACCESS_MODE, this.state.topic);\r\n  }\r\n\r\n  sendKeyPress(audio) {\r\n    const topic = this.props.tinode.getTopic(this.state.topic);\r\n    if (topic.isSubscribed()) {\r\n      if (audio) {\r\n        topic.noteRecording(true);\r\n      } else {\r\n        topic.noteKeyPress();\r\n      }\r\n    }\r\n  }\r\n\r\n  // sendMessage sends the message with an optional subscription to topic first.\r\n  sendMessage(msg, uploadCompletionPromise, uploader) {\r\n    let head;\r\n    if (this.props.forwardMessage) {\r\n      // We are forwarding a message.\r\n      msg = this.props.forwardMessage.msg;\r\n      head = this.props.forwardMessage.head;\r\n      this.handleCancelReply();\r\n    } else if (this.state.reply) {\r\n      if (this.state.reply.editing) {\r\n        if (msg == this.state.contentToEdit) {\r\n          // Message unchanged.\r\n          this.handleCancelReply();\r\n          return;\r\n        }\r\n        // Editing an existing message.\r\n        head = {replace: ':' + this.state.reply.seq};\r\n      } else if (this.state.reply.content) {\r\n        // Replying to a message in this topic.\r\n        // Turn it into Drafty so we can make a quoted Drafty object later.\r\n        head = {reply: '' + this.state.reply.seq};\r\n        if (typeof msg == 'string') {\r\n          msg = Drafty.parse(msg);\r\n        }\r\n        msg = Drafty.append(Drafty.sanitizeEntities(this.state.reply.content), msg);\r\n      }\r\n      this.handleCancelReply();\r\n    }\r\n    this.props.sendMessage(msg, uploadCompletionPromise, uploader, head);\r\n  }\r\n\r\n  // Retry sending a message.\r\n  retrySend(pub) {\r\n    this.props.sendMessage(pub.content, undefined, undefined, pub.head)\r\n      .then(_ => {\r\n        // All good. Remove the original message draft from the cache.\r\n        const topic = this.props.tinode.getTopic(this.state.topic);\r\n        topic.delMessagesList([pub.seq], true);\r\n      });\r\n  }\r\n\r\n  // Send attachment as Drafty message:\r\n  // - if file is too large, upload it and send a s link.\r\n  // - if file is small enough, just send it in-band.\r\n  sendFileAttachment(file) {\r\n    // Server-provided limit reduced for base64 encoding and overhead.\r\n    const maxInbandAttachmentSize = (this.props.tinode.getServerParam('maxMessageSize',\r\n      MAX_INBAND_ATTACHMENT_SIZE) * 0.75 - 1024) | 0;\r\n\r\n    // If the attachment is a JSON file, then use 'application/octet-stream' instead of 'application/json'.\r\n    // This is a temporary workaround for the collision with the 'application/json' MIME type of form responses.\r\n    // Remove this code in 2026 or so.\r\n    const jsonMimeConverter = (fileType) => fileType === DRAFTY_FR_MIME_TYPE_LEGACY ? 'application/octet-stream' : fileType;\r\n\r\n    if (file.size > maxInbandAttachmentSize) {\r\n      // Too large to send inband - uploading out of band and sending as a link.\r\n      const uploader = this.props.tinode.getLargeFileHelper();\r\n      if (!uploader) {\r\n        this.props.onError(this.props.intl.formatMessage(messages.cannot_initiate_upload));\r\n        return;\r\n      }\r\n      const uploadCompletionPromise = uploader.upload(file);\r\n      const msg = Drafty.attachFile(null, {\r\n        mime: jsonMimeConverter(file.type),\r\n        filename: file.name,\r\n        size: file.size,\r\n        urlPromise: uploadCompletionPromise\r\n      });\r\n      // Pass data and the uploader to the TinodeWeb.\r\n      this.sendMessage(msg, uploadCompletionPromise, uploader);\r\n    } else {\r\n      // Small enough to send inband.\r\n      fileToBase64(file)\r\n        .then(b64 => this.sendMessage(Drafty.attachFile(null, {\r\n          mime: jsonMimeConverter(b64.mime),\r\n          data: b64.bits,\r\n          filename: b64.name,\r\n          size: file.size\r\n        })))\r\n        .catch(err => this.props.onError(err.message, 'err'));\r\n    }\r\n  }\r\n\r\n  // handleAttachFile method is called when [Attach file] button is clicked: launch attachment preview.\r\n  handleAttachFile(file) {\r\n    const maxExternAttachmentSize = this.props.tinode.getServerParam('maxFileUploadSize', MAX_EXTERN_ATTACHMENT_SIZE);\r\n    console.log('drop', 'in handleAttachFile', file);\r\n    if (file.size > maxExternAttachmentSize) {\r\n      // Too large.\r\n      this.props.onError(this.props.intl.formatMessage(messages.file_attachment_too_large,\r\n        {size: bytesToHumanSize(file.size), limit: bytesToHumanSize(maxExternAttachmentSize)}), 'err');\r\n    } else {\r\n      this.setState({\r\n        docPreview: {\r\n          file: file,\r\n          name: file.name,\r\n          size: file.size,\r\n          type: file.type\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  handleCallHangup(topic, seq) {\r\n    this.props.onVideoCallClosed();\r\n    this.setState({\r\n      rtcPanel: null\r\n    });\r\n    this.props.onCallHangup(topic, seq);\r\n  }\r\n\r\n  // sendImageAttachment sends the image bits as Drafty message.\r\n  sendImageAttachment(caption, blob) {\r\n    const mime = this.state.imagePreview.mime;\r\n    const width = this.state.imagePreview.width;\r\n    const height = this.state.imagePreview.height;\r\n    const fname = this.state.imagePreview.filename;\r\n\r\n    // Server-provided limit reduced for base64 encoding and overhead.\r\n    const maxInbandAttachmentSize = (this.props.tinode.getServerParam('maxMessageSize',\r\n      MAX_INBAND_ATTACHMENT_SIZE) * 0.75 - 1024) | 0;\r\n\r\n    if (blob.size > maxInbandAttachmentSize) {\r\n      // Too large to send inband - uploading out of band and sending as a link.\r\n      const uploader = this.props.tinode.getLargeFileHelper();\r\n      if (!uploader) {\r\n        this.props.onError(this.props.intl.formatMessage(messages.cannot_initiate_upload));\r\n        return;\r\n      }\r\n      const uploadCompletionPromise = uploader.upload(blob);\r\n\r\n      // Make small preview to show while uploading.\r\n      imageScaled(blob, IMAGE_PREVIEW_DIM, IMAGE_PREVIEW_DIM, -1, false)\r\n        // Convert tiny image into base64 for serialization and previewing.\r\n        .then(scaled => blobToBase64(scaled.blob))\r\n        .then(b64 => {\r\n          let msg = Drafty.insertImage(null, 0, {\r\n            mime: mime,\r\n            _tempPreview: b64.bits, // This preview will not be serialized.\r\n            bits: b64.bits, // Image thumbnail.\r\n            width: width,\r\n            height: height,\r\n            filename: fname,\r\n            size: blob.size,\r\n            urlPromise: uploadCompletionPromise\r\n          });\r\n          if (caption) {\r\n            msg = Drafty.appendLineBreak(msg);\r\n            msg = Drafty.append(msg, Drafty.parse(caption));\r\n          }\r\n          // Pass data and the uploader to the TinodeWeb.\r\n          this.sendMessage(msg, uploadCompletionPromise, uploader);\r\n        })\r\n        .catch(err => this.props.onError(err, 'err'));\r\n      return;\r\n    }\r\n\r\n    // Send the image inband if it's not too big. The image has been scaled already\r\n    // in image preview.\r\n    blobToBase64(blob)\r\n      .then(b64 => {\r\n        let msg = Drafty.insertImage(null, 0, {\r\n          mime: b64.mime,\r\n          bits: b64.bits,\r\n          width: width,\r\n          height: height,\r\n          filename: fname,\r\n          size: blob.size\r\n        });\r\n        if (caption) {\r\n          msg = Drafty.appendLineBreak(msg);\r\n          msg = Drafty.append(msg, Drafty.parse(caption));\r\n        }\r\n        this.sendMessage(msg);\r\n      });\r\n  }\r\n\r\n  // sendVideoAttachment sends the video bits as Drafty message.\r\n  sendVideoAttachment(caption, videoBlob, previewBlob, params) {\r\n    const width = params.width;\r\n    const height = params.height;\r\n\r\n    // Server-provided limit reduced for base64 encoding and overhead.\r\n    const maxInbandAttachmentSize = (this.props.tinode.getServerParam('maxMessageSize',\r\n      MAX_INBAND_ATTACHMENT_SIZE) * 0.75 - 1024) | 0;\r\n\r\n    const uploads = [];\r\n    let uploader;\r\n    if ((videoBlob.size + previewBlob.size) > maxInbandAttachmentSize) {\r\n      // One or both are too large to send inband. Uploading out of band and sending as a link.\r\n      uploader = this.props.tinode.getLargeFileHelper();\r\n      if (!uploader) {\r\n        this.props.onError(this.props.intl.formatMessage(messages.cannot_initiate_upload));\r\n        return;\r\n      }\r\n\r\n      uploads[0] = videoBlob.size > maxInbandAttachmentSize * 0.675 ? uploader.upload(videoBlob) : null;\r\n      uploads[1] = previewBlob.size > maxInbandAttachmentSize * 0.275 ? uploader.upload(previewBlob) : null;\r\n    }\r\n\r\n    if (uploads.length == 0) {\r\n      // Both video and preview are small enough to send inband.\r\n      Promise.all([blobToBase64(videoBlob), blobToBase64(previewBlob)])\r\n        .then(b64s => {\r\n          const [v64, i64] = b64s;\r\n          let msg = Drafty.insertVideo(null, 0, {\r\n            mime: v64.mime,\r\n            bits: v64.bits,\r\n            preview: i64.bits,\r\n            premime: i64.mime,\r\n            width: width,\r\n            height: height,\r\n            duration: params.duration,\r\n            filename: params.name,\r\n            size: videoBlob.size\r\n          });\r\n          if (caption) {\r\n            msg = Drafty.appendLineBreak(msg);\r\n            msg = Drafty.append(msg, Drafty.parse(caption));\r\n          }\r\n          this.sendMessage(msg);\r\n      });\r\n      return;\r\n    }\r\n\r\n    const uploadCompletionPromise = Promise.all(uploads);\r\n\r\n    const b64conv = [];\r\n    // Small video converted to base64.\r\n    b64conv[0] = uploads[0] ? null : blobToBase64(videoBlob);\r\n    // Full-size preview fits inline.\r\n    b64conv[1] = uploads[1] ? null : imageScaled(previewBlob, MAX_IMAGE_DIM, MAX_IMAGE_DIM, -1, false)\r\n      .then(scaled => blobToBase64(scaled.blob));\r\n    // Small preview to show while uploading.\r\n    b64conv[2] = imageScaled(previewBlob, VIDEO_PREVIEW_DIM, VIDEO_PREVIEW_DIM, -1, false)\r\n      .then(scaled => blobToBase64(scaled.blob));\r\n    // Convert tiny image into base64 for serialization and previewing.\r\n    Promise.all(b64conv)\r\n      .then(b64s => {\r\n        const [video, img, preview] = b64s;\r\n        let msg = Drafty.insertVideo(null, 0, {\r\n          mime: params.mime,\r\n          bits: video ? video.bits : null,\r\n          _tempPreview: preview.bits,\r\n          preview: img ? img.bits : preview.bits,\r\n          premime: img ? img.mime : preview.mime,\r\n          width: width,\r\n          height: height,\r\n          duration: params.duration,\r\n          filename: params.name,\r\n          size: videoBlob.size,\r\n          urlPromise: uploadCompletionPromise\r\n        });\r\n\r\n        if (caption) {\r\n          msg = Drafty.appendLineBreak(msg);\r\n          msg = Drafty.append(msg, Drafty.parse(caption));\r\n        }\r\n        // Pass data and the uploader to the TinodeWeb.\r\n        this.sendMessage(msg, uploadCompletionPromise, uploader);\r\n      })\r\n      .catch(err => this.props.onError(err.message, 'err'));\r\n  }\r\n\r\n  // handleAttachImageOrVideo method is called when [Attach image or video] button is clicked: launch image or video preview.\r\n  handleAttachImageOrVideo(file) {\r\n    const maxExternAttachmentSize = this.props.tinode.getServerParam('maxFileUploadSize', MAX_EXTERN_ATTACHMENT_SIZE);\r\n    console.log('drop', 'in handleAttachImageOrVideo', file);\r\n    if (file.type.startsWith('video/')) {\r\n      this.setState({videoPreview: {\r\n        url: URL.createObjectURL(file),\r\n        blob: file,\r\n        filename: file.name,\r\n        size: file.size,\r\n        mime: file.type\r\n      }});\r\n      return;\r\n    }\r\n\r\n    // Get image dimensions and size, optionally scale it down.\r\n    imageScaled(file, MAX_IMAGE_DIM, MAX_IMAGE_DIM, maxExternAttachmentSize, false)\r\n      .then(scaled => {\r\n        this.setState({imagePreview: {\r\n          url: URL.createObjectURL(scaled.blob),\r\n          blob: scaled.blob,\r\n          filename: scaled.name,\r\n          width: scaled.width,\r\n          height: scaled.height,\r\n          size: scaled.blob.size,\r\n          mime: scaled.mime\r\n        }});\r\n      }).catch(err => {\r\n        this.props.onError(err.message, 'err');\r\n      });\r\n  }\r\n\r\n  // handleFileDrop is called when the user drags & drops a file upon the message view.\r\n  handleFileDrop(files) {\r\n    console.log('drop', 'in handleFileDrop', files);\r\n    if (!files || files.length == 0) {\r\n      return;\r\n    }\r\n    const file = files[0];\r\n    if (file.type && file.type.startsWith('image/')) {\r\n      console.log('drop', 'handleAttachImageOrVideo', files);\r\n      this.handleAttachImageOrVideo(file);\r\n    } else {\r\n      console.log('drop', 'handleAttachFile', files);\r\n      this.handleAttachFile(file);\r\n    }\r\n  }\r\n\r\n  // sendAudioAttachment sends audio bits inband as Drafty message (no preview).\r\n  sendAudioAttachment(url, preview, duration) {\r\n    fetch(url)\r\n      .then(result => result.blob())\r\n      .then(blob => {\r\n        // Server-provided limit reduced for base64 encoding and overhead.\r\n        const maxInbandAttachmentSize = this.props.tinode.getServerParam('maxMessageSize', MAX_INBAND_ATTACHMENT_SIZE) * 0.75 - 1024;\r\n        if (blob.size > maxInbandAttachmentSize) {\r\n          // Too large to send inband - uploading out of band and sending as a link.\r\n          const uploader = this.props.tinode.getLargeFileHelper();\r\n          if (!uploader) {\r\n            this.props.onError(this.props.intl.formatMessage(messages.cannot_initiate_upload));\r\n            return;\r\n          }\r\n          const uploadCompletionPromise = uploader.upload(blob);\r\n          const msg = Drafty.appendAudio(null, {\r\n            mime: blob.type,\r\n            size: blob.size,\r\n            duration: duration,\r\n            preview: preview,\r\n            urlPromise: uploadCompletionPromise\r\n          });\r\n          // Pass data and the uploader to the TinodeWeb.\r\n          this.sendMessage(msg, uploadCompletionPromise, uploader);\r\n        } else {\r\n          // Small enough to send inband.\r\n          blobToBase64(blob)\r\n            .then(b64 => {\r\n              this.sendMessage(Drafty.appendAudio(null, {\r\n                mime: b64.mime,\r\n                bits: b64.bits,\r\n                size: blob.size,\r\n                duration: duration,\r\n                preview: preview,\r\n              }))\r\n            })\r\n        }\r\n      })\r\n      .catch(err => {this.props.onError(err.message, 'err')});;\r\n  }\r\n\r\n  handleCancelUpload(seq, uploader) {\r\n    const topic = this.props.tinode.getTopic(this.state.topic);\r\n    const found = topic.findMessage(seq);\r\n    if (found) {\r\n      found._cancelled = true;\r\n    }\r\n    uploader.cancel();\r\n  }\r\n\r\n  // seq: seq ID of the source message\r\n  // context: message content.\r\n  // senderId: UID of the sender of the source message.\r\n  // senderName: full name of the sender of the original message.\r\n  handlePickReply(seq, content, senderId, senderName) {\r\n    if (!seq || !content) {\r\n      this.setState({reply: null});\r\n      return;\r\n    }\r\n\r\n    content = typeof content == 'string' ? Drafty.init(content) : content;\r\n    if (Drafty.isValid(content)) {\r\n      content = Drafty.replyContent(content, QUOTED_REPLY_LENGTH);\r\n    } else {\r\n      // /!\\ invalid content.\r\n      content = Drafty.append(Drafty.init('\\u26A0 '),\r\n        Drafty.wrapInto(this.props.intl.formatMessage(messages.invalid_content), 'EM'));\r\n    }\r\n\r\n    this.setState({\r\n      reply: {\r\n        content: Drafty.quote(senderName, senderId, content),\r\n        seq: seq\r\n      }\r\n    });\r\n    this.props.onCancelForwardMessage();\r\n  }\r\n\r\n  // seq: seq ID of the message to edit.\r\n  // context: message content.\r\n  handleEditMessage(seq, content) {\r\n    if (!seq || !content) {\r\n      this.setState({reply: null});\r\n      return;\r\n    }\r\n\r\n    content = typeof content == 'string' ? Drafty.init(content) : content;\r\n    const editable = Drafty.toMarkdown(content);\r\n    if (Drafty.isValid(content)) {\r\n      content = Drafty.replyContent(content, EDIT_PREVIEW_LENGTH);\r\n    } else {\r\n      // /!\\ invalid content.\r\n      content = Drafty.append(Drafty.init('\\u26A0 '),\r\n        Drafty.wrapInto(this.props.intl.formatMessage(messages.invalid_content), 'EM'));\r\n    }\r\n\r\n    this.setState({\r\n      reply: {\r\n        content: Drafty.quote(this.props.intl.formatMessage(messages.editing_message), null, content),\r\n        seq: seq,\r\n        editing: true\r\n      },\r\n      contentToEdit: editable\r\n    });\r\n    this.props.onCancelForwardMessage();\r\n  }\r\n\r\n\r\n  handleCancelReply() {\r\n    this.setState({reply: null, contentToEdit: null});\r\n    this.props.onCancelForwardMessage();\r\n  }\r\n\r\n  handleQuoteClick(replyToSeq) {\r\n    const ref = this.getOrCreateMessageRef(replyToSeq);\r\n    if (ref && ref.current) {\r\n      ref.current.scrollIntoView({block: \"center\", behavior: \"smooth\"});\r\n      ref.current.classList.add('flash');\r\n      setTimeout(_ => {ref.current.classList.remove('flash')} , 1000);\r\n    } else {\r\n      console.error(\"Unresolved message ref\", replyToSeq);\r\n    }\r\n  }\r\n\r\n  handleUnpinMessage(seq) {\r\n    const topic = this.props.tinode.getTopic(this.state.topic);\r\n    topic.pinMessage(seq, false);\r\n  }\r\n\r\n  isDragEnabled() {\r\n    return this.state.isWriter && !this.state.unconfirmed && !this.props.forwardMessage && !this.state.peerMessagingDisabled;\r\n  }\r\n\r\n  handleDragStart(e) {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    e.dataTransfer.clearData();\r\n  }\r\n\r\n  handleDragIn(e) {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    this.dragCounter++;\r\n    if (e.dataTransfer.items && e.dataTransfer.items.length > 0) {\r\n      this.setState({dragging: true});\r\n    }\r\n  }\r\n\r\n  handleDragOut(e) {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    this.dragCounter--;\r\n    if (this.dragCounter <= 0) {\r\n      this.setState({dragging: false});\r\n    }\r\n  }\r\n\r\n  handleDrag(e) {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n  }\r\n\r\n  handleDrop(e) {\r\n    console.log('drop', 'handleDrop start');\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    this.setState({dragging: false});\r\n    console.log('drop', this.isDragEnabled());\r\n    console.log('drop', e.dataTransfer.files);\r\n    console.log('drop', e.dataTransfer.files.length);\r\n    if (this.isDragEnabled() && e.dataTransfer.files && e.dataTransfer.files.length > 0) {\r\n      this.handleFileDrop(e.dataTransfer.files);\r\n      this.dragCounter = 0;\r\n    }\r\n    console.log('drop', 'handleDrop end');\r\n  }\r\n\r\n  render() {\r\n    const {formatMessage} = this.props.intl;\r\n\r\n    let component;\r\n    if (!this.state.topic) {\r\n      component = (\r\n        <LogoView\r\n          serverVersion={this.props.serverVersion}\r\n          serverAddress={this.props.serverAddress} />\r\n      );\r\n    } else {\r\n      let component2;\r\n      if (this.state.imagePreview) {\r\n        // Preview image before sending.\r\n        component2 = (\r\n          <ImagePreview\r\n            content={this.state.imagePreview}\r\n            tinode={this.props.tinode}\r\n            reply={this.state.reply}\r\n            onCancelReply={this.handleCancelReply}\r\n            onClose={this.handleClosePreview}\r\n            onSendMessage={this.sendImageAttachment} />\r\n        );\r\n      } else if (this.state.videoPreview) {\r\n          // Preview video.\r\n        component2 = (\r\n          <VideoPreview\r\n            content={this.state.videoPreview}\r\n            tinode={this.props.tinode}\r\n            reply={this.state.reply}\r\n            onError={this.props.onError}\r\n            onCancelReply={this.handleCancelReply}\r\n            onClose={this.handleClosePreview}\r\n            onSendMessage={this.sendVideoAttachment} />\r\n        );\r\n      } else if (this.state.imagePostview) {\r\n        // Expand received image.\r\n        component2 = (\r\n          <ImagePreview\r\n            content={this.state.imagePostview}\r\n            onClose={this.handleClosePreview} />\r\n        );\r\n      } else if (this.state.videoPostview) {\r\n        // Play received video.\r\n        component2 = (\r\n          <VideoPreview\r\n            content={this.state.videoPostview}\r\n            tinode={this.props.tinode}\r\n            onError={this.props.onError}\r\n            onClose={this.handleClosePreview} />\r\n        );\r\n      } else if (this.state.docPreview) {\r\n        // Preview attachment before sending.\r\n        component2 = (\r\n          <DocPreview\r\n            content={this.state.docPreview}\r\n            tinode={this.props.tinode}\r\n            reply={this.state.reply}\r\n            onCancelReply={this.handleCancelReply}\r\n            onClose={this.handleClosePreview}\r\n            onSendMessage={this.sendFileAttachment} />\r\n        );\r\n      } else if (this.state.rtcPanel) {\r\n        // P2P call.\r\n        component2 = (\r\n          <CallPanel\r\n            topic={this.state.topic}\r\n            seq={this.props.callSeq}\r\n            callState={this.props.callState}\r\n            callAudioOnly={this.props.callAudioOnly}\r\n            tinode={this.props.tinode}\r\n            title={this.state.title}\r\n            avatar={this.state.avatar || true}\r\n\r\n            onError={this.props.onError}\r\n            onHangup={this.handleCallHangup}\r\n            onInvite={this.props.onCallInvite}\r\n            onSendOffer={this.props.onCallSendOffer}\r\n            onIceCandidate={this.props.onCallIceCandidate}\r\n            onSendAnswer={this.props.onCallSendAnswer} />\r\n        );\r\n      } else {\r\n        const topic = this.props.tinode.getTopic(this.state.topic);\r\n        const isChannel = topic.isChannelType();\r\n        const groupTopic = topic.isGroupType() && !isChannel;\r\n        const icon_badges = [];\r\n        if (topic.trusted) {\r\n          if (topic.trusted.verified) {\r\n            icon_badges.push({icon: 'verified', color: 'badge-inv'});\r\n          }\r\n          if (topic.trusted.staff) {\r\n            icon_badges.push({icon: 'staff', color: 'badge-inv'});\r\n          }\r\n          if (topic.trusted.danger) {\r\n            icon_badges.push({icon: 'dangerous', color: 'badge-inv'});\r\n          }\r\n        }\r\n\r\n        const pinnedMessages = [];\r\n        this.state.pins.forEach(seq => pinnedMessages.push(topic.latestMsgVersion(seq) || topic.findMessage(seq)));\r\n\r\n        const messageNodes = [];\r\n        let previousFrom = null;\r\n        let prevDate = null;\r\n        let chatBoxClass = null;\r\n        topic.messages((msg, prev, next, i) => {\r\n          let nextFrom = next ? (next.from || 'chan') : null;\r\n\r\n          let sequence = 'single';\r\n          let thisFrom = msg.from || 'chan';\r\n          if (thisFrom == previousFrom) {\r\n            if (thisFrom == nextFrom) {\r\n              sequence = 'middle';\r\n            } else {\r\n              sequence = 'last';\r\n            }\r\n          } else if (thisFrom == nextFrom) {\r\n            sequence = 'first';\r\n          }\r\n          previousFrom = thisFrom;\r\n\r\n          const isReply = !(thisFrom == this.props.myUserId);\r\n          // console.log(555555, msg);\r\n          const deliveryStatus = topic.msgStatus(msg, true);\r\n\r\n          let userFrom = thisFrom, userName, userAvatar;\r\n          const user = topic.userDesc(thisFrom);\r\n          if (user && user.public) {\r\n            userName = user.public.fn;\r\n            userAvatar = makeImageUrl(user.public.photo);\r\n          }\r\n          chatBoxClass = groupTopic ? 'chat-box group' : 'chat-box';\r\n\r\n          // Ref for this chat message.\r\n          const ref = this.getOrCreateMessageRef(msg.seq);\r\n          let replyToSeq = msg.head ? parseInt(msg.head.reply) : null;\r\n          if (!replyToSeq || isNaN(replyToSeq)) {\r\n            replyToSeq = null;\r\n          }\r\n\r\n          if (msg.hi) {\r\n            // Deleted message.\r\n            messageNodes.push(\r\n              <MetaMessage\r\n                deleted={true}\r\n                key={msg.seq} />\r\n              );\r\n          } else {\r\n            const thisDate = new Date(msg.ts);\r\n            // This message was sent on a different date than the previous.\r\n            if (!prevDate || prevDate.toDateString() != thisDate.toDateString()) {\r\n              messageNodes.push(\r\n                <MetaMessage\r\n                  date={relativeDateFormat(msg.ts)}\r\n                  locale={this.props.intl.locale}\r\n                  key={'date-' + msg.seq} />\r\n              );\r\n              prevDate = thisDate;\r\n            }\r\n            messageNodes.push(\r\n              <ChatMessage\r\n                tinode={this.props.tinode}\r\n                topic={this.state.topic}\r\n                content={msg.content}\r\n                mimeType={msg.head && msg.head.mime}\r\n                replyToSeq={replyToSeq}\r\n                edited={msg.head && !msg.head.webrtc && msg.head.replace}\r\n                timestamp={msg.ts}\r\n                response={isReply}\r\n                seq={msg.seq}\r\n                isGroup={groupTopic}\r\n                isChan={this.state.channel}\r\n                userFrom={userFrom}\r\n                userName={userName}\r\n                userAvatar={userAvatar}\r\n                sequence={sequence}\r\n                received={deliveryStatus}\r\n                uploader={msg._uploader}\r\n                userIsWriter={this.state.isWriter}\r\n                userIsAdmin={this.state.isAdmin}\r\n                pinned={this.state.pins.includes(msg.seq)}\r\n                viewportWidth={this.props.viewportWidth}  // Used by `formatter`.\r\n                showContextMenu={this.handleShowMessageContextMenu}\r\n                onExpandMedia={this.handleExpandMedia}\r\n                onFormResponse={this.handleFormResponse}\r\n                onCancelUpload={this.handleCancelUpload}\r\n                pickReply={this.handlePickReply}\r\n                editMessage={this.handleEditMessage}\r\n                onQuoteClick={this.handleQuoteClick}\r\n                onAcceptCall={this.props.onAcceptCall}\r\n                onError={this.props.onError}\r\n                ref={ref}\r\n                key={msg.seq} />\r\n            );\r\n          }\r\n        });\r\n\r\n        let lastSeen = null;\r\n        if (isChannel) {\r\n          lastSeen = formatMessage(messages.channel);\r\n        } else {\r\n          const cont = this.props.tinode.getMeTopic().getContact(this.state.topic);\r\n          if (cont && Tinode.isP2PTopicName(cont.topic)) {\r\n            if (cont.online) {\r\n              lastSeen = formatMessage(messages.online_now);\r\n            } else if (cont.seen) {\r\n              lastSeen = formatMessage(messages.last_seen) + \": \" +\r\n                shortDateFormat(cont.seen.when, this.props.intl.locale);\r\n              // TODO: also handle user agent in c.seen.ua\r\n            }\r\n          }\r\n        }\r\n        const avatar = this.state.avatar || true;\r\n        const online = this.state.deleted || topic.isSelfType() ? null :\r\n          this.props.online ? 'online' + (this.state.typingIndicator ? ' typing' : '') : 'offline';\r\n\r\n        const titleClass = 'panel-title' + (this.state.deleted ? ' deleted' : '');\r\n\r\n        let messagesComponent = (\r\n          <>\r\n            <div id=\"messages-container\">\r\n              <button id=\"go-to-latest\" className={'action-button' + (this.state.showGoToLastButton ? '' : ' hidden')}\r\n                onClick={this.goToLatestMessage}>\r\n                <i className=\"material-icons\">arrow_downward</i>\r\n              </button>\r\n              <div id=\"messages-panel\" ref={this.handleScrollReference}>\r\n                <ul id=\"scroller\" className={chatBoxClass}>\r\n                  {messageNodes}\r\n                </ul>\r\n              </div>\r\n              {!this.state.isReader ?\r\n              <div id=\"write-only-background\">\r\n                {this.state.readingBlocked ?\r\n                <div id=\"write-only-note\">\r\n                  <FormattedMessage id=\"messages_not_readable\" defaultMessage=\"no access to messages\"\r\n                    description=\"Message shown in topic without the read access\" />\r\n                </div>\r\n                : null }\r\n              </div>\r\n              : null }\r\n            </div>\r\n            {this.state.peerMessagingDisabled && !this.state.unconfirmed ?\r\n              <div id=\"peer-messaging-disabled-note\">\r\n                <i className=\"material-icons secondary\">block</i> <FormattedMessage\r\n                  id=\"peers_messaging_disabled\" defaultMessage=\"Peer's messaging is disabled.\"\r\n                  description=\"Shown when the p2p peer's messaging is disabled\" /> <a href=\"#\"\r\n                    onClick={this.handleEnablePeer}><FormattedMessage id=\"enable_peers_messaging\"\r\n                    defaultMessage=\"Enable\" description=\"Call to action to enable peer's messaging\" /></a>.\r\n              </div> : null}\r\n            {this.state.unconfirmed ?\r\n              <Invitation onAction={this.handleNewChatAcceptance} />\r\n              :\r\n              <SendMessage\r\n                tinode={this.props.tinode}\r\n                topicName={this.state.topic}\r\n                noInput={!!this.props.forwardMessage}\r\n                disabled={!this.state.isWriter || this.state.deleted}\r\n                reply={this.state.reply}\r\n                initMessage={this.state.contentToEdit}\r\n                onKeyPress={this.sendKeyPress}\r\n                onRecordingProgress={this.sendKeyPress}\r\n                onSendMessage={this.sendMessage}\r\n                onAttachFile={this.props.forwardMessage ? null : this.handleAttachFile}\r\n                onAttachImage={this.props.forwardMessage ? null : this.handleAttachImageOrVideo}\r\n                onAttachAudio={this.props.forwardMessage ? null : this.sendAudioAttachment}\r\n                onError={this.props.onError}\r\n                onQuoteClick={this.handleQuoteClick}\r\n                onCancelReply={this.handleCancelReply} />}\r\n          </>\r\n        );\r\n\r\n        component2 = (\r\n          <>\r\n            <div id=\"topic-caption-panel\" className=\"caption-panel\">\r\n              {this.props.displayMobile ?\r\n                <a href=\"#\" id=\"hide-message-view\" onClick={(e) => {e.preventDefault(); this.leave(this.state.topic); this.props.onHideMessagesView();}}>\r\n                  <i className=\"material-icons\">arrow_back</i>\r\n                </a>\r\n                :\r\n                null}\r\n              <div className=\"avatar-box\">\r\n                <LetterTile\r\n                  tinode={this.props.tinode}\r\n                  avatar={avatar}\r\n                  topic={this.state.topic}\r\n                  title={this.state.title}\r\n                  deleted={this.state.deleted} />\r\n                {!isChannel ? <span className={online} /> : null}\r\n              </div>\r\n              <div id=\"topic-title-group\">\r\n                <div id=\"topic-title\" className={titleClass}>{\r\n                  this.state.title ||\r\n                  <i><FormattedMessage id=\"unnamed_topic\" defaultMessage=\"Unnamed\"\r\n                    description=\"Title shown when the topic has no name\" /></i>\r\n                }<ContactBadges badges={icon_badges} /></div>\r\n                <div id=\"topic-last-seen\">{lastSeen}</div>\r\n              </div>\r\n              <div style={{marginLeft: 'auto'}}/>\r\n              {!this.props.displayMobile && this.state.pins.length > 0 ?\r\n                <PinnedMessages\r\n                  tinode={this.props.tinode}\r\n                  pins={this.state.pins}\r\n                  messages={pinnedMessages}\r\n                  selected={this.state.selectedPin}\r\n                  isAdmin={this.state.isAdmin}\r\n                  setSelected={index => this.setState({selectedPin: index})}\r\n                  onSelected={this.handleQuoteClick}\r\n                  onCancel={this.handleUnpinMessage} />\r\n                : null}\r\n              {groupTopic ?\r\n                <GroupSubs\r\n                  tinode={this.props.tinode}\r\n                  subscribers={this.state.onlineSubs} /> :\r\n                null\r\n              }\r\n              <div>\r\n                <a href=\"#\" onClick={this.handleContextClick}>\r\n                  <i className=\"material-icons\">more_vert</i>\r\n                </a>\r\n              </div>\r\n            </div>\r\n            {this.props.displayMobile ?\r\n              <>\r\n                {this.state.pins.length > 0 ?\r\n                  <PinnedMessages\r\n                    tinode={this.props.tinode}\r\n                    pins={this.state.pins}\r\n                    messages={pinnedMessages}\r\n                    selected={this.state.selectedPin}\r\n                    isAdmin={this.state.isAdmin}\r\n                    setSelected={index => this.setState({selectedPin: index})}\r\n                    onSelected={this.handleQuoteClick}\r\n                    onCancel={this.handleUnpinMessage} />\r\n                    : null\r\n                }\r\n                <ErrorPanel\r\n                  level={this.props.errorLevel}\r\n                  text={this.props.errorText}\r\n                  onClearError={this.props.onError} />\r\n              </>\r\n              : null}\r\n            <LoadSpinner show={this.state.fetchingMessages} />\r\n            {messagesComponent}\r\n            {this.state.dragging && this.isDragEnabled() ?\r\n              <div className=\"drag-n-drop\">{formatMessage(messages.drag_file)}</div>\r\n            : null}\r\n          </>\r\n        );\r\n      }\r\n      component = <div id=\"topic-view\"  ref={this.mountDnDEvents}>{component2}</div>\r\n    }\r\n    return component;\r\n  }\r\n};\r\n\r\nexport default injectIntl(MessagesView);\r\n","// The <- button to be displayed in title bars.\r\nimport React from 'react';\r\n\r\nexport default class ButtonBack extends React.PureComponent {\r\n  render() {\r\n    return (\r\n      <a href=\"#\" onClick={(e) => {e.preventDefault(); this.props.onBack();}}>\r\n        <i className=\"material-icons\">arrow_back</i>\r\n      </a>\r\n    );\r\n  }\r\n}\r\n","import React from 'react';\r\n\r\nexport default class MenuContacts extends React.PureComponent {\r\n  render() {\r\n    return (\r\n      <div>\r\n        <a href=\"#\" onClick={(e) => {e.preventDefault(); this.props.onNewTopic();}}><i className=\"material-icons\">chat</i></a>\r\n        &nbsp;\r\n        <a href=\"#\" onClick={(e) => {e.preventDefault(); this.props.onSettings();}}><i className=\"material-icons\">settings</i></a>\r\n      </div>\r\n    );\r\n  }\r\n};\r\n","import React from 'react';\r\n\r\nexport default class MenuStart extends React.PureComponent {\r\n  render() {\r\n    return (\r\n        <div>\r\n          <a href=\"#\" onClick={(e) => {e.preventDefault(); this.props.onSignUp();}}><i className=\"material-icons\">person_add</i></a>\r\n          &nbsp;\r\n          <a href=\"#\" onClick={(e) => {e.preventDefault(); this.props.onSettings();}}><i className=\"material-icons\">settings</i></a>\r\n        </div>\r\n    );\r\n  }\r\n};\r\n","import React from 'react';\r\n\r\nimport LetterTile from './letter-tile.jsx';\r\nimport ButtonBack from './button-back.jsx';\r\nimport ContactBadges from './contact-badges.jsx';\r\nimport MenuContacts from './menu-contacts.jsx';\r\nimport MenuStart from './menu-start.jsx';\r\n\r\nimport { sanitizeUrlForMime } from '../lib/utils.js';\r\n\r\nexport default class SideNavbar extends React.PureComponent {\r\n  render() {\r\n    const icon_badges = [];\r\n    if (this.props.trustedBadges) {\r\n      this.props.trustedBadges.forEach(b => {\r\n        icon_badges.push({icon: b, color: 'badge-inv'});\r\n      });\r\n    }\r\n    let avatar = null;\r\n    if (this.props.tinode) {\r\n      avatar = this.props.tinode.authorizeURL(sanitizeUrlForMime(this.props.avatar, 'image'));\r\n    }\r\n    return (\r\n      <div id=\"side-caption-panel\" className=\"caption-panel\">\r\n        {this.props.onCancel ? <ButtonBack onBack={this.props.onCancel} /> : null}\r\n        {avatar ?\r\n          <div id=\"self-avatar\" className=\"avatar-box\">\r\n            <LetterTile\r\n              tinode={this.props.tinode}\r\n              avatar={avatar}\r\n              topic={this.props.myUserId}\r\n              title={this.props.title} />\r\n          </div>\r\n          :\r\n          null}\r\n        <div id=\"sidepanel-title\" className=\"panel-title\">{this.props.title}<ContactBadges badges={icon_badges}/></div>\r\n        {this.props.state === 'login' ?\r\n            <MenuStart onSignUp={this.props.onSignUp} onSettings={this.props.onSettings} /> :\r\n          this.props.state === 'contacts' ?\r\n            <MenuContacts onNewTopic={this.props.onNewTopic} onSettings={this.props.onSettings} /> :\r\n          null}\r\n      </div>\r\n    );\r\n  }\r\n};\r\n","/* ContactsView holds all contacts-related stuff */\r\nimport React from 'react';\r\nimport { FormattedMessage, defineMessages } from 'react-intl';\r\n\r\nimport ContactList from '../widgets/contact-list.jsx';\r\n\r\nimport { updateFavicon } from '../lib/utils.js';\r\n\r\nconst messages = defineMessages({\r\n  archived_contacts_title: {\r\n    id: \"archived_contacts\",\r\n    defaultMessage: \"Archived contacts ({count})\",\r\n    description: \"Label for archived chats\"\r\n  }\r\n});\r\n\r\nexport default class ContactsView extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.handleAction = this.handleAction.bind(this);\r\n\r\n    this.state = ContactsView.deriveStateFromProps(props);\r\n  }\r\n\r\n  static deriveStateFromProps(props) {\r\n    const contacts = [];\r\n    let unreadThreads = 0;\r\n    let archivedCount = 0;\r\n    props.chatList.forEach(c => {\r\n      const blocked = c.acs && !c.acs.isJoiner();\r\n      // Show only blocked contacts only when props.blocked == true.\r\n      if (blocked && props.blocked) {\r\n        contacts.push(c);\r\n      }\r\n      if (blocked || props.blocked) {\r\n        return;\r\n      }\r\n\r\n      if (c.private && c.private.arch) {\r\n        if (props.archive) {\r\n          contacts.push(c);\r\n        } else {\r\n          archivedCount ++;\r\n        }\r\n      } else if (!props.archive) {\r\n        contacts.push(c);\r\n        unreadThreads += c.unread > 0 ? 1 : 0;\r\n      }\r\n    });\r\n\r\n    contacts.sort((a, b) => {\r\n      return (b.touched || 0) - (a.touched || 0);\r\n    });\r\n\r\n    if (archivedCount > 0) {\r\n      contacts.push({\r\n        action: 'archive',\r\n        title: messages.archived_contacts_title,\r\n        values: {count: archivedCount}\r\n      });\r\n    }\r\n\r\n    return {\r\n      contactList: contacts,\r\n      unreadThreads: unreadThreads\r\n    };\r\n  }\r\n\r\n  componentDidUpdate(prevProps, prevState) {\r\n    if (prevProps.chatList != this.props.chatList ||\r\n        prevProps.archive != this.props.archive ||\r\n        prevProps.blocked != this.props.blocked) {\r\n      const newState = ContactsView.deriveStateFromProps(this.props);\r\n      this.setState(newState);\r\n      if (newState.unreadThreads != prevState.unreadThreads) {\r\n        updateFavicon(newState.unreadThreads);\r\n      }\r\n    }\r\n  }\r\n\r\n  handleAction(action_ignored) {\r\n    this.props.onShowArchive();\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <FormattedMessage id=\"contacts_not_found\"\r\n        defaultMessage=\"You have no chats<br />¯∖_(ツ)_/¯\"\r\n        description=\"HTML message shown in ContactList when no contacts are found\">{\r\n        (no_contacts) => <ContactList\r\n          tinode={this.props.tinode}\r\n          connected={this.props.connected}\r\n          contacts={this.state.contactList}\r\n          emptyListMessage={no_contacts}\r\n          topicSelected={this.props.topicSelected}\r\n          myUserId={this.props.myUserId}\r\n          showOnline={true}\r\n          showUnread={true}\r\n          onTopicSelected={this.props.onTopicSelected}\r\n          showContextMenu={this.props.showContextMenu}\r\n          onAction={this.handleAction} />\r\n      }</FormattedMessage>\r\n    );\r\n  }\r\n};\r\n","// Edit account parameters.\r\nimport React from 'react';\r\nimport { FormattedMessage } from 'react-intl';\r\n\r\nimport CheckBox from '../widgets/checkbox.jsx';\r\n\r\nexport default class EditAccountView extends React.PureComponent {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.handleCheckboxClick = this.handleCheckboxClick.bind(this);\r\n  }\r\n\r\n  handleCheckboxClick(what, checked) {\r\n    if (what == 'sound') {\r\n      this.props.onToggleMessageSounds(checked);\r\n    } else if (what == 'alert') {\r\n      this.props.onTogglePushNotifications(checked);\r\n    } else if (what == 'incognito') {\r\n      this.props.onToggleIncognitoMode(checked);\r\n    }\r\n  }\r\n\r\n  render() {\r\n    return (\r\n        <div className=\"scrollable-panel\">\r\n          <div className=\"panel-form-row\">\r\n            <label htmlFor=\"message-sound\">\r\n              <FormattedMessage id=\"label_message_sound\" defaultMessage=\"Message sound:\"\r\n                description=\"Label for message sounds toggle\" />\r\n            </label>\r\n            <CheckBox name=\"sound\" id=\"message-sound\"\r\n              checked={this.props.messageSounds} onChange={this.handleCheckboxClick} />\r\n          </div>\r\n          <div className=\"panel-form-row\">\r\n            <label htmlFor=\"desktop-alerts\">\r\n            {this.props.desktopAlertsEnabled ?\r\n              <FormattedMessage id=\"label_push_notifications\" defaultMessage=\"Notification alerts:\"\r\n                description=\"Label for push notifications switch\" />\r\n              :\r\n              <FormattedMessage id=\"label_push_notifications_disabled\"\r\n                defaultMessage=\"Notification alerts (requires HTTPS):\"\r\n                description=\"Label for push notifications switch\" />\r\n            }\r\n            </label>\r\n            <CheckBox name=\"alert\" id=\"desktop-alerts\"\r\n              checked={this.props.desktopAlerts}\r\n              onChange={this.props.desktopAlertsEnabled ? this.handleCheckboxClick : null} />\r\n          </div>\r\n          <div className=\"panel-form-row\">\r\n            <label htmlFor=\"incognito-mode\">\r\n              <FormattedMessage id=\"label_incognito_mode\" defaultMessage=\"Incognito mode:\"\r\n                description=\"Label for incognito mode toggle\" />\r\n            </label>\r\n            <CheckBox name=\"incognito\" id=\"incognito-mode\"\r\n              checked={this.props.incognitoMode} onChange={this.handleCheckboxClick} />\r\n          </div>\r\n        </div>\r\n    );\r\n  }\r\n};\r\n","// Edit account parameters.\r\nimport React from 'react';\r\nimport { FormattedMessage, defineMessages, injectIntl } from 'react-intl';\r\n\r\nimport InPlaceEdit from '../widgets/in-place-edit.jsx';\r\nimport PermissionsEditor from '../widgets/permissions-editor.jsx';\r\n\r\nconst messages = defineMessages({\r\n  delete_account: {\r\n    id: 'delete_account',\r\n    defaultMessage: 'Delete account',\r\n    description: 'Title for delete account warning'\r\n  },\r\n  delete_account_warning: {\r\n    id: 'delete_account_warning',\r\n    defaultMessage: 'Are you sure you want to delete your account? It cannot be undone.',\r\n    description: 'Warning message when deleting an account'\r\n  },\r\n  delete_all_message: {\r\n    id: 'delete_all_message',\r\n    defaultMessage: 'Delete all message',\r\n    description: 'Title for delete all message warning'\r\n  },\r\n  delete_all_message_warning: {\r\n    id: 'delete_all_message_warning',\r\n    defaultMessage: 'Are you sure you want to delete your all message? It cannot be undone.',\r\n    description: 'Warning message when deleting all message'\r\n  }\r\n});\r\n\r\nclass AccSecurityView extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    const me = this.props.tinode.getMeTopic();\r\n    let blockedCount = 0;\r\n    me.contacts((c) => {\r\n      if (c.acs && !c.acs.isJoiner()) {\r\n        blockedCount ++;\r\n      }\r\n    });\r\n    const defacs = me.getDefaultAccess();\r\n    this.state = {\r\n      auth: defacs ? defacs.auth : null,\r\n      anon: defacs ? defacs.anon : null,\r\n      showPermissionEditorFor: undefined,\r\n      blockedCount: blockedCount,\r\n    };\r\n\r\n    this.handlePasswordUpdate = this.handlePasswordUpdate.bind(this);\r\n    this.handleLaunchPermissionsEditor = this.handleLaunchPermissionsEditor.bind(this);\r\n    this.handleHidePermissionsEditor = this.handleHidePermissionsEditor.bind(this);\r\n    this.handlePermissionsChanged = this.handlePermissionsChanged.bind(this);\r\n    this.handleDeleteAccount = this.handleDeleteAccount.bind(this);\r\n    this.handleSoftDeleteAllMessage = this.handleSoftDeleteAllMessage.bind(this);\r\n  }\r\n\r\n  handlePasswordUpdate(pwd) {\r\n    this.setState({password: pwd});\r\n    this.props.onUpdatePassword(pwd);\r\n  }\r\n\r\n  handleLaunchPermissionsEditor(which) {\r\n    this.setState({\r\n      showPermissionEditorFor: which,\r\n      editedPermissions: this.state[which]\r\n    });\r\n  }\r\n\r\n  handleHidePermissionsEditor() {\r\n    this.setState({showPermissionEditorFor: undefined});\r\n  }\r\n\r\n  handlePermissionsChanged(perm) {\r\n    let defacs = {};\r\n    defacs[this.state.showPermissionEditorFor] = perm;\r\n    this.props.onUpdateAccountDesc('me', undefined, undefined, defacs);\r\n\r\n    let newState = {showPermissionEditorFor: undefined};\r\n    newState[this.state.showPermissionEditorFor] = perm;\r\n    this.setState(newState);\r\n  }\r\n\r\n  handleDeleteAccount(e) {\r\n    e.preventDefault();\r\n    const {formatMessage} = this.props.intl;\r\n    this.props.onShowAlert(\r\n      formatMessage(messages.delete_account), // title\r\n      formatMessage(messages.delete_account_warning), // content\r\n      (_ => this.props.onDeleteAccount()), // onConfirm\r\n      null, // use default text \"OK\"\r\n      true, // Show Reject button\r\n      null  // use default text \"Cancel\"\r\n    );\r\n  }\r\n\r\n  handleSoftDeleteAllMessage(e) {\r\n    e.preventDefault();\r\n    const {formatMessage} = this.props.intl;\r\n    this.props.onShowAlert(\r\n      formatMessage(messages.delete_all_message), // title\r\n      formatMessage(messages.delete_all_message_warning), // content\r\n      (_ => this.props.onSoftDeleteAllMessage()), // onConfirm\r\n      null, // use default text \"OK\"\r\n      true, // Show Reject button\r\n      null  // use default text \"Cancel\"\r\n    );\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <>{this.state.showPermissionEditorFor ?\r\n        <PermissionsEditor\r\n          mode={this.state.editedPermissions}\r\n          skip=\"O\"\r\n          onSubmit={this.handlePermissionsChanged}\r\n          onCancel={this.handleHidePermissionsEditor} />\r\n        :\r\n        <div className=\"scrollable-panel\">\r\n          <div className=\"panel-form-column\">\r\n            <label className=\"small\">\r\n              <FormattedMessage id=\"label_password\" defaultMessage=\"Password\"\r\n                  description=\"Label for password editing\" />\r\n            </label>\r\n            <div>\r\n              <FormattedMessage id=\"password_unchanged_prompt\" defaultMessage=\"Unchanged\"\r\n                description=\"Message in editor while password is unchanged\">{\r\n                (password_unchanged) => <InPlaceEdit\r\n                  placeholder={password_unchanged}\r\n                  type=\"password\"\r\n                  onFinished={this.handlePasswordUpdate} />\r\n              }</FormattedMessage>\r\n            </div>\r\n          </div>\r\n          <div className=\"hr\" />\r\n          <div className=\"panel-form-column\">\r\n            <a href=\"#\" className=\"danger flat-button\" onClick={(e) => {e.preventDefault(); this.props.onLogout();}}>\r\n              <i className=\"material-icons\">exit_to_app</i> &nbsp;<FormattedMessage id=\"button_logout\"\r\n                defaultMessage=\"Logout\" description=\"Button [Logout]\" />\r\n            </a>\r\n            <a href=\"#\" className=\"danger flat-button\" onClick={(e) => {this.handleDeleteAccount(e);}}>\r\n              <i className=\"material-icons\">delete</i> &nbsp;<FormattedMessage id=\"button_delete_account\"\r\n                defaultMessage=\"Delete account\" description=\"Button [Delete account]\" />\r\n            </a>\r\n            <a href=\"#\" className=\"danger flat-button\" onClick={(e) => {this.handleSoftDeleteAllMessage(e);}}>\r\n              <i className=\"material-icons\">delete</i> &nbsp;<FormattedMessage id=\"button_delete_all_message\"\r\n                defaultMessage=\"Delete all message\" description=\"Button [Delete all message]\" />\r\n            </a>\r\n          </div>\r\n          <div className=\"hr\" />\r\n          <div className=\"panel-form-column\">\r\n            <div>\r\n              <label className=\"small\">\r\n                <FormattedMessage id=\"label_default_access_mode\" defaultMessage=\"Default access mode:\"\r\n                  description=\"Label for default access mode\" />\r\n              </label>\r\n            </div>\r\n            <div className=\"quoted\">\r\n              <div>Auth: <tt className=\"clickable\"\r\n                onClick={this.handleLaunchPermissionsEditor.bind(this, 'auth')}>{this.state.auth}</tt></div>\r\n              <div>Anon: <tt className=\"clickable\"\r\n                onClick={this.handleLaunchPermissionsEditor.bind(this, 'anon')}>{this.state.anon}</tt></div>\r\n            </div>\r\n          </div>\r\n          {this.state.blockedCount > 0 ?\r\n            <>\r\n              <div className=\"hr\" />\r\n              <div className=\"panel-form-row\">\r\n                <i className=\"material-icons\">block</i>&nbsp;\r\n                <a href=\"#\" className=\"gray\" onClick={(e) => {e.preventDefault(); this.props.onShowBlocked();}}>\r\n                  <FormattedMessage id=\"blocked_contacts_link\" defaultMessage=\"Blocked contacts ({count})\"\r\n                    values={{ count: this.state.blockedCount }} description=\"Blocked contacts link\" />\r\n                </a>\r\n              </div>\r\n            </>\r\n            : null }\r\n        </div>\r\n      }</>\r\n    );\r\n  }\r\n};\r\n\r\nexport default injectIntl(AccSecurityView);\r\n","// Edit account parameters.\r\nimport React from 'react';\r\nimport { FormattedMessage } from 'react-intl';\r\n\r\nimport { Tinode } from 'tinode-sdk';\r\n\r\nimport { APP_NAME, LINK_CONTACT_US, LINK_PRIVACY_POLICY, LINK_TERMS_OF_SERVICE } from '../config.js';\r\n\r\nexport default class AccSupportView extends React.PureComponent {\r\n  render() {\r\n    return (\r\n      <div className=\"scrollable-panel\">\r\n        <div className=\"panel-form-column\">\r\n          <a href={LINK_CONTACT_US} className=\"flat-button\" target=\"_blank\">\r\n            <i className=\"material-icons\">email</i> &nbsp;<FormattedMessage id=\"link_contact_us\"\r\n              defaultMessage=\"Contact Us\" description=\"Ancor text for contacting us by email\" />\r\n          </a>\r\n          <a href={LINK_TERMS_OF_SERVICE} className=\"flat-button\" target=\"_blank\">\r\n            <i className=\"material-icons\">description</i> &nbsp;<FormattedMessage id=\"link_terms_of_service\"\r\n              defaultMessage=\"Terms of Service\" description=\"Ancor text for terms of service link\" />\r\n          </a>\r\n          <a href={LINK_PRIVACY_POLICY} className=\"flat-button\" target=\"_blank\">\r\n            <i className=\"material-icons\">policy</i> &nbsp;<FormattedMessage id=\"link_privacy_policy\"\r\n              defaultMessage=\"Privacy Policy\" description=\"Ancor text for privacy policy link\" />\r\n          </a>\r\n        </div>\r\n        <div className=\"hr\" />\r\n        <div className=\"panel-form-column\">\r\n          <div className=\"panel-form-row\">\r\n            <label className=\"small\"><FormattedMessage id=\"label_client\" defaultMessage=\"Client:\"\r\n              description=\"Label for a client version\" /></label>\r\n            {APP_NAME}\r\n          </div>\r\n          <div className=\"panel-form-row\">\r\n            <label className=\"small\"><FormattedMessage id=\"label_sdk\" defaultMessage=\"SDK:\" /></label>\r\n            {Tinode.getLibrary()}\r\n          </div>\r\n          <div className=\"panel-form-row\">\r\n            <label className=\"small\"><FormattedMessage id=\"label_server\" defaultMessage=\"Server:\"\r\n              description=\"Label for a server version\" /></label>\r\n            {this.props.serverVersion}\r\n          </div>\r\n          <div className=\"panel-form-row\">\r\n            <label className=\"small\"><FormattedMessage id=\"label_server_address\" defaultMessage=\"Server address:\" /></label>\r\n            {this.props.serverAddress}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n};\r\n","// Login form.\r\nimport React from 'react';\r\nimport { FormattedMessage } from 'react-intl';\r\n\r\nimport CheckBox from '../widgets/checkbox.jsx';\r\nimport VisiblePassword from '../widgets/visible-password.jsx';\r\n\r\nexport default class LoginView extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      login: props.login,\r\n      password: '',\r\n      hostName: props.serverAddress,\r\n      saveToken: props.persist\r\n    };\r\n    this.handleLoginChange = this.handleLoginChange.bind(this);\r\n    this.handlePasswordChange = this.handlePasswordChange.bind(this);\r\n    this.handleToggleSaveToken = this.handleToggleSaveToken.bind(this);\r\n    this.handleSubmit = this.handleSubmit.bind(this);\r\n  }\r\n\r\n  handleLoginChange(e) {\r\n    this.setState({login: e.target.value});\r\n  }\r\n\r\n  handlePasswordChange(e) {\r\n    this.setState({password: e.target.value});\r\n  }\r\n\r\n  handleToggleSaveToken() {\r\n    this.props.onPersistenceChange(!this.state.saveToken);\r\n    this.setState({saveToken: !this.state.saveToken});\r\n  }\r\n\r\n  handleSubmit(e) {\r\n    e.preventDefault();\r\n    this.props.onLogin(this.state.login.trim(), this.state.password.trim());\r\n  }\r\n\r\n  render() {\r\n    let submitClasses = 'primary';\r\n    if (this.props.disabled) {\r\n      submitClasses += ' disabled';\r\n    }\r\n\r\n    return (\r\n      <form id=\"login-form\" onSubmit={this.handleSubmit}>\r\n        <FormattedMessage id=\"login_prompt\" defaultMessage=\"Login\"\r\n          description=\"Placeholer for username/login\">\r\n        {\r\n          (login_prompt) => <input type=\"text\" id=\"inputLogin\"\r\n            placeholder={login_prompt}\r\n            autoComplete=\"username\"\r\n            autoCorrect=\"off\"\r\n            autoCapitalize=\"none\"\r\n            value={this.state.login}\r\n            onChange={this.handleLoginChange}\r\n            required autoFocus />\r\n        }\r\n        </FormattedMessage>\r\n        <FormattedMessage id=\"password_prompt\" defaultMessage=\"Password\"\r\n          description=\"Placeholder/prompt for entering password\">\r\n        {\r\n          (password_prompt) => <VisiblePassword type=\"password\" id=\"inputPassword\"\r\n            placeholder={password_prompt}\r\n            autoComplete=\"current-password\"\r\n            value={this.state.password}\r\n            onChange={this.handlePasswordChange}\r\n            required={true} />\r\n        }\r\n        </FormattedMessage>\r\n        <div className=\"panel-form-row\">\r\n          <CheckBox id=\"save-token\" name=\"save-token\" checked={this.state.saveToken}\r\n            onChange={this.handleToggleSaveToken} />\r\n          <label htmlFor=\"save-token\">&nbsp;\r\n            <FormattedMessage id=\"stay_logged_in\" defaultMessage=\"Stay logged in\"\r\n              description=\"Label for a checkbox\" />\r\n          </label>\r\n          <a href=\"#reset\">\r\n            <FormattedMessage id=\"forgot_password_link\" defaultMessage=\"Forgot password?\"\r\n              description=\"Link to Reset password form\" />\r\n          </a>\r\n        </div>\r\n        <div className=\"dialog-buttons\">\r\n          <button className={submitClasses} type=\"submit\">\r\n            <FormattedMessage id=\"button_sign_in\" defaultMessage=\"Sign in\"\r\n              description=\"Button [Sign In]\" />\r\n          </button>\r\n        </div>\r\n      </form>\r\n    );\r\n  }\r\n};\r\n","import QRCode from 'qrcodejs';\r\nimport React from 'react';\r\nimport { FormattedMessage, defineMessages, injectIntl } from 'react-intl';\r\n\r\nimport { QRCODE_SIZE } from '../config';\r\n\r\nconst messages = defineMessages({\r\n  invalid_id: {\r\n    id: 'error_invalid_id',\r\n    defaultMessage: 'Invalid ID',\r\n    description: 'Error message'\r\n  }\r\n});\r\n\r\nclass NewTopicById extends React.PureComponent {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.qrCodeRef = React.createRef();\r\n\r\n    this.state = {\r\n      groupId: '',\r\n    };\r\n\r\n    this.handleChange = this.handleChange.bind(this);\r\n    this.handleKeyPress = this.handleKeyPress.bind(this);\r\n    this.handleSubmit = this.handleSubmit.bind(this);\r\n  }\r\n\r\n  componentDidMount() {\r\n    new QRCode(this.qrCodeRef.current, {\r\n      text: this.props.myURI,\r\n      width: QRCODE_SIZE,\r\n      height: QRCODE_SIZE,\r\n    });\r\n  }\r\n\r\n  handleChange(e) {\r\n    this.setState({groupId: e.target.value});\r\n  }\r\n\r\n  handleKeyPress(e) {\r\n    if (e.key === 'Enter') {\r\n      this.handleSubmit(e);\r\n    }\r\n  }\r\n\r\n  handleSubmit(e) {\r\n    e.preventDefault();\r\n    if (this.state.groupId) {\r\n      const name = this.state.groupId.trim();\r\n      const prefix = name.substring(0, 3);\r\n      if (name.length > 3 && ['usr', 'grp', 'chn'].includes(prefix)) {\r\n        this.props.onSubmit(name);\r\n      } else {\r\n        this.props.onError(this.props.intl.formatMessage(messages.invalid_id), 'err');\r\n      }\r\n    }\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div className=\"panel-form\">\r\n        <div className=\"panel-form-row\">\r\n        <FormattedMessage id=\"group_user_id_prompt\" defaultMessage=\"Group or User ID\"\r\n          description=\"Prompt for entering user or group ID\">{\r\n          (prompt) => <input type=\"text\" placeholder={prompt}\r\n            value={this.state.groupId} onChange={this.handleChange}\r\n            onKeyDown={this.handleKeyPress} required autoFocus />\r\n        }</FormattedMessage>\r\n        </div>\r\n        <div className=\"dialog-buttons\">\r\n          <button className=\"primary\" onClick={this.handleSubmit}>\r\n            <FormattedMessage id=\"button_subscribe\" defaultMessage=\"Subscribe\"\r\n              description=\"Button [Subscribe]\" />\r\n          </button>\r\n        </div>\r\n        <br />\r\n        <div className=\"panel-form-column\">\r\n        <label className=\"small\">Scan my ID:</label>\r\n          <div className=\"qr-code\" ref={this.qrCodeRef} />\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n};\r\n\r\nexport default injectIntl(NewTopicById);\r\n","import React from 'react';\r\nimport { FormattedMessage } from 'react-intl';\r\n\r\nimport AvatarCrop from './avatar-crop.jsx';\r\nimport AvatarUpload from './avatar-upload.jsx';\r\nimport CheckBox from './checkbox.jsx';\r\nimport TagManager from './tag-manager.jsx';\r\n\r\nimport { AVATAR_SIZE, MAX_AVATAR_BYTES, MAX_EXTERN_ATTACHMENT_SIZE, MAX_TITLE_LENGTH,\r\n  MAX_TOPIC_DESCRIPTION_LENGTH } from '../config.js';\r\nimport { imageScaled, blobToBase64, makeImageUrl } from '../lib/blob-helpers.js';\r\n\r\nexport default class NewTopicGroup extends React.PureComponent {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.fullName = React.createRef();\r\n\r\n    this.state = {\r\n      fullName: '', // full/formatted name\r\n      private: '',\r\n      description: '',\r\n      imageUrl: null,\r\n      tags: [],\r\n      isChannel: false,\r\n      newAvatar: null,\r\n      newAvatarMime: null\r\n    };\r\n\r\n    this.handleFieldEdit = this.handleFieldEdit.bind(this);\r\n    this.handleImageChanged = this.handleImageChanged.bind(this);\r\n    this.handleAvatarCropped = this.handleAvatarCropped.bind(this);\r\n    this.handleAvatarCropCancel = this.handleAvatarCropCancel.bind(this);\r\n    this.uploadAvatar = this.uploadAvatar.bind(this);\r\n    this.handleTagsChanged = this.handleTagsChanged.bind(this);\r\n    this.handleChannelToggle = this.handleChannelToggle.bind(this);\r\n    this.handleSubmit = this.handleSubmit.bind(this);\r\n  }\r\n\r\n  componentDidMount() {\r\n    // this.fullName.current.focus();\r\n  }\r\n\r\n  handleFieldEdit(name, e) {\r\n    this.setState({[name]: e.target.value || ''});\r\n  }\r\n\r\n  handleImageChanged(mime, img) {\r\n    this.setState({newAvatar: img, newAvatarMime: mime});\r\n  }\r\n\r\n  handleAvatarCropped(mime, blob, width, height) {\r\n    const url = blob ? URL.createObjectURL(blob) : null;\r\n    this.setState({imageUrl: url, newAvatar: null, newAvatarMime: null});\r\n    if (blob) {\r\n      this.uploadAvatar(mime, blob, width, height);\r\n    }\r\n  }\r\n\r\n  handleAvatarCropCancel() {\r\n    this.setState({newAvatar: null, newAvatarMime: null});\r\n  }\r\n\r\n  // Utility method for converting cropped avatar blob to bytes for sending inband or\r\n  // for uploading it to the server out of band.\r\n  uploadAvatar(mime, blob, width, height) {\r\n    const readyToUpload = image => {\r\n      let {mime, blob} = image;\r\n      if (blob.size > MAX_AVATAR_BYTES) {\r\n        // Too large to send inband - uploading out of band and sending as a link.\r\n        const uploader = this.props.tinode.getLargeFileHelper();\r\n        uploader.upload(blob)\r\n          .then(url => this.setState({imageUrl: url}))\r\n          .catch(err => this.props.onError(err.message, 'err'));\r\n      } else {\r\n        // Convert blob to base64-encoded bits.\r\n        blobToBase64(blob)\r\n          .then(b64 => this.setState({imageUrl: makeImageUrl({data: b64.bits, type: mime})}));\r\n      }\r\n    };\r\n\r\n    if (width > AVATAR_SIZE || height > AVATAR_SIZE || width != height) {\r\n      // Avatar is not square or too large even after cropping. Shrink it and make square.\r\n      imageScaled(blob, AVATAR_SIZE, AVATAR_SIZE, MAX_EXTERN_ATTACHMENT_SIZE, true)\r\n        .then(scaled => readyToUpload(scaled))\r\n        .catch(err => this.props.onError(err.message, 'err'));\r\n    } else {\r\n      readyToUpload({mime: mime, blob: blob, width: width, height: height});\r\n    }\r\n  }\r\n\r\n  handleTagsChanged(tags) {\r\n    this.setState({tags: tags});\r\n  }\r\n\r\n  handleChannelToggle() {\r\n    this.setState({isChannel: !this.state.isChannel});\r\n  }\r\n\r\n  handleSubmit(e) {\r\n    e.preventDefault();\r\n\r\n    const fn = this.state.fullName.trim().substring(0, MAX_TITLE_LENGTH);\r\n    const comment = this.state.private.trim().substring(0, MAX_TITLE_LENGTH);\r\n    const description = this.state.description.trim().substring(0, MAX_TOPIC_DESCRIPTION_LENGTH);\r\n    if (fn) {\r\n      this.props.onSubmit(fn, description, this.state.imageUrl, comment, this.state.tags, this.state.isChannel);\r\n    }\r\n  }\r\n\r\n  render() {\r\n    if (this.state.newAvatar) {\r\n      return (\r\n        <AvatarCrop\r\n          avatar={this.state.newAvatar}\r\n          mime={this.state.newAvatarMime}\r\n          onSubmit={this.handleAvatarCropped}\r\n          onCancel={this.handleAvatarCropCancel}\r\n          onError={this.props.onError} />\r\n      );\r\n    }\r\n\r\n    let submitClasses = 'primary';\r\n    if (this.props.disabled) {\r\n      submitClasses += ' disabled';\r\n    }\r\n    return (\r\n      <form className=\"panel-form\" onSubmit={this.handleSubmit}>\r\n        <div className=\"panel-form-column\">\r\n          <center>\r\n            <AvatarUpload\r\n              tinode={this.props.tinode}\r\n              avatar={this.state.imageUrl}\r\n              onError={this.props.onError}\r\n              onImageUpdated={this.handleImageChanged} />\r\n          </center>\r\n          <div className=\"group\">\r\n            <label className=\"small\" htmlFor=\"new-topic-fn\">\r\n              <FormattedMessage id=\"label_topic_name\" defaultMessage=\"Name\"\r\n                description=\"Label for editing topic name\" />\r\n            </label>\r\n            <FormattedMessage id=\"topic_name_editing_placeholder\" defaultMessage=\"Freeform name of the group\"\r\n              description=\"Prompt for entering topic name\">{\r\n              (placeholder) => <input type=\"text\" id=\"new-topic-fn\" placeholder={placeholder}\r\n                ref={this.fullName} value={this.state.fullName} onChange={this.handleFieldEdit.bind(this, 'fullName')}\r\n                autoFocus required tabIndex={0} />\r\n            }</FormattedMessage>\r\n          </div>\r\n          <div className=\"group\">\r\n            <label className=\"small\" htmlFor=\"new-topic-priv\">\r\n              <FormattedMessage id=\"label_private\" defaultMessage=\"Private comment\"\r\n                description=\"Label for editing 'private'\" />\r\n            </label>\r\n            <FormattedMessage id=\"private_editing_placeholder\" defaultMessage=\"Visible to you only\"\r\n              description=\"Placeholder for editing 'private'\">{\r\n              (placeholder) => <input type=\"text\" id=\"new-topic-priv\" placeholder={placeholder}\r\n                value={this.state.private} onChange={this.handleFieldEdit.bind(this, 'private')} tabIndex={1} />\r\n            }</FormattedMessage>\r\n          </div>\r\n          <div className=\"group\">\r\n            <label className=\"small\" htmlFor=\"new-topic-desc\">\r\n              <FormattedMessage id=\"label_description\" defaultMessage=\"Description\"\r\n                description=\"Label for editing topic description\" />\r\n            </label>\r\n            <FormattedMessage id=\"description_editing_placeholder\" defaultMessage=\"Description (optional)\"\r\n              description=\"Placeholder for editing topic description\">{\r\n              (placeholder) => <input type=\"text\" id=\"new-topic-desc\" placeholder={placeholder}\r\n                value={this.state.description} onChange={this.handleFieldEdit.bind(this, 'description')} tabIndex={2} />\r\n            }</FormattedMessage>\r\n          </div>\r\n        </div>\r\n        <div className=\"panel-form-row\">\r\n          <CheckBox checked={this.state.isChannel} tabIndex={3} onChange={this.handleChannelToggle} />&nbsp;\r\n          <label onClick={this.handleChannelToggle}><FormattedMessage id=\"channel_prompt\"\r\n            defaultMessage=\"This is a channel\"\r\n            description=\"Checkbox label when creating a channel\" /></label>\r\n        </div>\r\n        <FormattedMessage id=\"title_tag_manager\" defaultMessage=\"Tags (search & discovery)\"\r\n          description=\"Section title for TagManager\">{\r\n          (title) => <TagManager\r\n            tinode={this.props.tinode}\r\n            tags={this.state.tags}\r\n            activated={true}\r\n            onTagsChanged={this.handleTagsChanged}\r\n            tabIndex={4}\r\n            title={title} />\r\n        }</FormattedMessage>\r\n        <div className=\"dialog-buttons\">\r\n          <button className={submitClasses}>\r\n            <FormattedMessage id=\"button_create\" defaultMessage=\"Create\"\r\n              description=\"Button [Create]\" />\r\n          </button>\r\n        </div>\r\n      </form>\r\n    );\r\n  }\r\n};\r\n","// Create new topic and invite users or send an invite.\r\nimport React from 'react';\r\nimport { FormattedMessage, defineMessages, injectIntl } from 'react-intl';\r\n\r\nimport { Tinode } from 'tinode-sdk';\r\n\r\nimport ContactList from '../widgets/contact-list.jsx';\r\nimport NewTopicById from '../widgets/new-topic-by-id.jsx';\r\nimport NewTopicGroup from '../widgets/new-topic-group.jsx';\r\nimport SearchContacts from '../widgets/search-contacts.jsx';\r\n\r\nimport HashNavigation from '../lib/navigation.js';\r\nimport { asEmail, asPhone, theCard } from '../lib/utils.js';\r\n\r\nconst messages = defineMessages({\r\n  search_for_contacts: {\r\n    id: \"search_for_contacts\",\r\n    defaultMessage: \"Use search to find contacts\",\r\n    description: \"Text shown in contacts view when user entered no search query.\"\r\n  },\r\n  search_no_results: {\r\n    id: \"search_no_results\",\r\n    defaultMessage: \"Search returned no results\",\r\n    description: \"Text shown in contacts view when query returned no results.\"\r\n  },\r\n  search_placeholder: {\r\n    id: \"search_placeholder\",\r\n    defaultMessage: \"List like alice@example.com, +17025550003...\",\r\n    description: \"Placeholder in contacts search field\"\r\n  },\r\n});\r\n\r\nclass NewTopicView extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      tabSelected: 'find',\r\n      searchQuery: null\r\n    };\r\n\r\n    this.handleTabClick = this.handleTabClick.bind(this);\r\n    this.handleSearchContacts = this.handleSearchContacts.bind(this);\r\n    this.handleSearchResultSelected = this.handleSearchResultSelected.bind(this);\r\n    this.handleNewGroupSubmit = this.handleNewGroupSubmit.bind(this);\r\n    this.handleGroupByID = this.handleGroupByID.bind(this);\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.props.onInitFind();\r\n  }\r\n\r\n  handleTabClick(e) {\r\n    e.preventDefault();\r\n    HashNavigation.navigateTo(HashNavigation.addUrlParam(window.location.hash, 'tab', e.currentTarget.dataset.id));\r\n    this.setState({tabSelected: e.currentTarget.dataset.id});\r\n  }\r\n\r\n  handleSearchContacts(query) {\r\n    query = query.trim() || Tinode.DEL_CHAR;\r\n    if (!/[\\s,:]/.test(query) && query != Tinode.DEL_CHAR) {\r\n      // No colons, spaces or commas, not DEL char. Try as email, phone, or alias.\r\n      const email = asEmail(query);\r\n      if (email) {\r\n        query = `${Tinode.TAG_EMAIL}${email}`;\r\n      } else {\r\n        const tel = asPhone(query);\r\n        if (tel) {\r\n          query = `${Tinode.TAG_PHONE}${tel}`;\r\n        } else {\r\n          if (query[0] == '@') {\r\n            // Strip the leading '@' sign if present.\r\n            query = query.substring(1);\r\n          }\r\n          // 'alice' -> 'alias:alice,alice'\r\n          query = `${Tinode.TAG_ALIAS}${query},${query}`;\r\n        }\r\n      }\r\n    }\r\n    this.props.onSearchContacts(query);\r\n    this.setState({searchQuery: Tinode.isNullValue(query) ? null : query});\r\n  }\r\n\r\n  handleSearchResultSelected(topicName) {\r\n    if (this.state.tabSelected == 'find') {\r\n      HashNavigation.navigateTo(HashNavigation.removeUrlParam(window.location.hash, 'tab'));\r\n      this.props.onCreateTopic(topicName);\r\n    }\r\n  }\r\n\r\n  handleNewGroupSubmit(name, description, dataUrl, priv, tags, isChannel) {\r\n    HashNavigation.navigateTo(HashNavigation.removeUrlParam(window.location.hash, 'tab'));\r\n    this.props.onCreateTopic(undefined,\r\n      {public: theCard(name, dataUrl, null, description), private: priv, tags: tags}, isChannel);\r\n  }\r\n\r\n  handleGroupByID(topicName) {\r\n    HashNavigation.navigateTo(HashNavigation.removeUrlParam(window.location.hash, 'tab'));\r\n    this.props.onCreateTopic(topicName);\r\n  }\r\n\r\n  render() {\r\n    const {formatMessage} = this.props.intl;\r\n    const no_contacts_placeholder = formatMessage(this.state.searchQuery ?\r\n      messages.search_no_results : messages.search_for_contacts);\r\n    const search_placeholder = formatMessage(messages.search_placeholder);\r\n    return (\r\n      <div className=\"flex-column\">\r\n        <ul className=\"tabbar\">\r\n          <li className={this.state.tabSelected === \"find\" ? \"active\" : null}>\r\n            <a href=\"#\" data-id=\"find\" onClick={this.handleTabClick}>\r\n              <FormattedMessage id=\"tabtitle_find_user\" defaultMessage=\"find\"\r\n                description=\"Tab title Find\" />\r\n            </a>\r\n          </li>\r\n          <li className={this.state.tabSelected === \"grp\" ? \"active\" : null}>\r\n            <a href=\"#\" data-id=\"grp\" onClick={this.handleTabClick}>\r\n              <FormattedMessage id=\"tabtitle_new_group\" defaultMessage=\"new group\"\r\n                description=\"Tab title New Group\" />\r\n            </a>\r\n          </li>\r\n          <li className={this.state.tabSelected === \"byid\" ? \"active\" : null}>\r\n            <a href=\"#\" data-id=\"byid\" onClick={this.handleTabClick}>\r\n              <FormattedMessage id=\"tabtitle_group_by_id\" defaultMessage=\"by id\"\r\n                description=\"Tab title Find topic by ID\" />\r\n            </a>\r\n          </li>\r\n        </ul>\r\n        {this.state.tabSelected === 'grp' ?\r\n          <NewTopicGroup\r\n            tinode={this.props.tinode}\r\n            onSubmit={this.handleNewGroupSubmit}\r\n            onError={this.props.onError} /> :\r\n          this.state.tabSelected === 'byid' ?\r\n            <NewTopicById\r\n              myURI={Tinode.URI_TOPIC_ID_PREFIX + this.props.tinode.getCurrentUserID()}\r\n              onSubmit={this.handleGroupByID}\r\n              onError={this.props.onError} /> :\r\n            <div className=\"flex-column\">\r\n              <SearchContacts\r\n                placeholder={search_placeholder}\r\n                onSearchContacts={this.handleSearchContacts} />\r\n              <ContactList\r\n                tinode={this.props.tinode}\r\n                contacts={this.props.searchResults}\r\n                myUserId={this.props.myUserId}\r\n                emptyListMessage={no_contacts_placeholder}\r\n                showSelfTopic={!this.state.searchQuery}\r\n                showOnline={false}\r\n                showUnread={false}\r\n                showContextMenu={false}\r\n                onTopicSelected={this.handleSearchResultSelected} />\r\n            </div>}\r\n      </div>\r\n    );\r\n  }\r\n};\r\n\r\nexport default injectIntl(NewTopicView);\r\n","import React from 'react';\r\n\r\nimport { KNOWN_HOSTS } from '../config.js';\r\n\r\n/* Combobox for selecting host name */\r\n\r\nexport default class HostSelector extends React.PureComponent {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      hostName: props.serverAddress,\r\n      changed: false\r\n    };\r\n\r\n    this.handleHostNameChange = this.handleHostNameChange.bind(this);\r\n    this.handleEditingFinished = this.handleEditingFinished.bind(this);\r\n    this.handleKeyDown = this.handleKeyDown.bind(this);\r\n  }\r\n\r\n  handleHostNameChange(e) {\r\n    this.setState({hostName: e.target.value, changed: true});\r\n  }\r\n\r\n  handleEditingFinished() {\r\n    if (this.state.changed) {\r\n      this.setState({changed: false});\r\n      this.props.onServerAddressChange(this.state.hostName.trim());\r\n    }\r\n  }\r\n\r\n  handleKeyDown(e) {\r\n    if (e.key == 'Enter') {\r\n      this.handleEditingFinished();\r\n    }\r\n  }\r\n\r\n  render() {\r\n    const hostOptions = [];\r\n    for (let key in KNOWN_HOSTS) {\r\n      let item = KNOWN_HOSTS[key];\r\n      hostOptions.push(\r\n        <option key={item} value={item} />\r\n      );\r\n    }\r\n    return (\r\n      <div className=\"panel-form-row\">\r\n        <input type=\"search\" id=\"host-name\" placeholder={this.props.hostName} list=\"known-hosts\"\r\n          className=\"quoted\" value={this.state.hostName} onChange={this.handleHostNameChange}\r\n          onBlur={this.handleEditingFinished}\r\n          onKeyDown={this.handleKeyDown} required />\r\n        <datalist id=\"known-hosts\">\r\n          {hostOptions}\r\n        </datalist>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","// Tinode config panel.\r\nimport React from 'react';\r\nimport { FormattedMessage } from 'react-intl';\r\n\r\nimport CheckBox from '../widgets/checkbox.jsx';\r\n\r\nimport HostSelector from '../widgets/host-selector.jsx';\r\n\r\nexport default class SettingsView extends React.PureComponent {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      transport: props.transport || 'def',\r\n      serverAddress: props.serverAddress,\r\n      secureConnection: props.secureConnection,\r\n    };\r\n\r\n    this.handleSubmit = this.handleSubmit.bind(this);\r\n    this.handleTransportSelected = this.handleTransportSelected.bind(this);\r\n    this.handleServerAddressChange = this.handleServerAddressChange.bind(this);\r\n    this.handleToggleSecure = this.handleToggleSecure.bind(this);\r\n  }\r\n\r\n  handleSubmit(e) {\r\n    e.preventDefault();\r\n    this.props.onUpdate({\r\n      transport: this.state.transport,\r\n      serverAddress: this.state.serverAddress,\r\n      secureConnection: this.state.secureConnection,\r\n    });\r\n  }\r\n\r\n  handleTransportSelected(e) {\r\n    this.setState({transport: e.currentTarget.value});\r\n  }\r\n\r\n  handleServerAddressChange(name) {\r\n    this.setState({serverAddress: name});\r\n  }\r\n\r\n  handleToggleSecure(e) {\r\n    this.setState({secureConnection: !this.state.secureConnection});\r\n  }\r\n\r\n  render() {\r\n    const names = {def: \"default\", ws: \"websocket\", lp: \"long polling\"};\r\n    const transportOptions = [];\r\n    ['def', 'ws', 'lp'].forEach(item => {\r\n      const id = 'transport-' + item;\r\n      const name = names[item];\r\n      transportOptions.push(\r\n        <li key={item}>\r\n          <input type=\"radio\" id={id} name=\"transport-select\" value={item}\r\n            checked={this.state.transport === item}\r\n            onChange={this.handleTransportSelected} />\r\n          <label htmlFor={id}>{name}</label>\r\n        </li>\r\n      );\r\n    });\r\n\r\n    return (\r\n      <form id=\"settings-form\" className=\"panel-form\" onSubmit={this.handleSubmit}>\r\n        <div className=\"panel-form-row\">\r\n          <label className=\"small\">\r\n            <FormattedMessage id=\"label_server_to_use\" defaultMessage=\"Server to use:\"\r\n              description=\"Label for server selector in SettingsView\" />\r\n          </label>\r\n        </div>\r\n        <HostSelector serverAddress={this.state.serverAddress} onServerAddressChange={this.handleServerAddressChange} />\r\n        <div className=\"panel-form-row\">\r\n          <CheckBox id=\"secure-connection\" name=\"secure-connection\" checked={this.state.secureConnection}\r\n            className=\"quoted\" onChange={this.handleToggleSecure} /><label htmlFor=\"secure-connection\">\r\n            <FormattedMessage id=\"label_use_secure_connection\" defaultMessage=\"Use secure connection\"\r\n              description=\"Label for WS/WSS connection type in SettingsView\" />\r\n          </label>\r\n        </div>\r\n        <div className=\"panel-form-row\">\r\n          <label className=\"small\">\r\n            <FormattedMessage id=\"label_wire_transport\" defaultMessage=\"Wire transport:\"\r\n              description=\"Label for wire transport selection in SettingsView\" />\r\n          </label>\r\n        </div>\r\n        <div className=\"panel-form-row\">\r\n          <ul className=\"quoted\">\r\n            {transportOptions}\r\n          </ul>\r\n        </div>\r\n        <div className=\"dialog-buttons\">\r\n          <button type=\"submit\" className=\"primary\">\r\n            <FormattedMessage id=\"button_update\" defaultMessage=\"Update\"\r\n              description=\"Button [Update]\" />\r\n          </button>\r\n        </div>\r\n      </form>\r\n    );\r\n  }\r\n};\r\n","// ValidationView: panel for confirming credentials, like email or phone.\r\nimport React from 'react';\r\nimport { FormattedMessage, defineMessages, injectIntl } from 'react-intl';\r\n\r\nconst messages = defineMessages({\r\n  phone: {\r\n    id: 'phone_dative',\r\n    defaultMessage: 'phone',\r\n    description: \"Dative case of 'phone', i.e. 'phone' in 'by phone'\",\r\n  },\r\n  email: {\r\n    id: 'email_dative',\r\n    defaultMessage: 'email',\r\n    description: \"Dative case of 'email', i.e. 'email' in 'by email'\",\r\n  }\r\n});\r\n\r\nclass ValidationView extends React.PureComponent {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      code: props.credCode || '',\r\n      codeReceived: props.credCode\r\n    };\r\n\r\n    this.handleCodeChange = this.handleCodeChange.bind(this);\r\n    this.handleKeyPress = this.handleKeyPress.bind(this);\r\n    this.handleSubmit = this.handleSubmit.bind(this);\r\n    this.handleCancel = this.handleCancel.bind(this);\r\n  }\r\n\r\n  static getDerivedStateFromProps(nextProps, prevState) {\r\n    if (nextProps.credCode != prevState.codeReceived) {\r\n      return {\r\n        code: nextProps.credCode || '',\r\n        codeReceived: nextProps.credCode\r\n      };\r\n    }\r\n\r\n    return prevState;\r\n  }\r\n\r\n  componentDidMount() {\r\n    // Submit code automatically if it's received from the parent.\r\n    if (this.props.credCode) {\r\n      this.props.onSubmit(this.props.credMethod, this.props.credCode, this.props.credToken);\r\n    }\r\n  }\r\n\r\n  componentDidUpdate(prevProps, prevState) {\r\n    // Submit code automatically if it's received from the parent.\r\n    if (this.state.codeReceived && this.state.code && this.state.code != prevState.code) {\r\n      this.props.onSubmit(this.props.credMethod, this.state.code, this.props.credToken);\r\n    }\r\n  }\r\n\r\n\r\n  handleCodeChange(e) {\r\n    this.setState({code: e.target.value.replace(/[^\\d]/g, '')});\r\n  }\r\n\r\n  handleKeyPress(e) {\r\n    if (e.key === 'Enter') {\r\n      this.handleSubmit(e);\r\n    } else if (e.key == 'Escape') {\r\n      this.handleCancel(e);\r\n    }\r\n  }\r\n\r\n  handleSubmit(e) {\r\n    e.preventDefault();\r\n    if (this.state.code && this.state.code.trim()) {\r\n      this.props.onSubmit(this.props.credMethod, this.state.code.trim(), this.props.credToken);\r\n    }\r\n  }\r\n\r\n  handleCancel(e) {\r\n    e.preventDefault();\r\n    this.props.onCancel();\r\n  }\r\n\r\n  render() {\r\n    const { formatMessage } = this.props.intl;\r\n    const methods = {'email': formatMessage(messages.email), 'tel': formatMessage(messages.phone)};\r\n    const method = methods[this.props.credMethod] || this.props.credMethod;\r\n    return (\r\n      <div className=\"panel-form\">\r\n        <div className=\"panel-form-row\">\r\n          <label className=\"small gray\" htmlFor=\"enter-confirmation-code\">\r\n            <FormattedMessage id=\"enter_confirmation_code_prompt\"\r\n              defaultMessage=\"Confirmation code\"\r\n              description=\"Request to enter confirmation code\"\r\n              values={{method: method}} />\r\n          </label>\r\n        </div>\r\n        <div className=\"panel-form-row\">\r\n          <FormattedMessage id=\"numeric_confirmation_code_prompt\"\r\n            defaultMessage=\"Numbers only\" description=\"Prompt for numeric conformation code\">{\r\n            (numbers_only) => <input type=\"text\" id=\"enter-confirmation-code\"\r\n              placeholder={numbers_only}\r\n              value={this.state.code} onChange={this.handleCodeChange}\r\n              onKeyDown={this.handleKeyPress} required />\r\n          }</FormattedMessage>\r\n        </div>\r\n        <div className=\"dialog-buttons\">\r\n          <button className=\"secondary\" onClick={this.handleCancel}>\r\n            <FormattedMessage id=\"button_cancel\" defaultMessage=\"Cancel\" description=\"Button [Cancel]\" />\r\n          </button>\r\n          <button className=\"primary\" onClick={this.handleSubmit}>\r\n            <FormattedMessage id=\"button_confirm\" defaultMessage=\"Confirm\" description=\"Button [Confirm]\" />\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n};\r\n\r\nexport default injectIntl(ValidationView);\r\n","import React, { Suspense } from 'react';\r\nimport { defineMessages, FormattedMessage, injectIntl } from 'react-intl';\r\n\r\nimport ErrorPanel from '../widgets/error-panel.jsx';\r\nimport LoadSpinner from '../widgets/load-spinner.jsx';\r\nimport SideNavbar from '../widgets/side-navbar.jsx';\r\nimport TopicCommonView from './topic-common-view.jsx';\r\n\r\nconst AccountSettingsView = React.lazy(_ => import('./account-settings-view.jsx'));\r\nimport ContactsView from './contacts-view.jsx';\r\nconst CreateAccountView = React.lazy(_ => import('./create-account-view.jsx'));\r\nimport AccNotificationsView from './acc-notifications-view.jsx';\r\nimport AccSecurityView from './acc-security-view.jsx';\r\nimport AccSupportView from './acc-support-view.jsx';\r\nimport LoginView from './login-view.jsx';\r\nimport NewTopicView from './new-topic-view.jsx';\r\nconst PasswordResetView = React.lazy(_ => import('./password-reset-view.jsx'));\r\nimport SettingsView from './settings-view.jsx';\r\nimport ValidationView from './validation-view.jsx';\r\n\r\n// Panel titles for translation.\r\nconst messages = defineMessages({\r\n  login: {\r\n    id: 'sidepanel_title_login',\r\n    description: 'Sidepanel title for LoginView.',\r\n    defaultMessage: 'Sign In'\r\n  },\r\n  register: {\r\n    id: 'sidepanel_title_register',\r\n    description: 'Sidepanel title for CreateAccountView.',\r\n    defaultMessage: 'Create Account'\r\n  },\r\n  settings: {\r\n    id: 'sidepanel_title_settings',\r\n    description: 'Sidepanel title for SettingsView.',\r\n    defaultMessage: 'Settings'\r\n  },\r\n  edit: {\r\n    id: 'sidepanel_title_account_settings',\r\n    description: 'Sidepanel title for AccountSettingsView.',\r\n    defaultMessage: 'Account Settings'\r\n  },\r\n  general: {\r\n    id: 'panel_title_general',\r\n    description: 'Title for TopicCommon.',\r\n    defaultMessage: 'General'\r\n  },\r\n  security: {\r\n    id: 'panel_title_security',\r\n    description: 'Title for TopicSecirity and AccSecurity.',\r\n    defaultMessage: 'Security'\r\n  },\r\n  crop: {\r\n    id: 'panel_title_crop',\r\n    description: 'Title for AvatarCropView.',\r\n    defaultMessage: 'Drag to Adjust'\r\n  },\r\n  notif: {\r\n    id: 'sidepanel_title_acc_notifications',\r\n    description: 'Sidepanel title for AccNotificationsView.',\r\n    defaultMessage: 'Notifications'\r\n  },\r\n  support: {\r\n    id: 'sidepanel_title_acc_support',\r\n    description: 'Sidepanel title for AccSupportView.',\r\n    defaultMessage: 'Support'\r\n  },\r\n  newtpk: {\r\n    id: 'sidepanel_title_newtpk',\r\n    description: 'Sidepanel title for NewTopicView.',\r\n    defaultMessage: 'Start New Chat'\r\n  },\r\n  cred: {\r\n    id: 'sidepanel_title_cred',\r\n    description: 'Sidepanel title for ValidationView.',\r\n    defaultMessage: 'Confirm Credentials'\r\n  },\r\n  reset: {\r\n    id: 'sidepanel_title_reset',\r\n    description: 'Sidepanel title for PasswordResetView.',\r\n    defaultMessage: 'Reset Password'\r\n  },\r\n  archive: {\r\n    id: 'sidepanel_title_archive',\r\n    description: 'Sidepanel title for ContactsView-Archive.',\r\n    defaultMessage: 'Archived Chats'\r\n  },\r\n  blocked: {\r\n    id: 'sidepanel_title_blocked',\r\n    description: 'Sidepanel title for ContactsView-Blocked.',\r\n    defaultMessage: 'Blocked Chats'\r\n  }\r\n});\r\n\r\nclass SidepanelView extends React.PureComponent {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.handleNewTopic = this.handleNewTopic.bind(this);\r\n  }\r\n\r\n  handleNewTopic() {\r\n    this.props.onNavigate('newtpk');\r\n  }\r\n\r\n  render() {\r\n    const {formatMessage} = this.props.intl;\r\n    const view = this.props.state || (this.props.myUserId ? 'contacts' : 'login');\r\n\r\n    let title, avatar, badges;\r\n    if (view == 'contacts') {\r\n      title = this.props.title;\r\n      avatar = this.props.avatar ? this.props.avatar : true;\r\n      badges = this.props.trustedBadges;\r\n    } else {\r\n      title = formatMessage(messages[view]);\r\n      avatar = false;\r\n      badges = null;\r\n    }\r\n\r\n    let onCancel;\r\n    if (['login', 'contacts'].indexOf(view) == -1) {\r\n      onCancel = this.props.onCancel;\r\n    }\r\n\r\n    return (\r\n      <div id=\"sidepanel\">\r\n        <SideNavbar\r\n          state={view}\r\n          title={title}\r\n          avatar={avatar}\r\n          tinode={this.props.tinode}\r\n          trustedBadges={badges}\r\n          myUserId={this.props.myUserId}\r\n          onSignUp={this.props.onSignUp}\r\n          onSettings={this.props.onSettings}\r\n          onNewTopic={this.handleNewTopic}\r\n          onCancel={onCancel} />\r\n\r\n        <ErrorPanel\r\n          level={this.props.errorLevel}\r\n          text={this.props.errorText}\r\n          action={this.props.errorAction}\r\n          actionText={this.props.errorActionText}\r\n          onClearError={this.props.onError} />\r\n\r\n        <LoadSpinner show={this.props.loadSpinnerVisible} />\r\n\r\n        {view === 'login' ?\r\n          <LoginView\r\n            login={this.props.login}\r\n            disabled={this.props.loginDisabled}\r\n            persist={this.props.persist}\r\n            onLogin={this.props.onLoginRequest}\r\n            onPersistenceChange={this.props.onPersistenceChange} /> :\r\n\r\n          view === 'register' ?\r\n          <Suspense fallback={<div className=\"panel-form-row\"><FormattedMessage id=\"loading_note\"\r\n            defaultMessage=\"Loading...\" description=\"Message shown when component is loading\"/></div>}>\r\n            <CreateAccountView\r\n              tinode={this.props.tinode}\r\n              reqCredMethod={this.props.reqCredMethod}\r\n              onShowCountrySelector={this.props.onShowCountrySelector}\r\n              onCreateAccount={this.props.onCreateAccount}\r\n              onCancel={this.props.onCancel}\r\n              onError={this.props.onError} />\r\n          </Suspense> :\r\n\r\n          view === 'settings' ?\r\n          <SettingsView\r\n            transport={this.props.transport}\r\n            serverAddress={this.props.serverAddress}\r\n            secureConnection={this.props.secureConnection}\r\n            onCancel={this.props.onCancel}\r\n            onUpdate={this.props.onGlobalSettings} /> :\r\n\r\n          view === 'edit' ?\r\n          <Suspense fallback={<div className=\"panel-form-row\"><FormattedMessage id=\"loading_note\"\r\n            defaultMessage=\"Loading...\" description=\"Message shown when component is loading\"/></div>}>\r\n            <AccountSettingsView\r\n              tinode={this.props.tinode}\r\n              myUserId={this.props.myUserId}\r\n              trustedBadges={this.props.trustedBadges}\r\n              reqCredMethod={this.props.reqCredMethod}\r\n              onShowCountrySelector={this.props.onShowCountrySelector}\r\n              onNavigate={this.props.onNavigate}\r\n              onCredAdd={this.props.onCredAdd}\r\n              onCredDelete={this.props.onCredDelete}\r\n              onCredConfirm={this.props.onCredConfirm}\r\n              onError={this.props.onError} />\r\n          </Suspense> :\r\n\r\n          (view === 'general' || view === 'crop') ?\r\n          <TopicCommonView\r\n            topic=\"me\"\r\n            tinode={this.props.tinode}\r\n            myUserId={this.props.myUserId}\r\n            reqCredMethod={this.props.reqCredMethod}\r\n            onUpdateTopicDesc={this.props.onUpdateAccountDesc}\r\n            onUpdateTagsRequest={this.props.onUpdateAccountTags}\r\n            onError={this.props.onError} /> :\r\n\r\n          view === 'notif' ?\r\n          <AccNotificationsView\r\n            messageSounds={this.props.messageSounds}\r\n            desktopAlerts={this.props.desktopAlerts}\r\n            desktopAlertsEnabled={this.props.desktopAlertsEnabled}\r\n            incognitoMode={this.props.incognitoMode}\r\n            onTogglePushNotifications={this.props.onTogglePushNotifications}\r\n            onToggleMessageSounds={this.props.onToggleMessageSounds}\r\n            onToggleIncognitoMode={this.props.onToggleIncognitoMode} /> :\r\n\r\n          view === 'security' ?\r\n          <AccSecurityView\r\n            tinode={this.props.tinode}\r\n            onUpdateAccountDesc={this.props.onUpdateAccountDesc}\r\n            onUpdatePassword={this.props.onUpdatePassword}\r\n            onLogout={this.props.onLogout}\r\n            onDeleteAccount={this.props.onDeleteAccount}\r\n            onSoftDeleteAllMessage={this.props.onSoftDeleteAllMessage}\r\n            onShowAlert={this.props.onShowAlert}\r\n            onShowBlocked={this.props.onShowBlocked} /> :\r\n\r\n          view === 'support' ?\r\n          <AccSupportView\r\n            serverAddress={this.props.serverAddress}\r\n            serverVersion={this.props.serverVersion} /> :\r\n\r\n          (view === 'contacts' || view == 'archive' || view == 'blocked') ?\r\n          <ContactsView\r\n            tinode={this.props.tinode}\r\n            myUserId={this.props.myUserId}\r\n            connected={this.props.connected}\r\n            topicSelected={this.props.topicSelected}\r\n            archive={view == 'archive'}\r\n            blocked={view == 'blocked'}\r\n            chatList={this.props.chatList}\r\n            showContextMenu={this.props.showContextMenu}\r\n            onTopicSelected={this.props.onTopicSelected}\r\n            onShowArchive={this.props.onShowArchive} /> :\r\n\r\n          view === 'newtpk' ?\r\n          <NewTopicView\r\n            tinode={this.props.tinode}\r\n            searchResults={this.props.searchResults}\r\n            onInitFind={this.props.onInitFind}\r\n            onSearchContacts={this.props.onSearchContacts}\r\n            onCreateTopic={this.props.onCreateTopic}\r\n            onError={this.props.onError} /> :\r\n\r\n          view === 'cred' ?\r\n          <ValidationView\r\n            credCode={this.props.credCode}\r\n            credMethod={this.props.credMethod}\r\n            credToken={this.props.credToken}\r\n            onSubmit={this.props.onValidateCredentials}\r\n            onCancel={this.props.onCancel} /> :\r\n\r\n          view === 'reset' ?\r\n          <Suspense fallback={<div className=\"panel-form-row\"><FormattedMessage id=\"loading_note\"\r\n            defaultMessage=\"Loading...\" description=\"Message shown when component is loading\"/></div>}>\r\n            <PasswordResetView\r\n              tinode={this.props.tinode}\r\n              reqCredMethod={this.props.reqCredMethod}\r\n              onShowCountrySelector={this.props.onShowCountrySelector}\r\n              onRequest={this.props.onPasswordResetRequest}\r\n              onReset={this.props.onResetPassword}\r\n              onCancel={this.props.onCancel}\r\n              onError={this.props.onError} />\r\n          </Suspense> :\r\n          null}\r\n      </div>\r\n    );\r\n  }\r\n};\r\n\r\nexport default injectIntl(SidepanelView);\r\n","import { KNOWN_HOSTS, DEFAULT_HOST } from '../config.js';\r\n\r\n// Detect server address from the URL\r\nexport function detectServerAddress() {\r\n  let host = DEFAULT_HOST;\r\n  if (typeof window.location == 'object') {\r\n    if (window.location.protocol == 'file:' || window.location.hostname == 'localhost') {\r\n      host = KNOWN_HOSTS.local;\r\n    } else if (window.location.hostname) {\r\n      host = window.location.hostname + (window.location.port ? ':' + window.location.port : '');\r\n    }\r\n  }\r\n  return host;\r\n}\r\n\r\n// Detect if the page is served over HTTPS.\r\nexport function isSecureConnection() {\r\n  if (typeof window.location == 'object') {\r\n    return window.location.protocol == 'https:';\r\n  }\r\n  return false;\r\n}\r\n\r\nexport function isLocalHost() {\r\n  if (typeof window.location == 'object') {\r\n    return window.location.hostname == 'localhost';\r\n  }\r\n  return false;\r\n}\r\n","// The top-level class to hold all functionality together.\r\nimport React, { Suspense } from 'react';\r\nimport { FormattedMessage, defineMessages, injectIntl } from 'react-intl';\r\n\r\nimport { initializeApp as firebaseInitApp } from 'firebase/app';\r\nimport { getMessaging as firebaseGetMessaging, getToken as firebaseGetToken,\r\n  deleteToken as firebaseDelToken, onMessage as firebaseOnMessage } from 'firebase/messaging';\r\n\r\nimport { Drafty, Tinode } from 'tinode-sdk';\r\n\r\nimport Alert from '../widgets/alert.jsx';\r\nimport ContextMenu from '../widgets/context-menu.jsx';\r\nimport ForwardDialog from '../widgets/forward-dialog.jsx';\r\nimport CallIncoming from '../widgets/call-incoming.jsx';\r\nconst PhoneCountrySelector = React.lazy(_ => import('../widgets/phone-country-selector.jsx'));\r\n\r\nimport InfoView from './info-view.jsx';\r\nimport MessagesView from './messages-view.jsx';\r\nimport SidepanelView from './sidepanel-view.jsx';\r\n\r\nimport { API_KEY, APP_NAME, DEFAULT_P2P_ACCESS_MODE, FORWARDED_PREVIEW_LENGTH, LOGGING_ENABLED,\r\n  MEDIA_BREAKPOINT, WAKE_UP_TICK, WAKE_UP_TIMEOUT } from '../config.js';\r\nimport { CALL_STATE_NONE, CALL_STATE_OUTGOING_INITATED,\r\n         CALL_STATE_INCOMING_RECEIVED, CALL_STATE_IN_PROGRESS,\r\n         CALL_HEAD_STARTED }  from '../constants.js';\r\nimport { PACKAGE_VERSION } from '../version.js';\r\nimport { base64ReEncode, makeImageUrl } from '../lib/blob-helpers.js';\r\nimport { detectServerAddress, isLocalHost, isSecureConnection } from '../lib/host-name.js';\r\nimport LocalStorageUtil from '../lib/local-storage.js';\r\nimport HashNavigation from '../lib/navigation.js';\r\nimport { secondsToTime } from '../lib/strformat.js'\r\nimport { updateFavicon } from '../lib/utils.js';\r\n\r\n// Sound to play on message received.\r\nconst POP_SOUND = new Audio('audio/msg.m4a');\r\n\r\nconst messages = defineMessages({\r\n  reconnect_countdown: {\r\n    id: 'reconnect_countdown',\r\n    defaultMessage: 'Disconnected. Reconnecting in {seconds}…',\r\n    description: 'Message shown when an app update is available.'\r\n  },\r\n  reconnect_now: {\r\n    id: 'reconnect_now',\r\n    defaultMessage: 'Try now',\r\n    description: 'Prompt for reconnecting now'\r\n  },\r\n  push_init_failed: {\r\n    id: 'push_init_failed',\r\n    defaultMessage: 'Failed to initialize push notifications',\r\n    description: 'Error message when push notifications have failed to initialize.'\r\n  },\r\n  invalid_security_token: {\r\n    id: 'invalid_security_token',\r\n    defaultMessage: 'Invalid security token',\r\n    description: 'Error message when resetting password.'\r\n  },\r\n  no_connection: {\r\n    id: 'no_connection',\r\n    defaultMessage: 'No connection',\r\n    description: 'Warning that the user is offline.'\r\n  },\r\n  code_doesnot_match: {\r\n    id: 'code_doesnot_match',\r\n    defaultMessage: 'Code does not match',\r\n    description: 'Error message when the credential validation code is incorrect.'\r\n  },\r\n  menu_item_info: {\r\n    id: 'menu_item_info',\r\n    defaultMessage: 'Info',\r\n    description: 'Show extended topic information'\r\n  },\r\n  menu_item_audio_call: {\r\n    id: 'menu_item_audio_call',\r\n    defaultMessage: 'Call',\r\n    description: 'Start audio call'\r\n  },\r\n  menu_item_video_call: {\r\n    id: 'menu_item_video_call',\r\n    defaultMessage: 'Video call',\r\n    description: 'Start video call'\r\n  },\r\n  cred_confirmed_successfully: {\r\n    id: 'cred_confirmed_successfully',\r\n    defaultMessage: 'Confirmed successfully',\r\n    description: 'Notification message that the credential was successfully validated.'\r\n  },\r\n  password_reset_success: {\r\n    id: 'password_reset_success',\r\n    defaultMessage: 'Password reset successfully',\r\n    description: 'Notification message that the password was successfully reset.'\r\n  },\r\n  select_country: {\r\n    id: 'select_country',\r\n    defaultMessage: 'Select country',\r\n    description: 'Placeholder for the country selector'\r\n  }\r\n});\r\n\r\nclass TinodeWeb extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.selfRef = React.createRef();\r\n\r\n    this.state = this.getBlankState();\r\n\r\n    this.handleResize = this.handleResize.bind(this);\r\n    this.handleHashRoute = this.handleHashRoute.bind(this);\r\n    this.handleOnline = this.handleOnline.bind(this);\r\n    this.checkForAppUpdate = this.checkForAppUpdate.bind(this);\r\n    this.handleVisibilityEvent = this.handleVisibilityEvent.bind(this);\r\n    this.handleError = this.handleError.bind(this);\r\n    this.handleLoginRequest = this.handleLoginRequest.bind(this);\r\n    this.handlePersistenceChange = this.handlePersistenceChange.bind(this);\r\n    this.handleConnected = this.handleConnected.bind(this);\r\n    this.handleAutoreconnectIteration = this.handleAutoreconnectIteration.bind(this);\r\n    this.doLogin = this.doLogin.bind(this);\r\n    this.handleLoginSuccessful = this.handleLoginSuccessful.bind(this);\r\n    this.handleDisconnect = this.handleDisconnect.bind(this);\r\n    this.tnMeMetaDesc = this.tnMeMetaDesc.bind(this);\r\n    this.tnMeContactUpdate = this.tnMeContactUpdate.bind(this);\r\n    this.tnMeSubsUpdated = this.tnMeSubsUpdated.bind(this);\r\n    this.resetContactList = this.resetContactList.bind(this);\r\n    this.tnInitFind = this.tnInitFind.bind(this);\r\n    this.tnFndSubsUpdated = this.tnFndSubsUpdated.bind(this);\r\n    this.handleSearchContacts = this.handleSearchContacts.bind(this);\r\n    this.handleTopicSelected = this.handleTopicSelected.bind(this);\r\n    this.handleHideMessagesView = this.handleHideMessagesView.bind(this);\r\n    this.handleSendMessage = this.handleSendMessage.bind(this);\r\n    this.handleNewChatInvitation = this.handleNewChatInvitation.bind(this);\r\n    this.handleNewAccount = this.handleNewAccount.bind(this);\r\n    this.handleNewAccountRequest = this.handleNewAccountRequest.bind(this);\r\n    this.handleUpdatePasswordRequest = this.handleUpdatePasswordRequest.bind(this);\r\n    this.handleUpdateAccountTagsRequest = this.handleUpdateAccountTagsRequest.bind(this);\r\n    this.handleToggleIncognitoMode = this.handleToggleIncognitoMode.bind(this);\r\n    this.handleSettings = this.handleSettings.bind(this);\r\n    this.handleGlobalSettings = this.handleGlobalSettings.bind(this);\r\n    this.handleShowArchive = this.handleShowArchive.bind(this);\r\n    this.handleShowBlocked = this.handleShowBlocked.bind(this);\r\n    this.handleToggleMessageSounds = this.handleToggleMessageSounds.bind(this);\r\n    this.handleCredAdd = this.handleCredAdd.bind(this);\r\n    this.handleCredDelete = this.handleCredDelete.bind(this);\r\n    this.handleCredConfirm = this.handleCredConfirm.bind(this);\r\n    this.initFCMessaging = this.initFCMessaging.bind(this);\r\n    this.toggleFCMToken = this.toggleFCMToken.bind(this);\r\n    this.handlePushMessage = this.handlePushMessage.bind(this);\r\n    this.handleSidepanelCancel = this.handleSidepanelCancel.bind(this);\r\n    this.handleStartTopicRequest = this.handleStartTopicRequest.bind(this);\r\n    this.handleNewTopicCreated = this.handleNewTopicCreated.bind(this);\r\n    this.handleTopicUpdateRequest = this.handleTopicUpdateRequest.bind(this);\r\n    this.handleUnarchive = this.handleUnarchive.bind(this);\r\n    this.handleChangePermissions = this.handleChangePermissions.bind(this);\r\n    this.handleTagsUpdateRequest = this.handleTagsUpdateRequest.bind(this);\r\n    this.handleLogout = this.handleLogout.bind(this);\r\n    this.handleDeleteAccount = this.handleDeleteAccount.bind(this);\r\n    this.handleSoftDeleteAllMessage = this.handleSoftDeleteAllMessage.bind(this);\r\n    this.handleDeleteTopicRequest = this.handleDeleteTopicRequest.bind(this);\r\n    this.handleDeleteMessagesRequest = this.handleDeleteMessagesRequest.bind(this);\r\n    this.handleLeaveUnsubRequest = this.handleLeaveUnsubRequest.bind(this);\r\n    this.handleBlockTopicRequest = this.handleBlockTopicRequest.bind(this);\r\n    this.handleReportTopic = this.handleReportTopic.bind(this);\r\n    this.handleShowContextMenu = this.handleShowContextMenu.bind(this);\r\n    this.defaultTopicContextMenu = this.defaultTopicContextMenu.bind(this);\r\n    this.handleHideContextMenu = this.handleHideContextMenu.bind(this);\r\n    this.handleShowAlert = this.handleShowAlert.bind(this);\r\n    this.handleShowInfoView = this.handleShowInfoView.bind(this);\r\n    this.handleMemberUpdateRequest = this.handleMemberUpdateRequest.bind(this);\r\n    this.handleValidateCredentialsRequest = this.handleValidateCredentialsRequest.bind(this);\r\n    this.handlePasswordResetRequest = this.handlePasswordResetRequest.bind(this);\r\n    this.handleResetPassword = this.handleResetPassword.bind(this);\r\n    this.handleContextMenuAction = this.handleContextMenuAction.bind(this);\r\n    this.handleShowCountrySelector =  this.handleShowCountrySelector.bind(this);\r\n\r\n    this.handleShowForwardDialog = this.handleShowForwardDialog.bind(this);\r\n    this.handleHideForwardDialog = this.handleHideForwardDialog.bind(this);\r\n\r\n    this.handleStartVideoCall = this.handleStartVideoCall.bind(this);\r\n    this.handleStartAudioCall = this.handleStartAudioCall.bind(this);\r\n    this.handleInfoMessage = this.handleInfoMessage.bind(this);\r\n    this.handleDataMessage = this.handleDataMessage.bind(this);\r\n    this.handleCallClose = this.handleCallClose.bind(this);\r\n\r\n    this.handleCallInvite = this.handleCallInvite.bind(this);\r\n    this.handleCallRinging = this.handleCallRinging.bind(this);\r\n    this.handleCallHangup = this.handleCallHangup.bind(this);\r\n    this.handleCallSendOffer = this.handleCallSendOffer.bind(this);\r\n    this.handleCallIceCandidate = this.handleCallIceCandidate.bind(this);\r\n    this.handleCallSendAnswer = this.handleCallSendAnswer.bind(this);\r\n\r\n    this.handleCallAccept = this.handleCallAccept.bind(this);\r\n\r\n    this.sendMessageToTopic = this.sendMessageToTopic.bind(this);\r\n\r\n    // FIXME: this is unused.\r\n    this.callTimeoutTimer = null;\r\n  }\r\n\r\n  getBlankState() {\r\n    const settings = LocalStorageUtil.getObject('settings') || {};\r\n    const persist = !!LocalStorageUtil.getObject('keep-logged-in');\r\n\r\n    return {\r\n      connected: false,\r\n      // Connected and subscribed to 'me'\r\n      ready: false,\r\n      // Try to re-login on new connection.\r\n      autoLogin: false,\r\n      transport: settings.transport || null,\r\n      serverAddress: settings.serverAddress || detectServerAddress(),\r\n      secureConnection: settings.secureConnection === undefined ?\r\n        isSecureConnection() : settings.secureConnection,\r\n      serverVersion: \"no connection\",\r\n      // \"On\" is the default, so saving the \"off\" state.\r\n      messageSounds: !settings.messageSoundsOff,\r\n      incognitoMode: false,\r\n      // Persistent request to enable alerts.\r\n      desktopAlerts: persist && !!settings.desktopAlerts,\r\n      // Enable / disable checkbox.\r\n      desktopAlertsEnabled: (isSecureConnection() || isLocalHost()) &&\r\n        (typeof firebaseInitApp != 'undefined') && (typeof navigator != 'undefined') &&\r\n        (typeof FIREBASE_INIT != 'undefined'),\r\n      firebaseToken: persist ? LocalStorageUtil.getObject('firebase-token') : null,\r\n\r\n      applicationVisible: !document.hidden,\r\n\r\n      errorText: '',\r\n      errorLevel: null,\r\n      errorAction: undefined,\r\n      errorActionText: null,\r\n\r\n      sidePanelSelected: 'login',\r\n      sidePanelTitle: null,\r\n      sidePanelAvatar: null,\r\n      myTrustedBadges: [],\r\n      loadSpinnerVisible: false,\r\n\r\n      login: '',\r\n      password: '',\r\n      persist: persist,\r\n      myUserId: null,\r\n      liveConnection: navigator.onLine,\r\n      topicSelected: '',\r\n      topicSelectedOnline: false,\r\n      topicSelectedAcs: null,\r\n      newTopicParams: null,\r\n      loginDisabled: false,\r\n      displayMobile: (window.innerWidth <= MEDIA_BREAKPOINT),\r\n      infoPanel: undefined,\r\n      mobilePanel: 'sidepanel',\r\n\r\n      // Video calls.\r\n      callTopic: undefined,\r\n      callState: CALL_STATE_NONE,\r\n      callAudioOnly: undefined,\r\n      // If true, call state should be transitioned to CALL_STATE_IN_PROGRESS upon\r\n      // switching to the call topic.\r\n      callShouldStart: false,\r\n\r\n      contextMenuVisible: false,\r\n      contextMenuBounds: null,\r\n      contextMenuClickAt: null,\r\n      contextMenuParams: null,\r\n      contextMenuItems: [],\r\n\r\n      forwardDialogVisible: false,\r\n      forwardMessage: null,\r\n\r\n      // Modal alert dialog.\r\n      alertVisible: false,\r\n      alertParams: {},\r\n\r\n      // Chats as shown in the ContactsView\r\n      chatList: [],\r\n      // Contacts returned by a search query.\r\n      searchResults: [],\r\n      // Merged results of a search query and p2p chats.\r\n      searchableContacts: [],\r\n      // Credential validation.\r\n      reqCredMethod: undefined,\r\n      credMethod: undefined,\r\n      credCode: undefined,\r\n      credToken: undefined,\r\n      // Topic to go to after login.\r\n      requestedTopic: undefined\r\n    };\r\n  }\r\n\r\n  componentDidMount() {\r\n    window.addEventListener('resize', this.handleResize);\r\n    this.handleOnlineOn = _ => { this.handleOnline(true); }\r\n    window.addEventListener('online', this.handleOnlineOn);\r\n    this.handleOnlineOff = _ => { this.handleOnline(false); }\r\n    window.addEventListener('offline', this.handleOnlineOff);\r\n    window.addEventListener('hashchange', this.handleHashRoute);\r\n\r\n    // Process background notifications from the service worker.\r\n    if (typeof BroadcastChannel == 'function') {\r\n      const serviceWorkerChannel = new BroadcastChannel('tinode-sw');\r\n      serviceWorkerChannel.addEventListener('message', this.handlePushMessage);\r\n    } else {\r\n      // Safari is broken by design.\r\n      console.warn(\"Your browser does not support BroadcastChannel. Some features will not be available\");\r\n    }\r\n\r\n    // Detect if computer just woke up from sleep. Checks how much time has passed since the last tick.\r\n    // If too much time has passed then the computer was asleep.\r\n    this.lastWakeUpCheck = new Date().getTime();\r\n    this.wakeUpTicker = setInterval(_ => {\r\n      const now = new Date().getTime();\r\n      if (now - this.lastWakeUpCheck > WAKE_UP_TIMEOUT) {\r\n        // Trigger reconnect.\r\n        this.handleOnlineOn();\r\n      }\r\n      this.lastWakeUpCheck = now;\r\n    }, WAKE_UP_TICK);\r\n\r\n    // Window/tab visible or invisible for pausing timers.\r\n    document.addEventListener('visibilitychange', this.handleVisibilityEvent);\r\n\r\n    this.setState({\r\n      viewportWidth: document.documentElement.clientWidth,\r\n      viewportHeight: document.documentElement.clientHeight\r\n    });\r\n\r\n    new Promise((resolve, reject) => {\r\n      this.tinode = TinodeWeb.tnSetup(this.state.serverAddress, isSecureConnection(), this.state.transport,\r\n        this.props.intl.locale, this.state.persist, resolve);\r\n      this.tinode.onConnect = this.handleConnected;\r\n      this.tinode.onDisconnect = this.handleDisconnect;\r\n      this.tinode.onAutoreconnectIteration = this.handleAutoreconnectIteration;\r\n      this.tinode.onInfoMessage = this.handleInfoMessage;\r\n      this.tinode.onDataMessage = this.handleDataMessage;\r\n    }).then(_ => {\r\n      // Initialize desktop alerts.\r\n      if (this.state.desktopAlertsEnabled) {\r\n        this.initFCMessaging().catch(_ => {\r\n          // do nothing: handled earlier.\r\n          // catch needed to pervent unnecessary logging of error.\r\n        });\r\n      }\r\n\r\n      // Read contacts from cache.\r\n      this.resetContactList();\r\n\r\n      const token = this.state.persist ? LocalStorageUtil.getObject('auth-token') : undefined;\r\n      if (token) {\r\n        this.setState({autoLogin: true});\r\n\r\n        // When reading from storage, date is returned as string.\r\n        token.expires = new Date(token.expires);\r\n        this.tinode.setAuthToken(token);\r\n        this.tinode.connect().catch(err => {\r\n          // Socket error\r\n          this.handleError(err.message, 'err');\r\n        });\r\n      }\r\n\r\n      this.readTimer = null;\r\n      this.readTimerCallback = null;\r\n\r\n      // set interval to delete expired message\r\n      this.autoDeleteExpiredMessageLock = false;\r\n      this.autoDeleteExpiredMessage = setInterval(_ => {\r\n        if (!this.autoDeleteExpiredMessageLock) {\r\n          this.autoDeleteExpiredMessageLock = true;\r\n          this.tinode.deleteExpiredMessages();\r\n          this.autoDeleteExpiredMessageLock = false;\r\n        }\r\n      }, 3000);\r\n\r\n      // Parse the hash navigation params.\r\n      const parsedNav = HashNavigation.parseUrlHash(window.location.hash);\r\n      // Maybe navigate to home screen.\r\n      if (!['cred', 'reset', 'register'].includes(parsedNav.path[0])) {\r\n        // Save possible topic name.\r\n        this.setState({requestedTopic: parsedNav.path[1]});\r\n        const path = parsedNav.params && parsedNav.params.cred_done ?\r\n          HashNavigation.addUrlParam('', 'cred_done', parsedNav.params.cred_done):\r\n          '';\r\n        HashNavigation.navigateTo(path);\r\n      } else {\r\n        this.handleHashRoute();\r\n      }\r\n    });\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    window.removeEventListener('resize', this.handleResize);\r\n    window.removeEventListener('hashchange', this.handleHashRoute);\r\n    window.removeEventListener('online', this.handleOnlineOn);\r\n    window.removeEventListener('offline', this.handleOnlineOff);\r\n    document.removeEventListener('visibilitychange', this.handleVisibilityEvent);\r\n\r\n    clearInterval(this.wakeUpTicker);\r\n  }\r\n\r\n  // Setup transport (usually websocket) and server address. This will terminate connection with the server.\r\n  static tnSetup(serverAddress, secureConnection, transport, locale, persistentCache, onSetupCompleted) {\r\n    const tinode = new Tinode({appName: APP_NAME, host: serverAddress, apiKey: API_KEY, transport: transport,\r\n      secure: secureConnection, persist: persistentCache}, onSetupCompleted);\r\n    tinode.setHumanLanguage(locale);\r\n    tinode.enableLogging(LOGGING_ENABLED, true);\r\n    return tinode;\r\n  }\r\n\r\n  // Tinode received a push notification from the server.\r\n  handlePushMessage(payload) {\r\n    this.tinode.oobNotification(payload.data || {});\r\n  }\r\n\r\n  initFCMessaging() {\r\n    const {formatMessage, locale} = this.props.intl;\r\n    const onError = (msg, err) => {\r\n      console.error(msg, err);\r\n      // this.handleError(formatMessage(messages.push_init_failed), 'err');\r\n      this.setState({firebaseToken: null});\r\n      LocalStorageUtil.updateObject('settings', {desktopAlerts: false});\r\n    }\r\n\r\n    try {\r\n      // this.fcm = firebaseGetMessaging(firebaseInitApp(FIREBASE_INIT, APP_NAME));\r\n      return navigator.serviceWorker.getRegistration('/service-worker.js').then(reg => {\r\n        return reg || navigator.serviceWorker.register('/service-worker.js').then(reg => {\r\n          this.checkForAppUpdate(reg);\r\n          return reg;\r\n        });\r\n      }).then(reg => {\r\n        // Pass locale and version config to the service worker.\r\n        (reg.active || reg.installing).postMessage(JSON.stringify({locale: locale, version: PACKAGE_VERSION}));\r\n        // Request token.\r\n        // return TinodeWeb.requestFCMToken(this.fcm, reg);\r\n      }).then(token => {\r\n        // const persist = LocalStorageUtil.getObject('keep-logged-in');\r\n        // if (token != this.state.firebaseToken) {\r\n        //   this.tinode.setDeviceToken(token);\r\n        //   if (persist) {\r\n        //     LocalStorageUtil.setObject('firebase-token', token);\r\n        //   }\r\n        // }\r\n        // this.setState({firebaseToken: token, desktopAlerts: true});\r\n        // if (persist) {\r\n        //   LocalStorageUtil.updateObject('settings', {desktopAlerts: true});\r\n        // }\r\n\r\n        // Handhe FCM pushes\r\n        // (a) for channels always,\r\n        // (b) pushes when the app is in foreground but has no focus.\r\n        // firebaseOnMessage(this.fcm, payload => { this.handlePushMessage(payload); });\r\n      }).catch(err => {\r\n        // SW registration or FCM has failed :(\r\n        onError(err);\r\n        throw err;\r\n      });\r\n    } catch (err) {\r\n      onError(err);\r\n      return Promise.reject(err);\r\n    }\r\n  }\r\n\r\n  // Google's FCM API is idiotic.\r\n  static requestFCMToken(fcm, sw) {\r\n    return firebaseGetToken(fcm, {\r\n      serviceWorkerRegistration: sw,\r\n      vapidKey: FIREBASE_INIT.messagingVapidKey\r\n    }).then(token => {\r\n      if (token) {\r\n        return token;\r\n      } else if (typeof Notification != 'undefined') {\r\n        // Try to request permissions.\r\n        return Notification.requestPermission().then(permission => {\r\n          if (permission === 'granted') {\r\n            return firebaseGetToken(fcm, {\r\n              serviceWorkerRegistration: reg,\r\n              vapidKey: FIREBASE_INIT.messagingVapidKey\r\n            }).then(token => {\r\n              if (token) {\r\n                return token;\r\n              } else {\r\n                throw new Error(\"Failed to initialize notifications\");\r\n              }\r\n            });\r\n          } else {\r\n            throw new Error(\"No permission to send notifications: \" + permission);\r\n          }\r\n        });\r\n      }\r\n      throw new Error(\"Notifications are not supported\");\r\n    });\r\n  }\r\n\r\n  handleResize() {\r\n    const mobile = document.documentElement.clientWidth <= MEDIA_BREAKPOINT;\r\n    this.setState({\r\n      viewportWidth: document.documentElement.clientWidth,\r\n      viewportHeight: document.documentElement.clientHeight\r\n    });\r\n    if (this.state.displayMobile != mobile) {\r\n      this.setState({displayMobile: mobile});\r\n    }\r\n  }\r\n\r\n  // Check if a newer version of TinodeWeb app is available at the server.\r\n  checkForAppUpdate(reg) {\r\n    reg.onupdatefound = _ => {\r\n      const installingWorker = reg.installing;\r\n      installingWorker.onstatechange = _ => {\r\n        if (installingWorker.state == 'installed' && navigator.serviceWorker.controller) {\r\n          const msg = <>\r\n            <FormattedMessage id=\"update_available\"\r\n              defaultMessage=\"Update available.\"\r\n              description=\"Message shown when an app update is available.\" /> <a href=\"\">\r\n              <FormattedMessage id=\"reload_update\"\r\n                defaultMessage=\"Reload\"\r\n                description=\"Call to action to reload application when update is available.\" />\r\n            </a>.</>;\r\n          this.handleError(msg, 'info');\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  // Handle for hash navigation (hashchange) event: update state.\r\n  handleHashRoute() {\r\n    const hash = HashNavigation.parseUrlHash(window.location.hash);\r\n    // Start with panel parameters.\r\n    const newState = {\r\n      infoPanel: hash.params.info,\r\n      newTopicTabSelected: hash.params.tab\r\n    };\r\n\r\n    if (hash.path && hash.path.length > 0) {\r\n      // Left-side panel selector.\r\n      if (['register','settings','edit','notif','security','support','general','crop',\r\n          'cred','reset','newtpk','archive','blocked','contacts',''].includes(hash.path[0])) {\r\n        newState.sidePanelSelected = hash.path[0];\r\n      } else {\r\n        console.warn(\"Unknown sidepanel view\", hash.path[0]);\r\n      }\r\n\r\n      // Topic for MessagesView selector.\r\n      let topicName = hash.path[1] || null;\r\n      if (topicName != this.state.topicSelected) {\r\n        if (!Tinode.topicType(topicName)) {\r\n          // Clear invalid topic name and hide messages view on mobile.\r\n          topicName = null;\r\n          newState.mobilePanel = 'sidepanel';\r\n        } else {\r\n          // Topic valid: show messages view on mobile.\r\n          newState.mobilePanel = 'topic-view';\r\n        }\r\n        Object.assign(newState, {\r\n          topicSelected: topicName,\r\n          topicSelectedAcs: this.tinode.getTopicAccessMode(topicName)\r\n        });\r\n      }\r\n    } else {\r\n      // Empty hashpath\r\n      Object.assign(newState, {sidePanelSelected: '', topicSelected: null});\r\n    }\r\n\r\n    // Save credential validation parameters, if available.\r\n    if (hash.params.method) {\r\n      newState.credMethod = hash.params.method;\r\n    }\r\n    if (hash.params.code) {\r\n      newState.credCode = hash.params.code;\r\n    }\r\n    if (hash.params.token) {\r\n      newState.credToken = hash.params.token;\r\n    }\r\n\r\n    // Show a message if validation was successful.\r\n    if (hash.params.cred_done) {\r\n      Object.assign(newState,\r\n        TinodeWeb.stateForError(this.props.intl.formatMessage(messages.cred_confirmed_successfully), 'info'));\r\n    }\r\n\r\n    this.setState(newState);\r\n  }\r\n\r\n  handleOnline(online) {\r\n    if (online) {\r\n      this.handleError();\r\n      clearInterval(this.reconnectCountdown);\r\n      this.tinode.reconnect();\r\n    } else {\r\n      this.handleError(this.props.intl.formatMessage(messages.no_connection), 'warn');\r\n    }\r\n    this.setState({liveConnection: online});\r\n  }\r\n\r\n  handleVisibilityEvent() {\r\n    this.setState({applicationVisible: !document.hidden});\r\n  }\r\n\r\n  static stateForError(err, level, action, actionText) {\r\n    return {\r\n      errorText: err,\r\n      errorLevel: level,\r\n      errorAction: action,\r\n      errorActionText: actionText,\r\n      callShouldStart: false,\r\n    };\r\n  }\r\n\r\n  handleError(err, level, action, actionText) {\r\n    this.setState(TinodeWeb.stateForError(err, level, action, actionText));\r\n  }\r\n\r\n  // User clicked Login button in the side panel.\r\n  handleLoginRequest(login, password) {\r\n    this.setState({\r\n      loginDisabled: true,\r\n      login: login,\r\n      password: password,\r\n      loadSpinnerVisible: true,\r\n      autoLogin: true\r\n    });\r\n    this.handleError('', null);\r\n\r\n    if (this.tinode.isConnected()) {\r\n      this.doLogin(login, password, null, {meth: this.state.credMethod, resp: this.state.credCode});\r\n    } else {\r\n      this.tinode.connect().catch(err => {\r\n        // Socket error\r\n        this.setState({loginDisabled: false, autoLogin: false, loadSpinnerVisible: false});\r\n        this.handleError(err.message, 'err');\r\n      });\r\n    }\r\n\r\n    if (this.state.desktopAlertsEnabled && !this.state.firebaseToken) {\r\n      // Firefox and Safari: \"The Notification permission may only be requested from inside a\r\n      // short running user-generated event handler\".\r\n      this.initFCMessaging();\r\n    }\r\n  }\r\n\r\n  // Enable or disable saving the password and IndexedDB.\r\n  handlePersistenceChange(persist) {\r\n    if (persist) {\r\n      this.tinode.initStorage().then(_ => {\r\n        LocalStorageUtil.setObject('keep-logged-in', true);\r\n        this.setState({persist: true});\r\n      });\r\n    } else {\r\n      this.tinode.clearStorage().then(_ => {\r\n        LocalStorageUtil.setObject('keep-logged-in', false);\r\n        this.setState({persist: false});\r\n      });\r\n    }\r\n  }\r\n\r\n  // Connection succeeded.\r\n  handleConnected() {\r\n    // Just to be sure.\r\n    clearInterval(this.reconnectCountdown);\r\n    this.handleError();\r\n\r\n    const params = this.tinode.getServerInfo();\r\n    this.setState({\r\n      serverVersion: params.ver + ' ' + (params.build ? params.build : 'none'),\r\n      // \"reqCred\":{\"auth\":[\"email\"]}\r\n      reqCredMethod: ((params.reqCred || {}).auth || [])[0] || 'email'\r\n    });\r\n\r\n    if (this.state.autoLogin) {\r\n      this.doLogin(this.state.login, this.state.password, null,\r\n        {meth: this.state.credMethod, resp: this.state.credCode});\r\n    }\r\n  }\r\n\r\n  // Called for each auto-reconnect iteration.\r\n  handleAutoreconnectIteration(sec, prom) {\r\n    clearInterval(this.reconnectCountdown);\r\n\r\n    if (sec < 0) {\r\n      // Clear error\r\n      this.handleError();\r\n      return;\r\n    }\r\n\r\n    if (prom) {\r\n      // Reconnecting now\r\n      prom.then(_ => {\r\n        // Reconnected: clear error\r\n        this.handleError();\r\n      }).catch(err => {\r\n        this.handleError(err.message, 'err');\r\n      });\r\n      return;\r\n    }\r\n\r\n    const {formatMessage} = this.props.intl;\r\n    let count = sec / 1000;\r\n    count = count | count;\r\n    this.reconnectCountdown = setInterval(_ => {\r\n      if (count < -10) {\r\n        // Count could go to negative if computer woke up from sleep.\r\n        clearInterval(this.reconnectCountdown);\r\n        this.tinode.reconnect();\r\n        return;\r\n      }\r\n\r\n      const fmtTime = (count > 99) ? secondsToTime(count) : count;\r\n      this.handleError(\r\n        formatMessage(messages.reconnect_countdown, {seconds: fmtTime}),\r\n        'warn',\r\n        _ => {\r\n          clearInterval(this.reconnectCountdown);\r\n          this.tinode.reconnect();\r\n        },\r\n        formatMessage(messages.reconnect_now)\r\n      );\r\n      count -= 1;\r\n    }, 1000);\r\n  }\r\n\r\n  // Connection lost\r\n  handleDisconnect(err) {\r\n    this.setState({\r\n      connected: false,\r\n      ready: false,\r\n      topicSelectedOnline: false,\r\n      errorText: err && err.message ? err.message : \"Disconnected\",\r\n      errorLevel: err && err.message ? 'err' : 'warn',\r\n      loginDisabled: false,\r\n      contextMenuVisible: false,\r\n      forwardDialogVisible: false,\r\n      serverVersion: \"no connection\"\r\n    });\r\n  }\r\n\r\n  doLogin(login, password, tmpToken, cred) {\r\n    if (this.tinode.isAuthenticated()) {\r\n      // Already logged in. Go to default screen.\r\n      HashNavigation.navigateTo('');\r\n      return;\r\n    }\r\n\r\n    let token = tmpToken || (this.tinode.getAuthToken() || {}).token;\r\n    if (!(login && password) && !token) {\r\n      // No login credentials provided.\r\n      // Make sure we are on the login page.\r\n      HashNavigation.navigateTo('');\r\n      this.setState({loginDisabled: false});\r\n      return;\r\n    }\r\n\r\n    // Sanitize and package credentail.\r\n    cred = Tinode.credential(cred);\r\n    // May be disconnected.\r\n    let connectionPromise = this.tinode.isConnected() ? Promise.resolve() : this.tinode.connect();\r\n    // Try to login with login/password. If they are not available, try token; if no token, ask for login/password.\r\n    let loginPromise;\r\n    if (login && password) {\r\n      token = null;\r\n      this.setState({password: null});\r\n      loginPromise = connectionPromise.then(_ => this.tinode.loginBasic(login, password, cred));\r\n    } else {\r\n      loginPromise = connectionPromise.then(_ => this.tinode.loginToken(token, cred));\r\n    }\r\n\r\n    loginPromise.then(ctrl => {\r\n      if (ctrl.code >= 300 && ctrl.text === 'validate credentials') {\r\n        this.setState({loadSpinnerVisible: false});\r\n        if (cred) {\r\n          this.handleError(this.props.intl.formatMessage(messages.code_doesnot_match), 'warn');\r\n        }\r\n        TinodeWeb.navigateToCredentialsView(ctrl.params);\r\n      } else {\r\n        this.handleLoginSuccessful();\r\n      }\r\n    }).catch(err => {\r\n      const autoLogin = err.code >= 500;\r\n      // Connection or login failed, report error.\r\n      this.setState({\r\n        loginDisabled: false,\r\n        credMethod: undefined,\r\n        credCode: undefined,\r\n        loadSpinnerVisible: false,\r\n        autoLogin: autoLogin\r\n      });\r\n      this.handleError(err.message, 'err');\r\n      console.warn(\"Login failed\", err);\r\n      if (!autoLogin) {\r\n        if (token) {\r\n          this.handleLogout();\r\n        }\r\n        HashNavigation.navigateTo('');\r\n      }\r\n    });\r\n  }\r\n\r\n  static navigateToCredentialsView(params) {\r\n    const parsed = HashNavigation.parseUrlHash(window.location.hash);\r\n    parsed.path[0] = 'cred';\r\n    parsed.params['method'] = params.cred[0];\r\n    parsed.params['token'] = params.token;\r\n    parsed.params['code'] = params.code;\r\n    HashNavigation.navigateTo(HashNavigation.composeUrlHash(parsed.path, parsed.params));\r\n  }\r\n\r\n  handleLoginSuccessful() {\r\n    this.handleError();\r\n\r\n    // Refresh authentication token.\r\n    if (LocalStorageUtil.getObject('keep-logged-in')) {\r\n      LocalStorageUtil.setObject('auth-token', this.tinode.getAuthToken());\r\n    }\r\n\r\n    const goToTopic = this.state.requestedTopic;\r\n    // Logged in fine, subscribe to 'me' attaching callbacks from the contacts view.\r\n    const me = this.tinode.getMeTopic();\r\n    me.onMetaDesc = this.tnMeMetaDesc;\r\n    me.onContactUpdate = this.tnMeContactUpdate;\r\n    me.onSubsUpdated = this.tnMeSubsUpdated;\r\n    this.setState({\r\n      connected: true,\r\n      credMethod: undefined,\r\n      credCode: undefined,\r\n      credToken: undefined,\r\n      myUserId: this.tinode.getCurrentUserID(),\r\n      autoLogin: true,\r\n      requestedTopic: undefined,\r\n    });\r\n    // Subscribe, fetch topic desc, the list of subscriptions. Messages are not fetched.\r\n    me.subscribe(\r\n      me.startMetaQuery().\r\n        withLaterSub().\r\n        withDesc().\r\n        withTags().\r\n        withCred().\r\n        build()\r\n      ).catch(err => {\r\n        this.tinode.disconnect();\r\n        localStorage.removeItem('auth-token');\r\n        this.handleError(err.message, 'err');\r\n        HashNavigation.navigateTo('');\r\n      }).finally(_ => {\r\n        this.setState({loadSpinnerVisible: false});\r\n      });\r\n    let urlHash = HashNavigation.setUrlSidePanel(window.location.hash, 'contacts');\r\n    if (goToTopic) {\r\n      urlHash = HashNavigation.setUrlTopic(urlHash, goToTopic);\r\n    }\r\n    HashNavigation.navigateTo(urlHash);\r\n  }\r\n\r\n  tnMeMetaDesc(desc) {\r\n    if (desc) {\r\n      if (desc.public) {\r\n        this.setState({\r\n          sidePanelTitle: desc.public.fn,\r\n          sidePanelAvatar: makeImageUrl(desc.public.photo)\r\n        });\r\n      }\r\n      if (desc.trusted) {\r\n        const badges = [];\r\n        for (const [key, val] of Object.entries(desc.trusted)) {\r\n          if (val) {\r\n            badges.push(key);\r\n          }\r\n        }\r\n        this.setState({\r\n          myTrustedBadges: badges,\r\n        });\r\n      }\r\n      if (desc.acs) {\r\n        this.setState({\r\n          incognitoMode: !desc.acs.isPresencer()\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n  // Reactions to updates to the contact list.\r\n  tnMeContactUpdate(what, cont) {\r\n    if (what == 'on' || what == 'off') {\r\n      this.resetContactList();\r\n      if (this.state.topicSelected == cont.topic) {\r\n        this.setState({topicSelectedOnline: (what == 'on')});\r\n      }\r\n    } else if (what == 'read') {\r\n      this.resetContactList();\r\n    } else if (what == 'msg' && cont) {\r\n      // Check if the topic is archived. If so, don't play a sound.\r\n      const topic = this.tinode.getTopic(cont.topic);\r\n      const archived = topic && topic.isArchived();\r\n\r\n      // New message received. Maybe the message is from the current user, then unread is 0.\r\n      if (cont.unread > 0 && this.state.messageSounds && !archived) {\r\n        // Skip update if the topic is currently open, otherwise the badge will annoyingly flash.\r\n        if (document.hidden || this.state.topicSelected != cont.topic) {\r\n          POP_SOUND.play().catch(_ => {\r\n            // play() throws if the user did not click the app first: https://goo.gl/xX8pDD.\r\n          });\r\n          if (window.electronAPI) {\r\n            console.log(cont);\r\n            window.electronAPI.newMsg(what, cont.topic, cont.public.fn, cont.unread, cont.read, cont.seq);\r\n          }\r\n        }\r\n      }\r\n      // Reorder contact list to use possibly updated 'touched'.\r\n      this.resetContactList();\r\n    } else if (what == 'recv') {\r\n      // Explicitly ignoring \"recv\" -- it causes no visible updates to contact list.\r\n    } else if (what == 'gone' || what == 'unsub') {\r\n      // Topic deleted or user unsubscribed. Remove topic from view.\r\n      // If the currently selected topic is gone, clear the selection.\r\n      if (this.state.topicSelected == cont.topic) {\r\n        this.handleTopicSelected(null);\r\n      }\r\n      // Redraw without the deleted topic.\r\n      this.resetContactList();\r\n    } else if (what == 'acs') {\r\n      // Permissions changed. If it's for the currently selected topic,\r\n      // update the views.\r\n      if (this.state.topicSelected == cont.topic) {\r\n        this.setState({topicSelectedAcs: cont.acs});\r\n      }\r\n    } else if (what == 'del') {\r\n      // TODO: messages deleted (hard or soft) -- update pill counter.\r\n      console.log('me del', cont);\r\n      this.resetContactList();\r\n    } else if (what == 'upd' || what == 'call') {\r\n      // upd, call - handled by the SDK. Explicitly ignoring here.\r\n    } else {\r\n      // TODO(gene): handle other types of notifications:\r\n      // * ua -- user agent changes (maybe display a pictogram for mobile/desktop).\r\n      console.info(\"Unsupported (yet) presence update:\", what, \"in\", (cont || {}).topic);\r\n    }\r\n  }\r\n\r\n  tnMeSubsUpdated(unused) {\r\n    this.resetContactList();\r\n  }\r\n\r\n  // Merge search results and contact list to create a single flat\r\n  // list of known contacts for GroupManager to use.\r\n  static prepareSearchableContacts(chatList, foundContacts) {\r\n    const merged = {};\r\n\r\n    // For chatList topics merge only p2p topics and convert them to the\r\n    // same format as foundContacts.\r\n    for (const c of chatList) {\r\n      if (Tinode.isP2PTopicName(c.topic)) {\r\n          merged[c.topic] = {\r\n            user: c.topic,\r\n            updated: c.updated,\r\n            public: c.public,\r\n            private: c.private,\r\n            acs: c.acs\r\n          };\r\n      }\r\n    }\r\n\r\n    // Add all foundCountacts if they have not been added already.\r\n    for (const c of foundContacts) {\r\n      if (!merged[c.user]) {\r\n        merged[c.user] = c;\r\n      }\r\n    }\r\n\r\n    return Object.values(merged);\r\n  }\r\n\r\n  resetContactList() {\r\n    const newState = {\r\n      chatList: []\r\n    };\r\n\r\n    if (!this.state.ready) {\r\n      newState.ready = true;\r\n    }\r\n\r\n    this.tinode.getMeTopic().contacts(c => {\r\n      if (!c.topic && !c.user) {\r\n        // Contacts expect c.topic to be set.\r\n        c.topic = c.name;\r\n      }\r\n\r\n      newState.chatList.push(c);\r\n      if (this.state.topicSelected == c.topic) {\r\n        newState.topicSelectedOnline = c.online;\r\n        newState.topicSelectedAcs = c.acs;\r\n      }\r\n    });\r\n\r\n    const past = new Date(0);\r\n    newState.chatList.sort((a, b) => {\r\n      return (a.touched || past).getTime() - (b.touched || past).getTime();\r\n    });\r\n    // console.log(newState.chatList);\r\n    // Merge search results and chat list.\r\n    newState.searchableContacts = TinodeWeb.prepareSearchableContacts(newState.chatList, this.state.searchResults);\r\n    this.setState(newState);\r\n  }\r\n\r\n  /* Fnd topic: find contacts by tokens */\r\n  tnInitFind() {\r\n    const fnd = this.tinode.getFndTopic();\r\n    fnd.onSubsUpdated = this.tnFndSubsUpdated;\r\n    if (fnd.isSubscribed()) {\r\n      this.tnFndSubsUpdated();\r\n    } else {\r\n      fnd.subscribe(fnd.startMetaQuery().withSub().build()).catch(err => {\r\n        this.handleError(err.message, 'err');\r\n      });\r\n    }\r\n  }\r\n\r\n  tnFndSubsUpdated() {\r\n    console.log(123123, '这里触发噢噢噢噢');\r\n    const foundContacts = [];\r\n    // Don't attempt to create P2P topics which already exist. Server will reject the duplicates.\r\n    this.tinode.getFndTopic().contacts((s) => {\r\n      foundContacts.push(s);\r\n    });\r\n    this.setState({\r\n      searchResults: foundContacts,\r\n      searchableContacts: TinodeWeb.prepareSearchableContacts(this.state.chatList, foundContacts)\r\n    });\r\n  }\r\n\r\n  /** Called when the user enters a contact into the contact search field in the NewAccount panel\r\n    @param query {Array} is an array of contacts to search for\r\n   */\r\n  handleSearchContacts(query) {\r\n    const fnd = this.tinode.getFndTopic();\r\n    fnd.setMeta({desc: {public: query}})\r\n      .then(_ => fnd.getMeta(fnd.startMetaQuery().withSub().build()))\r\n      .catch(err => this.handleError(err.message, 'err'));\r\n  }\r\n\r\n  // User clicked on a topic in the side panel or deleted a topic.\r\n  handleTopicSelected(topicName) {\r\n    // Clear newTopicParams after use.\r\n    if (this.state.newTopicParams && this.state.newTopicParams._topicName != topicName) {\r\n      this.setState({\r\n        newTopicParams: null\r\n      });\r\n    }\r\n\r\n    if (topicName) {\r\n      this.setState({\r\n        errorText: '',\r\n        errorLevel: null,\r\n        mobilePanel: 'topic-view',\r\n        infoPanel: undefined\r\n      });\r\n      // Different topic selected.\r\n      if (this.state.topicSelected != topicName) {\r\n        this.setState({\r\n          topicSelectedOnline: this.tinode.isTopicOnline(topicName),\r\n          topicSelectedAcs: this.tinode.getTopicAccessMode(topicName),\r\n          forwardMessage: null\r\n        });\r\n        HashNavigation.navigateTo(HashNavigation.setUrlTopic('', topicName));\r\n      }\r\n    } else {\r\n      // Currently selected contact deleted\r\n      this.setState({\r\n        topicSelected: null,\r\n        errorText: '',\r\n        errorLevel: null,\r\n        mobilePanel: 'sidepanel',\r\n        topicSelectedOnline: false,\r\n        topicSelectedAcs: null,\r\n        infoPanel: undefined,\r\n        forwardMessage: null\r\n      });\r\n\r\n      HashNavigation.navigateTo(HashNavigation.setUrlTopic('', null));\r\n    }\r\n  }\r\n\r\n  // In mobile view user requested to show sidepanel\r\n  handleHideMessagesView() {\r\n    this.setState({\r\n      mobilePanel: 'sidepanel'\r\n    });\r\n    HashNavigation.navigateTo(HashNavigation.setUrlTopic(window.location.hash, null));\r\n  }\r\n\r\n  // User is sending a message, either plain text or a drafty object, possibly\r\n  // with attachments.\r\n  //  - msg - Drafty message with content\r\n  //  - promise - Promise to be resolved when the upload is completed\r\n  //  - uploadCompletionPromise - for tracking progress\r\n  //  - head - head dictionary to be attached to the message\r\n  handleSendMessage(msg, uploadCompletionPromise, uploader, head) {\r\n    const topic = this.tinode.getTopic(this.state.topicSelected);\r\n    /* TODO: check if return is required */\r\n    return this.sendMessageToTopic(topic, msg, uploadCompletionPromise, uploader, head);\r\n  }\r\n\r\n  sendMessageToTopic(topic, msg, uploadCompletionPromise, uploader, head) {\r\n    msg = topic.createMessage(msg, false);\r\n    // The uploader is used to show progress.\r\n    msg._uploader = uploader;\r\n\r\n    msg.expirePeriod = topic.expirePeriod;\r\n    if (head) {\r\n      msg.head = Object.assign(msg.head || {}, head);\r\n    }\r\n\r\n    const completion = [];\r\n    if (uploadCompletionPromise) {\r\n      completion.push(uploadCompletionPromise);\r\n    }\r\n\r\n    if (!topic.isSubscribed()) {\r\n      // Topic is not subscribed yet. Subscribe.\r\n      const subscribePromise =\r\n        topic.subscribe()\r\n          .then(_ => {\r\n            // If there are unsent messages (except video call messages),\r\n            // try sending them now. Unsent video call messages will be dropped.\r\n            let calls = [];\r\n            topic.queuedMessages(pub => {\r\n              if (pub._sending || pub.seq == msg.seq) {\r\n                return;\r\n              }\r\n              if (pub.head && pub.head.webrtc) {\r\n                // Filter out unsent video call messages.\r\n                calls.push(pub.seq);\r\n                return;\r\n              }\r\n              if (topic.isSubscribed()) {\r\n                topic.publishMessage(pub);\r\n              }\r\n            });\r\n            if (calls.length > 0) {\r\n              topic.delMessagesList(calls, true);\r\n            }\r\n          });\r\n      completion.push(subscribePromise);\r\n    }\r\n\r\n    // TODO: check if return is required.\r\n    return topic.publishDraft(msg, Promise.all(completion))\r\n      .then(ctrl => {\r\n        if (topic.isArchived()) {\r\n          topic.archive(false);\r\n        }\r\n        return ctrl;\r\n      })\r\n      .catch(err => this.handleError(err.message, 'err'));\r\n  }\r\n\r\n  handleNewChatInvitation(topicName, action) {\r\n    const topic = this.tinode.getTopic(topicName);\r\n    let response = null;\r\n    switch (action) {\r\n      case 'accept':\r\n        // Accept given permissions.\r\n        const mode = topic.getAccessMode().getGiven();\r\n        response = topic.setMeta({sub: {mode: mode}});\r\n        if (topic.isP2PType()) {\r\n          // For P2P topics change 'given' permission of the peer too.\r\n          // In p2p topics the other user has the same name as the topic.\r\n          response = response.then(_ => topic.setMeta({sub: {user: topicName, mode: mode}}));\r\n        }\r\n        break;\r\n      case 'delete':\r\n        // Ignore invitation by deleting it.\r\n        response = topic.delTopic(true);\r\n        break;\r\n      case 'block':\r\n        // Ban the topic making futher invites impossible.\r\n        // Just self-ban.\r\n        const am = topic.getAccessMode().updateWant('-JP').getWant();\r\n        response = topic.setMeta({sub: {mode: am}}).then(_ => this.handleTopicSelected(null));\r\n        break;\r\n      default:\r\n        console.warn(\"Unknown invitation action\", '\"' + action + '\"\"');\r\n    }\r\n\r\n    if (response != null) {\r\n      response.catch(err => this.handleError(err.message, 'err'));\r\n    }\r\n  }\r\n\r\n  // User chose a Sign Up menu item.\r\n  handleNewAccount() {\r\n    this.handleError();\r\n\r\n    HashNavigation.navigateTo(HashNavigation.setUrlSidePanel(window.location.hash, 'register'));\r\n  }\r\n\r\n  // Actual registration of a new account.\r\n  handleNewAccountRequest(login_, password_, public_, cred_, tags_) {\r\n    // Clear old error, if any.\r\n    this.handleError();\r\n\r\n    this.tinode.connect(this.state.serverAddress)\r\n      .then(_ => {\r\n        let attachments;\r\n        if (public_ && public_.photo && public_.photo.ref) {\r\n          attachments = [public_.photo.ref];\r\n        }\r\n        return this.tinode.createAccountBasic(login_, password_,\r\n          {public: public_, tags: tags_, cred: Tinode.credential(cred_), attachments: attachments});\r\n      }).then(ctrl => {\r\n        if (ctrl.code >= 300 && ctrl.text == 'validate credentials') {\r\n          TinodeWeb.navigateToCredentialsView(ctrl.params);\r\n        } else {\r\n          this.handleLoginSuccessful(this);\r\n        }\r\n      }).catch(err => {\r\n        this.handleError(err.message, 'err');\r\n      });\r\n  }\r\n\r\n  handleToggleIncognitoMode(on) {\r\n    // Make state undefined.\r\n    this.setState({incognitoMode: null});\r\n\r\n    const me = this.tinode.getMeTopic();\r\n    const am = me.getAccessMode().updateWant(on ? '-P' : '+P').getWant();\r\n    me.setMeta({sub: {mode: am}}).catch(err => {\r\n      // Request failed, keep existing state.\r\n      this.setState({incognitoMode: !on});\r\n      this.handleError(err.message, 'err');\r\n    });\r\n  }\r\n\r\n  handleUpdateAccountTagsRequest(_, tags) {\r\n    this.tinode.getMeTopic().setMeta({tags: tags})\r\n      .catch(err => this.handleError(err.message, 'err'));\r\n  }\r\n\r\n  // User chose Settings menu item.\r\n  handleSettings() {\r\n    this.handleError();\r\n\r\n    HashNavigation.navigateTo(HashNavigation.setUrlSidePanel(window.location.hash,\r\n      this.state.myUserId ? 'edit' : 'settings'));\r\n  }\r\n\r\n  // User updated global parameters.\r\n  handleGlobalSettings(settings) {\r\n    const serverAddress = settings.serverAddress || this.state.serverAddress;\r\n    const transport = settings.transport || this.state.transport;\r\n    const secureConnection = settings.secureConnection === undefined ?\r\n      this.state.secureConnection : settings.secureConnection;\r\n    if (this.tinode) {\r\n      this.tinode.clearStorage();\r\n      this.tinode.onDisconnect = undefined;\r\n      this.tinode.disconnect();\r\n    }\r\n    this.tinode = TinodeWeb.tnSetup(serverAddress, secureConnection, transport,\r\n      this.props.intl.locale, LocalStorageUtil.getObject('keep-logged-in'));\r\n    this.tinode.onConnect = this.handleConnected;\r\n    this.tinode.onDisconnect = this.handleDisconnect;\r\n    this.tinode.onAutoreconnectIteration = this.handleAutoreconnectIteration;\r\n    this.tinode.onInfoMessage = this.handleInfoMessage;\r\n    this.tinode.onDataMessage = this.handleDataMessage;\r\n\r\n    this.setState({\r\n      serverAddress: serverAddress,\r\n      transport: transport,\r\n      secureConnection: secureConnection,\r\n    });\r\n    LocalStorageUtil.setObject('settings', {\r\n      serverAddress: serverAddress,\r\n      transport: transport,\r\n      secureConnection: secureConnection,\r\n    });\r\n\r\n    HashNavigation.navigateTo(HashNavigation.setUrlSidePanel(window.location.hash, ''));\r\n  }\r\n\r\n  // User chose 'Archived chats'.\r\n  handleShowArchive() {\r\n    HashNavigation.navigateTo(HashNavigation.setUrlSidePanel(window.location.hash,\r\n      this.state.myUserId ? 'archive' : ''));\r\n  }\r\n\r\n  // User viewes 'Blocked chats'.\r\n  handleShowBlocked() {\r\n    HashNavigation.navigateTo(HashNavigation.setUrlSidePanel(window.location.hash,\r\n      this.state.myUserId ? 'blocked' : ''));\r\n  }\r\n\r\n  toggleFCMToken(enabled) {\r\n    if (enabled) {\r\n      this.setState({desktopAlerts: null});\r\n      if (!this.state.firebaseToken) {\r\n        this.initFCMessaging();\r\n      } else {\r\n        this.setState({desktopAlerts: true});\r\n        if (LocalStorageUtil.getObject('keep-logged-in')) {\r\n          LocalStorageUtil.updateObject('settings', {desktopAlerts: true});\r\n        }\r\n      }\r\n    } else if (this.state.firebaseToken && this.fcm) {\r\n      firebaseDelToken(this.fcm).catch(err => {\r\n        console.error(\"Unable to delete token.\", err);\r\n      }).finally(_ => {\r\n        LocalStorageUtil.updateObject('settings', {desktopAlerts: false});\r\n        localStorage.removeItem('firebase-token');\r\n        this.setState({desktopAlerts: false, firebaseToken: null});\r\n        // Inform the server that the token was deleted.\r\n        this.tinode.setDeviceToken(null);\r\n      });\r\n    } else {\r\n      this.setState({desktopAlerts: false, firebaseToken: null});\r\n      LocalStorageUtil.updateObject('settings', {desktopAlerts: false});\r\n    }\r\n  }\r\n\r\n  handleToggleMessageSounds(enabled) {\r\n    this.setState({messageSounds: enabled});\r\n    LocalStorageUtil.updateObject('settings', {\r\n      messageSoundsOff: !enabled\r\n    });\r\n  }\r\n\r\n  handleCredAdd(method, value) {\r\n    const me = this.tinode.getMeTopic();\r\n    me.setMeta({cred: {meth: method, val: value}})\r\n      .catch(err => this.handleError(err.message, 'err'));\r\n  }\r\n\r\n  handleCredDelete(method, value) {\r\n    const me = this.tinode.getMeTopic();\r\n    me.delCredential(method, value)\r\n      .catch(err => this.handleError(err.message, 'err'));\r\n  }\r\n\r\n  handleCredConfirm(method, response) {\r\n    TinodeWeb.navigateToCredentialsView({cred: [method], code: response});\r\n  }\r\n\r\n  // User clicked Cancel button in Setting or Sign Up panel.\r\n  handleSidepanelCancel() {\r\n    const parsed = HashNavigation.parseUrlHash(window.location.hash);\r\n    let path = '';\r\n    if (['security','support','general','notif'].includes(parsed.path[0])) {\r\n      path = 'edit';\r\n    } else if ('crop' == parsed.path[0]) {\r\n      path = 'general';\r\n    } else if ('blocked' == parsed.path[0]) {\r\n      path = 'security';\r\n    } else if (this.state.myUserId) {\r\n      path = 'contacts';\r\n    }\r\n    parsed.path[0] = path;\r\n    if (parsed.params) {\r\n      delete parsed.params.code;\r\n      delete parsed.params.method;\r\n      delete parsed.params.tab;\r\n      delete parsed.params.scheme;\r\n      delete parsed.params.token;\r\n    }\r\n    HashNavigation.navigateTo(HashNavigation.composeUrlHash(parsed.path, parsed.params));\r\n    this.setState({errorText: '', errorLevel: null});\r\n  }\r\n\r\n  // Sidepanel navigator. No need to bind to 'this'.\r\n  basicNavigator(hash) {\r\n    HashNavigation.navigateTo(HashNavigation.setUrlSidePanel(window.location.hash, hash));\r\n  }\r\n\r\n  // Topic info navigator. No need to bind to 'this'.\r\n  infoNavigator(hash) {\r\n    HashNavigation.navigateTo(HashNavigation.setUrlInfoPanel(window.location.hash, hash));\r\n  }\r\n\r\n  // Request to start a topic, new or selected from search results, or \"by ID\".\r\n  handleStartTopicRequest(topicName, newTopicParams, isChannel) {\r\n    // Check if topic is indeed new. If not, launch it.\r\n    if (topicName && this.tinode.isTopicCached(topicName)) {\r\n      this.handleTopicSelected(topicName);\r\n      return;\r\n    }\r\n\r\n    const params = {};\r\n    if (Tinode.isP2PTopicName(topicName)) {\r\n      // Because we are initiating the subscription, set 'want' to all permissions.\r\n      params.sub = {mode: DEFAULT_P2P_ACCESS_MODE};\r\n      // Give the other user all permissions too.\r\n      params.desc = {defacs: {auth: DEFAULT_P2P_ACCESS_MODE}};\r\n    } else {\r\n      topicName = topicName || this.tinode.newGroupTopicName(isChannel);\r\n      if (newTopicParams) {\r\n        params.desc = {public: newTopicParams.public, private: {comment: newTopicParams.private}};\r\n        params.tags = newTopicParams.tags;\r\n      }\r\n    }\r\n    params._topicName = topicName;\r\n    this.setState({newTopicParams: params}, _ => {this.handleTopicSelected(topicName)});\r\n  }\r\n\r\n  // New topic was created, here is the new topic name.\r\n  handleNewTopicCreated(oldName, newName) {\r\n    let nextState = {};\r\n    if (this.state.callShouldStart) {\r\n      nextState = {callState: CALL_STATE_IN_PROGRESS, callShouldStart: false};\r\n    }\r\n    if (this.state.topicSelected == oldName && oldName != newName) {\r\n      // If the current URl contains the old topic name, replace it with new.\r\n      // Update the name of the selected topic first so the navigator doen't clear\r\n      // the state.\r\n      nextState.topicSelected = newName;\r\n    }\r\n    this.setState(nextState, _ => {\r\n      HashNavigation.navigateTo(HashNavigation.setUrlTopic('', newName));\r\n    });\r\n  }\r\n\r\n  handleTopicUpdateRequest(topicName, pub, priv, defacs) {\r\n    this.handleError();\r\n\r\n    const topic = this.tinode.getTopic(topicName);\r\n    if (topic) {\r\n      const params = {};\r\n      let attachments;\r\n      if (pub) {\r\n        if (pub.photo) {\r\n          if (pub.photo.ref && pub.photo.ref != Tinode.DEL_CHAR) {\r\n            attachments = [pub.photo.ref];\r\n          } else if (!pub.photo.data || pub.photo.data == Tinode.DEL_CHAR) {\r\n            pub.photo = Tinode.DEL_CHAR;\r\n          }\r\n        }\r\n        params.public = pub;\r\n      }\r\n\r\n      if (typeof priv == 'string') {\r\n        params.private = (priv === Tinode.DEL_CHAR) ?\r\n          Tinode.DEL_CHAR : {comment: priv};\r\n      }\r\n      if (defacs) {\r\n        params.defacs = defacs;\r\n      }\r\n      topic.setMeta({desc: params, attachments: attachments})\r\n        .catch(err => this.handleError(err.message, 'err'));\r\n    }\r\n  }\r\n\r\n  handleUnarchive(topicName) {\r\n    const topic = this.tinode.getTopic(topicName);\r\n    if (topic) {\r\n      topic.archive(false).catch(err => this.handleError(err.message, 'err'));\r\n    }\r\n  }\r\n\r\n  handleUpdatePasswordRequest(password)  {\r\n    this.handleError();\r\n\r\n    if (password) {\r\n      this.tinode.updateAccountBasic(null, this.tinode.getCurrentLogin(), password)\r\n        .catch(err => this.handleError(err.message, 'err'));\r\n    }\r\n  }\r\n\r\n  handleChangePermissions(topicName, mode, uid) {\r\n    const topic = this.tinode.getTopic(topicName);\r\n    if (topic) {\r\n      const am = topic.getAccessMode();\r\n      if (uid) {\r\n        am.updateGiven(mode);\r\n        mode = am.getGiven();\r\n      } else {\r\n        am.updateWant(mode);\r\n        mode = am.getWant();\r\n      }\r\n      topic.setMeta({sub: {user: uid, mode: mode}})\r\n        .catch(err => this.handleError(err.message, 'err'));\r\n    }\r\n  }\r\n\r\n  handleTagsUpdateRequest(topicName, tags) {\r\n    const topic = this.tinode.getTopic(topicName);\r\n    if (topic) {\r\n      topic.setMeta({tags: tags})\r\n        .catch(err => this.handleError(err.message, 'err'));\r\n    }\r\n  }\r\n\r\n  handleLogout() {\r\n    updateFavicon(0);\r\n\r\n    // Remove stored data.\r\n    localStorage.removeItem('auth-token');\r\n    localStorage.removeItem('firebase-token');\r\n    localStorage.removeItem('settings');\r\n    if (this.state.firebaseToken) {\r\n      firebaseDelToken(this.fcm);\r\n    }\r\n\r\n    clearInterval(this.reconnectCountdown);\r\n\r\n    let cleared;\r\n    if (this.tinode) {\r\n      cleared = this.tinode.clearStorage();\r\n      this.tinode.onDisconnect = undefined;\r\n      this.tinode.disconnect();\r\n    } else {\r\n      cleared = Promose.resolve();\r\n    }\r\n    this.setState(this.getBlankState());\r\n\r\n    cleared.then(_ => {\r\n      this.tinode = TinodeWeb.tnSetup(this.state.serverAddress, isSecureConnection(),\r\n        this.state.transport, this.props.intl.locale, LocalStorageUtil.getObject('keep-logged-in'), _ => {\r\n          this.tinode.onConnect = this.handleConnected;\r\n          this.tinode.onDisconnect = this.handleDisconnect;\r\n          this.tinode.onAutoreconnectIteration = this.handleAutoreconnectIteration;\r\n          this.tinode.onInfoMessage = this.handleInfoMessage;\r\n          this.tinode.onDataMessage = this.handleDataMessage;\r\n          HashNavigation.navigateTo('');\r\n        })\r\n    });\r\n  }\r\n\r\n  handleDeleteAccount() {\r\n    this.tinode.delCurrentUser(true).then(_ => {\r\n      this.handleLogout();\r\n    });\r\n  }\r\n\r\n  handleSoftDeleteAllMessage() {\r\n    this.tinode.softDelAllMessages().then(_ => {\r\n      // this.handleLogout();\r\n      // console.log('已经清楚全部消息');\r\n      this.resetContactList();\r\n    });\r\n  }\r\n\r\n  handleDeleteTopicRequest(topicName) {\r\n    const topic = this.tinode.getTopic(topicName);\r\n    if (!topic) {\r\n      return;\r\n    }\r\n\r\n    // Request to hard-delete topic.\r\n    topic.delTopic(true).then(_ => {\r\n      // Hide MessagesView and InfoView panels.\r\n      HashNavigation.navigateTo(HashNavigation.setUrlTopic(window.location.hash, ''));\r\n    }).catch(err => {\r\n      this.handleError(err.message, 'err');\r\n    });\r\n  }\r\n\r\n  handleDeleteMessagesRequest(topicName) {\r\n    const topic = this.tinode.getTopic(topicName);\r\n    if (!topic) {\r\n      return;\r\n    }\r\n\r\n    // Request hard-delete all messages.\r\n    topic.delMessagesAll(true)\r\n      .catch(err => this.handleError(err.message, 'err'));\r\n  }\r\n\r\n  handleExpirePeriodRequest(topicName, expirePeriod) {\r\n    const topic = this.tinode.getTopic(topicName);\r\n    if (!topic) {\r\n      return;\r\n    }\r\n    console.log(parseInt(expirePeriod));\r\n    topic.changeExpirePeriod(parseInt(expirePeriod));\r\n  }\r\n\r\n  handleLeaveUnsubRequest(topicName) {\r\n    const topic = this.tinode.getTopic(topicName);\r\n    if (!topic) {\r\n      return;\r\n    }\r\n\r\n    topic.leave(true).then(_ => {\r\n      // Hide MessagesView and InfoView panels.\r\n      HashNavigation.navigateTo(HashNavigation.setUrlTopic(window.location.hash, ''));\r\n    }).catch(err => {\r\n      this.handleError(err.message, 'err');\r\n    });\r\n  }\r\n\r\n  handleBlockTopicRequest(topicName) {\r\n    const topic = this.tinode.getTopic(topicName);\r\n    if (!topic) {\r\n      return;\r\n    }\r\n\r\n    topic.updateMode(null, '-JP')\r\n      .then(_ => {\r\n        // Hide MessagesView and InfoView panels.\r\n        HashNavigation.navigateTo(HashNavigation.setUrlTopic(window.location.hash, ''));\r\n      })\r\n      .catch(err => this.handleError(err.message, 'err'));\r\n  }\r\n\r\n  handleReportTopic(topicName) {\r\n    const topic = this.tinode.getTopic(topicName);\r\n    if (!topic) {\r\n      return;\r\n    }\r\n\r\n    // Publish spam report.\r\n    this.tinode.report('report', topicName);\r\n\r\n    // Remove J and P permissions.\r\n    topic.updateMode(null, '-JP')\r\n    .then(_ => {\r\n      // Hide MessagesView and InfoView panels.\r\n      HashNavigation.navigateTo(HashNavigation.setUrlTopic(window.location.hash, ''));\r\n    })\r\n    .catch(err => this.handleError(err.message, 'err'));\r\n  }\r\n\r\n  handleShowContextMenu(params, menuItems) {\r\n    this.setState({\r\n      contextMenuVisible: true,\r\n      contextMenuClickAt: {x: params.x, y: params.y},\r\n      contextMenuParams: params,\r\n      contextMenuItems: menuItems || this.defaultTopicContextMenu(params.topicName),\r\n      contextMenuBounds: this.selfRef.current.getBoundingClientRect()\r\n    });\r\n  }\r\n\r\n  //\r\n  handleShowForwardDialog(params) {\r\n    if (this.state.sidePanelSelected == 'newtpk') {\r\n      // If the Find panel is active, close it.\r\n      this.handleSidepanelCancel();\r\n    }\r\n    const header = '➦ ' + params.userName;\r\n    const content = typeof params.content == 'string' ? Drafty.init(params.content) : Drafty.forwardedContent(params.content);\r\n    const preview = Drafty.preview(content, FORWARDED_PREVIEW_LENGTH, true);\r\n    const msg = Drafty.append(Drafty.appendLineBreak(Drafty.mention(header, params.userFrom)), content);\r\n    const msgPreview = Drafty.quote(header, params.userFrom, preview);\r\n\r\n    const head = {\r\n      forwarded: params.topicName + ':' + params.seq\r\n    };\r\n    this.setState({\r\n      forwardDialogVisible: true,\r\n      forwardMessage: { head: head, msg: msg, preview: msgPreview }\r\n    });\r\n  }\r\n\r\n  defaultTopicContextMenu(topicName) {\r\n    const topic = this.tinode.getTopic(topicName);\r\n\r\n    if (topic._deleted) {\r\n      return [\r\n        'topic_delete'\r\n      ];\r\n    }\r\n\r\n    let muted = false, blocked = false, self_blocked = false, subscribed = false, deleter = false,\r\n      archived = false, webrtc = false, writer = false, p2p = false, self = false;\r\n    if (topic) {\r\n      subscribed = topic.isSubscribed();\r\n      archived = topic.isArchived();\r\n\r\n      const acs = topic.getAccessMode();\r\n      if (acs) {\r\n        muted = acs.isMuted();\r\n        blocked = !acs.isJoiner();\r\n        self_blocked = !acs.isJoiner('want');\r\n        deleter = acs.isDeleter();\r\n        writer = acs.isWriter();\r\n      }\r\n    }\r\n\r\n    webrtc = writer && !!this.tinode.getServerParam('iceServers');\r\n    p2p = Tinode.isP2PTopicName(topicName);\r\n    self = Tinode.isSelfTopicName(topicName);\r\n\r\n    return [\r\n      subscribed ? {\r\n        title: this.props.intl.formatMessage(messages.menu_item_info),\r\n        handler: this.handleShowInfoView\r\n      } : null,\r\n      subscribed && p2p && webrtc ? {\r\n        title: this.props.intl.formatMessage(messages.menu_item_audio_call),\r\n        handler: this.handleStartAudioCall\r\n      } : null,\r\n      subscribed && p2p && webrtc ? {\r\n        title: this.props.intl.formatMessage(messages.menu_item_video_call),\r\n        handler: this.handleStartVideoCall\r\n      } : null,\r\n      subscribed ? 'messages_clear' : null,\r\n      subscribed && deleter && !self ? 'messages_clear_hard' : null,\r\n      self ? null : (muted ? (blocked ? null : 'topic_unmute') : 'topic_mute'),\r\n      self ? null : (self_blocked ? 'topic_unblock' : 'topic_block'),\r\n      archived ? 'topic_restore' : 'topic_archive',\r\n      'topic_delete'\r\n    ];\r\n  }\r\n\r\n  handleHideContextMenu() {\r\n    this.setState({\r\n      contextMenuVisible: false,\r\n      contextMenuClickAt: null,\r\n      contextMenuParams: null,\r\n      contextMenuBounds: null\r\n    });\r\n  }\r\n\r\n  handleHideForwardDialog(keepForwardedMessage) {\r\n    this.setState({\r\n      forwardDialogVisible: false,\r\n      forwardMessage: keepForwardedMessage ? this.state.forwardMessage : null\r\n    });\r\n  }\r\n\r\n  handleContextMenuAction(action, promise, params) {\r\n    if (action == 'topic_archive') {\r\n      if (promise && params.topicName && params.topicName == this.state.topicSelected) {\r\n        promise.then(_ => {\r\n          this.handleTopicSelected(null);\r\n        });\r\n      }\r\n    } else if (action == 'menu_item_forward') {\r\n      this.handleShowForwardDialog(params);\r\n    }\r\n  }\r\n\r\n  handleShowAlert(title, content, onConfirm, confirmText, onReject, rejectText) {\r\n    this.setState({\r\n      alertVisible: true,\r\n      alertParams: {\r\n        title: title,\r\n        content: content,\r\n        onConfirm: onConfirm,\r\n        confirm: confirmText,\r\n        onReject: onReject,\r\n        reject: rejectText\r\n      }\r\n    });\r\n  }\r\n\r\n  handleShowInfoView() {\r\n    HashNavigation.navigateTo(HashNavigation.addUrlParam(window.location.hash, 'info', 'info'));\r\n    this.setState({infoPanel: 'info'});\r\n  }\r\n\r\n  handleMemberUpdateRequest(topicName, added, removed) {\r\n    if (!topicName) {\r\n      return;\r\n    }\r\n\r\n    const topic = this.tinode.getTopic(topicName);\r\n    if (!topic) {\r\n      return;\r\n    }\r\n\r\n    if (added && added.length > 0) {\r\n      added.forEach(uid => {\r\n        topic.invite(uid, null)\r\n          .catch(err => this.handleError(err.message, 'err'));\r\n      });\r\n    }\r\n\r\n    if (removed && removed.length > 0) {\r\n      removed.forEach(uid => {\r\n        topic.delSubscription(uid)\r\n          .catch(err => this.handleError(err.message, 'err'));\r\n      });\r\n    }\r\n  }\r\n\r\n  handleValidateCredentialsRequest(cred, code, token) {\r\n    if (this.tinode.isAuthenticated()) {\r\n      // Adding new email or phone number in account setting.\r\n      this.tinode.getMeTopic().setMeta({cred: {meth: cred, resp: code}})\r\n        .then(_ => HashNavigation.navigateTo(HashNavigation.setUrlSidePanel(window.location.hash, 'contacts')))\r\n        .catch(err => this.handleError(err.message, 'err'));\r\n    } else {\r\n      // Credential validation on signup.\r\n      this.setState({credMethod: cred, credCode: code, credToken: token});\r\n      this.doLogin(null, null, token, {meth: cred, resp: code});\r\n    }\r\n  }\r\n\r\n  handlePasswordResetRequest(method, value) {\r\n    // If already connected, connnect() will return a resolved promise.\r\n    return this.tinode.connect()\r\n      .then(_ => this.tinode.requestResetAuthSecret('basic', method, value))\r\n      .catch(err => {\r\n        // Socket error\r\n        this.handleError(err.message, 'err');\r\n      });\r\n  }\r\n\r\n  handleResetPassword(newPassword, tempAuth) {\r\n    const secret = base64ReEncode(tempAuth.secret);\r\n    if (!secret || !tempAuth.scheme) {\r\n      this.handleError(this.props.intl.formatMessage(messages.invalid_security_token), 'err');\r\n    } else {\r\n      this.tinode.connect()\r\n        .then(_ => this.tinode.updateAccountBasic(null, null, newPassword, {scheme: tempAuth.scheme, secret: secret}))\r\n        .then(_ => {\r\n          this.handleError(this.props.intl.formatMessage(messages.password_reset_success), 'info');\r\n          HashNavigation.navigateTo('');\r\n        })\r\n        .catch(err => {\r\n          this.handleError(err.message, 'err');\r\n        });\r\n    }\r\n  }\r\n\r\n  handleShowCountrySelector(code, dial, selectedCallback) {\r\n    this.handleShowAlert(this.props.intl.formatMessage(messages.select_country),\r\n      <Suspense fallback={<div><FormattedMessage id=\"loading_note\" defaultMessage=\"Loading...\"\r\n        description=\"Message shown when component is loading\"/></div>}>\r\n        <PhoneCountrySelector\r\n          selected={code}\r\n          onSubmit={(c, d) => {\r\n            this.setState({alertVisible: false});\r\n            selectedCallback(c, d);\r\n          }} />\r\n      </Suspense>,\r\n      null, null, _ => {}, null);\r\n  }\r\n\r\n  handleStartVideoCall() {\r\n    this.setState({\r\n      callTopic: this.state.topicSelected,\r\n      callState: CALL_STATE_OUTGOING_INITATED,\r\n      callAudioOnly: false\r\n    });\r\n  }\r\n\r\n  handleStartAudioCall() {\r\n    this.setState({\r\n      callTopic: this.state.topicSelected,\r\n      callState: CALL_STATE_OUTGOING_INITATED,\r\n      callAudioOnly: true\r\n    });\r\n  }\r\n\r\n  handleCallInvite(callTopic, callSeq, callState, audioOnly) {\r\n    switch (callState) {\r\n      case CALL_STATE_OUTGOING_INITATED:\r\n        const head = { webrtc: CALL_HEAD_STARTED, aonly: !!audioOnly };\r\n        return this.handleSendMessage(Drafty.videoCall(audioOnly), undefined, undefined, head)\r\n          .then(ctrl => {\r\n            if (ctrl.code < 200 || ctrl.code >= 300 || !ctrl.params || !ctrl.params.seq) {\r\n              this.handleCallClose();\r\n              return ctrl;\r\n            }\r\n            this.setState({callSeq: ctrl.params['seq']});\r\n            return ctrl\r\n          });\r\n      case CALL_STATE_IN_PROGRESS:\r\n        const topic = this.tinode.getTopic(callTopic);\r\n        if (!topic) {\r\n          return;\r\n        }\r\n        // We've accepted the call. Let the other side know.\r\n        topic.videoCall('accept', callSeq);\r\n        break;\r\n    }\r\n  }\r\n\r\n  handleCallRinging(callTopic, callSeq) {\r\n    const topic = this.tinode.getTopic(callTopic);\r\n    if (!topic) {\r\n      return;\r\n    }\r\n\r\n    topic.videoCall('ringing', callSeq);\r\n  }\r\n\r\n  handleCallHangup(callTopic, callSeq) {\r\n    const topic = this.tinode.getTopic(callTopic);\r\n    if (!topic) {\r\n      return;\r\n    }\r\n\r\n    topic.videoCall('hang-up', callSeq);\r\n  }\r\n\r\n  handleCallSendOffer(callTopic, callSeq, sdp) {\r\n    const topic = this.tinode.getTopic(callTopic);\r\n    if (!topic) {\r\n      return;\r\n    }\r\n\r\n    topic.videoCall('offer', callSeq, sdp);\r\n  }\r\n\r\n  handleCallIceCandidate(callTopic, callSeq, candidate) {\r\n    const topic = this.tinode.getTopic(callTopic);\r\n    if (!topic) {\r\n      return;\r\n    }\r\n\r\n    topic.videoCall('ice-candidate', callSeq, candidate);\r\n  }\r\n  handleCallSendAnswer(callTopic, callSeq, sdp) {\r\n    const topic = this.tinode.getTopic(callTopic);\r\n    if (!topic) {\r\n      return;\r\n    }\r\n\r\n    topic.videoCall('answer', callSeq, sdp);\r\n  }\r\n\r\n  handleCallClose() {\r\n    if (this.callTimeoutTimer) {\r\n      clearTimeout(this.callTimeoutTimer);\r\n    }\r\n    this.setState({\r\n      callTopic: undefined,\r\n      callState: CALL_STATE_NONE,\r\n      callAudioOnly: undefined\r\n    });\r\n  }\r\n\r\n  handleCallAccept(topicName, setCallTopic, callSeq) {\r\n    const topic = this.tinode.getTopic(topicName);\r\n    if (!topic) {\r\n      return;\r\n    }\r\n    if (topic.isSubscribed()) {\r\n      this.handleTopicSelected(setCallTopic ? topicName : this.state.callTopic);\r\n      const upd = {\r\n        callState: CALL_STATE_IN_PROGRESS\r\n      };\r\n      if (setCallTopic) {\r\n        upd.callTopic = topicName;\r\n        upd.callSeq = callSeq;\r\n      }\r\n      this.setState(upd);\r\n    } else {\r\n      // We need to switch and subscribe to callTopic first.\r\n      this.setState({\r\n        callShouldStart: true,\r\n      }, _ => this.handleTopicSelected(this.state.callTopic));\r\n    }\r\n  }\r\n\r\n  handleInfoMessage(info) {\r\n    if (info.what != 'call') {\r\n      return;\r\n    }\r\n    switch (info.event) {\r\n      case 'accept':\r\n        // If another my session has accepted the call.\r\n        if (Tinode.isMeTopicName(info.topic) && this.tinode.isMe(info.from)) {\r\n          this.setState({\r\n            callTopic: null,\r\n            callState: CALL_STATE_NONE,\r\n            callSeq: null,\r\n            callAudioOnly: undefined\r\n          });\r\n          return;\r\n        }\r\n        if (info.topic == this.state.callTopic) {\r\n          // Update state.\r\n          this.setState({callState: CALL_STATE_IN_PROGRESS});\r\n        }\r\n        break;\r\n      case 'hang-up':\r\n        // Remote hangup.\r\n        this.handleCallClose();\r\n        break;\r\n    }\r\n  }\r\n\r\n  handleDataMessage(data) {\r\n    if (data.head && data.head.webrtc && data.head.webrtc == CALL_HEAD_STARTED && Tinode.isP2PTopicName(data.topic)) {\r\n      // If it's a video call invite message.\r\n      // See if we need to display incoming call UI.\r\n      const topic = this.tinode.getTopic(data.topic);\r\n      if (topic) {\r\n        // Check if a later version of the message exists (which means the call\r\n        // has been either accepted or finished already).\r\n        const msg = topic.latestMsgVersion(data.seq) || data;\r\n        if (msg.head && msg.head.webrtc && msg.head.webrtc == CALL_HEAD_STARTED) {\r\n          // This is a legit new call.\r\n          if (data.from != this.state.myUserId) {\r\n            if (this.state.callState == CALL_STATE_NONE) {\r\n              // Incoming call.\r\n              this.setState({\r\n                callTopic: data.topic,\r\n                callState: CALL_STATE_INCOMING_RECEIVED,\r\n                callSeq: data.seq,\r\n                callAudioOnly: !!msg.head.aonly\r\n              });\r\n            } else {\r\n              // Another call is either in progress or being established.\r\n              // Reject the incoming call.\r\n              this.handleCallHangup(data.topic, data.seq);\r\n            }\r\n          }\r\n        }\r\n      } else {\r\n        console.warn(\"Received vc data message from unknown topic\", data.topic);\r\n      }\r\n    }\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div id=\"app-container\" ref={this.selfRef}>\r\n        {this.state.contextMenuVisible ?\r\n          <ContextMenu\r\n            tinode={this.tinode}\r\n            bounds={this.state.contextMenuBounds}\r\n            clickAt={this.state.contextMenuClickAt}\r\n            params={this.state.contextMenuParams}\r\n            items={this.state.contextMenuItems}\r\n            hide={this.handleHideContextMenu}\r\n            onShowAlert={this.handleShowAlert}\r\n            onAction={this.handleContextMenuAction}\r\n            onTopicRemoved={(topicName) => {\r\n              if (topicName == this.state.topicSelected) {\r\n                this.handleTopicSelected(null);\r\n              }\r\n            }}\r\n            onError={this.handleError} />\r\n          :\r\n          null\r\n        }\r\n        {this.state.forwardDialogVisible ?\r\n          <ForwardDialog\r\n            tinode={this.tinode}\r\n            contacts={this.state.chatList}\r\n            topicSelected={this.state.topicSelected}\r\n            myUserId={this.state.myUserId}\r\n\r\n            hide={this.handleHideForwardDialog}\r\n            onInitFind={this.tnInitFind}\r\n            searchResults={this.state.searchResults}\r\n            onSearchContacts={this.handleSearchContacts}\r\n            onTopicSelected={this.handleStartTopicRequest}\r\n          />\r\n          :\r\n          null\r\n        }\r\n        {this.state.callTopic && this.state.callState == CALL_STATE_INCOMING_RECEIVED ?\r\n          <CallIncoming\r\n            tinode={this.tinode}\r\n            topic={this.state.callTopic}\r\n            seq={this.state.callSeq}\r\n            callState={this.state.callState}\r\n            audioOnly={this.state.callAudioOnly}\r\n            onClose={this.handleCallClose}\r\n            onRinging={this.handleCallRinging}\r\n            onAcceptCall={this.handleCallAccept}\r\n            onReject={this.handleCallHangup}\r\n            />\r\n          :\r\n          null\r\n        }\r\n        {this.state.alertVisible ?\r\n          <Alert\r\n            title={this.state.alertParams.title}\r\n            content={this.state.alertParams.content}\r\n            onReject={this.state.alertParams.onReject ? (_ => this.setState({alertVisible: false})) : null}\r\n            reject={this.state.alertParams.reject}\r\n            onConfirm={this.state.alertParams.onConfirm ?\r\n              (_ => {this.setState({alertVisible: false}); this.state.alertParams.onConfirm();}) : null}\r\n            confirm={this.state.alertParams.confirm}\r\n            /> : null}\r\n\r\n        {!this.state.displayMobile || this.state.mobilePanel == 'sidepanel' ?\r\n          <SidepanelView\r\n            tinode={this.tinode}\r\n            connected={this.state.connected}\r\n            displayMobile={this.state.displayMobile}\r\n            state={this.state.sidePanelSelected}\r\n            title={this.state.sidePanelTitle}\r\n            avatar={this.state.sidePanelAvatar}\r\n            trustedBadges={this.state.myTrustedBadges}\r\n            login={this.state.login}\r\n            persist={this.state.persist}\r\n            myUserId={this.state.myUserId}\r\n            loginDisabled={this.state.loginDisabled}\r\n            loadSpinnerVisible={this.state.loadSpinnerVisible}\r\n\r\n            errorText={this.state.errorText}\r\n            errorLevel={this.state.errorLevel}\r\n            errorAction={this.state.errorAction}\r\n            errorActionText={this.state.errorActionText}\r\n\r\n            topicSelected={this.state.topicSelected}\r\n            chatList={this.state.chatList}\r\n            credMethod={this.state.credMethod}\r\n            credCode={this.state.credCode}\r\n            credToken={this.state.credToken}\r\n\r\n            transport={this.state.transport}\r\n            messageSounds={this.state.messageSounds}\r\n            desktopAlerts={this.state.desktopAlerts}\r\n            desktopAlertsEnabled={this.state.desktopAlertsEnabled}\r\n            incognitoMode={this.state.incognitoMode}\r\n            serverAddress={this.state.serverAddress}\r\n            secureConnection={this.state.secureConnection}\r\n            serverVersion={this.state.serverVersion}\r\n            reqCredMethod={this.state.reqCredMethod}\r\n\r\n            onGlobalSettings={this.handleGlobalSettings}\r\n            onSignUp={this.handleNewAccount}\r\n            onSettings={this.handleSettings}\r\n            onNavigate={this.basicNavigator}\r\n            onLoginRequest={this.handleLoginRequest}\r\n            onPersistenceChange={this.handlePersistenceChange}\r\n            onCreateAccount={this.handleNewAccountRequest}\r\n            onUpdateAccountDesc={this.handleTopicUpdateRequest}\r\n            onUpdatePassword={this.handleUpdatePasswordRequest}\r\n            onUpdateAccountTags={this.handleUpdateAccountTagsRequest}\r\n            onTogglePushNotifications={this.toggleFCMToken}\r\n            onToggleMessageSounds={this.handleToggleMessageSounds}\r\n            onToggleIncognitoMode={this.handleToggleIncognitoMode}\r\n            onCredAdd={this.handleCredAdd}\r\n            onCredDelete={this.handleCredDelete}\r\n            onCredConfirm={this.handleCredConfirm}\r\n            onTopicSelected={this.handleTopicSelected}\r\n            onCreateTopic={this.handleStartTopicRequest}\r\n            onLogout={this.handleLogout}\r\n            onDeleteAccount={this.handleDeleteAccount}\r\n            onSoftDeleteAllMessage={this.handleSoftDeleteAllMessage}\r\n            onShowAlert={this.handleShowAlert}\r\n            onCancel={this.handleSidepanelCancel}\r\n            onError={this.handleError}\r\n            onValidateCredentials={this.handleValidateCredentialsRequest}\r\n            onPasswordResetRequest={this.handlePasswordResetRequest}\r\n            onResetPassword={this.handleResetPassword}\r\n            onShowArchive={this.handleShowArchive}\r\n            onShowBlocked={this.handleShowBlocked}\r\n            onShowCountrySelector={this.handleShowCountrySelector}\r\n\r\n            onInitFind={this.tnInitFind}\r\n            searchResults={this.state.searchResults}\r\n            onSearchContacts={this.handleSearchContacts}\r\n\r\n            showContextMenu={this.handleShowContextMenu} />\r\n          : null}\r\n\r\n        {!this.state.displayMobile || (this.state.mobilePanel == 'topic-view' && !this.state.infoPanel) ?\r\n          <MessagesView\r\n            tinode={this.tinode}\r\n            connected={this.state.connected}\r\n            ready={this.state.ready}\r\n            online={this.state.topicSelectedOnline}\r\n            acs={this.state.topicSelectedAcs}\r\n            displayMobile={this.state.displayMobile}\r\n            viewportWidth={this.state.viewportWidth}\r\n            viewportHeight={this.state.viewportHeight}\r\n            topic={this.state.topicSelected}\r\n            myUserId={this.state.myUserId}\r\n            // User public.fn.\r\n            myUserName={this.state.sidePanelTitle}\r\n            serverVersion={this.state.serverVersion}\r\n            serverAddress={this.state.serverAddress}\r\n            applicationVisible={this.state.applicationVisible}\r\n\r\n            forwardMessage={this.state.forwardMessage}\r\n            onCancelForwardMessage={this.handleHideForwardDialog}\r\n\r\n            callTopic={this.state.callTopic}\r\n            callSeq={this.state.callSeq}\r\n            callState={this.state.callState}\r\n            callAudioOnly={this.state.callAudioOnly}\r\n            onCallHangup={this.handleCallHangup}\r\n            onAcceptCall={this.handleCallAccept}\r\n\r\n            onCallInvite={this.handleCallInvite}\r\n            onCallSendOffer={this.handleCallSendOffer}\r\n            onCallIceCandidate={this.handleCallIceCandidate}\r\n            onCallSendAnswer={this.handleCallSendAnswer}\r\n\r\n            errorText={this.state.errorText}\r\n            errorLevel={this.state.errorLevel}\r\n            errorAction={this.state.errorAction}\r\n            errorActionText={this.state.errorActionText}\r\n\r\n            newTopicParams={this.state.newTopicParams}\r\n\r\n            onHideMessagesView={this.handleHideMessagesView}\r\n            onError={this.handleError}\r\n            onNewTopicCreated={this.handleNewTopicCreated}\r\n            showContextMenu={this.handleShowContextMenu}\r\n            onChangePermissions={this.handleChangePermissions}\r\n            onNewChat={this.handleNewChatInvitation}\r\n            sendMessage={this.handleSendMessage}\r\n            onResetContactList={this.resetContactList}\r\n            onVideoCallClosed={this.handleCallClose} />\r\n          : null}\r\n\r\n        {this.state.infoPanel ?\r\n          <InfoView\r\n            tinode={this.tinode}\r\n            connected={this.state.connected}\r\n            displayMobile={this.state.displayMobile}\r\n            topic={this.state.topicSelected}\r\n            searchableContacts={this.state.searchableContacts}\r\n            myUserId={this.state.myUserId}\r\n            panel={this.state.infoPanel}\r\n\r\n            errorText={this.state.errorText}\r\n            errorLevel={this.state.errorLevel}\r\n            errorAction={this.state.errorAction}\r\n            errorActionText={this.state.errorActionText}\r\n\r\n            onNavigate={this.infoNavigator}\r\n            onTopicDescUpdateRequest={this.handleTopicUpdateRequest}\r\n            onShowAlert={this.handleShowAlert}\r\n            onChangePermissions={this.handleChangePermissions}\r\n            onMemberUpdateRequest={this.handleMemberUpdateRequest}\r\n            onDeleteTopic={this.handleDeleteTopicRequest}\r\n            onDeleteMessages={this.handleDeleteMessagesRequest}\r\n            onExpirePeriodChanged={this.handleExpirePeriodRequest}\r\n            onLeaveTopic={this.handleLeaveUnsubRequest}\r\n            onBlockTopic={this.handleBlockTopicRequest}\r\n            onReportTopic={this.handleReportTopic}\r\n            onAddMember={this.handleManageGroupMembers}\r\n            onTopicTagsUpdateRequest={this.handleTagsUpdateRequest}\r\n            onTopicUnArchive={this.handleUnarchive}\r\n            onInitFind={this.tnInitFind}\r\n            onError={this.handleError}\r\n\r\n            showContextMenu={this.handleShowContextMenu}\r\n            />\r\n          :\r\n          null\r\n        }\r\n      </div>\r\n    );\r\n  }\r\n};\r\n\r\nexport default injectIntl(TinodeWeb);\r\n","// Put all packages together.\r\n// Used to generate umd/index.prod.js\r\n\r\nimport React from 'react';\r\nimport { createRoot } from 'react-dom/client';\r\n\r\nimport { IntlProvider } from 'react-intl';\r\n\r\nimport TinodeWeb from './views/tinode-web.jsx';\r\nimport HashNavigation from './lib/navigation.js';\r\n\r\n// Insert google analytics script and tag if configured.\r\nif (typeof FIREBASE_INIT != 'undefined' && FIREBASE_INIT && FIREBASE_INIT.measurementId) {\r\n  const head = document.getElementsByTagName('head')[0];\r\n  let script = document.createElement('script');\r\n  script.src = 'https://www.googletagmanager.com/gtag/js?id=' + FIREBASE_INIT.measurementId;\r\n  script.async = true;\r\n  head.prepend(script);\r\n  window.dataLayer = window.dataLayer || [];\r\n  function gtag(){dataLayer.push(arguments);}\r\n  gtag('js', new Date());\r\n  gtag('config', FIREBASE_INIT.measurementId);\r\n}\r\n\r\n// Allow loading translation strings for just one language.\r\nconst messageLoader = {\r\n  'ar': _ => import('./i18n.min/ar.json'),\r\n  'de': _ => import('./i18n.min/de.json'),\r\n  'en': _ => import('./i18n.min/en.json'),\r\n  'es': _ => import('./i18n.min/es.json'),\r\n  'fr': _ => import('./i18n.min/fr.json'),\r\n  'ko': _ => import('./i18n.min/ko.json'),\r\n  'ro': _ => import('./i18n.min/ro.json'),\r\n  'ru': _ => import('./i18n.min/ru.json'),\r\n  'th': _ => import('./i18n.min/th.json'),\r\n  'uk': _ => import('./i18n.min/uk.json'),\r\n  'zh': _ => import('./i18n.min/zh.json'),\r\n  'zh-TW': _ => import('./i18n.min/zh-TW.json')\r\n};\r\n\r\n// List of languages that are written right-to-left.\r\nconst rtl = ['ar', 'fa', 'he', 'ur'];\r\n\r\n// Detect human language to use in the UI:\r\n//  Check parameters from URL hash #?hl=ru, then browser, then use 'en' as a fallback.\r\nconst { params } = HashNavigation.parseUrlHash(window.location.hash);\r\nconst language = (params && params.hl) ||\r\n  (navigator.languages && navigator.languages[0]) ||\r\n  navigator.language ||\r\n  navigator.userLanguage ||\r\n  'en';\r\n\r\n// Make sure names like 'en_GB' and 'en-GB' consistently use '-'.\r\nconst normalized = language.replace('_', '-');\r\n// Get the base language 'en' from a more specific 'en-US' as a partial fallback.\r\nconst baseLanguage = normalized.split('-')[0].toLowerCase();\r\n\r\n// Try the full locale first, then the locale without the region code, fallback to 'en'.\r\nconst htmlLang = messageLoader[normalized] ? language : messageLoader[baseLanguage] ? baseLanguage : 'en';\r\n\r\nconst html = document.getElementsByTagName('html')[0];\r\n// Set lang attribute of the HTML element: <html lang=\"XX\">\r\nhtml.setAttribute('lang', htmlLang);\r\nif (rtl.includes(baseLanguage)) {\r\n  // Set right-to-left dir attribute of the HTML element: <html dir=\"rtl\">\r\n  html.setAttribute('dir', 'rtl');\r\n}\r\n// Render the app.\r\nconst root = createRoot(document.getElementById('mountPoint'));\r\nmessageLoader[htmlLang]().then(messages =>\r\n  root.render(\r\n    <IntlProvider locale={language} messages={messages} textComponent={React.Fragment}>\r\n      <TinodeWeb />\r\n    </IntlProvider>\r\n));\r\n"],"names":["leafPrototypes","getProto","inProgress","APP_NAME","PACKAGE_VERSION","API_KEY","KNOWN_HOSTS","hosted","local","DEFAULT_HOST","LOGGING_ENABLED","KEYPRESS_DELAY","READ_DELAY","MIN_TAG_LENGTH","MAX_TAG_LENGTH","MAX_TAG_COUNT","DEFAULT_P2P_ACCESS_MODE","NO_ACCESS_MODE","MEDIA_BREAKPOINT","REM_SIZE","AVATAR_SIZE","MAX_AVATAR_BYTES","BROKEN_IMAGE_SIZE","NO_DIMENSIONS_VIDEO","MESSAGES_PAGE","MAX_INBAND_ATTACHMENT_SIZE","MAX_EXTERN_ATTACHMENT_SIZE","MAX_IMAGE_DIM","IMAGE_PREVIEW_DIM","VIDEO_PREVIEW_DIM","IMAGE_THUMBNAIL_DIM","VIDEO_THUMBNAIL_WIDTH","MAX_ONLINE_IN_TOPIC","MAX_TITLE_LENGTH","MAX_TOPIC_DESCRIPTION_LENGTH","MAX_PEER_TITLE_LENGTH","MESSAGE_PREVIEW_LENGTH","QUOTED_REPLY_LENGTH","FORWARDED_PREVIEW_LENGTH","EDIT_PREVIEW_LENGTH","MIN_DURATION","MAX_DURATION","LINK_CONTACT_US","LINK_PRIVACY_POLICY","LINK_TERMS_OF_SERVICE","IMMEDIATE_P2P_SUBSCRIPTION","CLICKABLE_URL_SCHEMES","QRCODE_SIZE","WAKE_UP_TIMEOUT","WAKE_UP_TICK","MIN_SWIPE_DISTANCE","SELF_AVATAR_URI","TOAST_DURATION","DRAFTY_FR_MIME_TYPE_LEGACY","SUPPORTED_IMAGE_FORMATS","MIME_EXTENSIONS","makeImageUrl","photo","ref","data","type","startsWith","fitImageSize","width","height","maxWidth","maxHeight","forceSquare","Math","min","scale","size","dstWidth","dstHeight","srcWidth","srcHeight","xoffset","yoffset","fileNameForMime","fname","mime","idx","indexOf","ext","at","lastIndexOf","substring","imageScaled","fileOrBlob","maxSize","Promise","resolve","reject","img","Image","crossOrigin","onerror","err","Error","onload","async","URL","revokeObjectURL","src","dim","canvas","document","createElement","ctx","getContext","imageSmoothingEnabled","drawImage","includes","blob","toBlob","length","clearRect","name","createObjectURL","imageCrop","objURL","left","top","_","fileToBase64","file","reader","FileReader","error","bits","result","split","readAsDataURL","blobToBase64","filePasted","event","onImageSuccess","onAttachmentSuccess","onError","items","clipboardData","originalEvent","console","log","i","item","kind","getAsFile","base64ReEncode","str","replace","btoa","atob","base64ToBlob","bin","buf","ArrayBuffer","arr","Uint8Array","charCodeAt","Blob","intArrayToBase64","Array","isArray","forEach","b","String","fromCharCode","window","base64ToIntArray","b64","c","push","LocalStorageUtil","setObject","key","value","localStorage","setItem","JSON","stringify","getObject","getItem","parse","updateObject","oldVal","this","Object","assign","removeItem","HashNavigation","parseUrlHash","hash","parts","params","path","arg","eq","slice","decodeURIComponent","navigateTo","url","location","composeUrlHash","join","args","hasOwnProperty","undefined","encodeURIComponent","addUrlParam","parsed","removeUrlParam","setUrlSidePanel","sidepanel","setUrlInfoPanel","infopanel","info","setUrlTopic","topic","shortDateFormat","then","locale","navigator","userLanguage","language","now","Date","getFullYear","getMonth","getDate","toLocaleTimeString","hour12","hour","minute","toLocaleDateString","month","day","year","relativeDateFormat","diff","floor","getTime","getTimezoneOffset","abs","Intl","RelativeTimeFormat","numeric","format","DateTimeFormat","secondsToTime","seconds","fixedMin","hours","sec","bytesToHumanSize","bytes","sizes","bucket","log2","count","pow","round","toFixed","shortenFileName","filename","maxLength","idToColorClass","id","light","fg","userId","stringToColorHash","flagEmoji","countryCode","codePoints","toUpperCase","map","char","fromCodePoint","updateFavicon","oldIcon","getElementById","head","getElementsByTagName","newIcon","rel","href","removeChild","appendChild","title","theCard","fn","imageUrl","imageMimeType","note","card","trim","Tinode","DEL_CHAR","mimeType","matches","exec","arrayEqual","a","sort","l","asPhone","val","test","replaceAll","asEmail","isUrlRelative","sanitizeUrl","allowedSchemes","schemes","RegExp","sanitizeUrlForMime","mimeMajor","sanitizedUrl","urlAsAttachment","query","fragment","idxF","idxQ","URLSearchParams","append","toString","deliveryMarker","received","MESSAGE_STATUS_SENDING","MESSAGE_STATUS_FAILED","MESSAGE_STATUS_FATAL","color","MESSAGE_STATUS_SENT","MESSAGE_STATUS_RECEIVED","MESSAGE_STATUS_READ","cancelablePromise","promise","hasCanceled","isCanceled","cancel","clipStr","BAR_COLOR_DARK","messages","defineMessages","icon_title_play","defaultMessage","AudioPlayer","React","constructor","props","super","preview","state","canPlay","playing","currentTime","duration","longMin","initAudio","bind","initCanvas","resampleBars","visualize","handlePlay","handleSeek","handleError","getBlob","audioPlayer","viewBuffer","canvasRef","componentDidMount","componentWillUnmount","onloadedmetadata","ontimeupdate","onended","pause","componentDidUpdate","prevProps","setState","MediaRecorder","isTypeSupported","Audio","load","e","current","offsetWidth","offsetHeight","canvasContext","lineCap","effectiveWidth","lineWidth","drawFrame","requestAnimationFrame","thumbAt","max","LINE_WIDTH","beginPath","strokeStyle","x","y","stroke","moveTo","lineTo","arc","PI","fillStyle","fill","original","dstCount","apply","factor","amps","maxAmp","lo","hi","amp","j","preventDefault","readyState","play","target","rect","getBoundingClientRect","offset","clientX","xhr","XMLHttpRequest","responseType","overrideMimeType","response","open","send","render","playClass","short","onClick","intl","formatMessage","className","injectIntl","Cropper","panX","panY","originX","originY","zoom","minZoom","maxZoom","overlay","cutout","boundingBox","imageWidth","imageHeight","mouseX","mouseY","prevDistance","cutoutRect","bBoxRect","initScaling","onZoom","handleZoom","mouseDown","mouseUp","mouseMove","mouseTouch","positionAll","translate","addEventListener","passive","removeEventListener","onChange","checkBound","currPan","delta","nextDiff","imgRect","imgLeft","imgRight","coLeft","coRight","imgTop","imgBottom","coTop","coBottom","touches","pageX","pageY","body","style","dX","dY","right","bottom","touch0","touch1","distance","sqrt","t3d","orig","source","alt","transform","transformOrigin","onLoad","step","AvatarCrop","handleSubmit","handleChange","avatar","onSubmit","catch","onCancel","FormattedMessage","AvatarUpload","handleFileReceived","image","files","onImageUpdated","randId","random","readOnly","tinode","authorizeURL","uid","LetterTile","accept","htmlFor","LoadSpinner","show","uploading","large","clear","centered","icon_mapping","badge_verified","badge_staff","badge_danger","BadgeList","badges","trustedBadges","comment","CheckBox","checked","iconName","classList","attrs","isSelfTopicName","isGroup","isGroupTopicName","iconColor","letter","charAt","deleted","VisiblePassword","inputRef","visible","handleVisibility","handeTextChange","handleKeyDown","handleEditingFinished","autoFocus","focus","keyCode","onFinished","currentTarget","setTimeout","contains","activeElement","tabIndex","onBlur","placeholder","required","autoComplete","onKeyDown","m","exports","createRoot","hydrateRoot","module","ReactDOM","ReactIntl","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","__webpack_modules__","call","n","getter","__esModule","d","getPrototypeOf","obj","__proto__","t","mode","ns","create","r","def","getOwnPropertyNames","definition","o","defineProperty","enumerable","get","f","chunkId","all","keys","reduce","promises","u","g","globalThis","Function","prop","prototype","done","script","needAttach","scripts","s","getAttribute","charset","timeout","nc","setAttribute","onScriptComplete","prev","clearTimeout","doneFns","parentNode","Symbol","toStringTag","p","installedChunks","installedChunkData","errorType","realSrc","message","request","webpackJsonpCallback","parentChunkLoadingFunction","chunkIds","moreModules","runtime","some","chunkLoadingGlobal","self","stringToByteArray$1","out","base64","byteToCharMap_","charToByteMap_","byteToCharMapWebSafe_","charToByteMapWebSafe_","ENCODED_VALS_BASE","ENCODED_VALS","ENCODED_VALS_WEBSAFE","HAS_NATIVE_SUPPORT","encodeByteArray","input","webSafe","init_","byteToCharMap","output","byte1","haveByte2","byte2","haveByte3","byte3","outByte1","outByte2","outByte3","outByte4","encodeString","decodeString","pos","c1","c2","c3","byteArrayToString","decodeStringToByteArray","charToByteMap","byte4","DecodeBase64StringError","arguments","base64urlEncodeWithoutPadding","utf8Bytes","base64Encode","base64Decode","getDefaultsFromGlobal","getGlobal","__FIREBASE_DEFAULTS__","getDefaults","process","env","defaultsJsonString","getDefaultsFromEnvVariable","match","cookie","decoded","getDefaultsFromCookie","Deferred","wrapCallback","callback","FirebaseError","code","customData","setPrototypeOf","captureStackTrace","ErrorFactory","service","serviceName","errors","fullCode","template","PATTERN","replaceTemplate","fullMessage","deepEqual","aKeys","bKeys","k","aProp","bProp","isObject","thing","_delegate","Component","instanceFactory","multipleInstances","serviceProps","instantiationMode","onInstanceCreated","setInstantiationMode","setMultipleInstances","setServiceProps","setInstanceCreatedCallback","DEFAULT_ENTRY_NAME","Provider","container","component","instances","Map","instancesDeferred","instancesOptions","onInitCallbacks","identifier","normalizedIdentifier","normalizeInstanceIdentifier","has","deferred","set","isInitialized","shouldAutoInitialize","instance","getOrInitializeService","instanceIdentifier","getImmediate","options","_a","optional","getComponent","setComponent","isComponentEager","instanceDeferred","entries","clearInstance","delete","services","from","values","filter","INTERNAL","_delete","isComponentSet","getOptions","initialize","opts","onInit","existingCallbacks","Set","add","existingInstance","invokeOnInitCallbacks","callbacks","providers","addComponent","provider","getProvider","addOrOverwriteComponent","getProviders","LogLevel","levelStringToEnum","DEBUG","VERBOSE","INFO","WARN","ERROR","SILENT","defaultLogLevel","ConsoleMethod","defaultLogHandler","logType","logLevel","toISOString","method","idbProxyableTypes","cursorAdvanceMethods","cursorRequestMap","WeakMap","transactionDoneMap","transactionStoreNamesMap","transformCache","reverseTransformCache","idbProxyTraps","receiver","IDBTransaction","objectStoreNames","objectStore","wrap","wrapFunction","func","IDBDatabase","transaction","IDBCursor","advance","continue","continuePrimaryKey","unwrap","storeNames","tx","transformCachableValue","unlisten","complete","DOMException","cacheDonePromiseForTransaction","object","IDBObjectStore","IDBIndex","Proxy","IDBRequest","success","promisifyRequest","newValue","openDB","version","blocked","upgrade","blocking","terminated","indexedDB","openPromise","oldVersion","newVersion","db","deleteDB","deleteDatabase","readMethods","writeMethods","cachedMethods","getMethod","targetFuncName","useIndex","isWrite","storeName","store","index","shift","oldTraps","PlatformLoggerServiceImpl","getPlatformInfoString","isVersionServiceProvider","library","logString","name$q","version$1","logger","_logLevel","_logHandler","_userLogHandler","TypeError","setLogLevel","logHandler","userLogHandler","debug","warn","name$p","name$o","name$n","name$m","name$l","name$k","name$j","name$i","name$h","name$g","name$f","name$e","name$d","name$c","name$b","name$a","name$9","name$8","name$7","name$6","name$5","name$4","name$3","name$2","name$1","PLATFORM_LOG_STRING","_apps","_serverApps","_components","_addComponent","app","_registerComponent","componentName","serverApp","heartbeatController","triggerHeartbeat","ERROR_FACTORY","FirebaseAppImpl","config","_isDeleted","_options","_config","_name","_automaticDataCollectionEnabled","automaticDataCollectionEnabled","_container","checkDestroyed","isDeleted","appName","initializeApp","rawConfig","existingApp","newApp","registerVersion","libraryKeyOrName","variant","libraryMismatch","versionMismatch","warning","STORE_NAME","dbPromise","getDbPromise","createObjectStore","originalErrorMessage","writeHeartbeatsToIndexedDB","heartbeatObject","put","computeKey","idbGetError","appId","HeartbeatServiceImpl","_heartbeatsCache","_storage","HeartbeatStorageImpl","_heartbeatsCachePromise","read","_b","agent","date","getUTCDateString","heartbeats","lastSentHeartbeatDate","singleDateHeartbeat","earliestHeartbeatIdx","earliestHeartbeatDate","getEarliestHeartbeatIdx","splice","overwrite","getHeartbeatsHeader","heartbeatsToSend","unsentEntries","heartbeatsCache","heartbeatEntry","find","hb","dates","countBytes","pop","extractHeartbeatsForHeader","headerString","_canUseIndexedDBPromise","runIndexedDBEnvironmentCheck","preExist","DB_CHECK_NAME","onsuccess","close","onupgradeneeded","idbHeartbeatObject","readHeartbeatsFromIndexedDB","heartbeatsObject","existingHeartbeatsObject","PENDING_TIMEOUT_MS","INTERNAL_AUTH_VERSION","TOKEN_EXPIRATION_BUFFER","isServerError","getInstallationsEndpoint","projectId","extractAuthTokenInfoFromResponse","token","requestStatus","expiresIn","responseExpiresIn","Number","creationTime","getErrorFromResponse","requestName","errorData","json","serverCode","serverMessage","serverStatus","status","getHeaders","apiKey","Headers","Accept","getHeadersWithAuth","appConfig","refreshToken","headers","getAuthorizationHeader","retryIfServerError","sleep","ms","VALID_FID_PATTERN","generateFid","fidByteArray","crypto","msCrypto","getRandomValues","fid","b64String","array","substr","encode","getKey","fidChangeCallbacks","fidChanged","callFidChangeCallbacks","channel","getBroadcastChannel","postMessage","closeBroadcastChannel","broadcastFidChange","broadcastChannel","BroadcastChannel","onmessage","OBJECT_STORE_NAME","oldValue","remove","update","updateFn","getInstallationEntry","installations","registrationPromise","installationEntry","oldEntry","entry","registrationStatus","clearTimedOutRequest","updateOrCreateInstallationEntry","entryWithPromise","onLine","inProgressEntry","registrationTime","registeredInstallationEntry","heartbeatServiceProvider","endpoint","heartbeatService","heartbeatsHeader","authVersion","sdkVersion","fetch","ok","responseValue","authToken","createInstallationRequest","registerInstallation","waitUntilFidRegistration","triggerRegistrationIfNecessary","updateInstallationRequest","generateAuthTokenRequest","getGenerateAuthTokenEndpoint","installation","refreshAuthToken","forceRefresh","tokenPromise","isEntryRegistered","oldAuthToken","isAuthTokenExpired","isAuthTokenValid","updateAuthTokenRequest","waitUntilAuthTokenRequest","inProgressAuthToken","requestTime","makeAuthTokenRequestInProgressEntry","updatedInstallationEntry","fetchAuthTokenFromServer","getToken","installationsImpl","completeInstallationRegistration","getMissingValueError","valueName","INSTALLATIONS_NAME","internalFactory","getId","configKeys","keyName","extractAppConfig","DEFAULT_VAPID_KEY","CONSOLE_CAMPAIGN_ID","DEFAULT_REGISTRATION_TIMEOUT","MessageType$1","MessageType","arrayToBase64","uint8Array","base64ToArray","base64String","repeat","rawData","outputArray","OLD_DB_NAME","OLD_OBJECT_STORE_NAME","upgradeDb","dbGet","firebaseDependencies","tokenDetails","oldTokenDetails","senderId","dbNames","databases","upgradeTransaction","oldDetails","auth","p256dh","fcmToken","createTime","subscriptionOptions","swScope","vapidKey","checkTokenDetails","migrateOldDatabase","dbSet","requestDeleteToken","unsubscribeOptions","getEndpoint","responseData","errorInfo","getBody","web","applicationPubKey","getTokenInternal","messaging","pushSubscription","swRegistration","subscription","pushManager","getSubscription","subscribe","userVisibleOnly","applicationServerKey","getPushSubscription","scope","dbOptions","currentOptions","isVapidKeyEqual","isEndpointEqual","isAuthEqual","isP256dhEqual","isTokenValid","updatedToken","updateOptions","requestUpdateToken","updatedTokenDetails","updateToken","getNewToken","deleteTokenInternal","dbRemove","unsubscribe","subscribeOptions","requestGetToken","externalizePayload","internalPayload","payload","collapseKey","collapse_key","messageId","fcmMessageId","messagePayloadInternal","notification","icon","propagateNotificationPayload","propagateDataPayload","_c","_d","_e","fcmOptions","click_action","link","analyticsLabel","analytics_label","propagateFcmOptions","s1","s2","resultArray","_mergeStrings","MessagingService","analyticsProvider","deliveryMetricsExportedToBigQueryEnabled","onBackgroundMessageHandler","onMessageHandler","logEvents","isLogServiceStarted","messagingSenderId","registerDefaultSw","serviceWorker","register","registration","rejectTimeout","incomingSw","installing","waiting","active","onstatechange","ev","waitForRegistrationActive","browserErrorMessage","getToken$1","Notification","permission","requestPermission","updateVapidKey","ServiceWorkerRegistration","updateSwReg","serviceWorkerRegistration","logToScion","messageType","eventType","NOTIFICATION_CLICKED","PUSH_RECEIVED","getEventType","logEvent","message_id","message_name","message_time","message_device_time","messageEventListener","isFirebaseMessaging","next","dataPayload","WindowMessagingInternalFactory","deleteToken","deleteToken$1","Alert","content","onReject","onConfirm","confirm","clear_messages","clear_for_all","delete_for_all","send_retry","mute","unmute","reply","forward","edit","topic_delete","topic_delete_warning","delete_messages_warning","unblock","block","topic_block_warning","member_delete","archive","unarchive","edit_permissions","clear_messages_warning","pin_message","unpin_message","ContextMenu","selfRef","handlePageClick","handleEscapeKey","handleClick","MenuItems","handler","errorHandler","onShowAlert","deleteMessages","retryMessage","replyToMessage","editMessage","pinMessage","topicPermissionSetter","ctrl","onTopicRemoved","topicName","getTopic","delTopic","user","delSubscription","stopPropagation","hide","dataset","onAction","hard","cancelSend","seq","delMessagesAll","delMessagesEdits","delMessagesList","flushMessage","msg","createMessage","publishDraft","pin","updateMode","pickReply","userFrom","userName","menu","disabled","hSize","vSize","position","bounds","clickAt","ContactBadges","UnreadBadge","CallMessage","isCallDropped","callState","successClass","callIcon","incoming","CallStatus","icon2","InlineVideo","videoRef","LazyImage","isvideo","padding","whenDone","FileProgress","progress","UploadingImage","onCancelUpload","drafty_form","drafty_attachment","drafty_image","drafty_video","drafty_unknown","fullFormatter","stack","quoteFormatter","el","Drafty","tagName","attr","attrValue","loading","handleImageData","onFormButtonClick","inner","child","onQuoteClick","handleVideoData","concat","viewportWidth","minWidth","minHeight","isProcessing","onImagePreview","onVideoPreview","previewFormatter","isFormResponseType","inlineImageAttr","inlineVideoAttr","quoteImageOrVideo","isVideo","premime","preref","evt","statusText","scaled","replyFormatter","loadedPromise","self_topic_name","self_topic_comment","Contact","handleContextClick","onSelected","showContextMenu","online","icon_badges","isVerified","isStaff","isDangerous","acs","showMode","getMode","isMuted","isJoiner","isValid","previewIsResponse","marker","titleClass","showCheckmark","selected","showOnline","isChannel","unread","small","ContactAction","action","badge_you","badge_owner","ContactList","topicSelected","contactNodes","contactsCount","contacts","filterFunc","filterOn","private","toLowerCase","public","isChannelTopicName","myUserId","isOwner","forwarded","deliveryStatus","latestMessage","_status","msgStatus","showUnread","connected","trusted","verified","staff","danger","_deleted","onTopicSelected","noScroll","dangerouslySetInnerHTML","__html","emptyListMessage","SearchContacts","edited","search","handleSearchChange","handleSearch","handleClear","onSearchContacts","ForwardDialog","handleClose","handleSearchContacts","handleContactSelected","onInitFind","isNullValue","searchResults","isWriter","desription","search_placeholder","not_found_placeholder","CALL_HEAD_STARTED","RING_SOUND","CallIncoming","fullName","previousMetaDesc","resetDesc","onMetaDesc","handleRejectCall","handleAcceptCall","ringTimer","setInterval","onRinging","clearInterval","desc","onAcceptCall","onClose","MenuCancel","ErrorPanel","level","onClearError","text","whiteSpace","actionText","Chip","handleCancel","invalid","noAvatar","ChipInput","deriveStateFromProps","focused","handleTextInput","removeChipAt","handleChipCancel","handleFocusGained","handleFocusLost","chips","prompt","sortedChips","sortChips","staticMembers","chipIndex","indexChips","prevState","keep","normal","removed","onChipRemoved","onFocusLost","onEnter","avatarDisabled","onFocus","no_contacts","contacts_not_found_short","GroupManager","members","indexMembers","keepInitialMembers","requiredMember","contactFilter","noContactsMessage","selectedContacts","handleMemberRemoved","handleContactFilter","present","keepInitial","stat","sel","doContactFiltering","added","joiner","writer","preser","approver","sharer","deleter","owner","PermissionsEditor","names","skip","compare","userTitle","userAvatar","modeTitle","compareTitle","QRCode","ShowQRCode","qrCodeRef","uri","InPlaceEdit","initialValue","valid","handleStartEditing","handlePasswordFinished","validator","checkValidity","spanText","spanClass","multiline","iconLeft","iconRight","element","rows","spellCheck","TagManager","tags","alias","tagByPrefix","TAG_ALIAS","tagInput","activated","handleTagInput","handleAddTag","handleRemoveTag","getDerivedStateFromProps","nextProps","last","tag","maxTagCount","getServerParam","onTagsChanged","setUniqueTag","minTagLength","maxTagLength","add_tags_prompt","alias_invalid","alias_already_taken","TopicDescEdit","getAccessMode","isSelf","isMe","isMeTopicName","description","newAvatar","newAvatarMime","aliasError","previousOnTags","aliasCheckTimer","aliasCheckPromise","tnNewTags","handleFullNameUpdate","handleImageUpdated","handleAvatarCropped","handleAvatarCropCancel","uploadAvatar","handlePrivateUpdate","handleAliasUpdate","handleDescriptionUpdate","handleTagsUpdated","validateAlias","cancelValidator","onTagsUpdated","onUpdateTopicDesc","readyToUpload","getLargeFileHelper","upload","du","clearTagPrefix","isValidTagValue","fnd","getFndTopic","validationPromise","checkTagUniqueness","onUpdateTags","editable","full_name_placeholder","group_name_placeholder","private_placeholder","title_tag_manager","TopicCommonView","previousTagsUpdated","getType","onUpdateTagsRequest","delete_messages","leave_chat","leave_chat_warning","block_contact","block_contact_warning","report_chat","report_chat_warning","other_user","TopicSecurity","expire","expirePeriod","handleDeleteTopic","handleDeleteMessages","handleLeave","handleBlock","handleReport","handleChangeExpirePeriod","onDeleteTopic","onDeleteMessages","onLeaveTopic","onBlockTopic","onReportTopic","parseInt","onExpirePeriodChanged","groupTopic","onLaunchPermissionsEditor","access","anon","modeGiven2","general","security","crop","perm_want","perm_given","perm_auth","perm_anon","perm_user","qrcode","text_copied","InfoView","admin","muted","address","selectedContact","modeGiven","modeWant","modeWant2","contactList","previousSubsUpdated","resetSubs","resetTags","onSubsUpdated","handleImageChanged","handleMuted","handleUnarchive","handlePermissionsChanged","handleLaunchPermissionsEditor","handleShowQRCode","handleCopyToClipboard","handleShowAddMembers","handleMemberUpdateRequest","handleMemberSelected","handleContextMenu","handleBackNavigate","handleExpirePeriodChanged","newState","user2","subscriber","getGiven","getWant","subscribers","sub","defacs","getDefaultAccess","isSelfType","isAdmin","isSharer","isDeleter","archived","isArchived","isGroupType","isChannelType","chan","getMeta","startMetaQuery","withTags","build","subs","onTopicDescUpdate","ignored","onChangePermissions","ignored2","onTopicUnArchive","which","perm","onTopicDescUpdateRequest","userPermissionsEdited","toEdit","toCompare","toSkip","titleEdit","titleCompare","AccessMode","userPermissionsTitle","userPermissionsAvatar","editedPermissions","immutablePermissions","editedPermissionsTitle","immutablePermissionsTitle","editedPermissionsSkipped","onNavigate","clipboard","writeText","toast","onMemberUpdateRequest","panel","menuItems","view","panelTitle","displayMobile","errorLevel","errorText","searchableContacts","reqCredMethod","onCredAdd","onTopicTagsUpdateRequest","onCredConfirm","onCredDelete","URI_TOPIC_ID_PREFIX","marginLeft","opacity","no_members","loop","CALL_ENDED_SOUND","DIALING_SOUND","VIDEO_MUTED_EVENT","VIDEO_UNMUTED_EVENT","already_in_call","CallPanel","localStream","remoteStream","pc","dataChannel","previousOnInfo","waitingForPeer","callInitialSetupComplete","audioOnly","callAudioOnly","videoToggleInProgress","remoteVideoLive","localStreamConstraints","audio","video","isOutgoingCall","localRef","remoteRef","remoteIceCandidatesCache","onInfo","start","stop","createPeerConnection","canSendOffer","drainRemoteIceCandidatesCache","handleNegotiationNeededEvent","handleICECandidateEvent","handleNewICECandidateMsg","handleICEConnectionStateChangeEvent","handleSignalingStateChangeEvent","handleICEGatheringStateChangeEvent","handleIceCandidateErrorEvent","handleTrackEvent","handleVideoOfferMsg","handleVideoAnswerMsg","reportError","handleGetUserMediaError","stopTracks","disconnectMedia","handleCloseClick","handleToggleCameraClick","handleToggleMicClick","handleRemoteHangup","handleVideoCallAccepted","muteVideo","unmuteVideo","emptyVideoTrack","handleDataChannelEvent","handleDataChannelError","handleDataChannelMessage","handleDataChannelOpen","handleDataChannelClose","stream","getTracks","track","addTrack","enabled","removeTrack","what","fillRect","captureStream","getVideoTracks","mediaDevices","getUserMedia","srcObject","onInvite","ontrack","onremovetrack","onremovestream","onicecandidate","oniceconnectionstatechange","onsignalingstatechange","onicegatheringstatechange","onnegotiationneeded","onicecandidateerror","ondatachannel","tracks","onopen","onclose","withDataChannel","iceServers","RTCPeerConnection","stateUpdate","createDataChannel","ordered","RTCSessionDescription","setRemoteDescription","createOffer","offer","setLocalDescription","onSendOffer","localDescription","toJSON","candidate","onIceCandidate","RTCIceCandidate","addIceCandidate","iceConnectionState","signalingState","streams","dummyVideo","createAnswer","answer","onSendAnswer","onHangup","sender","getSenders","replaceTrack","finally","getAudioTracks","forceUpdate","audioTracks","videoTracks","audioIcon","videoIcon","peerTitle","pulseAnimation","remoteActive","rstream","autoPlay","playsInline","Attachment","downloader","downloadFile","mimetype","download","loaded","helperFunc","downloadUrl","downloadWidget","message_sending","message_sending_failed","message_edited_marker","ReceivedMarker","timestamp","timeStyle","BaseChatMessage","uploader","onProgress","handleProgress","handleExpandImage","handlePlayVideo","handleFormButtonClick","handleCancelUpload","handleQuoteClick","formatterContext","onExpandMedia","resp","act","onFormResponse","userIsWriter","immutable","entities","_0","_1","tp","styles","userIsAdmin","pinned","ratio","replyToSeq","sideClass","sequence","bubbleClass","textSizeClass","fullDisplay","attachments","getContentType","att","getDownloadUrl","getEntitySize","tree","innerRef","IntlChatMessage","_extends","AudioRecorder","messaging_disabled","type_new_message","add_image_caption","file_attachment_too_large","cannot_initiate_upload","icon_title_record_voice","icon_title_attach_file","icon_title_add_image","icon_title_send","SendMessage","quote","audioRec","audioAvailable","keypressTimestamp","handlePasteEvent","handleAttachImage","handleAttachFile","handleAttachAudio","handleSend","handleKeyPress","handleMessageTyping","handleDropAttach","formatReply","messageEditArea","getComputedStyle","getPropertyValue","scrollHeight","initMessage","scrollTop","setSelectionRange","onAttachImage","onAttachFile","onAttachAudio","acceptBlank","noInput","onSendMessage","shiftKey","onKeyPress","messagePrompt","sendIcon","editing","onCancelReply","audioEnabled","attachImage","click","attachFile","Suspense","fallback","onRecordingProgress","onDeleted","display","DocPreview","handleSendDoc","caption","mimeToIcon","default","iconFromMime","GroupSubs","usersOnline","totalCount","countToShow","overflow","ImagePreview","handleSendImage","assignWidth","node","maxlength","download_url","Invitation","handleButtonAction","LogoView","getLibrary","serverVersion","serverAddress","MetaMessage","message_not_found","message_deleted","PinnedMessages","touchX","touchY","touchSurface","getSelectedIndex","handleSelected","handleMoveNext","handleMovePrev","handleTouchEventStart","handleTouchEventEnd","handleTouchCancel","pins","isTouch","setSelected","clientY","changedTouches","messageShown","dots","cn","unrecognized_video_format","VideoPreview","handleSendVideo","videoWidth","videoHeight","controlist","controls","controlsList","disablePictureInPicture","poster","online_now","last_seen","not_found","invalid_content","editing_message","drag_file","isUnconfirmed","ex","getExcessive","isPeerRestricted","getMissing","shouldPresentCallPanel","MessagesView","componentSetup","leave","sendMessage","retrySend","sendImageAttachment","sendVideoAttachment","sendFileAttachment","sendAudioAttachment","sendKeyPress","handleScrollReference","mountDnDEvents","handleScrollEvent","handleDescChange","handleSubsUpdated","handleMessageUpdate","handleAuxUpdate","handleAllMessagesReceived","handleInfoReceipt","handleExpandMedia","handleClosePreview","handleFormResponse","handleShowMessageContextMenu","handleNewChatAcceptance","handleEnablePeer","handleAttachImageOrVideo","postReadNotification","clearNotificationQueue","goToLatestMessage","handleFileDrop","handlePickReply","handleEditMessage","handleCancelReply","handleUnpinMessage","handleCallHangup","isDragEnabled","handleDragStart","handleDragIn","handleDragOut","handleDrag","handleDrop","chatMessageRefs","getOrCreateMessageRef","getVisibleMessageRange","dragCounter","dndRef","readNotificationQueue","readNotificationTimer","keyPressTimer","seqId","holderRect","MAX_SAFE_INTEGER","visibilityStatus","every","messagesScroller","maxSeqId","minSeqId","scrollPosition","applicationVisible","isNewGroupTopicName","rtcPanel","callSeq","onData","onAllMessagesReceived","onPres","onAuxUpdated","newTopic","newTopicParams","_topicName","isP2PType","withDesc","isSubscribed","isReader","withLaterData","nextState","docPreview","imagePreview","imagePostview","videoPreview","videoPostview","typingIndicator","fetchingMessages","showGoToLastButton","contentToEdit","dragging","selectedPin","forwardMessage","onlineSubs","peer","p2pPeerDesc","peerMessagingDisabled","minMsgSeq","maxMsgSeq","latestClearId","maxClearId","aux","pinsLoaded","callTopic","subsVersion","readingBlocked","unconformed","unconfirmed","ready","getQuery","withLaterDesc","withLaterSub","withAux","withLaterDel","setQuery","onNewTopicCreated","discard","queuedMessages","pub","_sending","_fatal","webrtc","blankState","oldTopicName","isTopicCached","oldTopic","processingScrollEvent","gaps","msgHasMoreMessages","getMessagesPage","dnd","sendAt","isServerAssignedSeq","noteRead","electronAPI","readMsg","setMilliseconds","getMilliseconds","onResetContactList","isNewMessage","getPinnedMessages","attachJSON","searchParams","messageSpecificMenuItems","onNewChat","noteRecording","noteKeyPress","uploadCompletionPromise","sanitizeEntities","maxInbandAttachmentSize","jsonMimeConverter","fileType","urlPromise","maxExternAttachmentSize","limit","onVideoCallClosed","onCallHangup","insertImage","_tempPreview","appendLineBreak","videoBlob","previewBlob","uploads","b64s","v64","i64","insertVideo","b64conv","appendAudio","found","findMessage","_cancelled","senderName","init","replyContent","wrapInto","onCancelForwardMessage","toMarkdown","scrollIntoView","behavior","dataTransfer","clearData","component2","onCallInvite","onCallSendOffer","onCallIceCandidate","onCallSendAnswer","pinnedMessages","latestMsgVersion","messageNodes","previousFrom","prevDate","chatBoxClass","nextFrom","thisFrom","isReply","userDesc","isNaN","thisDate","ts","toDateString","ChatMessage","isChan","_uploader","lastSeen","cont","getMeTopic","getContact","isP2PTopicName","seen","when","messagesComponent","onHideMessagesView","ButtonBack","onBack","MenuContacts","onNewTopic","onSettings","MenuStart","onSignUp","SideNavbar","archived_contacts_title","ContactsView","handleAction","unreadThreads","archivedCount","chatList","arch","touched","action_ignored","onShowArchive","EditAccountView","handleCheckboxClick","onToggleMessageSounds","onTogglePushNotifications","onToggleIncognitoMode","messageSounds","desktopAlertsEnabled","desktopAlerts","incognitoMode","delete_account","delete_account_warning","delete_all_message","delete_all_message_warning","AccSecurityView","me","blockedCount","showPermissionEditorFor","handlePasswordUpdate","handleHidePermissionsEditor","handleDeleteAccount","handleSoftDeleteAllMessage","pwd","password","onUpdatePassword","onUpdateAccountDesc","onDeleteAccount","onSoftDeleteAllMessage","password_unchanged","onLogout","onShowBlocked","AccSupportView","LoginView","login","hostName","saveToken","persist","handleLoginChange","handlePasswordChange","handleToggleSaveToken","onPersistenceChange","onLogin","submitClasses","login_prompt","autoCorrect","autoCapitalize","password_prompt","invalid_id","NewTopicById","groupId","myURI","prefix","NewTopicGroup","handleFieldEdit","handleTagsChanged","handleChannelToggle","search_for_contacts","search_no_results","NewTopicView","tabSelected","searchQuery","handleTabClick","handleSearchResultSelected","handleNewGroupSubmit","handleGroupByID","email","TAG_EMAIL","tel","TAG_PHONE","onCreateTopic","dataUrl","priv","no_contacts_placeholder","getCurrentUserID","showSelfTopic","HostSelector","changed","handleHostNameChange","onServerAddressChange","hostOptions","list","SettingsView","transport","secureConnection","handleTransportSelected","handleServerAddressChange","handleToggleSecure","onUpdate","ws","lp","transportOptions","phone","ValidationView","credCode","codeReceived","handleCodeChange","credMethod","credToken","numbers_only","AccountSettingsView","CreateAccountView","PasswordResetView","settings","notif","support","newtpk","cred","reset","SidepanelView","handleNewTopic","errorAction","errorActionText","loadSpinnerVisible","loginDisabled","onLoginRequest","onShowCountrySelector","onCreateAccount","onGlobalSettings","onUpdateAccountTags","AccNotificationsView","onValidateCredentials","onRequest","onPasswordResetRequest","onReset","onResetPassword","detectServerAddress","host","protocol","hostname","port","isSecureConnection","PhoneCountrySelector","POP_SOUND","reconnect_countdown","reconnect_now","push_init_failed","invalid_security_token","no_connection","code_doesnot_match","menu_item_info","menu_item_audio_call","menu_item_video_call","cred_confirmed_successfully","password_reset_success","select_country","TinodeWeb","getBlankState","handleResize","handleHashRoute","handleOnline","checkForAppUpdate","handleVisibilityEvent","handleLoginRequest","handlePersistenceChange","handleConnected","handleAutoreconnectIteration","doLogin","handleLoginSuccessful","handleDisconnect","tnMeMetaDesc","tnMeContactUpdate","tnMeSubsUpdated","resetContactList","tnInitFind","tnFndSubsUpdated","handleTopicSelected","handleHideMessagesView","handleSendMessage","handleNewChatInvitation","handleNewAccount","handleNewAccountRequest","handleUpdatePasswordRequest","handleUpdateAccountTagsRequest","handleToggleIncognitoMode","handleSettings","handleGlobalSettings","handleShowArchive","handleShowBlocked","handleToggleMessageSounds","handleCredAdd","handleCredDelete","handleCredConfirm","initFCMessaging","toggleFCMToken","handlePushMessage","handleSidepanelCancel","handleStartTopicRequest","handleNewTopicCreated","handleTopicUpdateRequest","handleChangePermissions","handleTagsUpdateRequest","handleLogout","handleDeleteTopicRequest","handleDeleteMessagesRequest","handleLeaveUnsubRequest","handleBlockTopicRequest","handleReportTopic","handleShowContextMenu","defaultTopicContextMenu","handleHideContextMenu","handleShowAlert","handleShowInfoView","handleValidateCredentialsRequest","handlePasswordResetRequest","handleResetPassword","handleContextMenuAction","handleShowCountrySelector","handleShowForwardDialog","handleHideForwardDialog","handleStartVideoCall","handleStartAudioCall","handleInfoMessage","handleDataMessage","handleCallClose","handleCallInvite","handleCallRinging","handleCallSendOffer","handleCallIceCandidate","handleCallSendAnswer","handleCallAccept","sendMessageToTopic","callTimeoutTimer","autoLogin","messageSoundsOff","firebaseInitApp","FIREBASE_INIT","firebaseToken","hidden","sidePanelSelected","sidePanelTitle","sidePanelAvatar","myTrustedBadges","liveConnection","topicSelectedOnline","topicSelectedAcs","innerWidth","infoPanel","mobilePanel","callShouldStart","contextMenuVisible","contextMenuBounds","contextMenuClickAt","contextMenuParams","contextMenuItems","forwardDialogVisible","alertVisible","alertParams","requestedTopic","handleOnlineOn","handleOnlineOff","lastWakeUpCheck","wakeUpTicker","documentElement","clientWidth","viewportHeight","clientHeight","tnSetup","onConnect","onDisconnect","onAutoreconnectIteration","onInfoMessage","onDataMessage","expires","setAuthToken","connect","readTimer","readTimerCallback","autoDeleteExpiredMessageLock","autoDeleteExpiredMessage","deleteExpiredMessages","parsedNav","cred_done","persistentCache","onSetupCompleted","secure","setHumanLanguage","enableLogging","oobNotification","getRegistration","reg","requestFCMToken","fcm","sw","firebaseGetToken","messagingVapidKey","mobile","onupdatefound","installingWorker","controller","newTopicTabSelected","tab","topicType","getTopicAccessMode","stateForError","reconnectCountdown","reconnect","isConnected","meth","initStorage","clearStorage","getServerInfo","ver","reqCred","prom","fmtTime","tmpToken","isAuthenticated","getAuthToken","credential","loginPromise","connectionPromise","loginBasic","loginToken","navigateToCredentialsView","goToTopic","onContactUpdate","withCred","disconnect","urlHash","isPresencer","newMsg","unused","prepareSearchableContacts","foundContacts","merged","updated","past","withSub","setMeta","isTopicOnline","completion","subscribePromise","calls","publishMessage","am","updateWant","login_","password_","public_","cred_","tags_","createAccountBasic","on","firebaseDelToken","setDeviceToken","delCredential","scheme","basicNavigator","infoNavigator","newGroupTopicName","oldName","newName","updateAccountBasic","getCurrentLogin","updateGiven","cleared","Promose","delCurrentUser","softDelAllMessages","handleExpirePeriodRequest","changeExpirePeriod","report","header","forwardedContent","mention","msgPreview","self_blocked","subscribed","p2p","keepForwardedMessage","confirmText","rejectText","invite","requestResetAuthSecret","newPassword","tempAuth","secret","dial","selectedCallback","aonly","videoCall","sdp","setCallTopic","upd","myUserName","onAddMember","handleManageGroupMembers","measurementId","gtag","dataLayer","prepend","messageLoader","hl","languages","normalized","baseLanguage","htmlLang","html","root","IntlProvider","textComponent"],"sourceRoot":""}